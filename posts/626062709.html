<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ROS基础知识 | がんばろう</title><meta name="author" content="今天睡够了吗"><meta name="copyright" content="今天睡够了吗"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="注意注意：可以直接学习ROS2，不用从ROS开始 代码模板c++ 模板 12345678910#include &quot;ros/ros.h&quot;int main(int argc, char *argv[]){    setlocale(LC_ALL,&quot;&quot;);    ros::init(argc,argv,&quot;&quot;);    ros::Nod">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS基础知识">
<meta property="og:url" content="http://yhblogs.cn/posts/626062709.html">
<meta property="og:site_name" content="がんばろう">
<meta property="og:description" content="注意注意：可以直接学习ROS2，不用从ROS开始 代码模板c++ 模板 12345678910#include &quot;ros/ros.h&quot;int main(int argc, char *argv[]){    setlocale(LC_ALL,&quot;&quot;);    ros::init(argc,argv,&quot;&quot;);    ros::Nod">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/ros-logo.png">
<meta property="article:published_time" content="2025-05-19T15:45:57.000Z">
<meta property="article:modified_time" content="2025-11-01T15:04:06.750Z">
<meta property="article:author" content="今天睡够了吗">
<meta property="article:tag" content="🤖ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/ros-logo.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yhblogs.cn/posts/626062709.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ROS基础知识',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-11-01 15:04:06'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_3319458_ks437t3n4r.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/b_2a1aef95f351a5f7ef72eb81e6838fd6.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-rili"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="がんばろう"><img class="site-icon" src="/img/favicon.png"><span class="site-name">がんばろう</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-rili"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">ROS基础知识</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-05-19T15:45:57.000Z" title="发表于 2025-05-19 15:45:57">2025-05-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">23.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>96分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ROS基础知识"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><p><font color="Violetred">注意注意</font>：可以直接学习ROS2，不用从ROS开始</p>
<h2 id="代码模板"><a href="#代码模板" class="headerlink" title="代码模板"></a>代码模板</h2><p>c++ 模板</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">""</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>python 模板</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	rospy.init_node(<span class="string">""</span>)</span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>

<h2 id="ROS环境搭建与初认识"><a href="#ROS环境搭建与初认识" class="headerlink" title="ROS环境搭建与初认识"></a>ROS环境搭建与初认识</h2><h3 id="ROS安装"><a href="#ROS安装" class="headerlink" title="ROS安装"></a>ROS安装</h3><p>具体细节看教程 <a target="_blank" rel="noopener" href="http://www.autolabor.com.cn/book/ROSTutorials/chapter1/12-roskai-fa-gong-ju-an-zhuang.html">1.2 ROS安装</a></p>
<p>采用虚拟机安装 ubuntu，再安装 ROS </p>
<p>虚拟机软件：<a target="_blank" rel="noopener" href="https://www.virtualbox.org/wiki/Downloads">virtualbox(免费)</a>  官网下载软件安装包以及拓展包</p>
<p>ubuntu版本：ubuntu-20.04.6  <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/">镜像文件下载地址</a></p>
<p>在下载过程中可能需要修改软件与更新中的下载自(以后安装库的时候经常会碰上)</p>
<p>在虚拟机中如果出现右键没有反应的情况，按住shift再点</p>
<p>ROS版本：Noetic</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-noetic-desktop-full</span><br></pre></td></tr></tbody></table></figure>

<p>配置环境变量，方便在任意终端中使用 ROS：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo "source /opt/ros/noetic/setup.bash" &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></tbody></table></figure>

<p>安装构建依赖：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-rosdep python3-rosinstall python3-rosinstall-generator python3-wstool build-essential</span><br></pre></td></tr></tbody></table></figure>

<p>测试ROS安装环境：</p>
<ol>
<li>启动三个命令行(ctrl + alt + T)</li>
<li>命令行1键入:<code>roscore</code></li>
<li>命令行2键入:<code>rosrun turtlesim turtlesim_node</code>(此时会弹出图形化界面)</li>
<li>命令行3键入:<code>rosrun turtlesim turtle_teleop_key</code>(可以控制小乌龟运动)</li>
</ol>
<p>以下命令行内容中[ ]包围的为替换内容</p>
<p>补充ubuntu创建右键快捷键方法：</p>
<ol>
<li>在用户主目录里找到“模板“文件夹</li>
<li>右键在终端打开，<code>sudo gedit 文本文件</code></li>
<li>保存，可在任何文件夹下创建文本文件了</li>
</ol>
<h3 id="ROS集成开发环境"><a href="#ROS集成开发环境" class="headerlink" title="ROS集成开发环境"></a>ROS集成开发环境</h3><p>在刚刚的过程会发现ubuntu频繁需要密码，打开terminal，输入seahorse，点击左上角➕号，新建一个空钥匙环，建立完成后设置为默认，打开一些软件不再提示输入密码了</p>
<h4 id="终端"><a href="#终端" class="headerlink" title="终端"></a>终端</h4><p>在 ROS 中，需要频繁的使用到终端，且可能需要同时开启多个窗口，推荐使用<strong>Terminator</strong></p>
<p>安装：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install terminator</span><br></pre></td></tr></tbody></table></figure>

<p>常用快捷键：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Alt+Up                          //移动到上面的终端</span><br><span class="line">Alt+Down                        //移动到下面的终端</span><br><span class="line">Alt+Left                        //移动到左边的终端</span><br><span class="line">Alt+Right                       //移动到右边的终端</span><br><span class="line">Ctrl+Shift+O                    //水平分割终端</span><br><span class="line">Ctrl+Shift+E                    //垂直分割终端</span><br></pre></td></tr></tbody></table></figure>

<h4 id="VScode"><a href="#VScode" class="headerlink" title="VScode"></a>VScode</h4><p>下载：<a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs?start=true%5B">vscode 下载</a>  选择适用于linux系统的.deb文件</p>
<p>安装：</p>
<ul>
<li>方式1：双击安装即可(或右击选择安装) [可能会出现没反应或闪退行为]</li>
<li>方式2：<code>sudo dpkg -i xxxx.deb</code> 复制具体的下载文件名称</li>
</ul>
<p>vscode 下载插件：c++，CMake，python，ROS</p>
<p>快捷键配置：向上向下复制行；向上向下移动</p>
<p>vscode 使用_基本配置：</p>
<ol>
<li><p>创建 ROS 工作空间</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p [工作空间名称]/src(必须得有 src)</span><br><span class="line">cd [工作空间名称]</span><br><span class="line">catkin_make</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>启动 vscode</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code .</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>vscode 中编译 ros</p>
<p>快捷键 ctrl + shift + B 调用编译，选择<code>catkin_make:build</code>右边的小齿轮配置</p>
<p>修改<code>.vscode/tasks.json </code>文件</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"2.0.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"tasks"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"label"</span><span class="punctuation">:</span> <span class="string">"catkin_make:debug"</span><span class="punctuation">,</span> <span class="comment">//代表提示的描述性信息</span></span><br><span class="line">            <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"shell"</span><span class="punctuation">,</span>  <span class="comment">//可以选择shell或者process,如果是shell代码是在shell里面运行一个命令，如果是process代表作为一个进程来运行</span></span><br><span class="line">            <span class="attr">"command"</span><span class="punctuation">:</span> <span class="string">"catkin_make"</span><span class="punctuation">,</span><span class="comment">//这个是我们需要运行的命令</span></span><br><span class="line">            <span class="attr">"args"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//如果需要在命令后面加一些后缀，可以写在这里，比如-DCATKIN_WHITELIST_PACKAGES=“pac1;pac2”</span></span><br><span class="line">            <span class="attr">"group"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="attr">"kind"</span><span class="punctuation">:</span><span class="string">"build"</span><span class="punctuation">,</span><span class="attr">"isDefault"</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"presentation"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"reveal"</span><span class="punctuation">:</span> <span class="string">"always"</span><span class="comment">//可选always或者silence，代表是否输出信息</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"problemMatcher"</span><span class="punctuation">:</span> <span class="string">"$msCompile"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>创建 ROS 功能包</p>
<p><font color="Violetred">选定 src 右击 —&gt; create catkin package</font></p>
<p>设置包名(helloworld) 添加依赖(roscpp rospy std_msgs)</p>
</li>
<li><p>C++ 实现</p>
<p>在功能包的 src 下新建 cpp 文件</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 解决中文乱码</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"hello_c"</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"hello vscode"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如果没有代码提示</p>
<p>修改 <code>.vscode/c_cpp_properties.json</code>，设置 “cppStandard”: “c++17”</p>
<p>则ctrl+shift+空格提示函数格式</p>
</li>
<li><p>python 实现</p>
<p>在 功能包 下新建 scripts 文件夹，添加 python 文件</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"hello_p"</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">"hello vscode! it's python"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><font color="Violetred">在scripts文件夹下打开终端</font>并添加可执行权限</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x *.py</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>配置 CMakeLists.txt</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">add_executable([自定义名称]</span><br><span class="line">  src/helloworld_c.cpp</span><br><span class="line">)</span><br><span class="line">target_link_libraries([自定义名称]</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">catkin_install_python(PROGRAMS scripts/[文件名].py</span><br><span class="line">  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>编译执行</p>
<p>编译：ctrl + shift + B</p>
<p>执行：在 VScode 中添加终端</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ./devel/setup.bash</span><br></pre></td></tr></tbody></table></figure>

<p>c++：rosrun [包名] [<font color="Violetred">自定义名称</font>]</p>
<p>python：rosrun [包名] [<font color="Violetred">文件名称</font>]</p>
<p>如果不编译直接执行 python 文件，会抛出异常</p>
<p>解决方案：</p>
<ol>
<li>第一行解释器声明，可以使用绝对路径定位到 python3 的安装路径 #! /usr/bin/python3(不建议)</li>
<li>创建一个链接符号到 python 命令：<code>sudo ln -s /usr/bin/python3 /usr/bin/python</code>(建议)</li>
</ol>
</li>
</ol>
<h4 id="launch文件"><a href="#launch文件" class="headerlink" title="launch文件"></a>launch文件</h4><p>解决需要启动多个节点的效率问题</p>
<p>实现：</p>
<ol>
<li><p>选定功能包右击 —&gt; 添加 launch 文件夹</p>
</li>
<li><p>选定 launch 文件夹右击 —&gt; 添加 launch 文件</p>
</li>
<li><p>编辑 launch 文件内容</p>
<p>以小乌龟示例程序启动为例：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 乌龟GUI --&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="turtle_GUI" /&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtle_teleop_key" name="turtle_key" /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>node —&gt; 包含的某个节点</li>
<li>pkg —–&gt; 功能包</li>
<li>type —-&gt; 被运行的节点文件</li>
<li>name –&gt; 为节点命名</li>
<li>output-&gt; 设置日志的输出目标</li>
</ul>
</li>
<li><p>运行 launch 文件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch [功能包名] [launch文件名]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>运行结果：一次性启动了多个节点</p>
</li>
</ol>
<h3 id="ROS架构"><a href="#ROS架构" class="headerlink" title="ROS架构"></a>ROS架构</h3><h4 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h4><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/ROS_file.jpg" alt="ROS_file">

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">WorkSpace --- 自定义的工作空间</span><br><span class="line"></span><br><span class="line">    |--- build:编译空间，用于存放CMake和catkin的缓存信息、配置信息和其他中间文件。</span><br><span class="line"></span><br><span class="line">    |--- devel:开发空间，用于存放编译后生成的目标文件，包括头文件、动态&amp;静态链接库、可执行文件等。</span><br><span class="line"></span><br><span class="line">    |--- src: 源码</span><br><span class="line"></span><br><span class="line">        |-- package：功能包(ROS基本单元)包含多个节点、库与配置文件，包名所有字母小写，只能由字母、数字与下划线组成</span><br><span class="line"></span><br><span class="line">            |-- CMakeLists.txt 配置编译规则，比如源文件、依赖项、目标文件</span><br><span class="line"></span><br><span class="line">            |-- package.xml 包信息，比如:包名、版本、作者、依赖项...(以前版本是 manifest.xml)</span><br><span class="line"></span><br><span class="line">            |-- scripts 存储python文件</span><br><span class="line"></span><br><span class="line">            |-- src 存储C++源文件</span><br><span class="line"></span><br><span class="line">            |-- include 头文件</span><br><span class="line"></span><br><span class="line">            |-- msg 消息通信格式文件</span><br><span class="line"></span><br><span class="line">            |-- srv 服务通信格式文件</span><br><span class="line"></span><br><span class="line">            |-- action 动作格式文件</span><br><span class="line"></span><br><span class="line">            |-- launch 可一次性运行多个节点 </span><br><span class="line"></span><br><span class="line">            |-- config 配置信息</span><br><span class="line"></span><br><span class="line">        |-- CMakeLists.txt: 编译的基本配置</span><br></pre></td></tr></tbody></table></figure>

<h4 id="文件系统相关命令"><a href="#文件系统相关命令" class="headerlink" title="文件系统相关命令"></a>文件系统相关命令</h4><ol>
<li><p>增</p>
<p>catkin_create_pkg 自定义包名 依赖包 === 创建新的ROS功能包</p>
<p>sudo apt install xxx === 安装 ROS功能包</p>
</li>
<li><p>删</p>
<p>sudo apt purge xxx === 删除某个功能包</p>
</li>
<li><p>查</p>
<p>rospack list === 列出所有功能包</p>
<p>rospack find 包名 === 查找某个功能包是否存在，如果存在返回安装路径</p>
<p>roscd 包名 === 进入某个功能包</p>
<p>rosls 包名 === 列出某个包下的文件</p>
<p>apt search xxx === 搜索某个功能包</p>
</li>
<li><p>rosed 包名 文件名 === 修改功能包文件</p>
<p>需要安装 vim</p>
<p>比如:rosed turtlesim Color.msg</p>
</li>
<li><p>执行</p>
<p>roscore === 是 ROS 的系统先决条件节点和程序的集合， 必须运行 roscore 才能使 ROS 节点进行通信</p>
<p>roscore 将启动:</p>
<ul>
<li>ros master</li>
<li>ros 参数服务器</li>
<li>rosout 日志节点</li>
</ul>
<p>rosrun 包名 可执行文件名 === 运行指定的ROS节点</p>
<p>比如:<code>rosrun turtlesim turtlesim_node</code></p>
<p>roslaunch 包名 launch文件名 === 执行某个包下的 launch 文件</p>
</li>
</ol>
<h4 id="计算图"><a href="#计算图" class="headerlink" title="计算图"></a>计算图</h4><p>rqt_graph能够创建一个显示当前系统运行情况的动态图形</p>
<p>计算图可以以点对点的网络形式表现数据交互过程</p>
<p>运行程序后，启动新终端，键入:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rqt_graph</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun rqt_graph rqt_graph</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到网络拓扑图，显示不同节点之间的关系</p>
<h2 id="ROS通信机制"><a href="#ROS通信机制" class="headerlink" title="ROS通信机制"></a>ROS通信机制</h2><h3 id="话题通信"><a href="#话题通信" class="headerlink" title="话题通信"></a>话题通信</h3><p>话题通信是ROS中使用频率最高的一种通信模式，基于<strong>发布订阅</strong>模式，即一个节点发布消息，另一个节点订阅该消息</p>
<p>以激光雷达信息的采集处理为例，在 ROS 中有一个节点需要时时的发布当前雷达采集到的数据，导航模块中也有节点会订阅并解析雷达数据</p>
<p>以此类推，像雷达、摄像头、GPS…. 等等一些传感器数据的采集都使用了话题通信</p>
<p><font color="Violetred">话题通信适用于不断更新、少逻辑处理的数据传输场景</font></p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/image-20250519215104543_compressed (1).webp" alt="image-20250519215104543_compressed (1)" style="zoom:67%;">

<ul>
<li>在工作空间下功能包中，基本每一个可执行文件都会初始化一个节点(node)，并唯一命名</li>
<li>节点之间通过话题(topic)进行通信</li>
<li>话题类型就是发布的消息(msg)</li>
<li>传输的内容需要关注消息类型</li>
</ul>
<h4 id="普通文本"><a href="#普通文本" class="headerlink" title="普通文本"></a>普通文本</h4><p>需求: 实现基本的话题通信，一方发布数据，一方接收数据</p>
<p><strong>c++实现</strong></p>
<p>在模型实现中，ROS master 不需要实现，而连接的建立也已经被封装了，需要关注：</p>
<ol>
<li>发布方</li>
<li>接收方</li>
<li>数据</li>
</ol>
<p>发布方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/String.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    发布方实现：</span></span><br><span class="line"><span class="comment">        1.包含头文件 </span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="comment">        3.创建节点句柄</span></span><br><span class="line"><span class="comment">        4.创建发布者对象</span></span><br><span class="line"><span class="comment">        5.编写发布逻辑并发布数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{   </span><br><span class="line">    <span class="comment">// 设置编码格式</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"talker"</span>);</span><br><span class="line">    <span class="comment">// 3.创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh; <span class="comment">//该类封装了 ROS 中的一些常用功能</span></span><br><span class="line">    <span class="comment">// 4.创建发布者对象</span></span><br><span class="line">    <span class="comment">//泛型: 发布的消息类型</span></span><br><span class="line">    <span class="comment">//参数1: 要发布到的话题</span></span><br><span class="line">    <span class="comment">//参数2: 队列中最大保存的消息数，超出此阀值时，早接受到的销毁</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">"chatter"</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 5.编写发布逻辑并发布数据</span></span><br><span class="line">    <span class="comment">// 创建发布消息</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    <span class="comment">// 分布频率</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span> <span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="comment">// 设置编号</span></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 编写循环</span></span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 实现字符串拼接</span></span><br><span class="line">        std::stringstream ss;</span><br><span class="line">        ss &lt;&lt; <span class="string">"hello ---"</span>&lt;&lt; count;</span><br><span class="line">        msg.data = ss.<span class="built_in">str</span>();</span><br><span class="line">        pub.<span class="built_in">publish</span>(msg);</span><br><span class="line">        <span class="comment">//  添加日志</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"发布的数据: %s"</span>,ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">        count++;</span><br><span class="line">        <span class="comment">//根据前面制定的发送频率自动休眠</span></span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>(); </span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>接收方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/String.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    订阅方实现：</span></span><br><span class="line"><span class="comment">        1.包含头文件 </span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="comment">        3.创建节点句柄</span></span><br><span class="line"><span class="comment">        4.创建订阅者对象</span></span><br><span class="line"><span class="comment">        5.处理订阅数据</span></span><br><span class="line"><span class="comment">        6.设置循环调用回调函数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doMsg</span><span class="params">(<span class="type">const</span> std_msgs::String::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"我听见: %s"</span>,msg-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 设置编码格式</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"listener"</span>);</span><br><span class="line">    <span class="comment">// 3.创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建订阅者对象</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">"chatter"</span>,<span class="number">10</span>,doMsg);</span><br><span class="line">    <span class="comment">// 5.处理订阅数据</span></span><br><span class="line">    ros::<span class="built_in">spin</span>(); <span class="comment">// 循环读取接收的数据，并调用回调函数处理</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p><code>ConstPtr</code> 是 <code>boost::shared_ptr</code>（智能指针），即 <code>msg</code> 是一个<strong>指针</strong></p>
<p>必须用 <code>-&gt;</code> 访问其成员的 <code>data</code> 字段</p>
</blockquote>
<p>配置CmakeList.txt</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add_executable(demo01_pub src/demo01_pub.cpp)</span><br><span class="line">add_executable(demo02_sub src/demo02_sub.cpp)</span><br><span class="line">target_link_libraries(demo01_pub</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">target_link_libraries(demo02_sub</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>vscode 中的 main 函数 声明 <code>int main(int argc, char const *argv[]){}</code>，默认生成 argv 被 const 修饰，需要去除该修饰符</p>
<p><strong>python实现</strong></p>
<p>发布方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="string">""" </span></span><br><span class="line"><span class="string">实现流程:</span></span><br><span class="line"><span class="string">    1.导包 </span></span><br><span class="line"><span class="string">    2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="string">    3.实例化 发布者 对象</span></span><br><span class="line"><span class="string">    4.组织被发布的数据，并编写逻辑发布数据</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment">#2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    rospy.init_node(<span class="string">"talker_p"</span>)</span><br><span class="line">    <span class="comment">#3.实例化 发布者 对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">"chatter_p"</span>,String,queue_size= <span class="number">10</span> )</span><br><span class="line">    <span class="comment">#4.组织被发布的数据，并编写逻辑发布数据</span></span><br><span class="line">    msg = String()</span><br><span class="line">    <span class="comment">#指定发布频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#设置计数器</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="comment">#循环发布数据</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">        msg.data = <span class="string">"hello---"</span>+<span class="built_in">str</span>(count)</span><br><span class="line">        <span class="comment">#发布数据</span></span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rate.sleep()</span><br><span class="line">        rospy.loginfo(<span class="string">"写入的数据：%s"</span>,msg.data)</span><br></pre></td></tr></tbody></table></figure>

<p>订阅方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="string">""" </span></span><br><span class="line"><span class="string">    实现流程:</span></span><br><span class="line"><span class="string">        1.导包 </span></span><br><span class="line"><span class="string">        2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="string">        3.实例化 订阅者 对象</span></span><br><span class="line"><span class="string">        4.处理订阅的消息(回调函数)</span></span><br><span class="line"><span class="string">        5.设置循环调用回调函数</span></span><br><span class="line"><span class="string"> """</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doMsg</span>(<span class="params">msg</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">"I heard:%s"</span>,msg.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    rospy.init_node(<span class="string">"listener_p"</span>)</span><br><span class="line">    <span class="comment"># 3.实例化 订阅者 对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">"chatter_p"</span>,String,doMsg,queue_size=<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># 4.处理订阅的消息(回调函数)  </span></span><br><span class="line">    <span class="comment"># 5.设置循环调用回调函数   </span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></tbody></table></figure>

<p>添加可执行权限</p>
<p>终端下进入 scripts 执行：<code>chmod +x *.py</code></p>
<p>配置 CMakeLists.txt：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS</span><br><span class="line">  scripts/demo01_pub_p.py</span><br><span class="line">  scripts/demo02_sub_p.py</span><br><span class="line">  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="自定义msg"><a href="#自定义msg" class="headerlink" title="自定义msg"></a>自定义msg</h4><p>msgs只是简单的文本文件，每行具有字段类型和字段名称</p>
<p>如果需要自定义消息类型，则需要自定义msg</p>
<p>流程：</p>
<ol>
<li>按照固定格式创建 msg 文件</li>
<li>编辑配置文件</li>
<li>编译生成可以被 Python 或 C++ 调用的中间文件</li>
</ol>
<p>创建自定义消息</p>
<ol>
<li><p>定义msg文件</p>
<p>功能包下新建 msg 目录，添加文件 Person.msg</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint16 age</span><br><span class="line">float64 height</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>编辑配置文件</p>
<p><strong>package.xml</strong>中添加编译依赖与执行依赖</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;message_generation&lt;/build_depend&gt;</span><br><span class="line">&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>CMakeLists.txt</strong>编辑 msg 相关配置</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"># 需要加入 message_generation,必须有 std_msgs</span><br><span class="line">...</span><br><span class="line"># 配置 msg 源文件</span><br><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Person.msg</span><br><span class="line">)</span><br><span class="line">...</span><br><span class="line"># 执行时依赖</span><br><span class="line">catkin_package(</span><br><span class="line">#  INCLUDE_DIRS include</span><br><span class="line">#  LIBRARIES demo02_talker_listener</span><br><span class="line">  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line">#  DEPENDS system_lib</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>编译依赖find_package内的包</p>
<p>find_package依赖catkin_package内的包</p>
<p>如果catkin_package内的包不对，可能编译成功但运行失败</p>
</li>
<li><p>编译</p>
<p>编译后查看</p>
<p>C++ 需要调用的中间文件(…/工作空间/devel/include/包名/xxx.h)</p>
<p>Python 需要调用的中间文件(…/工作空间/devel/lib/python3/msg/xxx.py)</p>
</li>
</ol>
<p><strong>c++实现</strong></p>
<p>需要先配置 vscode，将前面生成的 head 文件路径配置进 c_cpp_properties.json 的 includepath属性</p>
<p>发布方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"plumbing_pub_sub/Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"发布方："</span>);</span><br><span class="line"></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"talker_person"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;plumbing_pub_sub::Person&gt;(<span class="string">"chatter_person"</span>,<span class="number">1000</span>);</span><br><span class="line">    plumbing_pub_sub::Person p;</span><br><span class="line">    p.name = <span class="string">"孙悟空"</span>;</span><br><span class="line">    p.age = <span class="number">2000</span>;</span><br><span class="line">    p.height = <span class="number">1.45</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    {</span><br><span class="line">        pub.<span class="built_in">publish</span>(p);</span><br><span class="line">        p.age += <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"我叫:%s,今年%d岁,高%.2f米"</span>, p.name.<span class="built_in">c_str</span>(), p.age, p.height);</span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>订阅方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"plumbing_pub_sub/Person.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPerson</span><span class="params">(<span class="type">const</span> plumbing_pub_sub::Person::ConstPtr&amp; person)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"订阅的人信息:%s,%d,%.2f"</span>,person-&gt;name.<span class="built_in">c_str</span>(),person-&gt;age,person-&gt;height);</span><br><span class="line">} </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"订阅方："</span>);</span><br><span class="line"></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"listener_person"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">"chatter_person"</span>,<span class="number">1000</span>,doPerson);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>配置CMakeList：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">add_executable(person_talker src/person_talker.cpp)</span><br><span class="line">add_executable(person_listener src/person_listener.cpp)</span><br><span class="line"></span><br><span class="line">// 额外配置，避免编译报错</span><br><span class="line">## Add cmake target dependencies of the executable</span><br><span class="line">## same as for the library above</span><br><span class="line">add_dependencies(person_talker ${PROJECT_NAME}_generate_messages_cpp)</span><br><span class="line">add_dependencies(person_listener ${PROJECT_NAME}_generate_messages_cpp)</span><br><span class="line"></span><br><span class="line">target_link_libraries(person_talker</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br><span class="line">target_link_libraries(person_listener</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>add_dependencies如果考虑简单，可以仅将注释的内容</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># add_dependencies(${PROJECT_NAME}_node ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})</span><br></pre></td></tr></tbody></table></figure>

<p>中<code>${PROJECT_NAME}_node</code>处改为节点名称，其它保留原来格式也是可以的</p>
</blockquote>
<p><strong>python实现</strong></p>
<p>将前面生成的 python 文件路径配置进 settings.json</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">"python.autoComplete.extraPaths"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">"/opt/ros/noetic/lib/python3/dist-packages"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">"/home/ros/demo03_ws/devel/lib/python3/dist-packages"</span> <span class="comment">//添加的</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure>

<p>发布方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> plumbing_pub_sub.msg <span class="keyword">import</span>  Person</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"talker_person_p"</span>)</span><br><span class="line">    pub = rospy.Publisher(<span class="string">"chatter_person"</span>,Person,queue_size=<span class="number">1000</span>)</span><br><span class="line">    p = Person()</span><br><span class="line">    p.name = <span class="string">"葫芦娃"</span></span><br><span class="line">    p.age = <span class="number">18</span></span><br><span class="line">    p.height =<span class="number">0.75</span></span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        pub.publish(p)</span><br><span class="line">        rate.sleep()</span><br><span class="line">        rospy.loginfo(<span class="string">"姓名:%s, 年龄:%d, 身高:%.2f"</span>,p.name,p.age,p.height)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>订阅方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> plumbing_pub_sub.msg <span class="keyword">import</span>  Person</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doPerson</span>(<span class="params">p</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">"订阅信息：%s,%d,%.2f"</span>,p.name,p.age,p.height)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"listener_person_p"</span>)</span><br><span class="line">    sub = rospy.Subscriber(<span class="string">"chatter_person"</span>,Person,doPerson,queue_size=<span class="number">1000</span>)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></tbody></table></figure>

<p>终端下进入 scripts 执行:<code>chmod +x *.py</code></p>
<p>配置 CMakeLists.txt：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS</span><br><span class="line">  scripts/talker_p.py</span><br><span class="line">  scripts/listener_p.py</span><br><span class="line">  scripts/person_talker.py</span><br><span class="line">  scripts/person_listener.py</span><br><span class="line">  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="服务通信"><a href="#服务通信" class="headerlink" title="服务通信"></a>服务通信</h3><p>服务通信也是ROS中一种极其常用的通信模式，服务通信是基于<strong>请求响应</strong>模式的，是一种应答机制</p>
<p>即一个节点A向另一个节点B发送请求，B接收处理请求并产生响应结果返回给A</p>
<p>服务通信更适用于对时时性有要求、具有一定逻辑处理的应用场景</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/Snipaste_2025-05-22_16-29-54_compressed.webp" alt="Snipaste_2025-05-22_16-29-54_compressed" style="zoom: 67%;">

<p>案例：</p>
<p>实现两个数字的求和，客户端节点，运行会向服务器发送两个数字，服务器端节点接收两个数字求和并将结果响应回客户端</p>
<h4 id="自定义srv"><a href="#自定义srv" class="headerlink" title="自定义srv"></a>自定义srv</h4><p>srv 文件内的可用数据类型与 msg 文件一致，且定义 srv 实现流程与自定义 msg 实现流程类似:</p>
<ol>
<li>按照固定格式创建srv文件</li>
<li>编辑配置文件</li>
<li>编译生成中间文件</li>
</ol>
<p>流程：</p>
<ol>
<li><p>定义srv文件</p>
<p>功能包下新建 srv 目录，添加 xxx.srv 文件，请求和响应数据类型之间用<code>---</code>分开</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 客户端请求时发送的两个数字</span><br><span class="line">int32 num1</span><br><span class="line">int32 num2</span><br><span class="line">---</span><br><span class="line"># 服务器响应发送的数据</span><br><span class="line">int32 sum</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>编译配置文件</p>
<p><strong>package.xml</strong>中添加编译依赖与执行依赖</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;message_generation&lt;/build_depend&gt;</span><br><span class="line">&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>同话题通信自定义</p>
<p><strong>CMakeLists.txt</strong>编辑 srv 相关配置</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"># 需要加入 message_generation,必须有 std_msgs</span><br><span class="line"></span><br><span class="line">add_service_files(</span><br><span class="line">  FILES</span><br><span class="line">  AddInts.srv</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>官网示例没有在 catkin_package 中配置 message_runtime，经测试配置也可以</p>
</li>
<li><p>编译，查看包方式同之前</p>
</li>
</ol>
<p>需要先配置 vscode，将前面生成的 head 文件路径配置进 c_cpp_properties.json 的 includepath属性</p>
<pre><code>  "includePath": [
    "/opt/ros/noetic/include/**",
    "/usr/include/**",
    "/home/ros/demo03_ws/devel/include/**" //增加的
  ],
</code></pre>
<p><strong>c++</strong></p>
<p>服务端：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    服务器实现:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建 服务 对象</span></span><br><span class="line"><span class="comment">        5.回调函数处理请求并产生响应</span></span><br><span class="line"><span class="comment">        6.由于请求有多个，需要调用 ros::spin()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"plumbing_server_client/AddInts.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">doNums</span><span class="params">(plumbing_server_client::AddInts::Request &amp;req,</span></span></span><br><span class="line"><span class="params"><span class="function">            plumbing_server_client::AddInts::Response &amp;resp)</span></span>{</span><br><span class="line">    <span class="type">int</span> num1 = req.num1;</span><br><span class="line">    <span class="type">int</span> num2 = req.num2;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"服务器接收到的数据为: num1 = %d,num2 = %d"</span>,num1,num2);</span><br><span class="line">    <span class="type">int</span> sum = num1 + num2 ;</span><br><span class="line">    resp.sum = sum;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"处理结果: sum = %d"</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"服务器启动"</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"AddInts_Server"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceServer server = nh.<span class="built_in">advertiseService</span>(<span class="string">"AddInts"</span>,doNums);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>服务端的回调函数的参数是 <code>demo03_server_client::AddInts::Request&amp; req</code>，没有<code>ConstPtr</code>， <code>req</code> 是请求对象的<strong>引用</strong>，不是指针</p>
<p>引用 (<code>req</code>) 的行为和对象实例一致，直接用 <code>.</code> 访问成员，因为服务是“一问一答”模式，不需要共享所有权，直接修改传入的请求和响应对象即可</p>
<p>话题通信中将接收到的消息封装为 <code>boost::shared_ptr</code>（智能指针）传递给回调函数，目的是为了高效管理内存（避免拷贝）</p>
</blockquote>
<p>客户端：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    服务器实现:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建 客户端 对象</span></span><br><span class="line"><span class="comment">        5.请求服务，接收响应</span></span><br><span class="line"><span class="comment">    实现参数的动态提交：</span></span><br><span class="line"><span class="comment">        1. 格式 rosrun ..... (参数)</span></span><br><span class="line"><span class="comment">        2. 节点执行时，需要获取命令中的参数，并组织进 request</span></span><br><span class="line"><span class="comment">    问题：</span></span><br><span class="line"><span class="comment">        如果先启动客户端，会请求异常</span></span><br><span class="line"><span class="comment">    需求：</span></span><br><span class="line"><span class="comment">        先启动客户端，不直接抛出异常，挂起，等待服务器启动再请求</span></span><br><span class="line"><span class="comment">    解决：</span></span><br><span class="line"><span class="comment">        ROS中内置函数，可以让客户端启动后挂起等待</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"plumbing_server_client/AddInts.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    <span class="comment">// 优化实现，获取命令中的参数</span></span><br><span class="line">    <span class="comment">// 如果不传递任何ROS参数，argc 的值为 1（只有程序名本身）</span></span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">3</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"提交的参数个数不对"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"AddInts_Client"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;plumbing_server_client::AddInts&gt;(<span class="string">"AddInts"</span>);</span><br><span class="line">    <span class="comment">// 5.请求服务，接收响应</span></span><br><span class="line">    plumbing_server_client::AddInts ai;</span><br><span class="line">    <span class="comment">// 组织请求</span></span><br><span class="line">    ai.request.num1 = <span class="built_in">atoi</span>(argv[<span class="number">1</span>]);</span><br><span class="line">    ai.request.num2 = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="comment">// 处理响应</span></span><br><span class="line">    <span class="comment">// 函数1，等到服务启动后才继续</span></span><br><span class="line">    <span class="comment">// client.waitForExistence();</span></span><br><span class="line">    <span class="comment">// 函数2，需要传入具体的服务话题</span></span><br><span class="line">    ros::service::<span class="built_in">waitForService</span>(<span class="string">"AddInts"</span>); </span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(ai);</span><br><span class="line">    <span class="keyword">if</span>(flag)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"响应成功"</span>);</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"响应结果 = %d"</span>,ai.response.sum);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"响应失败"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>配置CMakeLists</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add_executable(AddInts_Server src/AddInts_Server.cpp)</span><br><span class="line">add_executable(AddInts_Client src/AddInts_Client.cpp)</span><br><span class="line"></span><br><span class="line">add_dependencies(AddInts_Server ${PROJECT_NAME}_gencpp)</span><br><span class="line">add_dependencies(AddInts_Client ${PROJECT_NAME}_gencpp)</span><br><span class="line"></span><br><span class="line">target_link_libraries(AddInts_Server</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br><span class="line">target_link_libraries(AddInts_Client</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<p>服务端：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> plumbing_server_client.srv <span class="keyword">import</span> AddInts,AddIntsRequest,AddIntsResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doReq</span>(<span class="params">req</span>):</span><br><span class="line">    num1 = req.num1</span><br><span class="line">    num2 = req.num2</span><br><span class="line">    <span class="built_in">sum</span> = num1 + num2</span><br><span class="line">    resp = AddIntsResponse()</span><br><span class="line">    resp.<span class="built_in">sum</span> = <span class="built_in">sum</span></span><br><span class="line">    rospy.loginfo(<span class="string">"服务器解析结果:%d"</span>,<span class="built_in">sum</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"AddInts_Server_p"</span>)</span><br><span class="line">    server = rospy.Service(<span class="string">"AddInts"</span>,AddInts,doReq)</span><br><span class="line">    rospy.loginfo(<span class="string">"服务器启动"</span>)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></tbody></table></figure>

<p>客户端：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> plumbing_server_client.srv <span class="keyword">import</span> AddInts,AddIntsRequest,AddIntsResponse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment">#优化实现</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:</span><br><span class="line">        rospy.logerr(<span class="string">"请正确提交参数"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    rospy.init_node(<span class="string">"AddInts_Client_p"</span>)</span><br><span class="line">    client = rospy.ServiceProxy(<span class="string">"AddInts"</span>,AddInts)</span><br><span class="line">    client.wait_for_service()</span><br><span class="line">    req = AddIntsRequest()</span><br><span class="line">    req.num1 = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">    req.num2 = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    resp = client.call(req)</span><br><span class="line">    rospy.loginfo(<span class="string">"响应结果:%d"</span>,resp.<span class="built_in">sum</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>配置CMakeLists</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS</span><br><span class="line">  scripts/demo01_server_p.py</span><br><span class="line">  scripts/demo02_client_p.py</span><br><span class="line">  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="参数服务器"><a href="#参数服务器" class="headerlink" title="参数服务器"></a>参数服务器</h3><p>以共享的方式实现不同节点之间数据交互的通信模式，存储一些多节点共享的数据，类似于全局变量。</p>
<p>案例：实现参数增删改查操作</p>
<p>ROS Master 作为一个公共容器保存参数，Talker 可以向容器中设置参数，Listener 可以获取参数</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/03ROS通信机制03_参数服务器.jpg" alt="03ROS通信机制03_参数服务器" style="zoom: 67%;">

<blockquote>
<p>注意：参数服务器不是为高性能而设计的，因此最好用于存储静态的非二进制的简单数据</p>
</blockquote>
<p><strong>c++</strong></p>
<ul>
<li>参数服务器新增(修改)参数</li>
</ul>
<p>实现参数服务器数据的增删改查，可以通过两套 API 实现:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*   </span></span><br><span class="line"><span class="comment">	ros::NodeHandle</span></span><br><span class="line"><span class="comment">        setParam("键","值")</span></span><br><span class="line"><span class="comment">    ros::param</span></span><br><span class="line"><span class="comment">        set("键","值")</span></span><br><span class="line"><span class="comment">*/</span>        </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"set_param_c"</span>);</span><br><span class="line">    std::vector&lt;std::string&gt; stus;</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">"zhangsan"</span>);</span><br><span class="line">    stus.<span class="built_in">push_back</span>(<span class="string">"lisi"</span>);</span><br><span class="line"></span><br><span class="line">    std::map&lt;std::string,std::string&gt; friends;</span><br><span class="line">    friends[<span class="string">"guo"</span>] = <span class="string">"huang"</span>;</span><br><span class="line">    friends[<span class="string">"yuang"</span>] = <span class="string">"xiao"</span>;</span><br><span class="line">    <span class="comment">//NodeHandle--------------------------------------------------------</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_int"</span>,<span class="number">10</span>); <span class="comment">//整型</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_double"</span>,<span class="number">3.14</span>); <span class="comment">//浮点型</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_bool"</span>,<span class="literal">true</span>); <span class="comment">//bool</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_string"</span>,<span class="string">"hello NodeHandle"</span>); <span class="comment">//字符串</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_vector"</span>,stus); <span class="comment">// vector</span></span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"nh_map"</span>,friends); <span class="comment">// map</span></span><br><span class="line">    <span class="comment">//param--------------------------------------------------------</span></span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_int"</span>,<span class="number">20</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_double"</span>,<span class="number">3.14</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_string"</span>,<span class="string">"Hello Param"</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_bool"</span>,<span class="literal">false</span>);</span><br><span class="line">    ros::param::<span class="built_in">set</span>(<span class="string">"param_vector"</span>,stus);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>参数服务器获取参数</li>
</ul>
<p>在 roscpp 中提供了两套 API 实现参数操作</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">	ros::NodeHandle</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        param(键,默认值) </span></span><br><span class="line"><span class="comment">            存在，返回对应结果，否则返回默认值</span></span><br><span class="line"><span class="comment">				int res1 = nh.param("nh_int",100); </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParam(键,存储结果的变量)</span></span><br><span class="line"><span class="comment">            存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">            如果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment">				nh.getParam("nh_int",nh_int_value);</span></span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">        getParamCached(键,存储结果的变量)--提高变量获取效率</span></span><br><span class="line"><span class="comment">            存在,返回 true,且将值赋值给参数2</span></span><br><span class="line"><span class="comment">            如果键不存在，那么返回值为 false，且不为参数2赋值</span></span><br><span class="line"><span class="comment">			    nh.getParamCached("nh_int",nh_int_value);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        getParamNames(std::vector&lt;std::string&gt;)</span></span><br><span class="line"><span class="comment">            获取所有的键,并存储在参数 vector 中 </span></span><br><span class="line"><span class="comment">                std::vector&lt;std::string&gt; param_names;</span></span><br><span class="line"><span class="comment">                nh.getParamNames(param_names);</span></span><br><span class="line"><span class="comment">                for (auto &amp;&amp;name : param_names)</span></span><br><span class="line"><span class="comment">                {</span></span><br><span class="line"><span class="comment">                    ROS_INFO("名称解析name = %s",name.c_str());   </span></span><br><span class="line"><span class="comment">                }</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        hasParam(键)</span></span><br><span class="line"><span class="comment">        是否包含某个键，存在返回 true，否则返回 false</span></span><br><span class="line"><span class="comment">			ROS_INFO("存在 nh_int 吗? %d",nh.hasParam("nh_int"));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        searchParam(参数1，参数2)</span></span><br><span class="line"><span class="comment">            搜索键，参数1是被搜索的键，参数2存储搜索结果的变量</span></span><br><span class="line"><span class="comment">                nh.searchParam("nh_int",key);</span></span><br><span class="line"><span class="comment">                ROS_INFO("搜索键:%s",key.c_str());</span></span><br><span class="line"><span class="comment">                -&gt; 搜索键:/nh_int</span></span><br><span class="line"><span class="comment">                </span></span><br><span class="line"><span class="comment">    ros::param ----- 与 NodeHandle 类似</span></span><br><span class="line"><span class="comment">*/</span> </span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>参数服务器删除参数</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    ros::NodeHandle</span></span><br><span class="line"><span class="comment">        deleteParam("键")</span></span><br><span class="line"><span class="comment">        根据键删除参数，删除成功，返回 true，否则(参数不存在)，返回 false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ros::param</span></span><br><span class="line"><span class="comment">        del("键")</span></span><br><span class="line"><span class="comment">        根据键删除参数，删除成功，返回 true，否则(参数不存在)，返回 false</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<ul>
<li>参数服务器新增(修改)参数</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"set_update_paramter_p"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置各种类型参数</span></span><br><span class="line">    rospy.set_param(<span class="string">"p_int"</span>,<span class="number">10</span>)</span><br><span class="line">    rospy.set_param(<span class="string">"p_double"</span>,<span class="number">3.14</span>)</span><br><span class="line">    rospy.set_param(<span class="string">"p_bool"</span>,<span class="literal">True</span>)</span><br><span class="line">    rospy.set_param(<span class="string">"p_string"</span>,<span class="string">"hello python"</span>)</span><br><span class="line">    rospy.set_param(<span class="string">"p_list"</span>,[<span class="string">"hello"</span>,<span class="string">"haha"</span>,<span class="string">"xixi"</span>])</span><br><span class="line">    rospy.set_param(<span class="string">"p_dict"</span>,{<span class="string">"name"</span>:<span class="string">"hulu"</span>,<span class="string">"age"</span>:<span class="number">8</span>})</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改</span></span><br><span class="line">    rospy.set_param(<span class="string">"p_int"</span>,<span class="number">100</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>参数服务器获取参数</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">	rospy.init_node("get_param_p")</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数服务器操作之查询_Python实现:    </span></span><br><span class="line"><span class="string">        get_param(键,默认值)</span></span><br><span class="line"><span class="string">            当键存在时，返回对应的值，如果不存在返回默认值</span></span><br><span class="line"><span class="string">            	int_value = rospy.get_param("p_int",10000)</span></span><br><span class="line"><span class="string">            	</span></span><br><span class="line"><span class="string">        get_param_cached(键,默认值)--提高变量获取效率</span></span><br><span class="line"><span class="string">        		int_cached = rospy.get_param_cached("p_int")</span></span><br><span class="line"><span class="string">        		</span></span><br><span class="line"><span class="string">        get_param_names--获取所有的键</span></span><br><span class="line"><span class="string">            names = rospy.get_param_names()</span></span><br><span class="line"><span class="string">            for name in names:</span></span><br><span class="line"><span class="string">                rospy.loginfo("name = %s",name)</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">        has_param</span></span><br><span class="line"><span class="string">        	是否包含某个键，存在返回 true，否则返回 false</span></span><br><span class="line"><span class="string">        		    flag = rospy.has_param("p_int")</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        search_param--寻找某个键，并返回完整的路径</span></span><br><span class="line"><span class="string">        	key = rospy.search_param("p_int")</span></span><br><span class="line"><span class="string">    		rospy.loginfo("搜索的键 = %s",key)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>参数服务器删除参数</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">"""</span></span><br><span class="line"><span class="string">    rospy.delete_param("键")</span></span><br><span class="line"><span class="string">    键存在时，可以删除成功，键不存在时，会抛出异常</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    rospy.init_node("delete_param_p")</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        rospy.delete_param("p_int")</span></span><br><span class="line"><span class="string">    except Exception as e:</span></span><br><span class="line"><span class="string">        rospy.loginfo("删除失败")</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>和之前介绍的文件系统操作命令比较，文件操作命令是静态的，操作的是磁盘上的文件，而上述命令是动态的，在ROS程序启动后，可以动态的获取运行中的节点或参数的相关信息</p>
<p><a target="_blank" rel="noopener" href="https://wiki.ros.org/ROS/CommandLineTools">ROS/CommandLineTools - ROS Wiki</a></p>
<p><a target="_blank" rel="noopener" href="https://wiki.ros.org/rosnode">rosnode - ROS Wiki</a>   用于获取节点信息的命令</p>
<ul>
<li>rosnode list        列出所有的活动节点</li>
<li>rosnode ping [node_name]        测试到节点的连接状态</li>
<li>rosnode info [node_name]         打印节点信息</li>
<li>rosnode machine [machine_name]        列出指定设备上的节点</li>
<li>rosnode kill [node_name]        杀死某个节点</li>
<li>rosnode cleanup        清除无用节点，比如小乌龟示例</li>
</ul>
<hr>
<p><a target="_blank" rel="noopener" href="https://wiki.ros.org/rostopic">rostopic - ROS Wiki</a>   用于显示有关ROS话题的调试信息，包括发布者，订阅者，发布频率和ROS消息</p>
<ul>
<li><p>rostopic list        显示所有活动状态下的话题</p>
</li>
<li><p>rostpic echo [topic-name]        获取指定话题当前发布的消息</p>
</li>
<li><p>rostopic pub        直接调用命令向订阅者发布消息 [这类指令都需要先source 一下]</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rostopic pub -r [频率] /话题名称 消息类型 消息内容</span><br><span class="line">rostopic pub -r 10 chatter_person plumbing_pub_sub/Person [按两次Tab补齐]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>rostopic info [topic-name]        获取当前话题的相关信息</p>
</li>
<li><p>rostopic type [topic-name]       打印话题类型</p>
</li>
<li><p>rostopic hz [topic-name]         显示话题的发布频率</p>
</li>
</ul>
<hr>
<p><a target="_blank" rel="noopener" href="https://wiki.ros.org/rosmsg">rosmsg - ROS Wiki</a>   用于显示有关 ROS消息类型的工具</p>
<ul>
<li><p>rosmsg list        列出所有消息</p>
</li>
<li><p>rosmsg list | grep -i [消息种类]      显示消息的具体路径</p>
</li>
<li><p>rosmsg show [消息种类]        显示消息描述</p>
</li>
<li><p>rosmsg info [消息种类]        作用与 rosmsg show 一样</p>
</li>
</ul>
<hr>
<p><a target="_blank" rel="noopener" href="https://wiki.ros.org/rosservice">rosservice - ROS Wiki</a>   用于列出和查询ROS <a target="_blank" rel="noopener" href="http://wiki.ros.org/Services">Services</a>的工具</p>
<ul>
<li>rosservice list         列出所有活动的服务</li>
<li>rosservice call [service-name]       使用提供的参数调用服务</li>
<li>rosservice info [service-name]       打印有关服务的信息</li>
<li>rosservice type [service-name]      打印服务类型</li>
</ul>
<p>rossrv是用于显示有关ROS服务类型的信息的命令行工具，与 rosmsg 使用语法高度一致</p>
<hr>
<p><a target="_blank" rel="noopener" href="https://wiki.ros.org/rosparam">rosparam - ROS Wiki</a>  用于使用YAML编码文件在参数服务器上获取和设置ROS参数</p>
<ul>
<li><p>rosparam list        列出所有参数</p>
</li>
<li><p>rosparam set       设置参数 [参数名] [参数值]</p>
</li>
<li><p>rosparam get       获取参数</p>
</li>
<li><p>rosparam delete   删除参数</p>
</li>
<li><p>rosparam dump    将参数写出到外部文件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam dump xxx.yaml</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>rosparam load [yaml文件]  从外部文件加载参数</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam load xxx.yaml</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="通信机制实操"><a href="#通信机制实操" class="headerlink" title="通信机制实操"></a>通信机制实操</h3><h4 id="实操1-话题发布"><a href="#实操1-话题发布" class="headerlink" title="实操1 话题发布"></a>实操1 话题发布</h4><p>需求描述：编码实现乌龟运动控制，让小乌龟做圆周运动</p>
<p>实现分析：</p>
<ol>
<li>乌龟运动控制实现，关键节点有两个，一个是乌龟运动显示节点 turtlesim_node，另一个是控制节点，二者是订阅发布模式实现通信的，乌龟运动显示节点直接调用即可，运动控制节点之前是使用的 turtle_teleop_key 通过键盘控制，现在需要自定义控制节点</li>
<li>控制节点自实现时，首先需要了解控制节点与显示节点通信使用的话题与消息，可以使用ros命令结合计算图来获取</li>
<li>了解了话题与消息之后，通过 C++ 或 Python 编写运动控制节点，通过指定的话题，按照一定的逻辑发布消息即可</li>
</ol>
<p>实现流程：</p>
<ol>
<li>通过计算图结合ros命令获取话题与消息信息</li>
<li>编码实现运动控制节点</li>
<li>启动 roscore、turtlesim_node 以及自定义的控制节点，查看运行结果</li>
</ol>
<p><strong>话题与消息获取</strong></p>
<p>先启动键盘控制乌龟运动案例</p>
<ol>
<li><p>话题获取</p>
<p>通过 rostopic 列出话题</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic list</span><br></pre></td></tr></tbody></table></figure>

<p>或者通过计算图查看话题，启动计算图</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rqt_graph</span><br></pre></td></tr></tbody></table></figure>



<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/image-20250523203511067.png" alt="image-20250523203511067" style="zoom: 67%;">

<p>-&gt; /turtle1/cmd_vel 传递运动指令</p>
</li>
<li><p>消息获取</p>
<p>获取消息类型：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rostopic type /turtle1/cmd_vel</span><br><span class="line">// rostopic info /turtle1/cmd_vel</span><br></pre></td></tr></tbody></table></figure>

<p>info 命令下也显示type</p>
<p>type: geometry_msgs/Twist</p>
</li>
<li><p>获取消息格式</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosmsg info geometry_msgs/Twist</span><br></pre></td></tr></tbody></table></figure>

<p>输出: </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">geometry_msgs/Vector3 linear</span><br><span class="line">  float64 x</span><br><span class="line">  float64 y</span><br><span class="line">  float64 z</span><br><span class="line">geometry_msgs/Vector3 angular</span><br><span class="line">  float64 x</span><br><span class="line">  float64 y</span><br><span class="line">  float64 z</span><br></pre></td></tr></tbody></table></figure>

<p>inear(线速度) ：xyz分别对应在x、y和z方向上的速度(单位是 m/s)</p>
<p>angular(角速度)：xyz分别对应x轴上的翻滚roll、y轴上pitch和z轴上偏航yaw的速度(单位是rad/s)</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/欧拉角1.webp" alt="欧拉角1" style="zoom: 67%;">

<blockquote>
<p>弧度：单位弧度定义为圆弧长度等于半径时的圆心角</p>
<p>在ros中顺时针弧度为 - ，逆时针为 +，值的范围在[-π,π]</p>
</blockquote>
</li>
</ol>
<p>于是可以通过直接发布指令做到简单实现</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic pub -r 10 /turtle1/cmd_vel [TAB补齐]</span><br></pre></td></tr></tbody></table></figure>

<p><strong>实现发布节点</strong></p>
<p>创建功能包需要依赖的功能包: roscpp rospy std_msgs geometry_msgs(封装坐标)</p>
<p><strong>c++</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	topic(已知: /turtle1/cmd_vel)</span></span><br><span class="line"><span class="comment">    消息类型(已知: geometry_msgs/Twist)</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建节点句柄</span></span><br><span class="line"><span class="comment">        4.创建发布者对象</span></span><br><span class="line"><span class="comment">        5.发布逻辑</span></span><br><span class="line"><span class="comment">        6.spinOnce()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/Twist.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"circle_control"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">"/turtle1/cmd_vel"</span>,<span class="number">1000</span>);</span><br><span class="line">    geometry_msgs::Twist msg;</span><br><span class="line"></span><br><span class="line">    msg.linear.x = <span class="number">1.0</span>;</span><br><span class="line">    msg.linear.y = <span class="number">1.0</span>;</span><br><span class="line">    msg.linear.z = <span class="number">0.0</span>;</span><br><span class="line">    msg.angular.x = <span class="number">0.0</span>;</span><br><span class="line">    msg.angular.y = <span class="number">0.0</span>;</span><br><span class="line">    msg.angular.z = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">    {</span><br><span class="line">        pub.<span class="built_in">publish</span>(msg);</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    rospy.init_node(<span class="string">"circle_control_p"</span>)</span><br><span class="line">    pub = rospy.Publisher(<span class="string">"/turtle1/cmd_vel"</span>,Twist,queue_size=<span class="number">1000</span>)</span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    msg = Twist()  // 注意这里要()</span><br><span class="line"></span><br><span class="line">    msg.linear.x = <span class="number">1.0</span></span><br><span class="line">    msg.linear.y = <span class="number">0.0</span></span><br><span class="line">    msg.linear.z = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    msg.angular.x = <span class="number">0.0</span></span><br><span class="line">    msg.angular.y = <span class="number">0.0</span></span><br><span class="line">    msg.angular.z = <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rate.sleep</span><br></pre></td></tr></tbody></table></figure>

<h4 id="实操2-话题订阅"><a href="#实操2-话题订阅" class="headerlink" title="实操2 话题订阅"></a>实操2 话题订阅</h4><p>需求描述：turtlesim中的乌龟显示节点，会发布当前乌龟的位姿(窗体中乌龟的坐标以及朝向)，要求控制乌龟运动，并时时打印当前乌龟的位姿</p>
<p>实现分析：</p>
<ol>
<li>首先，需要启动乌龟显示以及运动控制节点并控制乌龟运动</li>
<li>要通过ROS命令，来获取乌龟位姿发布的话题以及消息</li>
<li>编写订阅节点，订阅并打印乌龟的位姿</li>
</ol>
<p>实现流程:</p>
<ol>
<li>通过ros命令获取话题与消息信息</li>
<li>编码实现位姿获取节点</li>
<li>启动 roscore、turtlesim_node 、控制节点以及位姿订阅节点，控制乌龟运动并输出乌龟的位姿</li>
</ol>
<p><strong>话题与消息获取</strong></p>
<p>先启动键盘控制乌龟运动案例</p>
<ol>
<li><p>话题获取</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic list</span><br></pre></td></tr></tbody></table></figure>

<p>-&gt; /turtle1/pose  存储乌龟位置</p>
</li>
<li><p>获取消息类型</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic info  /turtle1/pose</span><br></pre></td></tr></tbody></table></figure>

<p>-&gt; type: turtlesim/Pose</p>
</li>
<li><p>获取消息格式</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosmsg info turtlesim/Pose</span><br></pre></td></tr></tbody></table></figure>

<p>响应结果：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">float32 x</span><br><span class="line">float32 y</span><br><span class="line">float32 theta</span><br><span class="line">float32 linear_velocity</span><br><span class="line">float32 angular_velocity</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p><strong>实现订阅节点</strong></p>
<p>需要增添功能包turtlesim</p>
<p>在package.xml中增添</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>turtlesim<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>sturtlesim<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>在CMakeLsit.txt中增添</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  geometry_msgs</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  turtlesim //增添包</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>c++</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    话题名称 /turtle1/pose</span></span><br><span class="line"><span class="comment">    消息类型 turtlesim/Pose</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建订阅者对象</span></span><br><span class="line"><span class="comment">        5.回调函数处理订阅的数据</span></span><br><span class="line"><span class="comment">        6.spin</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/Pose.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr &amp;pose)</span></span>{</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"乌龟的位姿信息: \n坐标(%.2f,%.2f)\n朝向(%.2f)\n线速度:%.2f\n角速度:%.2f"</span>,</span><br><span class="line">    pose-&gt;x,pose-&gt;y,pose-&gt;theta,pose-&gt;linear_velocity,pose-&gt;angular_velocity);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"sub_pose"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">"/turtle1/pose"</span>,<span class="number">1000</span>,doPose);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doPose</span>(<span class="params">pose</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">"乌龟的位姿信息: \n坐标(%.2f,%.2f)\n朝向(%.2f)\n线速度:%.2f\n角速度:%.2f"</span>,</span><br><span class="line">                pose.x,pose.y,pose.theta,pose.linear_velocity,pose.angular_velocity)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"sub_pose_p"</span>)</span><br><span class="line">    sub = rospy.Subscriber(<span class="string">"/turtle1/pose"</span>,Pose,doPose,queue_size=<span class="number">1000</span>)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></tbody></table></figure>

<p>代码中容易错误的地方：话题名是/turtle1/pose ，注意这个1</p>
<h4 id="实操3-服务调用"><a href="#实操3-服务调用" class="headerlink" title="实操3 服务调用"></a>实操3 服务调用</h4><p>需求描述：编码实现向 turtlesim 发送请求，在乌龟显示节点的窗体指定位置生成一乌龟，这是一个服务请求操作</p>
<p>实现分析:</p>
<ol>
<li>首先，需要启动乌龟显示节点</li>
<li>要通过ROS命令，来获取乌龟生成服务的服务名称以及服务消息类型</li>
<li>编写服务请求节点，生成新的乌龟</li>
</ol>
<p>实现流程:</p>
<ol>
<li>通过ros命令获取服务与服务消息信息</li>
<li>编码实现服务请求节点</li>
<li>启动 roscore、turtlesim_node 、乌龟生成节点，生成新的乌龟</li>
</ol>
<p><strong>服务名称与服务消息获取</strong></p>
<ol>
<li><p>获取话题</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosservice list</span><br></pre></td></tr></tbody></table></figure>

<p>-&gt; /spawn</p>
</li>
<li><p>获取服务消息类型</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosservice info /spawn</span><br></pre></td></tr></tbody></table></figure>

<p>type: turtlesim/Spawn</p>
<p>Args: x y theta name</p>
</li>
<li><p>获取服务消息格式</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rossrv info turtlesim/Spawn</span><br></pre></td></tr></tbody></table></figure>

<p>响应结果:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">float32 x</span><br><span class="line">float32 y</span><br><span class="line">float32 theta</span><br><span class="line">string name</span><br><span class="line">---</span><br><span class="line">string name</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p>也可以简单实现增添乌龟</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosservice call /spawn [TAB补齐]</span><br></pre></td></tr></tbody></table></figure>

<p><strong>c++</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    服务话题 /spawn</span></span><br><span class="line"><span class="comment">    服务消息类型 turtlesim/Spawn</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">          需要包含 turtlesim 包下资源，注意在 package.xml 配置</span></span><br><span class="line"><span class="comment">        2.初始化 ros 节点</span></span><br><span class="line"><span class="comment">        3.创建 ros 句柄</span></span><br><span class="line"><span class="comment">        4.创建 service 客户端</span></span><br><span class="line"><span class="comment">        5.等待服务启动</span></span><br><span class="line"><span class="comment">        6.发送请求</span></span><br><span class="line"><span class="comment">        7.处理响应</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/Spawn.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"service_call"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">"/spawn"</span>);</span><br><span class="line">    turtlesim::Spawn spawn;</span><br><span class="line">    spawn.request.x = <span class="number">1.0</span>;</span><br><span class="line">    spawn.request.y = <span class="number">4.0</span>;</span><br><span class="line">    spawn.request.theta = <span class="number">1.57</span>;</span><br><span class="line">    spawn.request.name = <span class="string">"turtlec"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ros::service::waitForService("/spawn");</span></span><br><span class="line">    client.<span class="built_in">waitForExistence</span>();</span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(spawn);</span><br><span class="line">    <span class="comment">// 7.处理响应结果</span></span><br><span class="line">    <span class="keyword">if</span> (flag)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"新的乌龟生成,名字:%s"</span>,spawn.response.name.<span class="built_in">c_str</span>());</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"乌龟生成失败！！！"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.srv <span class="keyword">import</span> Spawn,SpawnRequest,SpawnResponse </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	</span><br><span class="line">    rospy.init_node(<span class="string">"service_call_p"</span>)</span><br><span class="line">    client = rospy.ServiceProxy(<span class="string">"/spawn"</span>,Spawn)</span><br><span class="line">    request = SpawnRequest()</span><br><span class="line">    request.x = <span class="number">4.0</span></span><br><span class="line">    request.y = <span class="number">1.0</span></span><br><span class="line">    request.theta = <span class="number">1.57</span></span><br><span class="line">    request.name = <span class="string">"turtlep"</span></span><br><span class="line">    client.wait_for_service()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = client.call(request)</span><br><span class="line">        rospy.loginfo(<span class="string">"乌龟创建成功!，叫:%s"</span>,response.name)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        rospy.loginfo(<span class="string">"服务调用失败"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>可能会出现因为重复命名的异常</p>
<h4 id="实操4-参数设置"><a href="#实操4-参数设置" class="headerlink" title="实操4 参数设置"></a>实操4 参数设置</h4><p>需求描述: 修改turtlesim乌龟显示节点窗体的背景色，已知背景色是通过参数服务器的方式以 rgb 方式设置的</p>
<p>实现分析:</p>
<ol>
<li>首先，需要启动乌龟显示节点[注意这里不启动launch文件]</li>
<li>要通过ROS命令，来获取参数服务器中设置背景色的参数</li>
<li>编写参数设置节点，修改参数服务器中的参数值</li>
</ol>
<p>实现流程:</p>
<ol>
<li>通过ros命令获取参数</li>
<li>编码实现服参数设置节点</li>
<li>启动 roscore、turtlesim_node 与参数设置节点，查看运行结果</li>
</ol>
<p><strong>参数名获取</strong></p>
<p>获取参数列表：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosparam list</span><br></pre></td></tr></tbody></table></figure>

<p>响应结果：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/turtle1/background_b</span><br><span class="line">/turtle1/background_g</span><br><span class="line">/turtle1/background_r</span><br><span class="line">/turtlesim/background_b</span><br><span class="line">/turtlesim/background_g</span><br><span class="line">/turtlesim/background_r</span><br></pre></td></tr></tbody></table></figure>

<p>方式1：命令行实现</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rosparam set /turtlesim/background_r 自定义数值</span><br><span class="line">rosparam set /turtlesim/background_g 自定义数值</span><br><span class="line">rosparam set /turtlesim/background_b 自定义数值</span><br></pre></td></tr></tbody></table></figure>

<p>修改相关参数后，重启 turtlesim_node 节点，背景色就会发生改变了</p>
<p>方式2：代码</p>
<p><strong>c++</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"color"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"/turtlesim/background_r"</span>,<span class="number">0</span>);</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"/turtlesim/background_g"</span>,<span class="number">0</span>);</span><br><span class="line">    nh.<span class="built_in">setParam</span>(<span class="string">"/turtlesim/background_b"</span>,<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ros::NodeHandle nh("turtlesim"); //加上命名空间</span></span><br><span class="line">	<span class="comment">// nh.setParam("background_r",0);</span></span><br><span class="line">    <span class="comment">// nh.setParam("background_g",0);</span></span><br><span class="line">    <span class="comment">// nh.setParam("background_b",0);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"color_p"</span>)</span><br><span class="line">    rospy.set_param(<span class="string">"/turtlesim/background_r"</span>,<span class="number">255</span>)</span><br><span class="line">    rospy.set_param(<span class="string">"/turtlesim/background_g"</span>,<span class="number">255</span>)</span><br><span class="line">    rospy.set_param(<span class="string">"/turtlesim/background_b"</span>,<span class="number">255</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="通信机制比较"><a href="#通信机制比较" class="headerlink" title="通信机制比较"></a>通信机制比较</h3><p>三种通信机制中</p>
<p>参数服务器是一种数据共享机制，可以在不同的节点之间共享数据</p>
<p>话题通信与服务通信是在不同的节点之间传递数据的</p>
<p>话题通信：Publisher→Subscriber [Topic] [msg]</p>
<p>服务通信：Client→Server [Service] [srv]</p>
<p>二者的实现流程相似，都是两个节点通过话题关联到一起，并使用某种类型的数据载体实现数据传输</p>
<table>
<thead>
<tr>
<th></th>
<th>Topic(话题)</th>
<th>Service(服务)</th>
</tr>
</thead>
<tbody><tr>
<td>通信模式</td>
<td>发布/订阅</td>
<td>请求/响应</td>
</tr>
<tr>
<td>同步性</td>
<td>异步(无序)</td>
<td>同步(有序)</td>
</tr>
<tr>
<td>底层协议</td>
<td>ROSTCP/ROSUDP</td>
<td>ROSTCP/ROSUDP</td>
</tr>
<tr>
<td>缓冲区</td>
<td>有(queue_size 队列)</td>
<td>无</td>
</tr>
<tr>
<td>时时性</td>
<td>弱</td>
<td>强</td>
</tr>
<tr>
<td>节点关系</td>
<td>多对多</td>
<td>一对多(一个 Server)</td>
</tr>
<tr>
<td>通信数据</td>
<td>msg</td>
<td>srv</td>
</tr>
<tr>
<td>使用场景</td>
<td>连续高频的数据发布与接收：雷达、里程计</td>
<td>偶尔调用或执行某一项特定功能：拍照、语音识别</td>
</tr>
</tbody></table>
<h2 id="ROS通信机制进阶"><a href="#ROS通信机制进阶" class="headerlink" title="ROS通信机制进阶"></a>ROS通信机制进阶</h2><p><a target="_blank" rel="noopener" href="https://docs.ros.org/en/api/roscpp/html/">roscpp</a>	<a target="_blank" rel="noopener" href="https://wiki.ros.org/rospy">rospy</a></p>
<h3 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h3><p>建议参考官方API文档或参考源码</p>
<p>在运行程序时rosrun 后接着写 _[参数名] = [参数值] 可以给节点 </p>
<h4 id="初始化函数"><a href="#初始化函数" class="headerlink" title="初始化函数"></a>初始化函数</h4><p>ros::init(argc, argv, “name”, [options])</p>
<ol>
<li><p>argc — 封装实参的个数(n+1)</p>
</li>
<li><p>argv — 封装参数的数组</p>
</li>
<li><p>name — 为节点命名(唯一性)</p>
</li>
<li><p>options — 节点启动选项  ros::init_options::AnonymousName  </p>
<blockquote>
<p>给前面的节点命名后增加一个随机数，使得同一个节点能够重复启动</p>
<p>否则重名情况下，第二次启动时第一次会自动停止</p>
</blockquote>
</li>
</ol>
<p>返回值: void</p>
<p>rospy.init_node(name, argv=None, anonymous=False) </p>
<ol>
<li>name — 节点名称</li>
<li>argv — 封装节点调用时传递的参数</li>
<li>anonymous — 取值为 true 时，为节点名称后缀随机编号</li>
</ol>
<h4 id="话题与服务"><a href="#话题与服务" class="headerlink" title="话题与服务"></a>话题与服务</h4><p>在 roscpp 中，话题和服务的相关对象一般由 ros::NodeHandle nh 创建，python中不用专门创建NodeHandle  </p>
<p><strong>发布对象</strong></p>
<p>ros::Publisher pub = nh.advertise&lt; type &gt;(“topic”, queue_size, [latch])</p>
<ol>
<li><p>type — 消息类型</p>
</li>
<li><p>topic — 话题名称</p>
</li>
<li><p>queue_size — 队列长度</p>
</li>
<li><p>latch — 设置为ture时，该话题发布的最后一条消息将被保存，并且当有订阅者连接时会将该消息发送给订阅者</p>
<p>以静态地图发送为例(短时间不变的数据)</p>
<p>方案1：可以使用固定频率发送地图数据，但是效率低</p>
<p>方案2：可以将地图发布对象的latch设置为true，并且发布方只发送一次数据，每当订阅者连接时，将地图数据发送给订阅者(只发送一次)，这样提高了数据的发送效率</p>
</li>
</ol>
<p>pub = rospy.Publisher(“topic”, type, queue_size, [lathc])</p>
<p><strong>订阅对象</strong>  </p>
<p>ros::Subscriber sub = nh.subscribe(“topic”, queue_size, callback);</p>
<blockquote>
<p>void callback(const std_msgs::String::ConstPtr &amp;msg)</p>
</blockquote>
<p>sub = rospy.Subscriber(“topic”, type, callback, queue_size)</p>
<blockquote>
<p>def callback(msg):</p>
</blockquote>
<p><strong>服务对象</strong></p>
<p>ros::ServiceServer server = nh.advertiseService(“service”, callback);</p>
<blockquote>
<p>bool callback(srv type::Request &amp;req, srv type::Response &amp;resp)</p>
</blockquote>
<p>server = rospy.Service(“service”, srv type, callback)</p>
<blockquote>
<p>def callback(req):</p>
<p>return resp</p>
</blockquote>
<p><strong>客户端对象</strong></p>
<p>ros::ServiceClient client = nh.serviceClient&lt; srv type &gt;(“service”);</p>
<p>等待服务函数1  ros::service::waitForService(“service”)</p>
<p>等待服务函数2  client.waitForExistence();</p>
<p>请求写入：srv type req; req.request.input1 = atoi(argv[1]); (类推写完输入)</p>
<p>client = rospy.ServiceProxy(“service”, srv type)</p>
<p>等待服务函数    client.wait_for_service()</p>
<p>请求写入：req = srv typeRequets() req.input1 = sys.argv[1] (类推写完输入)</p>
<h4 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h4><p>spinOnce()  处理一轮回调，一般用于循环体内</p>
<p>spin() 进入循环去处理回调</p>
<p>不同点：在ros::spin() 后的语句不会执行到，而 ros::spinOnce() 后的语句可以执行</p>
<p>python 只有 rospy.spin()</p>
<h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p><strong>时刻</strong> </p>
<p>获取时刻，或是设置指定时刻</p>
<p>ros::Time::now()</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"hello_time"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 获取当前时刻：now 被调用执行的那一刻</span></span><br><span class="line">    <span class="comment">// 参考系：1970年01月01日 00:00:00</span></span><br><span class="line">    ros::Time current_time = ros::Time::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取距离 1970年01月01日 00:00:00 的秒数</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"当前时刻:%.2f"</span>,current_time.<span class="built_in">toSec</span>()); <span class="comment">// 浮点型</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"当前时刻:%d"</span>,current_time.sec);  <span class="comment">// 整型    </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转化为年月日时分秒格式</span></span><br><span class="line">    std::<span class="type">time_t</span> raw_time = current_time.<span class="built_in">toSec</span>(); <span class="comment">// 转换为秒</span></span><br><span class="line">    std::tm* time_info = std::<span class="built_in">localtime</span>(&amp;raw_time); <span class="comment">// 转换为本地时间</span></span><br><span class="line">    <span class="comment">// 如果需要UTC时间使用 std::gmtime</span></span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">80</span>];</span><br><span class="line">    std::<span class="built_in">strftime</span>(buffer, <span class="built_in">sizeof</span>(buffer), <span class="string">"%Y-%m-%d %H:%M:%S"</span>, time_info); <span class="comment">// 格式化时间</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"当前时间: %s"</span>,buffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置指定时刻</span></span><br><span class="line">    <span class="function">ros::Time <span class="title">t1</span><span class="params">(<span class="number">100</span>,<span class="number">100000000</span>)</span></span>; <span class="comment">// 参数1:秒数  参数2:纳秒</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"时刻:%.2f"</span>,t<span class="number">1.</span><span class="built_in">toSec</span>()); </span><br><span class="line">    <span class="function">ros::Time <span class="title">t2</span><span class="params">(<span class="number">100.1</span>)</span></span>; <span class="comment">// 传入浮点型</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"时刻:%.2f"</span>,t<span class="number">2.</span><span class="built_in">toSec</span>()); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>命名增加时间戳方法：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="type">time_t</span> raw_time = ros::Time::<span class="built_in">now</span>().<span class="built_in">toSec</span>(); <span class="comment">// 转换为秒</span></span><br><span class="line">std::tm* time_info = std::<span class="built_in">localtime</span>(&amp;raw_time); <span class="comment">// 转换为本地时间</span></span><br><span class="line"><span class="comment">// 如果需要UTC时间使用 std::gmtime</span></span><br><span class="line"><span class="type">char</span> buffer[<span class="number">80</span>];</span><br><span class="line">std::<span class="built_in">strftime</span>(buffer, <span class="built_in">sizeof</span>(buffer), <span class="string">"%Y%m%d_%H%M%S"</span>, time_info); <span class="comment">// 格式化时间</span></span><br></pre></td></tr></tbody></table></figure>

<p>后续直接+buffer即可</p>
<p>rospy.Time.now()</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">current_time = rospy.Time.now()</span><br><span class="line">rospy.loginfo(<span class="string">"当前时刻:%.2f"</span>,right_now.to_sec()) <span class="comment"># 浮点型</span></span><br><span class="line">rospy.loginfo(<span class="string">"当前时刻:%.2f"</span>,right_now.to_nsec()) <span class="comment"># 整型</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置指定时刻</span></span><br><span class="line">time1 = rospy.Time(<span class="number">100</span>,<span class="number">100000000</span>)  <span class="comment"># 参数1:秒数  参数2:纳秒</span></span><br><span class="line">time2 = rospy.Time(<span class="number">100.1</span>)</span><br><span class="line">time3 = rospy.Time.from_sec(<span class="number">100.1</span>)</span><br><span class="line">rospy.loginfo(<span class="string">"设置时刻1:%.2f"</span>,time1.to_sec())</span><br><span class="line">rospy.loginfo(<span class="string">"设置时刻2:%.2f"</span>,time2.to_sec())</span><br><span class="line">rospy.loginfo(<span class="string">"设置时刻2:%.2f"</span>,time3.to_sec())</span><br></pre></td></tr></tbody></table></figure>

<p><strong>持续时间</strong></p>
<p>设置一个时间区间(间隔)</p>
<p>ros::Duration du()</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ROS_INFO</span>(<span class="string">"开始休眠:%.2f"</span>,ros::Time::<span class="built_in">now</span>().<span class="built_in">toSec</span>());</span><br><span class="line"><span class="function">ros::Duration <span class="title">du</span><span class="params">(<span class="number">4.5</span>)</span></span>;<span class="comment">//持续4.5秒,double类型，以秒为单位</span></span><br><span class="line">du.<span class="built_in">sleep</span>();</span><br><span class="line"><span class="built_in">ROS_INFO</span>(<span class="string">"结束休眠:%.2f"</span>,ros::Time::<span class="built_in">now</span>().<span class="built_in">toSec</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>du = rospy.Duration()</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rospy.loginfo(<span class="string">"持续时间测试开始....."</span>)</span><br><span class="line">du = rospy.Duration(<span class="number">3.3</span>)</span><br><span class="line">rospy.sleep(du) <span class="comment">#休眠函数</span></span><br><span class="line">rospy.loginfo(<span class="string">"持续时间测试结束....."</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>时刻运算</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ros::Time begin = ros::Time::<span class="built_in">now</span>();</span><br><span class="line"><span class="function">ros::Duration <span class="title">du1</span><span class="params">(<span class="number">5</span>)</span></span>;     <span class="comment">// 模拟运行时间</span></span><br><span class="line">ros::Time stop = begin + du1;</span><br><span class="line"><span class="built_in">ROS_INFO</span>(<span class="string">"开始时刻:%.2f"</span>,begin.<span class="built_in">toSec</span>());</span><br><span class="line"><span class="built_in">ROS_INFO</span>(<span class="string">"结束时刻:%.2f"</span>,stop.<span class="built_in">toSec</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>time 与 duration 可以+/-，duration 之间也可以+/-</p>
<p>但time 之间只可以 - ，不可以 + ，返回的是 ros::Duration 类型</p>
<p>python与c++相同</p>
<p><strong>设置运行频率</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">1</span>)</span></span>;<span class="comment">//指定频率</span></span><br><span class="line">   <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">   {</span><br><span class="line">       rate.<span class="built_in">sleep</span>(); <span class="comment">// 要放在循环里</span></span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">    rate.sleep() <span class="comment">#休眠，要放在循环里</span></span><br><span class="line">    rospy.loginfo(<span class="string">"+++++++++++++++"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>定时器</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cb</span><span class="params">(<span class="type">const</span> ros::TimerEvent &amp;event)</span></span>{</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"----"</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"调用时刻:%.2f"</span>,event.current_real.<span class="built_in">toSec</span>());</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Timer createTimer(ros::Duration(period), // 时间间隔</span></span><br><span class="line"><span class="comment">        const TimerCallback&amp; callback,      // 回调函数</span></span><br><span class="line"><span class="comment">        bool oneshot = false,               // 是否一次性</span></span><br><span class="line"><span class="comment">        bool autostart = true ）            // 是否自动启动，设置为false时需要手动启动 time.start()</span></span><br><span class="line"><span class="comment">    定时器启动需要ros::spin() 因为有回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">    ros::Timer timer = nh.<span class="built_in">createTimer</span>(ros::<span class="built_in">Duration</span>(<span class="number">1</span>),cb);</span><br><span class="line">    <span class="comment">// ros::Timer timer = nh.createTimer(ros::Duration(1),cb,false,false);</span></span><br><span class="line">    <span class="comment">// timer.start(); // 手动启动</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cb</span>(<span class="params">event</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">"+++++++++++"</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">"当前时刻:%.2f"</span>,event.current_real.to_sec())</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">	rospy.Timer(rospy.Duration(period), // 时间间隔</span></span><br><span class="line"><span class="string">				callback,				// 回调函数</span></span><br><span class="line"><span class="string">				oneshot=False,			// 是否一次性</span></span><br><span class="line"><span class="string">                reset=False)			</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">    rospy.Timer(rospy.Duration(<span class="number">1</span>),cb)</span><br><span class="line">	<span class="comment"># rospy.Timer(rospy.Duration(1),cb,True) # 只执行一次</span></span><br><span class="line">	rospy.spin()</span><br></pre></td></tr></tbody></table></figure>

<h4 id="其它函数"><a href="#其它函数" class="headerlink" title="其它函数"></a>其它函数</h4><p>在发布实现时，一般会循环发布消息，循环的判断条件一般由节点状态来控制</p>
<p>C++中可以通过 ros::ok() 来判断节点状态是否正常，而 python 中则通过 rospy.is_shutdown() 来实现判断，导致节点退出的原因主要有如下几种：</p>
<ul>
<li>节点接收到了关闭信息，比如常用的 ctrl + c(z) 快捷键就是关闭节点的信号</li>
<li>同名节点启动，导致现有节点退出</li>
<li>程序中的其他部分调用了节点关闭相关的API(C++中是ros::shutdown()，python中是rospy.signal_shutdown())</li>
</ul>
<p>日志函数：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ROS_DEBUG</span>(<span class="string">"hello,DEBUG"</span>); <span class="comment">//不会输出</span></span><br><span class="line"><span class="built_in">ROS_INFO</span>(<span class="string">"hello,INFO"</span>); <span class="comment">//默认白色字体</span></span><br><span class="line"><span class="built_in">ROS_WARN</span>(<span class="string">"Hello,WARN"</span>); <span class="comment">//默认黄色字体</span></span><br><span class="line"><span class="built_in">ROS_ERROR</span>(<span class="string">"hello,ERROR"</span>);<span class="comment">//默认红色字体</span></span><br><span class="line"><span class="built_in">ROS_FATAL</span>(<span class="string">"hello,FATAL"</span>);<span class="comment">//默认红色字体</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rospy.logdebug(<span class="string">"hello,debug"</span>)  <span class="comment">#不会输出</span></span><br><span class="line">rospy.loginfo(<span class="string">"hello,info"</span>)  <span class="comment">#默认白色字体</span></span><br><span class="line">rospy.logwarn(<span class="string">"hello,warn"</span>)  <span class="comment">#默认黄色字体</span></span><br><span class="line">rospy.logerr(<span class="string">"hello,error"</span>)  <span class="comment">#默认红色字体</span></span><br><span class="line">rospy.logfatal(<span class="string">"hello,fatal"</span>) <span class="comment">#默认红色字体</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="头文件与源文件"><a href="#头文件与源文件" class="headerlink" title="头文件与源文件"></a>头文件与源文件</h3><p>核心内容在于CMakeLists.txt文件的配置</p>
<h4 id="自定义头文件调用"><a href="#自定义头文件调用" class="headerlink" title="自定义头文件调用"></a>自定义头文件调用</h4><p>流程: </p>
<ol>
<li>编写头文件；</li>
<li>编写可执行文件(同时也是源文件)；</li>
<li>编辑配置文件并执行。</li>
</ol>
<p><strong>头文件</strong></p>
<p>在功能包下的<code>include/功能包名</code>目录下新建头文件: hello.h</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HELLO_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HELLO_H</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    声明namespace</span></span><br><span class="line"><span class="comment">        |-- class</span></span><br><span class="line"><span class="comment">            |- run</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> hello_ns{</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyHello</span>{</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">};</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>为了后续包含头文件时不抛出异常，配置 .vscode 下 _cpp_properties.json 的 includepath属性（和之前配置服务srv文件生成的头文件过程相似）</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">"includePath"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">		...</span><br><span class="line">        <span class="string">"/home/ros/demo03_ws/src/plumbing_head/include/**"</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>源文件</strong></p>
<p>src目录下新建 hello.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"plumbing_head/hello.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> hello_ns{</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyHello::run</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">"run函数执行...."</span>);</span><br><span class="line">}    </span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"hello_head"</span>);</span><br><span class="line">    hello_ns::MyHello myhello;</span><br><span class="line">    myhello.<span class="built_in">run</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>配置文件</strong></p>
<p>与之前配置多一步</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">include_directories(</span><br><span class="line">include // 这里解除注释</span><br><span class="line">  ${catkin_INCLUDE_DIRS}</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">add_executable(hello src/hello.cpp)</span><br><span class="line"></span><br><span class="line">add_dependencies(hello ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})</span><br><span class="line"></span><br><span class="line">target_link_libraries(hello</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<h4 id="自定义源文件调用"><a href="#自定义源文件调用" class="headerlink" title="自定义源文件调用"></a>自定义源文件调用</h4><p>流程:</p>
<ol>
<li>编写头文件；</li>
<li>编写源文件；</li>
<li>编写可执行文件；</li>
<li>编辑配置文件并执行。</li>
</ol>
<p><strong>可执行文件</strong></p>
<p>src目录下新建 use_head.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"plumbing_head/hello.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"hello_head_src"</span>);</span><br><span class="line">    hello_ns::MyHello my;</span><br><span class="line">    my.<span class="built_in">run</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>配置文件</strong></p>
<p>头文件与源文件相关配置：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">include_directories(</span><br><span class="line">include // 这里解除注释</span><br><span class="line">  ${catkin_INCLUDE_DIRS}</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">## 声明C++库</span><br><span class="line">## Declare a C++ library</span><br><span class="line"># add_library(${PROJECT_NAME}</span><br><span class="line">#   src/${PROJECT_NAME}/plumbing_pub_sub.cpp</span><br><span class="line"># )</span><br><span class="line">add_library(head_src</span><br><span class="line">  include/${PROJECT_NAME}/hello.h</span><br><span class="line">  src/hello.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">add_dependencies(head_src ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})</span><br><span class="line"></span><br><span class="line">target_link_libraries(head_src</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>可执行文件配置:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add_executable(use_hello src/use_hello.cpp)</span><br><span class="line"></span><br><span class="line">add_dependencies(use_hello ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})</span><br><span class="line"></span><br><span class="line">#此处需要添加之前设置的库</span><br><span class="line">target_link_libraries(use_hello</span><br><span class="line">  head_src // 库声明</span><br><span class="line">  ${catkin_LIBRARIES}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Python模块导入"><a href="#Python模块导入" class="headerlink" title="Python模块导入"></a>Python模块导入</h3><p>实现:</p>
<ol>
<li>新建两个Python文件，使用 import 实现导入关系；</li>
<li>添加可执行权限、编辑配置文件并执行UseA</li>
</ol>
<p>tool.py文件</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line">num = <span class="number">1000</span></span><br></pre></td></tr></tbody></table></figure>

<p>use_tool.py文件</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置临时环境变量</span></span><br><span class="line"><span class="comment"># sys.path.insert(0,"/home/ros/demo03_ws/src/plumbing_pub_sub/scripts")</span></span><br><span class="line"><span class="comment"># 路径动态，保证移植可执行</span></span><br><span class="line">path = os.path.abspath(<span class="string">"."</span>)</span><br><span class="line">sys.path.insert(<span class="number">0</span>,path + <span class="string">"/src/plumbing_head/scripts"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"tool"</span>)</span><br><span class="line">    <span class="comment"># 异常：ModuleNotFoundError:No module named'tools'</span></span><br><span class="line">    <span class="string">""" </span></span><br><span class="line"><span class="string">        原因: rosrun 执行时，参考路径是工作空间的路径，在工作空间下无法查找依赖的模块 </span></span><br><span class="line"><span class="string">        解决：可以声明python的环境变量,当依赖某个模块时,先去指定环境变量中查找依赖</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    rospy.loginfo(<span class="string">"num=%d"</span>,tool.num)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ROS运行管理"><a href="#ROS运行管理" class="headerlink" title="ROS运行管理"></a>ROS运行管理</h2><h3 id="元功能包"><a href="#元功能包" class="headerlink" title="元功能包"></a>元功能包</h3><p>完成ROS中一个系统性的功能，可能涉及到多个功能包，逐一安装功能包的效率低下，在ROS中，提供了一种方式可以将不同的功能包打包成一个功能包，当安装某个功能模块时，直接调用打包后的功能包即可，该包又称之为元功能包</p>
<p><code>MetaPackage</code>是Linux的一个文件管理系统的概念，是ROS中的一个虚包，里面没有实质性的内容，但是它依赖了其他的软件包，通过这种方法可以把其他包组合起来，可以认为它是一本书的目录索引，告诉我们这个包集合中有哪些子包，并且该去哪里下载</p>
<p>例如：sudo apt install ros-noetic-desktop-full 命令安装ros时就使用了元功能包</p>
<p><strong>实现</strong></p>
<p>新建一个功能包，不需要添加依赖，修改package.xml</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>catkin<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 添加依赖的功能包名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>plumbing_pub_sub<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>plumbing_server_client<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>plumbing_param_server<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- The export tag contains other, unspecified, tags --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">metapackage</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>修改 CMakeLists.txt</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0.2)</span><br><span class="line">project(plumbing_my)</span><br><span class="line">find_package(catkin REQUIRED)</span><br><span class="line">catkin_metapackage()</span><br></pre></td></tr></tbody></table></figure>

<p><font color="Violetred">不能出现换行以及注释</font></p>
<p><a target="_blank" rel="noopener" href="https://wiki.ros.org/catkin/package.xml#Metapackages">catkin/package.xml - ROS Wiki</a></p>
<h3 id="launch文件-1"><a href="#launch文件-1" class="headerlink" title="launch文件"></a>launch文件</h3><p>在功能包下添加 launch目录, 目录下新建 xxxx.launch 文件，编辑 launch 文件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node"     name="myTurtle" output="screen" /&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtle_teleop_key"  name="myTurtleContro" output="screen" /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>调用 launch 文件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch 包名 xxx.launch</span><br></pre></td></tr></tbody></table></figure>

<p>roslaunch 命令执行launch文件时，首先会判断是否启动了 roscore，如果启动了，则不再启动，否则，会自动调用 roscore</p>
<p><strong>launch标签</strong></p>
<p><code>&lt;launch&gt;</code>标签是所有 launch 文件的根标签，充当其他标签的容器</p>
<p>deprecated 告知用户当前 launch 文件已经弃用</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch deprecated="此文件可能过时！"&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>node标签</strong></p>
<p><code>&lt;node&gt;</code>标签用于指定 ROS 节点，是最常见的标签，但 roslaunch 命令不能保证按照 node 的声明顺序来启动节点(节点的启动是多进程的)</p>
<ul>
<li><p>pkg=”包名”</p>
<p>节点所属的功能包</p>
</li>
<li><p>type=”nodeType”  </p>
<p>节点类型，即与之相同名称的可执行文件，python文件需要带上<code>.py</code>，cpp文件不需要，类似CMakeList配置</p>
</li>
<li><p>name=”nodeName”</p>
<p>节点名称，在 ROS 网络拓扑中节点的名称</p>
</li>
<li><p>machine=”机器名”</p>
<p>在指定机器上启动节点</p>
</li>
<li><p>respawn=”true | false” (可选)</p>
<p>如果节点退出，是否自动重启</p>
</li>
<li><p>respawn_delay=” N” (可选)</p>
<p>如果 respawn 为 true，那么延迟 N 秒后启动节点</p>
</li>
<li><p>required=”true | false” (可选)</p>
<p>如果为 true，那么该节点退出，将杀死整个 roslaunch，不能和respawn一起用，会报错</p>
</li>
<li><p>ns=”xxx” (可选)</p>
<p>在指定命名空间 xxx 中启动节点 ，主要用来避免重名</p>
<p>node list -&gt;  /命名空间/name </p>
</li>
<li><p>output=”log | screen” (可选)</p>
<p>默认log，但一般改成screen</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;node pkg="turtlesim" type="turtlesim_node" name="myTurtle" output="screen"/&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>include标签</strong></p>
<p>用于将另一个 xml 格式的 launch 文件导入到当前文件</p>
<p>file=”$(find 包名)/xxx/xxx.launch”</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 包含 --&gt;</span><br><span class="line">    &lt;include file = "$(find launch01_basic)/launch/start_turtle.launch"/&gt;</span><br><span class="line">    &lt;!-- 其他节点 --&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>用于复用</p>
<p><strong>remap标签</strong></p>
<p>用于话题重命名</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;node pkg="turtlesim" type="turtlesim_node"  name="myTurtle" output="screen"&gt;</span><br><span class="line">    &lt;remap from="/turtle1/cmd_vel" to = "/cmd_vel" /&gt;</span><br><span class="line">&lt;/node&gt;</span><br><span class="line">&lt;!-- 在launch中的语法是每个标签结束后才标斜杠，没结束还有子标签的话就不标 --&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>from = “原始话题名称” to = “目标话题名称”</p>
<p>此时原来的控制失效，因为turtle_teleop_key 是以/turtle1/cmd_vel 发布</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;node pkg="turtlesim" type="turtle_teleop_key"  name="myTurtleContro" output="screen" /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>这里需要下载一个控制包</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-noetic-teleop-twist-keyboard</span><br></pre></td></tr></tbody></table></figure>

<p><strong>param标签</strong></p>
<p><code>&lt;param&gt;</code>标签主要用于在参数服务器上设置参数</p>
<p>在<code>&lt;node&gt;</code>标签中时，相当于私有参数</p>
<p>在<code>&lt;node&gt;</code>标签外时，相当于全局参数</p>
<ul>
<li><p>name=”[命名空间]/参数名”</p>
<p>参数名称，可以包含命名空间</p>
</li>
<li><p>value=”xxx” (可选)</p>
<p>定义参数值，如果此处省略，必须指定外部文件作为参数源</p>
</li>
<li><p>type=”str | int | double | bool | yaml” (可选)</p>
<p>指定参数类型，如果未指定，roslaunch 会尝试确定参数类型，规则如下:</p>
<ul>
<li>如果包含 ‘.’ 的数字解析未浮点型，否则为整型</li>
<li>“true” 和 “false” 是 bool 值(不区分大小写)</li>
<li>其他是字符串</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;param name="param_A" type = "int" value ="100" /&gt;</span><br><span class="line">&lt;node pkg="turtlesim" type="turtlesim_node" name="myTurtle" output="screen"&gt;</span><br><span class="line">    &lt;remap from="/turtle1/cmd_vel" to = "/cmd_vel" /&gt;</span><br><span class="line">    &lt;param name="param_B" type = "double" value ="3.14" /&gt;</span><br><span class="line">&lt;/node&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>rosparam标签</strong></p>
<p><code>&lt;rosparam&gt;</code>标签可以从 YAML 文件导入参数，或将参数导出到 YAML 文件，也可以用来删除参数</p>
<ul>
<li>command=”load | dump | delete” (可选，默认 load)</li>
<li>file=”$(find 功能包)/xxx/yyy….”</li>
<li>param=”参数名称”</li>
<li>ns=”命名空间” (可选)</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 导入参数 --&gt;</span><br><span class="line">&lt;rosparam command = "load" file = "$(find launch01_basic)/launch/param.yaml"/&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>由于launch文件也不是按顺序进行，导出虽然写在launch文件较后的位置也可能无法正常导出，所以最好分两个launch文件，在完成后再进行导出</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;!-- 导出参数 --&gt;</span><br><span class="line">    &lt;rosparam command = "dump" file = "$(find launch01_basic)/launch/param_out.yaml"/&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>删除操作：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;rosparam command = "delete" param = "bg_B" /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>group标签</strong></p>
<p><code>&lt;group&gt;</code>标签可以对节点分组，具有 ns 属性，可以让节点归属某个命名空间</p>
<ul>
<li><p>clear_params=”true | false” (可选)</p>
<p>启动前，是否删除组名称空间的所有参数(慎用….此功能危险)</p>
</li>
</ul>
<p>这个时候即使在node中name属性相同也不会报错，因为group使得前面加上前缀，不会产生相同的节点名称</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch &gt;</span><br><span class="line">    &lt;group ns = "first"&gt;</span><br><span class="line">        &lt;node pkg="turtlesim" type="turtlesim_node" name="myTurtle" output="screen" /&gt;</span><br><span class="line">        &lt;node pkg="turtlesim" type="turtle_teleop_key"  name="myTurtleContro" output="screen" /&gt;</span><br><span class="line">    &lt;/group&gt; </span><br><span class="line">    &lt;group ns = "second"&gt;</span><br><span class="line">        &lt;node pkg="turtlesim" type="turtlesim_node" name="myTurtle" output="screen" /&gt;</span><br><span class="line">        &lt;node pkg="turtlesim" type="turtle_teleop_key"  name="myTurtleContro" output="screen" /&gt;</span><br><span class="line">    &lt;/group&gt; </span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>arg标签</strong></p>
<p><code>&lt;arg&gt;</code>标签是用于动态传参，类似于函数的参数</p>
<ul>
<li><p>name=”参数名称”</p>
</li>
<li><p>default=”默认值” (可选)</p>
</li>
<li><p>value=”数值” (可选)</p>
<p>不可以与 default 并存</p>
</li>
<li><p>doc=”描述”</p>
</li>
</ul>
<p>命令行调用传参</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch hello.launch xxx:=值</span><br></pre></td></tr></tbody></table></figure>

<h3 id="工作空间覆盖"><a href="#工作空间覆盖" class="headerlink" title="工作空间覆盖"></a>工作空间覆盖</h3><p>所谓工作空间覆盖，是指不同工作空间中，存在重名的功能包的情形</p>
<p>比如：自定义工作空间A存在功能包 turtlesim，自定义工作空间B也存在功能包 turtlesim，当然系统内置空间也存在turtlesim，如果调用turtlesim包，会调用哪个工作空间中的呢</p>
<ol>
<li><p>新建工作空间A与工作空间B，两个工作空间中都创建功能包: turtlesim</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include "ros/ros.h"</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">    ros::init(argc,argv,"hello_ws1");</span><br><span class="line">    ROS_INFO("demo01_ws");</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>为了在任何工作空间下调用demo01_ws和demo02_ws，需要在根目录下的.bashrc文件中进行修改</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source /opt/ros/noetic/setup.bash</span><br><span class="line"># 新增</span><br><span class="line">source /home/ros/demo01_ws/devel/setup.bash</span><br><span class="line">source /home/ros/demo02_ws/devel/setup.bash</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>刷新环境变量</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .bashrc</span><br></pre></td></tr></tbody></table></figure>

<p>运行</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun turtlesim [TAB]</span><br></pre></td></tr></tbody></table></figure>

<p>会发现直接跳出hello_ws2 </p>
<p>是因为在.bashrc中后刷新的会覆盖前面的</p>
</li>
<li><p>查看ROS环境环境变量</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $ROS_PACKAGE_PATH</span><br></pre></td></tr></tbody></table></figure>

<p>ROS_PACKAGE_PATH 中的值，和 .bashrc 的配置顺序相反—&gt;后配置的优先级更高</p>
</li>
</ol>
<p>功能包重名时，会按照 ROS_PACKAGE_PATH 查找，配置在前的会优先执行</p>
<p><strong>隐患</strong></p>
<p>比如当前工作空间B优先级更高，意味着当程序调用 turtlesim 时，不会调用工作空间A也不会调用系统内置的 turtlesim，如果工作空间A在实现时有其他功能包依赖于自身的 turtlesim，而按照ROS工作空间覆盖的涉及原则，那么实际执行时将会调用工作空间B的turtlesim，从而导致执行异常，出现安全隐患</p>
<p>BUG 说明:</p>
<blockquote>
<p>在 .bashrc 文件中 source 多个工作空间后，可能出现在 ROS PACKAGE PATH 中只包含两个工作空间，可以删除自定义工作空间的 build 与 devel 目录，重新 catkin_make，然后重新载入 .bashrc 文件，问题解决</p>
</blockquote>
<p>目前没有特别的解决方案</p>
<h3 id="节点名称重名"><a href="#节点名称重名" class="headerlink" title="节点名称重名"></a>节点名称重名</h3><p>ros::init(argc,argv,””)   rospy.init_node(“”)  定义节点名称</p>
<p>在ROS的网络拓扑中，是不可以出现重名的节点的，也不可以启动重名节点或者同一个节点多次</p>
<p>在ROS中给出的解决策略是使用命名空间或名称重映射</p>
<p>命名空间就是为名称添加前缀，名称重映射是为名称起别名</p>
<h4 id="rosrun实现"><a href="#rosrun实现" class="headerlink" title="rosrun实现"></a>rosrun实现</h4><p><strong>rosrun设置命名空间</strong></p>
<p>语法: rosrun 包名 节点名 __ns:=新名称</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rosrun turtlesim turtlesim_node __ns:=t1</span><br><span class="line">rosrun turtlesim turtlesim_node __ns:=t2</span><br><span class="line"># 注意，这里=后面不可以有空格</span><br></pre></td></tr></tbody></table></figure>

<p>rosnode list </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/t1/turtlesim</span><br><span class="line">/t2/turtlesim</span><br></pre></td></tr></tbody></table></figure>

<p><strong>rosrun名称重映射</strong></p>
<p>语法: rosrun 包名 节点名 __name:=新名称</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosrun turtlesim  turtlesim_node __name:=t1</span><br><span class="line">rosrun turtlesim  turtlesim_node __name:=t2</span><br></pre></td></tr></tbody></table></figure>

<p><strong>设置命名空间同时名称重映射</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun turtlesim turtlesim_node __ns:=w1 __name:=t1</span><br></pre></td></tr></tbody></table></figure>

<p>使用环境变量也可以设置命名空间，启动节点前在终端键入如下命令</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ROS_NAMESPACE=sw1</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br></pre></td></tr></tbody></table></figure>

<h4 id="launch实现"><a href="#launch实现" class="headerlink" title="launch实现"></a>launch实现</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch &gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="turtlesim" output="screen"/&gt;</span><br><span class="line">    &lt;!-- 名称重映射 --&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="t1" output="screen"/&gt;</span><br><span class="line">    &lt;!-- 命名空间 --&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="turtlesim" output="screen" ns="p1" /&gt;</span><br><span class="line">    &lt;!-- 命名空间 + 称重映射 --&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="t2" output="screen" ns="p2" /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>在 node 标签中，name 属性是必须的，ns 可选</p>
<p><code>rosnode list</code>查看节点信息</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/p1/turtlesim</span><br><span class="line">/p2/t2</span><br><span class="line">/rosout</span><br><span class="line">/t1</span><br><span class="line">/turtlesim</span><br></pre></td></tr></tbody></table></figure>

<h4 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h4><p><strong>c++</strong></p>
<p>重映射：(设置别名)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros::init(argc,argv,"name",ros::init_options::AnonymousName)；</span><br></pre></td></tr></tbody></table></figure>

<p>在名称后面添加时间戳</p>
<p>命名空间：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::map&lt;std::string, std::string&gt; map;</span><br><span class="line">map["__ns"] = "name";</span><br><span class="line">ros::init(map,"");</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<p>重映射：(设置别名)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rospy.init_node("name",anonymous=True)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="话题名称重名"><a href="#话题名称重名" class="headerlink" title="话题名称重名"></a>话题名称重名</h3><h4 id="rosrun实现-1"><a href="#rosrun实现-1" class="headerlink" title="rosrun实现"></a>rosrun实现</h4><p>语法: rorun 包名 节点名 话题名:=新话题名称</p>
<p>实现teleop_twist_keyboard与乌龟显示节点通信方案</p>
<p>方案1：将 teleop_twist_keyboard 节点的话题设置为<code>/turtle1/cmd_vel</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun teleop_twist_keyboard teleop_twist_keyboard.py /cmd_vel:=/turtle1/cmd_vel</span><br></pre></td></tr></tbody></table></figure>

<p>这个时候<code>rosrun turtlesim turtle_teleop_key</code> 也能正常控制，相当于两个发布</p>
<p>方案2：将乌龟显示节点的话题设置为 <code>/cmd_vel</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun turtlesim turtlesim_node /turtle1/cmd_vel:=/cmd_vel</span><br></pre></td></tr></tbody></table></figure>

<h4 id="launch实现-1"><a href="#launch实现-1" class="headerlink" title="launch实现"></a>launch实现</h4><p>在之前launch文件标签那里讲过，这里就给个代码</p>
<p>语法<code>&lt;remap from="原话题" to="新话题" /&gt;</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="t1" /&gt;</span><br><span class="line">    &lt;node pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py" name="key"&gt;</span><br><span class="line">        &lt;remap from="/cmd_vel" to="/turtle1/cmd_vel" /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="t1"&gt;</span><br><span class="line">        &lt;remap from="/turtle1/cmd_vel" to="/cmd_vel" /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    &lt;node pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py" name="key" /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="编码实现-1"><a href="#编码实现-1" class="headerlink" title="编码实现"></a>编码实现</h4><p>话题的名称与节点的命名空间、节点的名称是有一定关系的，话题名称大致可以分为三种类型:</p>
<ul>
<li>全局(话题参考ROS系统，与节点命名空间平级)</li>
<li>相对(话题参考的是节点的命名空间，与节点名称平级)</li>
<li>私有(话题参考节点名称，是节点名称的子级)</li>
</ul>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/Snipaste_2025-05-30_21-27-59.webp" alt="Snipaste_2025-05-30_21-27-59" style="zoom: 50%;">

<p><strong>c++</strong>：</p>
<p>全局名称：以<code>/</code>开头，和节点名称无关</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">"/chatter"</span>,<span class="number">1000</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>相对名称：非<code>/</code>开头，参考命名空间(与节点名称平级)来确定话题名称</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">"chatter"</span>,<span class="number">1000</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>__ns:=设置命名空间后，则话题位于 /name/chatter</p>
<p>私有名称：以<code>~</code>开头的名称</p>
<p>需要在节点handle创建时候做出些改变</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ros::NodeHandle <span class="title">nh</span><span class="params">(<span class="string">"~"</span>)</span></span>;</span><br><span class="line">ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">"chatter"</span>,<span class="number">1000</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>但如果话题以<code>/</code>开头则话题仍为全局(全局话题优先级更高)</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ros::NodeHandle <span class="title">nh</span><span class="params">(<span class="string">"~"</span>)</span></span>;</span><br><span class="line">ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">"/chatter"</span>,<span class="number">1000</span>);</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong>：</p>
<p>全局名称：以<code>/</code>开头，和节点名称无关</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pub = rospy.Publisher(<span class="string">"/chatter"</span>,String,queue_size=<span class="number">1000</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>相对名称：非<code>/</code>开头，参考命名空间(与节点名称平级)来确定话题名称</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pub = rospy.Publisher(<span class="string">"chatter"</span>,String,queue_size=<span class="number">1000</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>私有名称：以<code>~</code>开头的名称</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pub = rospy.Publisher(<span class="string">"~chatter"</span>,String,queue_size=<span class="number">1000</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="参数名称重名"><a href="#参数名称重名" class="headerlink" title="参数名称重名"></a>参数名称重名</h3><p>在ROS中节点名称话题名称可能出现重名的情况，同理参数名称也可能重名</p>
<p>当参数名称重名时，那么就会产生覆盖</p>
<p>关于参数重名的处理，没有重映射实现，为了尽量的避免参数重名，都是使用为参数名添加前缀的方式，实现类似于话题名称，有全局、相对、和私有三种类型之分</p>
<h4 id="rosrun实现-2"><a href="#rosrun实现-2" class="headerlink" title="rosrun实现"></a>rosrun实现</h4><p>语法：rosrun 包名 节点名称 _参数名:=参数值</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun turtlesim turtlesim_node _A:=100</span><br></pre></td></tr></tbody></table></figure>

<p>rosparam list 查看节点信息</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/turtlesim/A</span><br></pre></td></tr></tbody></table></figure>

<p>这种方法创建出来的参数为私有模式</p>
<h4 id="launch实现-2"><a href="#launch实现-2" class="headerlink" title="launch实现"></a>launch实现</h4><p>在launch文件那部分细讲过了，不再赘述</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;param name="radius" value="0.2" /&gt;</span><br><span class="line">    &lt;node pkg="turtlesim" type="turtlesim_node" name="t1" ns="xxx"&gt;</span><br><span class="line">        &lt;param name="radius" value="0.08" /&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="编码实现-2"><a href="#编码实现-2" class="headerlink" title="编码实现"></a>编码实现</h4><p><strong>c++</strong></p>
<p>使用 ros::param 或者 ros::NodeHandle 来设置参数</p>
<p>具体内容查看 - ROS通信机制 -&gt; 参数服务器</p>
<p>ros::param::set，参数1传入参数名称，参数2传入参数值</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ros::param::<span class="built_in">set</span>(<span class="string">"/set_A"</span>,<span class="number">100</span>); <span class="comment">//全局,和命名空间以及节点名称无关</span></span><br><span class="line">ros::param::<span class="built_in">set</span>(<span class="string">"set_B"</span>,<span class="number">100</span>); <span class="comment">//相对,参考命名空间</span></span><br><span class="line">ros::param::<span class="built_in">set</span>(<span class="string">"~set_C"</span>,<span class="number">100</span>); <span class="comment">//私有,参考命名空间与节点名称</span></span><br></pre></td></tr></tbody></table></figure>

<p>ros::NodeHandle，首先需要创建 NodeHandle 对象，然后调用该对象的 setParam 函数，该函数参数1为参数名，参数2为要设置的参数值</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ros::NodeHandle nh;</span><br><span class="line">nh.<span class="built_in">setParam</span>(<span class="string">"/nh_A"</span>,<span class="number">100</span>); <span class="comment">//全局,和命名空间以及节点名称无关</span></span><br><span class="line"></span><br><span class="line">nh.<span class="built_in">setParam</span>(<span class="string">"nh_B"</span>,<span class="number">100</span>); <span class="comment">//相对,参考命名空间</span></span><br><span class="line"></span><br><span class="line"><span class="function">ros::NodeHandle <span class="title">nh_private</span><span class="params">(<span class="string">"~"</span>)</span></span>;</span><br><span class="line">nh_private.<span class="built_in">setParam</span>(<span class="string">"nh_C"</span>,<span class="number">100</span>);<span class="comment">//私有,参考命名空间与节点名称</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rospy.set_param(<span class="string">"/py_A"</span>,<span class="number">100</span>)  <span class="comment">#全局,和命名空间以及节点名称无关</span></span><br><span class="line">rospy.set_param(<span class="string">"py_B"</span>,<span class="number">100</span>)  <span class="comment">#相对,参考命名空间</span></span><br><span class="line">rospy.set_param(<span class="string">"~py_C"</span>,<span class="number">100</span>)  <span class="comment">#私有,参考命名空间与节点名称</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="分布式通信"><a href="#分布式通信" class="headerlink" title="分布式通信"></a>分布式通信</h3><p>ROS是一个分布式计算环境，一个运行中的ROS系统可以包含分布在多台计算机上多个节点</p>
<p>ROS对网络配置有某些要求：</p>
<ul>
<li>所有端口上的所有机器之间必须有完整的双向连接</li>
<li>每台计算机必须通过所有其他计算机都可以解析的名称来公告自己</li>
</ul>
<p><strong>实现</strong></p>
<ol>
<li><p>准备</p>
<p>先要保证不同计算机处于同一网络中，最好分别设置固定IP，如果为虚拟机，需要将网络适配器改为桥接模式</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/Snipaste_2025-05-31_13-04-06.webp" alt="Snipaste_2025-05-31_13-04-06" style="zoom: 67%;">

<p>修改有线连接的IPv4</p>
<p>下载包 </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install net-tools</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></tbody></table></figure>

<p>查看网络信息</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ros-VirtualBox (ROS1)</span><br><span class="line">inet 10.129.163.127 # ip地址</span><br><span class="line">netmask 255.255.248.0 # 子网掩码</span><br><span class="line"># ROS2</span><br><span class="line">inet 10.129.164.127 # ip地址</span><br><span class="line">netmask 255.255.248.0 # 子网掩码</span><br></pre></td></tr></tbody></table></figure>

<p>网关和地址一样，但是最后一组数只留1</p>
</li>
<li><p>配置文件修改</p>
<p>分别修改不同计算机的 /etc/hosts 文件，在该文件中加入对方的IP地址和计算机名</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc</span><br><span class="line">sudo gedit hosts</span><br></pre></td></tr></tbody></table></figure>

<p>可以通过hostname查看计算机名</p>
<p>设置完毕，可以通过 ping 命令测试网络通信是否正常</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping 10.129.164.127 #地址 </span><br><span class="line">ping ROS2 #计算机名</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>配置主机</p>
<p>~/.bashrc 追加</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># export ROS_MASTER_URI=http://主机IP:11311</span><br><span class="line"># export ROS_HOSTNAME=主机IP</span><br><span class="line"></span><br><span class="line">export ROS_MASTER_URI=http://10.129.163.127:11311</span><br><span class="line">export ROS_HOSTNAME=10.129.163.127</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>配置从机</p>
<p>从机可以有多台，每台都做设置，~/.bashrc 追加</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># export ROS_MASTER_URI=http://主机IP:11311</span><br><span class="line"># export ROS_HOSTNAME=从机IP</span><br><span class="line"></span><br><span class="line">export ROS_MASTER_URI=http://10.129.163.127:11311</span><br><span class="line">export ROS_HOSTNAME=10.129.164.127</span><br></pre></td></tr></tbody></table></figure>

<p>source .bashrc  刷新环境变量</p>
</li>
</ol>
<p><strong>测试</strong></p>
<ol>
<li><p>主机启动 roscore(必须)</p>
</li>
<li><p>主机启动订阅节点，从机启动发布节点，测试通信是否正常</p>
</li>
<li><p>反向测试，主机启动发布节点，从机启动订阅节点，测试通信是否正常</p>
</li>
</ol>
<h2 id="ROS常用组件"><a href="#ROS常用组件" class="headerlink" title="ROS常用组件"></a>ROS常用组件</h2><p>章主要介绍ROS中内置的如下组件:</p>
<ul>
<li>TF坐标变换，实现不同类型的坐标系之间的转换；</li>
<li>rosbag 用于录制ROS节点的执行过程并可以重放该过程；</li>
<li>rqt 工具箱，集成了多款图形化的调试工具</li>
</ul>
<p>案例演示: 小乌龟跟随实现</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roslaunch turtle_tf2 turtle_tf2_demo_cpp.launch</span><br><span class="line">roslaunch turtle_tf2 turtle_tf2_demo.launch </span><br><span class="line"># 如果报错 sudo ln -s /usr/bin/python3 /usr/bin/python</span><br></pre></td></tr></tbody></table></figure>

<h3 id="TF坐标变换"><a href="#TF坐标变换" class="headerlink" title="TF坐标变换"></a>TF坐标变换</h3><p>机器人系统上有多个传感器，如激光雷达、摄像头等，有的是可以感知机器人周边的物体方位(坐标，横向、纵向、高度的距离信息)的，以协助机器人定位障碍物</p>
<p>但不可以直接将物体相对该传感器的方位信息，等价于物体相对于机器人系统或机器人其它组件的方位信息</p>
<p>ROS 中直接封装了相关的模块: 坐标变换(TransForm Frame，TF)</p>
<p>tf2常用功能包有：</p>
<ul>
<li><p>tf2_geometry_msgs：将ROS消息转换成tf2消息</p>
</li>
<li><p>tf2：封装了坐标变换的常用消息</p>
<ul>
<li>欧拉角转四元数：tf2/LinearMath/Quaternion.h (python：tf.transformations)</li>
</ul>
</li>
<li><p>tf2_ros：为tf2提供了roscpp和rospy绑定，封装了坐标变换常用的API(python比较简洁，直接import tf2_ros就行)，一般创建类对象</p>
<ul>
<li>静态变换广播器：tf2_ros/static_transform_broadcaster.h</li>
<li>转换关系订阅器：tf2_ros/transform_listener.h</li>
<li>缓存数据：tf2_ros/buffer.h</li>
</ul>
</li>
</ul>
<p>可以借助于rviz显示坐标系关系</p>
<ul>
<li>新建窗口输入命令rviz</li>
<li>在启动的 rviz 中设置Fixed Frame 为 base_link;</li>
<li>点击左下的 add 按钮，在弹出的窗口中选择 TF 组件，即可显示坐标关系</li>
</ul>
<h4 id="坐标msg消息"><a href="#坐标msg消息" class="headerlink" title="坐标msg消息"></a>坐标msg消息</h4><p>在坐标转换实现中常用的 msg：</p>
<p><font color="Violetred">geometry_msgs/TransformStamped   传输坐标系相关位置信息</font></p>
<p><font color="Violetred">geometry_msgs/PointStamped&nbsp;传输坐标系内坐标点的信息</font>     </p>
<blockquote>
<p>c++: 调用PointStamped需要调用tf2_geometry_msgs/tf2_geometry_msgs.h</p>
<p>python: 需要from tf2_geometry_msgs import PointStamped调用</p>
</blockquote>
<p>命令行键入:<code>rosmsg info geometry_msgs/TransformStamped</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header                     #头信息</span><br><span class="line">  uint32 seq                                #|-- 序列号</span><br><span class="line">  time stamp                                #|-- 时间戳</span><br><span class="line">  string frame_id                           #|-- 坐标 ID</span><br><span class="line">string child_frame_id                    #子坐标系的 id</span><br><span class="line">geometry_msgs/Transform transform        #坐标信息</span><br><span class="line">  geometry_msgs/Vector3 translation        #偏移量</span><br><span class="line">    float64 x                                #|-- X 方向的偏移量</span><br><span class="line">    float64 y                                #|-- Y 方向的偏移量</span><br><span class="line">    float64 z                                #|-- Z 方向上的偏移量</span><br><span class="line">  geometry_msgs/Quaternion rotation        #四元数</span><br><span class="line">    float64 x                                </span><br><span class="line">    float64 y                                </span><br><span class="line">    float64 z                                </span><br><span class="line">    float64 w</span><br><span class="line"># 四元数用于表示坐标的相对姿态</span><br></pre></td></tr></tbody></table></figure>

<p>命令行键入:<code>rosmsg info geometry_msgs/PointStamped</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header                    #头</span><br><span class="line">  uint32 seq                                #|-- 序号</span><br><span class="line">  time stamp                                #|-- 时间戳</span><br><span class="line">  string frame_id                           #|-- 所属坐标系的 id</span><br><span class="line">geometry_msgs/Point point                #点坐标</span><br><span class="line">  float64 x                                 #|-- x y z 坐标</span><br><span class="line">  float64 y</span><br><span class="line">  float64 z</span><br></pre></td></tr></tbody></table></figure>

<h4 id="静态坐标变换"><a href="#静态坐标变换" class="headerlink" title="静态坐标变换"></a>静态坐标变换</h4><p>静态坐标变换，是指两个坐标系之间的相对位置是固定的</p>
<p><strong>需求</strong>：</p>
<p>现有一机器人模型，核心构成包含主体与雷达，各对应一坐标系，坐标系的原点分别位于主体与雷达的物理中心，已知雷达原点相对于主体原点位移关系如下: x 0.2 y0.0 z0.5。当前雷达检测到一障碍物，在雷达坐标系中障碍物的坐标为 (2.0 3.0 5.0),请问，该障碍物相对于主体的坐标是多少？</p>
<p>添加依赖</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roscpp rospy std_msgs geometry_msgs tf2 tf2_ros tf2_geometry_msgs </span><br></pre></td></tr></tbody></table></figure>

<p><strong>c++</strong></p>
<p>发布方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/static_transform_broadcaster.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/TransformStamped.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2/LinearMath/Quaternion.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"static_pub"</span>);</span><br><span class="line">    ros::NodeHandle nh; <span class="comment">// 非必需</span></span><br><span class="line">    <span class="comment">// 创建发布对象</span></span><br><span class="line">    tf2_ros::StaticTransformBroadcaster pub;</span><br><span class="line">    <span class="comment">// 组织发布消息 </span></span><br><span class="line">    geometry_msgs::TransformStamped tfs;</span><br><span class="line">    <span class="comment">// 设置头信息</span></span><br><span class="line">    tfs.header.stamp = ros::Time::<span class="built_in">now</span>(); <span class="comment">// 时间戳</span></span><br><span class="line">    tfs.header.frame_id = <span class="string">"base_link"</span>; <span class="comment">// 原点坐标系</span></span><br><span class="line">    <span class="comment">// 部件坐标系</span></span><br><span class="line">    tfs.child_frame_id = <span class="string">"laser"</span>; </span><br><span class="line">    <span class="comment">// 部件相对原点的位移</span></span><br><span class="line">    tfs.transform.translation.x = <span class="number">0.2</span>;</span><br><span class="line">    tfs.transform.translation.y = <span class="number">0.0</span>;</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0.5</span>;</span><br><span class="line">    <span class="comment">// 设置四元数</span></span><br><span class="line">    tf2::Quaternion qtn; </span><br><span class="line">    <span class="comment">// 向该对象设置欧拉角,可以将欧拉角转化为四元数</span></span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>); <span class="comment">// 翻滚roll,俯仰pitch,偏航yaw,值为弧度</span></span><br><span class="line">    tfs.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    tfs.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    tfs.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    tfs.transform.rotation.w = qtn.<span class="built_in">getW</span>();  </span><br><span class="line">    <span class="comment">// 发布数据</span></span><br><span class="line">    pub.<span class="built_in">sendTransform</span>(tfs);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/欧拉角1.webp" alt="欧拉角1" style="zoom: 67%;">

<blockquote>
<p>欧拉角：翻滚roll,俯仰pitch,偏航yaw，对应绕xyz轴旋转多少度</p>
<p>转化为四元数是为了避免出现万向节死锁，当俯仰角达到90°时（机头垂直向下），此时横滚（X轴）和偏航（Z轴）<code>重合为同一旋转轴</code>，无法区分左右倾斜和水平转向</p>
<p>四元数：由1个实部 + 3个虚部组成，这个转化过程计算太复杂了，会用就行</p>
</blockquote>
<p>订阅方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/transform_listener.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/buffer.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/PointStamped.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_geometry_msgs/tf2_geometry_msgs.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"static_sub"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 创建TF订阅节点</span></span><br><span class="line">    <span class="comment">// 创建一个Buffer 缓存</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="comment">// 创建监听对象(可以将订阅数据放入buffer)</span></span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="comment">// 正常雷达不断扫描坐标</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 组织一个部件坐标系</span></span><br><span class="line">        geometry_msgs::PointStamped point_laser;</span><br><span class="line">        <span class="comment">// 部件坐标系名称 与发布方的child_frame_id 相同</span></span><br><span class="line">        point_laser.header.frame_id = <span class="string">"laser"</span>; </span><br><span class="line">        point_laser.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">        <span class="comment">// 检测物体信息(部件坐标系位置)</span></span><br><span class="line">        point_laser.point.x = <span class="number">2.0</span>;</span><br><span class="line">        point_laser.point.y = <span class="number">3.0</span>;</span><br><span class="line">        point_laser.point.z = <span class="number">5.0</span>;</span><br><span class="line">        <span class="comment">// 添加休眠,避免开始的时候没有找到发布的坐标系相对关系,导致异常</span></span><br><span class="line">        <span class="comment">// ros::Duration(2); 但是用try的方法更好</span></span><br><span class="line">        <span class="comment">// 转换坐标点(相对于原点坐标系)</span></span><br><span class="line">        <span class="comment">// 新建一个坐标点，用于接收转换结果 </span></span><br><span class="line">        <span class="comment">// 使用 try 语句或休眠，否则可能由于缓存接收延迟而导致坐标转换失败</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 核心代码,将部件坐标系坐标点转化为原点坐标系坐标点</span></span><br><span class="line">            geometry_msgs::PointStamped point_base;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                调用的是buffer的转换函数transform</span></span><br><span class="line"><span class="comment">                参数1是被转换的坐标点</span></span><br><span class="line"><span class="comment">                参数2是目标坐标系</span></span><br><span class="line"><span class="comment">                返回输出的坐标点</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                PS:调用时需要加头文件 tf2_geometry_msgs/tf2_geometry_msgs.h</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            point_base = buffer.<span class="built_in">transform</span>(point_laser,<span class="string">"base_link"</span>); </span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"转换后的坐标值:(%.2f,%.2f,%.2f),参考的坐标系:%s"</span>,</span><br><span class="line">                point_base.point.x,</span><br><span class="line">                point_base.point.y,</span><br><span class="line">                point_base.point.z,</span><br><span class="line">                point_base.header.frame_id.<span class="built_in">c_str</span>());</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"程序异常....."</span>);</span><br><span class="line">        }</span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>tos::NodeHandle nh 注册节点到ROS Master，提供访问ROS功能（如话题、服务、参数）的接口，如如果删除 ros::NodeHandle nh，<code>TransformListener</code> 的订阅失败，<code>buffer</code> 收不到TF数据</p>
<p><strong>python</strong></p>
<p>发布方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf.transformations</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">import</span> tf</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"static_pub_p"</span>)</span><br><span class="line">    pub = tf2_ros.StaticTransformBroadcaster()</span><br><span class="line">    <span class="comment"># 组织发布的数据</span></span><br><span class="line">    tfs = TransformStamped()</span><br><span class="line">    <span class="comment"># 设置头信息</span></span><br><span class="line">    tfs.header.stamp = rospy.Time.now()  <span class="comment"># 时间戳信息</span></span><br><span class="line">    tfs.header.frame_id = <span class="string">"base_link"</span>  <span class="comment"># 原点坐标系id</span></span><br><span class="line">    <span class="comment"># 设置部件坐标系id</span></span><br><span class="line">    tfs.child_frame_id = <span class="string">"laser"</span></span><br><span class="line">    <span class="comment"># 部件相对原点的位移</span></span><br><span class="line">    tfs.transform.translation.x = <span class="number">0.2</span></span><br><span class="line">    tfs.transform.translation.y = <span class="number">0.0</span></span><br><span class="line">    tfs.transform.translation.z = <span class="number">0.5</span></span><br><span class="line">    <span class="comment"># 设置四元数</span></span><br><span class="line">    qtn = tf.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">    tfs.transform.rotation.x = qtn[<span class="number">0</span>]</span><br><span class="line">    tfs.transform.rotation.y = qtn[<span class="number">1</span>]</span><br><span class="line">    tfs.transform.rotation.z = qtn[<span class="number">2</span>]</span><br><span class="line">    tfs.transform.rotation.w = qtn[<span class="number">3</span>]</span><br><span class="line">    <span class="comment"># 广播发送</span></span><br><span class="line">    pub.sendTransform(tfs)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></tbody></table></figure>

<p>订阅方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="comment"># 不要使用 geometry_msgs,需要使用 tf2 内置的消息类型</span></span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> PointStamped</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"static_sub_p"</span>)</span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    listener = tf2_ros.TransformListener(buffer)</span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        <span class="comment"># 组织一个部件坐标系 </span></span><br><span class="line">        point_laser = PointStamped()</span><br><span class="line">        <span class="comment"># 部件坐标系名称</span></span><br><span class="line">        point_laser.header.frame_id = <span class="string">"laser"</span></span><br><span class="line">        <span class="comment"># 坐标点数据</span></span><br><span class="line">        point_laser.header.stamp = rospy.Time.now()</span><br><span class="line">        point_laser.point.x = <span class="number">2.0</span></span><br><span class="line">        point_laser.point.y = <span class="number">3.0</span></span><br><span class="line">        point_laser.point.z = <span class="number">5.0</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 组织一个转换参考系</span></span><br><span class="line">            point_base = PointStamped()</span><br><span class="line">            <span class="comment"># 坐标转换</span></span><br><span class="line">            point_base = buffer.transform(point_laser,<span class="string">"base_link"</span>)</span><br><span class="line">            rospy.loginfo(<span class="string">"转换后的坐标值:(%.2f,%.2f,%.2f),参考的坐标系:%s"</span>,</span><br><span class="line">                point_base.point.x,</span><br><span class="line">                point_base.point.y,</span><br><span class="line">                point_base.point.z,</span><br><span class="line">                point_base.header.frame_id)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="string">"异常:%s"</span>,e)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></tbody></table></figure>

<p>python 这里不写spin是因为python没有spinOnce，无法跳过循环</p>
<p>当坐标系之间的相对位置固定时，那么所需参数也是固定的，实现逻辑相同，参数不同，那么 ROS 系统就已经封装好了专门的节点，使用方式如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun tf2_ros static_transform_publisher x偏移量 y偏移量 z偏移量 z偏航角度 y俯仰角度 x翻滚角度 父级坐标系 子级坐标系</span><br></pre></td></tr></tbody></table></figure>

<p>其实父系就是代码中的原点坐标系，子级就是代码中的部件坐标系</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun tf2_ros static_transform_publisher 0.2 0 0.5 0 0 0 /base_link /laser</span><br></pre></td></tr></tbody></table></figure>

<p><font color="Violetred">建议使用该种方式直接实现静态坐标系相对信息发布</font></p>
<h4 id="动态坐标变换"><a href="#动态坐标变换" class="headerlink" title="动态坐标变换"></a>动态坐标变换</h4><p><strong>需求</strong>：</p>
<p>启动 turtlesim_node，该节点中窗体有一个世界坐标系(左下角为坐标系原点)，乌龟是另一个坐标系，键盘控制乌龟运动，将两个坐标系的相对位置动态发布</p>
<p>依赖同静态</p>
<p><strong>c++</strong></p>
<p>发布方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/Pose.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/transform_broadcaster.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/TransformStamped.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2/LinearMath/Quaternion.h"</span> </span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    发布方：需要订阅乌龟的位姿信息，转换成相对于窗体的坐标关系，并发布</span></span><br><span class="line"><span class="comment">    准 备</span></span><br><span class="line"><span class="comment">        话题：/turtle1/pose</span></span><br><span class="line"><span class="comment">        消息：/turtlesim/Pose</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; pose)</span></span>{</span><br><span class="line">    <span class="comment">// 获取位姿信息，转换成坐标系相对关系(核心),并发布</span></span><br><span class="line">    <span class="comment">// 创建发布对象</span></span><br><span class="line">    <span class="comment">// tf2_ros::TransformBroadcaster pub; 如果这么写每次处理都要创建一个新的发布对象</span></span><br><span class="line">    <span class="type">static</span> tf2_ros::TransformBroadcaster pub; <span class="comment">// 静态发布对象</span></span><br><span class="line">    <span class="comment">// 处理发布数据</span></span><br><span class="line">    geometry_msgs::TransformStamped tfs;</span><br><span class="line">    tfs.header.frame_id = <span class="string">"world"</span>;</span><br><span class="line">    tfs.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    tfs.child_frame_id = <span class="string">"turtle1"</span>;</span><br><span class="line">    <span class="comment">// 从乌龟位姿信息获取坐标</span></span><br><span class="line">    tfs.transform.translation.x = pose-&gt;x;</span><br><span class="line">    tfs.transform.translation.y = pose-&gt;y;</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 坐标系四元数</span></span><br><span class="line">    <span class="comment">// pose 信息中只有偏航yaw -&gt; theta,二维没有翻滚roll,俯仰pitch</span></span><br><span class="line">    <span class="comment">// 欧拉角为 (0,0,theta)</span></span><br><span class="line">    tf2::Quaternion qtn;</span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>,<span class="number">0</span>,pose-&gt;theta);</span><br><span class="line">    tfs.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    tfs.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    tfs.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    tfs.transform.rotation.w = qtn.<span class="built_in">getW</span>();</span><br><span class="line">    <span class="comment">// 发布</span></span><br><span class="line">    pub.<span class="built_in">sendTransform</span>(tfs);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"dynamic_pub"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 创建订阅对象</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">"turtle1/pose"</span>,<span class="number">100</span>,doPose);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>订阅方：</p>
<p>代码和静态的类似，可以直接复制粘贴改</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/transform_listener.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/buffer.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/PointStamped.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_geometry_msgs/tf2_geometry_msgs.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"dynamic_sub"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 创建TF订阅节点 -&gt; 订阅相对关系</span></span><br><span class="line">    <span class="comment">// 创建一个Buffer 缓存</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="comment">// 创建监听对象(可以将订阅数据放入buffer)</span></span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="comment">// 组织一个部件坐标系</span></span><br><span class="line">    geometry_msgs::PointStamped point_turtle;</span><br><span class="line">    point_turtle.header.frame_id = <span class="string">"turtle1"</span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 使用 try 语句或休眠，否则可能由于缓存接收延迟而导致坐标转换失败</span></span><br><span class="line">        point_turtle.header.stamp = ros::<span class="built_in">Time</span>(<span class="number">0.0</span>);</span><br><span class="line">        point_turtle.point.x = <span class="number">1</span>;</span><br><span class="line">        point_turtle.point.y = <span class="number">1</span>;</span><br><span class="line">        point_turtle.point.z = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 核心代码,将部件坐标系坐标点转化为原点坐标系坐标点</span></span><br><span class="line">            geometry_msgs::PointStamped point_world;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                调用的是buffer的转换函数transform</span></span><br><span class="line"><span class="comment">                参数1是被转换的坐标点</span></span><br><span class="line"><span class="comment">                参数2是目标坐标系</span></span><br><span class="line"><span class="comment">                返回输出的坐标点</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                PS:调用时需要加头文件 tf2_geometry_msgs/tf2_geometry_msgs.h</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            point_world = buffer.<span class="built_in">transform</span>(point_turtle,<span class="string">"world"</span>); </span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"转换后的坐标值:(%.2f,%.2f,%.2f),参考的坐标系:%s"</span>,</span><br><span class="line">                point_world.point.x,</span><br><span class="line">                point_world.point.y,</span><br><span class="line">                point_world.point.z,</span><br><span class="line">                point_world.header.frame_id.<span class="built_in">c_str</span>());</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"程序异常....."</span>);</span><br><span class="line">        }</span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>注意这里<code>ros::Time</code>不可以用now 了，因为动态使得部件位置一直在发生变化，buffer接收有延迟，使得部件相对位置和检测物体位置的时间戳匹配不上，这个时候就会报错，设置ros::time(0.0)或者空数值就可以避免这个问题(不考虑时间戳继续转化)</p>
<p><strong>python</strong></p>
<p>订阅方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"><span class="keyword">import</span> tf.transformations</span><br><span class="line"><span class="string">"""  </span></span><br><span class="line"><span class="string">    发布方：需要订阅乌龟的位姿信息，转换成相对于窗体的坐标关系，并发布</span></span><br><span class="line"><span class="string">    准 备</span></span><br><span class="line"><span class="string">        话题：/turtle1/pose</span></span><br><span class="line"><span class="string">        消息：/turtlesim/Pose</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doPose</span>(<span class="params">pose</span>):</span><br><span class="line">	<span class="comment"># 1. 创建发布坐标系相对关系的对象</span></span><br><span class="line">    pub = tf2_ros.TransformBroadcaster()</span><br><span class="line">    <span class="comment"># 2. 将pose转换成坐标系相对关系消息</span></span><br><span class="line">    tfs = TransformStamped()</span><br><span class="line">    tfs.header.frame_id = <span class="string">"world"</span></span><br><span class="line">    tfs.header.stamp = rospy.Time.now()</span><br><span class="line">    tfs.child_frame_id = <span class="string">"turtle1"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成部件坐标系相对于原点坐标系的偏移量</span></span><br><span class="line">    tfs.transform.translation.x = pose.x</span><br><span class="line">    tfs.transform.translation.y = pose.y</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 四元数,从欧拉角转换</span></span><br><span class="line">    qtn = tf.transformations.quaternion_from_euler(<span class="number">0</span>,<span class="number">0</span>,pose.theta)</span><br><span class="line">    tfs.transform.rotation.x = qtn[<span class="number">0</span>]</span><br><span class="line">    tfs.transform.rotation.y = qtn[<span class="number">1</span>]</span><br><span class="line">    tfs.transform.rotation.z = qtn[<span class="number">2</span>]</span><br><span class="line">    tfs.transform.rotation.w = qtn[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 发布</span></span><br><span class="line">    pub.sendTransform(tfs)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"dynamic_pub_p"</span>)</span><br><span class="line">    sub = rospy.Subscriber(<span class="string">"/turtle1/pose"</span>,Pose,doPose,queue_size=<span class="number">100</span>)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></tbody></table></figure>

<p>订阅方：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="comment"># 不要使用 geometry_msgs,需要使用 tf2 内置的消息类型</span></span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> PointStamped</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    rospy.init_node(<span class="string">"dynamic_sub_p"</span>)</span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    listener = tf2_ros.TransformListener(buffer)</span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    point_turtle = PointStamped()</span><br><span class="line">    point_turtle.header.frame_id = <span class="string">"turtle1"</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        point_turtle.header.stamp = rospy.Time()</span><br><span class="line">        point_turtle.point.x = <span class="number">1</span></span><br><span class="line">        point_turtle.point.y = <span class="number">1</span> </span><br><span class="line">        point_turtle.point.z = <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            point_world = buffer.transform(point_turtle,<span class="string">"world"</span>)</span><br><span class="line">            rospy.loginfo(<span class="string">"转换后的坐标值:(%.2f,%.2f,%.2f)"</span>,</span><br><span class="line">                point_world.point.x,</span><br><span class="line">                point_world.point.y,</span><br><span class="line">                point_world.point.z,)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.loginfo(<span class="string">"异常:%s"</span>,e)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></tbody></table></figure>

<h4 id="多坐标系变换"><a href="#多坐标系变换" class="headerlink" title="多坐标系变换"></a>多坐标系变换</h4><p><strong>需求</strong>：</p>
<p>现有坐标系统，父级坐标系统 world,下有两子级系统 son1，son2，son1 相对于 world，以及 son2 相对于 world 的关系是已知的，求 son1原点在 son2中的坐标，又已知在 son1中一点的坐标，要求求出该点在 son2 中的坐标</p>
<p>发布方：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;node pkg="tf2_ros" type="static_transform_publisher" name="son1" args="5 1 0 0 0 0 /world /son1" output="screen"/&gt;</span><br><span class="line">    &lt;node pkg="tf2_ros" type="static_transform_publisher" name="son2" args="-5 -1 0 0 0 0 /world /son2" output="screen"/&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>使用launch文件建立两个子坐标系</p>
<p>订阅方：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/transform_listener.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/buffer.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/PointStamped.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_geometry_msgs/tf2_geometry_msgs.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/TransformStamped.h"</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    订阅方实现：</span></span><br><span class="line"><span class="comment">        1. 计算son1与son2的相对关系</span></span><br><span class="line"><span class="comment">        2. 计算son1中的某个点在son2中的坐标值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"tfs_sub"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">sub</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="comment">// 创建坐标点</span></span><br><span class="line">    geometry_msgs::PointStamped psAtSon1;</span><br><span class="line">    psAtSon<span class="number">1.</span>header.frame_id = <span class="string">"son1"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>()){</span><br><span class="line"></span><br><span class="line">        psAtSon<span class="number">1.</span>header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">        psAtSon<span class="number">1.</span>point.x = <span class="number">1.0</span>;</span><br><span class="line">        psAtSon<span class="number">1.</span>point.y = <span class="number">2.0</span>;</span><br><span class="line">        psAtSon<span class="number">1.</span>point.z = <span class="number">3.0</span>;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            geometry_msgs::PointStamped psAtSon2;</span><br><span class="line">            <span class="comment">// 计算son1 和son2 的坐标关系</span></span><br><span class="line">            <span class="comment">// lookupTransform:参数1父级坐标系,参数2子坐标系,参数3ros::Time(0) 取间隔最小的两个时间戳进行计算</span></span><br><span class="line">            geometry_msgs::TransformStamped son1Toson2 = buffer.<span class="built_in">lookupTransform</span>(<span class="string">"son2"</span>,<span class="string">"son1"</span>,ros::<span class="built_in">Time</span>(<span class="number">0</span>));</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"son1 相对 son2 的信息: 父级:%s,子级:%s, 偏移量:(%.2f,%.2f,%.2f)"</span>,</span><br><span class="line">                    son1Toson<span class="number">2.</span>header.frame_id.<span class="built_in">c_str</span>(),</span><br><span class="line">                    son1Toson<span class="number">2.</span>child_frame_id.<span class="built_in">c_str</span>(),</span><br><span class="line">                    son1Toson<span class="number">2.</span>transform.translation.x,</span><br><span class="line">                    son1Toson<span class="number">2.</span>transform.translation.y,</span><br><span class="line">                    son1Toson<span class="number">2.</span>transform.translation.z</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 计算son1中某个点在son2中的坐标值</span></span><br><span class="line">            psAtSon2 = buffer.<span class="built_in">transform</span>(psAtSon1,<span class="string">"son2"</span>);</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"坐标点在Son2中的值:(%.2f,%.2f,%.2f)"</span>,</span><br><span class="line">                    psAtSon<span class="number">2.</span>point.x,</span><br><span class="line">                    psAtSon<span class="number">2.</span>point.y,</span><br><span class="line">                    psAtSon<span class="number">2.</span>point.z);</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"错误提示:%s"</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.导包</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> tf2_ros</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> TransformStamped</span><br><span class="line"><span class="keyword">from</span> tf2_geometry_msgs <span class="keyword">import</span> PointStamped</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.初始化 ROS 节点</span></span><br><span class="line">    rospy.init_node(<span class="string">"frames_sub_p"</span>)</span><br><span class="line">    <span class="comment"># 3.创建 TF 订阅对象</span></span><br><span class="line">    buffer = tf2_ros.Buffer()</span><br><span class="line">    listener = tf2_ros.TransformListener(buffer)</span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 4.调用 API 求出 son1 相对于 son2 的坐标关系</span></span><br><span class="line">            <span class="comment">#lookup_transform(self, target_frame, source_frame, time, timeout=rospy.Duration(0.0)):</span></span><br><span class="line">            tfs = buffer.lookup_transform(<span class="string">"son2"</span>,<span class="string">"son1"</span>,rospy.Time(<span class="number">0</span>))</span><br><span class="line">            rospy.loginfo(<span class="string">"son1 与 son2 相对关系:"</span>)</span><br><span class="line">            rospy.loginfo(<span class="string">"父级坐标系:%s"</span>,tfs.header.frame_id)</span><br><span class="line">            rospy.loginfo(<span class="string">"子级坐标系:%s"</span>,tfs.child_frame_id)</span><br><span class="line">            rospy.loginfo(<span class="string">"相对坐标:x=%.2f, y=%.2f, z=%.2f"</span>,</span><br><span class="line">                        tfs.transform.translation.x,</span><br><span class="line">                        tfs.transform.translation.y,</span><br><span class="line">                        tfs.transform.translation.z,</span><br><span class="line">            )</span><br><span class="line">        <span class="comment"># 5.创建一依赖于 son1 的坐标点，调用 API 求出该点在 son2 中的坐标</span></span><br><span class="line">            point_source = PointStamped()</span><br><span class="line">            point_source.header.frame_id = <span class="string">"son1"</span></span><br><span class="line">            point_source.header.stamp = rospy.Time.now()</span><br><span class="line">            point_source.point.x = <span class="number">1</span></span><br><span class="line">            point_source.point.y = <span class="number">1</span></span><br><span class="line">            point_source.point.z = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            point_target = buffer.transform(point_source,<span class="string">"son2"</span>,rospy.Duration(<span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">            rospy.loginfo(<span class="string">"point_target 所属的坐标系:%s"</span>,point_target.header.frame_id)</span><br><span class="line">            rospy.loginfo(<span class="string">"坐标点相对于 son2 的坐标:(%.2f,%.2f,%.2f)"</span>,</span><br><span class="line">                        point_target.point.x,</span><br><span class="line">                        point_target.point.y,</span><br><span class="line">                        point_target.point.z</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            rospy.logerr(<span class="string">"错误提示:%s"</span>,e)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></tbody></table></figure>

<h4 id="坐标系关系查看"><a href="#坐标系关系查看" class="headerlink" title="坐标系关系查看"></a>坐标系关系查看</h4><p>在机器人系统中，涉及的坐标系有多个，为了方便查看，ros 提供了专门的工具，可以用于生成显示坐标系关系的 pdf 文件，该文件包含树形结构的坐标系图谱</p>
<p>安装指令</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-noetic-tf2-tools</span><br></pre></td></tr></tbody></table></figure>

<p>启动坐标系广播程序之后，运行如下命令:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun tf2_tools view_frames.py</span><br></pre></td></tr></tbody></table></figure>

<p>会产生类似于下面的日志信息:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [1592920556.827549]: Listening to tf data during 5 seconds...</span><br><span class="line">[INFO] [1592920561.841536]: Generating graph in frames.pdf file...</span><br></pre></td></tr></tbody></table></figure>

<p>查看当前目录会生成一个 frames.pdf 文件</p>
<p>可以直接进入目录打开文件，或者调用命令查看文件:<code>evince frames.pdf</code></p>
<h4 id="坐标变换实操"><a href="#坐标变换实操" class="headerlink" title="坐标变换实操"></a>坐标变换实操</h4><p>需求描述：程序启动之初产生两只乌龟，中间的乌龟(A) 和 左下乌龟(B)，B 会自动运行至A的位置，并且键盘控制时，只是控制 A 的运动，但是 B 可以跟随 A 运行</p>
<p>实现分析：</p>
<p>乌龟跟随实现的核心，是乌龟A和B都要发布相对世界坐标系的坐标信息，然后，订阅到该信息需要转换获取A相对于B坐标系的信息，最后，再生成速度信息，并控制B运动。</p>
<ol>
<li>启动乌龟显示节点</li>
<li>在乌龟显示窗体中生成一只新的乌龟(需要使用服务)</li>
<li>编写两只乌龟发布坐标信息的节点</li>
<li>编写订阅节点订阅坐标信息并生成新的相对关系生成速度信息</li>
</ol>
<p>实现流程：</p>
<ol>
<li>新建功能包，添加依赖</li>
<li>编写服务客户端，用于生成一只新的乌龟</li>
<li>编写发布方，发布两只乌龟的坐标信息</li>
<li>编写订阅方，订阅两只乌龟信息，生成速度信息并发布</li>
<li>运行</li>
</ol>
<p>创建第二只乌龟需要使用rosservice，话题使用的是 spawn</p>
<p>位置信息通过话题 /乌龟名称/pose 来获取的</p>
<p>创建功能包依赖于 tf2、tf2_ros、tf2_geometry_msgs、roscpp rospy std_msgs geometry_msgs、turtlesim</p>
<p><strong>服务客户端(生成乌龟)</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/Spawn.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"turtle_new"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 创建客户端</span></span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">"/spawn"</span>);</span><br><span class="line">    <span class="comment">// 请求内容</span></span><br><span class="line">    turtlesim::Spawn spawn;</span><br><span class="line">    spawn.request.x = <span class="number">1</span>;</span><br><span class="line">    spawn.request.y = <span class="number">3</span>;</span><br><span class="line">    spawn.request.theta = <span class="number">1.57</span>;</span><br><span class="line">    spawn.request.name = <span class="string">"turtle2"</span>;</span><br><span class="line">    <span class="comment">// 等待服务器启动</span></span><br><span class="line">    client.<span class="built_in">waitForExistence</span>();</span><br><span class="line">    <span class="comment">// call 发送请求,flag反应结果</span></span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(spawn);</span><br><span class="line">    <span class="keyword">if</span>(flag)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"新的乌龟生成,名称:%s"</span>,spawn.response.name.<span class="built_in">c_str</span>());</span><br><span class="line">    }<span class="keyword">else</span> {</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"乌龟生成失败！！！"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>发布方(发布两只乌龟的坐标信息)</strong></p>
<ul>
<li>该节点需要启动两次</li>
<li>每次启动时都需要传入乌龟节点名称(第一次是 turtle1 第二次是 turtle2)</li>
</ul>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/Pose.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/transform_broadcaster.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/TransformStamped.h"</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2/LinearMath/Quaternion.h"</span> </span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    发布方：需要订阅乌龟的位姿信息，转换成相对于窗体的坐标关系，并发布</span></span><br><span class="line"><span class="comment">    准 备</span></span><br><span class="line"><span class="comment">        话题：/turtle1/pose</span></span><br><span class="line"><span class="comment">        消息：/turtlesim/Pose</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明传入的变量</span></span><br><span class="line">std::string turtle_name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; pose)</span></span>{</span><br><span class="line">    <span class="comment">// 获取位姿信息，转换成坐标系相对关系(核心),并发布</span></span><br><span class="line">    <span class="comment">// 创建发布对象</span></span><br><span class="line">    <span class="comment">// tf2_ros::TransformBroadcaster pub; 如果这么写每次处理都要创建一个新的发布对象</span></span><br><span class="line">    <span class="type">static</span> tf2_ros::TransformBroadcaster pub; <span class="comment">// 静态发布对象</span></span><br><span class="line">    <span class="comment">// 处理发布数据</span></span><br><span class="line">    geometry_msgs::TransformStamped tfs;</span><br><span class="line">    tfs.header.frame_id = <span class="string">"world"</span>;</span><br><span class="line">    tfs.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    <span class="comment">// tfs.child_frame_id 动态传入</span></span><br><span class="line">    tfs.child_frame_id = turtle_name;</span><br><span class="line">    <span class="comment">// 从乌龟位姿信息获取坐标</span></span><br><span class="line">    tfs.transform.translation.x = pose-&gt;x;</span><br><span class="line">    tfs.transform.translation.y = pose-&gt;y;</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 坐标系四元数</span></span><br><span class="line">    <span class="comment">// pose 信息中只有偏航yaw -&gt; theta,二维没有翻滚roll,俯仰pitch</span></span><br><span class="line">    <span class="comment">// 欧拉角为 (0,0,theta)</span></span><br><span class="line">    tf2::Quaternion qtn;</span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>,<span class="number">0</span>,pose-&gt;theta);</span><br><span class="line">    tfs.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    tfs.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    tfs.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    tfs.transform.rotation.w = qtn.<span class="built_in">getW</span>();</span><br><span class="line">    <span class="comment">// 发布</span></span><br><span class="line">    pub.<span class="built_in">sendTransform</span>(tfs);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"dynamic_pub"</span>);</span><br><span class="line">    <span class="comment">// 解析argc传入的参数</span></span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">"请传入一个参数"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }<span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        turtle_name = argv[<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"乌龟 %s 坐标发送启动"</span>,turtle_name.<span class="built_in">c_str</span>());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 创建订阅对象,订阅话题动态传入</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(turtle_name + <span class="string">"/pose"</span>,<span class="number">100</span>,doPose);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>订阅方(解析坐标信息并生成速度信息)</strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/transform_listener.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_ros/buffer.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/PointStamped.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"tf2_geometry_msgs/tf2_geometry_msgs.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/TransformStamped.h"</span> <span class="comment">// buffer.lookupTransform 返回值类型</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/Twist.h"</span> <span class="comment">//速度信息</span></span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    订阅方实现：</span></span><br><span class="line"><span class="comment">        1. 计算turtle1相对turtle2的关系</span></span><br><span class="line"><span class="comment">        2. 计算线速度和角速度发布</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"control"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>; <span class="comment">// 不能删监听器</span></span><br><span class="line">    <span class="comment">// 创建发布对象</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">"/turtle2/cmd_vel"</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>()){</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// 参数1父级坐标系,参数2子坐标系,参数3ros::Time(0) 取间隔最小的两个时间戳进行计算</span></span><br><span class="line">            geometry_msgs::TransformStamped tfs = buffer.<span class="built_in">lookupTransform</span>(<span class="string">"turtle2"</span>,<span class="string">"turtle1"</span>,ros::<span class="built_in">Time</span>(<span class="number">0</span>));</span><br><span class="line">            <span class="comment">// ROS_INFO("%s 相对 %s 的偏移量:(%.2f,%.2f,%.2f)",</span></span><br><span class="line">            <span class="comment">//         tfs.child_frame_id.c_str(),</span></span><br><span class="line">            <span class="comment">//         tfs.header.frame_id.c_str(),</span></span><br><span class="line">            <span class="comment">//         tfs.transform.translation.x,</span></span><br><span class="line">            <span class="comment">//         tfs.transform.translation.y,</span></span><br><span class="line">            <span class="comment">//         tfs.transform.translation.z</span></span><br><span class="line">            <span class="comment">//     );</span></span><br><span class="line">            geometry_msgs::Twist twist;</span><br><span class="line">            <span class="comment">// 2D只需要配置角速度z和线速度x</span></span><br><span class="line">            <span class="comment">// x = 系数*\sqrt{(y^2+x^2)}</span></span><br><span class="line">            <span class="comment">// z = 系数*arctan(y/x)</span></span><br><span class="line">            twist.linear.x = <span class="number">0.5</span> * <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(tfs.transform.translation.x,<span class="number">2</span>)+<span class="built_in">pow</span>(tfs.transform.translation.y,<span class="number">2</span>));</span><br><span class="line">            twist.angular.z = <span class="number">0.5</span> * <span class="built_in">atan2</span>(tfs.transform.translation.y,tfs.transform.translation.x);</span><br><span class="line">            <span class="comment">// 发布</span></span><br><span class="line">            pub.<span class="built_in">publish</span>(twist);</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">"错误提示:%s"</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        }</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>(); </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>运行</strong></p>
<p>使用launch文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 启动乌龟GUI节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"turtlesim"</span> <span class="attr">type</span>=<span class="string">"turtlesim_node"</span> <span class="attr">name</span>=<span class="string">"turtle1"</span> <span class="attr">output</span>=<span class="string">"screen"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"turtlesim"</span> <span class="attr">type</span>=<span class="string">"turtle_teleop_key"</span> <span class="attr">name</span>=<span class="string">"key"</span> <span class="attr">output</span>=<span class="string">"screen"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2. 生成新乌龟节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"tf04_test"</span> <span class="attr">type</span>=<span class="string">"new_turtle"</span> <span class="attr">name</span>=<span class="string">"turtle2"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3. 设置两个乌龟相对于世界坐标的发布 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"tf04_test"</span> <span class="attr">type</span>=<span class="string">"dynamic_pub"</span> <span class="attr">name</span>=<span class="string">"pub1"</span> <span class="attr">args</span>=<span class="string">"turtle1"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"tf04_test"</span> <span class="attr">type</span>=<span class="string">"dynamic_pub"</span> <span class="attr">name</span>=<span class="string">"pub2"</span> <span class="attr">args</span>=<span class="string">"turtle2"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 4. 订阅两只乌龟相对于世界坐标系的信息,并转化为turtle1相对于turtle2的坐标关系</span></span><br><span class="line"><span class="comment">            再生成速度信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"tf04_test"</span> <span class="attr">type</span>=<span class="string">"control"</span> <span class="attr">name</span>=<span class="string">"control"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="rosbag"><a href="#rosbag" class="headerlink" title="rosbag"></a>rosbag</h3><p>机器人传感器获取到的信息，有时我们可能需要时时处理，有时可能只是采集数据，事后分析</p>
<p>机器人导航实现中，可能需要绘制导航所需的全局地图，地图绘制实现，有两种方式</p>
<ul>
<li>方式1：控制机器人运动，将机器人传感器感知到的数据时时处理，生成地图信息</li>
<li>方式2：控制机器人运动，将机器人传感器感知到的数据留存，事后再重新读取数据，生成地图信息</li>
</ul>
<p>两种方式比较，显然方式2使用上更为灵活方便</p>
<p>在ROS中关于数据的留存以及读取实现，提供了专门的工具: rosbag</p>
<p>rosbag是用于录制和回放 ROS 主题的一个工具集</p>
<p>本质也是ros的节点，当录制时，rosbag是一个订阅节点，可以订阅话题消息并将订阅到的数据写入磁盘文件；当重放时，rosbag是一个发布节点，可以读取磁盘文件，发布文件中的话题消息</p>
<h4 id="通过命令行"><a href="#通过命令行" class="headerlink" title="通过命令行"></a>通过命令行</h4><p>创建目录保存录制的文件 比如根目录下创建bsgs文件夹</p>
<p>开始录制（-a指的是全部）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosbag record -a -O [bags/turtle.bag]</span><br></pre></td></tr></tbody></table></figure>

<p>操作小乌龟一段时间，结束录制使用 ctrl + c，在创建的目录中会生成bag文件</p>
<p>此时文件命名为turtle_[时间戳]</p>
<p>查看文件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosbag info [bags/turtle TAB]</span><br></pre></td></tr></tbody></table></figure>

<p>回放文件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosbag play [bags/turtle TAB]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun rosbag play [bags/turtle TAB]</span><br></pre></td></tr></tbody></table></figure>

<p>重启乌龟节点，会发现，乌龟按照录制时的轨迹运动</p>
<h4 id="通过编码"><a href="#通过编码" class="headerlink" title="通过编码"></a>通过编码</h4><p><strong>c++</strong></p>
<p>写：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rosbag/bag.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/String.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"bag_write"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 创建rosbag对象</span></span><br><span class="line">    rosbag::Bag bag;</span><br><span class="line">    <span class="comment">// 打开文件流</span></span><br><span class="line">    bag.<span class="built_in">open</span>(<span class="string">"hello.bag"</span>,rosbag::BagMode::Write);</span><br><span class="line">    <span class="comment">// 写数据</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    msg.data = <span class="string">"hello xxx"</span>;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        参数1:话题</span></span><br><span class="line"><span class="comment">        参数2:时间戳</span></span><br><span class="line"><span class="comment">        参数3:消息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">"/chatter"</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    <span class="comment">// 关闭文件流(养成习惯,打开写完就写关)</span></span><br><span class="line">    bag.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>读：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rosbag/bag.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rosbag/view.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/String.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/Int32.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">""</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"bag_read"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 bag 对象</span></span><br><span class="line">    rosbag::Bag bag;</span><br><span class="line">    <span class="comment">// 打开 bag 文件</span></span><br><span class="line">    bag.<span class="built_in">open</span>(<span class="string">"hello.bag"</span>,rosbag::BagMode::Read);</span><br><span class="line">    <span class="comment">// 读数据</span></span><br><span class="line">    <span class="comment">// 可以先获取消息的集合，再迭代取出消息的字段</span></span><br><span class="line">    <span class="comment">// forrange 增强for循环</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;m : rosbag::<span class="built_in">View</span>(bag)) <span class="comment">// rosbag::View 解析信息</span></span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// 解析, 对应的函数类型可以看函数返回值</span></span><br><span class="line">        std::string topic =  m.<span class="built_in">getTopic</span>();</span><br><span class="line">        ros::Time time = m.<span class="built_in">getTime</span>();</span><br><span class="line">        std_msgs::StringPtr p = m.<span class="built_in">instantiate</span>&lt;std_msgs::String&gt;();</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"解析的数据为:话题:%s,时间戳:%.2f,消息:%s"</span>,</span><br><span class="line">                topic.<span class="built_in">c_str</span>(),</span><br><span class="line">                time.<span class="built_in">toSec</span>(),</span><br><span class="line">                p-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 关闭文件流</span></span><br><span class="line">    bag.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>python</strong></p>
<p>写：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> rosbag</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	rospy.init_node(<span class="string">"write_bag_p"</span>)</span><br><span class="line">	<span class="comment"># 创建bag对象并打开数据流</span></span><br><span class="line">	bag = rosbag.Bag(<span class="string">"hello_p.bag"</span>,<span class="string">'w'</span>) <span class="comment"># 注意这里是'w'，不是双引号</span></span><br><span class="line">	<span class="comment"># 写数据</span></span><br><span class="line">	msg = String()</span><br><span class="line">	msg.data = <span class="string">"hello bag"</span></span><br><span class="line">	bag.write(<span class="string">"/chatter"</span>,msg)</span><br><span class="line">    <span class="comment"># 关闭数据流</span></span><br><span class="line">	bag.close()</span><br></pre></td></tr></tbody></table></figure>

<p>读：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> rosbag</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	rospy.init_node(<span class="string">"read_bag_p"</span>)</span><br><span class="line">	<span class="comment"># 创建bag对象并打开数据流</span></span><br><span class="line">	bag = rosbag.Bag(<span class="string">"hello_p.bag"</span>,<span class="string">'r'</span>)</span><br><span class="line">	<span class="comment"># 读数据</span></span><br><span class="line">	msgs = bag.read_messages(topics=<span class="string">"/chatter"</span>)</span><br><span class="line">	<span class="keyword">for</span> topic,msg,time <span class="keyword">in</span> msgs: <span class="comment"># 将返回的topic, message, timestamp赋到topic,msg,time</span></span><br><span class="line">		rospy.loginfo(<span class="string">"话题:%s,消息:%s,时间:%s"</span>,topic,msg,time)</span><br><span class="line">	bag.close()</span><br></pre></td></tr></tbody></table></figure>

<h3 id="rqt工具箱"><a href="#rqt工具箱" class="headerlink" title="rqt工具箱"></a>rqt工具箱</h3><p>ROS基于 QT 框架，针对机器人开发提供了一系列可视化的工具，这些工具的集合就是rqt</p>
<p>rqt 工具箱组成有三大部分</p>
<ul>
<li>rqt——核心实现，开发人员无需关注</li>
<li>rqt_common_plugins——rqt 中常用的工具套件</li>
<li>rqt_robot_plugins——运行中和机器人交互的插件(比如: rviz)</li>
</ul>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><p>一般只要安装的是desktop-full版本就会自带工具箱</p>
<p>如果需要安装可以以如下方式安装</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-noetic-rqt</span><br><span class="line">sudo apt-get install ros-noetic-rqt-common-plugins</span><br></pre></td></tr></tbody></table></figure>

<p><code>rqt</code>的启动方式有两种：</p>
<ul>
<li>方式1：rqt</li>
<li>方式2：rosrun rqt_gui rqt_gui</li>
</ul>
<p>启动 rqt 之后，可以通过 plugins 添加所需的插件</p>
<h4 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a>常用插件</h4><ul>
<li>rqt_graph：plugins/introspection/Node Graph or rqt_graph</li>
</ul>
<p>圆框是节点，方框是话题，箭头是数据的订阅发布方向</p>
<ul>
<li>rqt_console：plugins/Logging/Console or rqt_console</li>
</ul>
<p>ROS 中用于显示和过滤日志的图形化插件</p>
<p>编写 Node 节点输出各个级别的日志信息</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"ros/ros.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">"log_demo"</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">0.3</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">ROS_DEBUG</span>(<span class="string">"Debug message d"</span>);</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">"Info message oooo"</span>);</span><br><span class="line">        <span class="built_in">ROS_WARN</span>(<span class="string">"Warn message wwww"</span>);</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">"Erroe message EEEE"</span>);</span><br><span class="line">        <span class="built_in">ROS_FATAL</span>(<span class="string">"Fatal message FFFF"</span>);</span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/01_rqt_console插件.webp" alt="01_rqt_console插件" style="zoom: 67%;">

<ul>
<li>rqt_plot：plugins/Visualization/plot or rqt_plot</li>
</ul>
<p>图形绘制插件，可以以 2D 绘图的方式绘制发布在 topic 上的数据</p>
<ul>
<li>rqt_bag：plugins/Logging/Bag or rqt_bag</li>
</ul>
<p>录制和重放 bag 文件的图形化插件</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/14rqt_bag_录制.webp" alt="14rqt_bag_录制" style="zoom: 50%;">

<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/15rqt_bag_回放.webp" alt="15rqt_bag_回放" style="zoom: 50%;">
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://yhblogs.cn">今天睡够了吗</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://yhblogs.cn/posts/626062709.html">http://yhblogs.cn/posts/626062709.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yhblogs.cn" target="_blank">がんばろう</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%F0%9F%A4%96ROS/">🤖ROS</a></div><div class="post_share"><div class="social-share" data-image="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/ros-logo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/3254549402.html" title="ROS机器人系统"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-1q83qg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ROS机器人系统</div></div></a></div><div class="next-post pull-right"><a href="/posts/4024736854.html" title="OpenAI使用指南"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/what-is-openai.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">OpenAI使用指南</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/3894864178.html" title="ROS2理论"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-5g22q5_1920x1080_compressed.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-30</div><div class="title">ROS2理论</div></div></a></div><div><a href="/posts/3254549402.html" title="ROS机器人系统"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-1q83qg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-10</div><div class="title">ROS机器人系统</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/b_2a1aef95f351a5f7ef72eb81e6838fd6.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">今天睡够了吗</div><div class="author-info__description">相遇是最小单位的奇迹</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/202206071549233.webp" target="_blank" title="QQ"><i class="iconfont icon-QQ"></i></a><a class="social-icon" href="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/202206071549234.webp" target="_blank" title="微信"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://space.bilibili.com/277953459?spm_id_from=333.1007.0.0" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="https://github.com/YaoHui-Wu06022" target="_blank" title="Github"><i class="iconfont icon-GitHub"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">保持理智，相信明天</div><div class="twopeople"><div class="twopeople"><div class="container" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div> <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script> <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script> <script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script> <style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.</span> <span class="toc-text">代码模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%88%9D%E8%AE%A4%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">ROS环境搭建与初认识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">ROS安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">2.2.</span> <span class="toc-text">ROS集成开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%88%E7%AB%AF"><span class="toc-number">2.2.1.</span> <span class="toc-text">终端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VScode"><span class="toc-number">2.2.2.</span> <span class="toc-text">VScode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#launch%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.3.</span> <span class="toc-text">launch文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS%E6%9E%B6%E6%9E%84"><span class="toc-number">2.3.</span> <span class="toc-text">ROS架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.3.1.</span> <span class="toc-text">文件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.</span> <span class="toc-text">文件系统相关命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%9B%BE"><span class="toc-number">2.3.3.</span> <span class="toc-text">计算图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">ROS通信机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="toc-number">3.1.</span> <span class="toc-text">话题通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%96%87%E6%9C%AC"><span class="toc-number">3.1.1.</span> <span class="toc-text">普通文本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89msg"><span class="toc-number">3.1.2.</span> <span class="toc-text">自定义msg</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1"><span class="toc-number">3.2.</span> <span class="toc-text">服务通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89srv"><span class="toc-number">3.2.1.</span> <span class="toc-text">自定义srv</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">3.3.</span> <span class="toc-text">参数服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E5%AE%9E%E6%93%8D"><span class="toc-number">3.5.</span> <span class="toc-text">通信机制实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D1-%E8%AF%9D%E9%A2%98%E5%8F%91%E5%B8%83"><span class="toc-number">3.5.1.</span> <span class="toc-text">实操1 话题发布</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D2-%E8%AF%9D%E9%A2%98%E8%AE%A2%E9%98%85"><span class="toc-number">3.5.2.</span> <span class="toc-text">实操2 话题订阅</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D3-%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8"><span class="toc-number">3.5.3.</span> <span class="toc-text">实操3 服务调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D4-%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.5.4.</span> <span class="toc-text">实操4 参数设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E6%AF%94%E8%BE%83"><span class="toc-number">3.6.</span> <span class="toc-text">通信机制比较</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E8%BF%9B%E9%98%B6"><span class="toc-number">4.</span> <span class="toc-text">ROS通信机制进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8API"><span class="toc-number">4.1.</span> <span class="toc-text">常用API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.1.</span> <span class="toc-text">初始化函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E4%B8%8E%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.1.2.</span> <span class="toc-text">话题与服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.3.</span> <span class="toc-text">回调函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4"><span class="toc-number">4.1.4.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.5.</span> <span class="toc-text">其它函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6%E4%B8%8E%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">头文件与源文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%B4%E6%96%87%E4%BB%B6%E8%B0%83%E7%94%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">自定义头文件调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BA%90%E6%96%87%E4%BB%B6%E8%B0%83%E7%94%A8"><span class="toc-number">4.2.2.</span> <span class="toc-text">自定义源文件调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5"><span class="toc-number">4.3.</span> <span class="toc-text">Python模块导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">ROS运行管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-number">5.1.</span> <span class="toc-text">元功能包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#launch%E6%96%87%E4%BB%B6-1"><span class="toc-number">5.2.</span> <span class="toc-text">launch文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E8%A6%86%E7%9B%96"><span class="toc-number">5.3.</span> <span class="toc-text">工作空间覆盖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E5%90%8D%E7%A7%B0%E9%87%8D%E5%90%8D"><span class="toc-number">5.4.</span> <span class="toc-text">节点名称重名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rosrun%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.1.</span> <span class="toc-text">rosrun实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#launch%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.2.</span> <span class="toc-text">launch实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.3.</span> <span class="toc-text">编码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E5%90%8D%E7%A7%B0%E9%87%8D%E5%90%8D"><span class="toc-number">5.5.</span> <span class="toc-text">话题名称重名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rosrun%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">5.5.1.</span> <span class="toc-text">rosrun实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#launch%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">5.5.2.</span> <span class="toc-text">launch实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">5.5.3.</span> <span class="toc-text">编码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%90%8D%E7%A7%B0%E9%87%8D%E5%90%8D"><span class="toc-number">5.6.</span> <span class="toc-text">参数名称重名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rosrun%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">5.6.1.</span> <span class="toc-text">rosrun实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#launch%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">5.6.2.</span> <span class="toc-text">launch实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">5.6.3.</span> <span class="toc-text">编码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%80%9A%E4%BF%A1"><span class="toc-number">5.7.</span> <span class="toc-text">分布式通信</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">ROS常用组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TF%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">6.1.</span> <span class="toc-text">TF坐标变换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%90%E6%A0%87msg%E6%B6%88%E6%81%AF"><span class="toc-number">6.1.1.</span> <span class="toc-text">坐标msg消息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">6.1.2.</span> <span class="toc-text">静态坐标变换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">6.1.3.</span> <span class="toc-text">动态坐标变换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%9D%90%E6%A0%87%E7%B3%BB%E5%8F%98%E6%8D%A2"><span class="toc-number">6.1.4.</span> <span class="toc-text">多坐标系变换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E7%B3%BB%E5%85%B3%E7%B3%BB%E6%9F%A5%E7%9C%8B"><span class="toc-number">6.1.5.</span> <span class="toc-text">坐标系关系查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E5%AE%9E%E6%93%8D"><span class="toc-number">6.1.6.</span> <span class="toc-text">坐标变换实操</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rosbag"><span class="toc-number">6.2.</span> <span class="toc-text">rosbag</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-number">6.2.1.</span> <span class="toc-text">通过命令行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BC%96%E7%A0%81"><span class="toc-number">6.2.2.</span> <span class="toc-text">通过编码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rqt%E5%B7%A5%E5%85%B7%E7%AE%B1"><span class="toc-number">6.3.</span> <span class="toc-text">rqt工具箱</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">6.3.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6"><span class="toc-number">6.3.2.</span> <span class="toc-text">常用插件</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2022 - 2025 By 今天睡够了吗</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">You must always have faith in who you are！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>