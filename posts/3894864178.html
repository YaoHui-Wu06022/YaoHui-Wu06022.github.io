<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ROS2ç†è®º | ãŒã‚“ã°ã‚ã†</title><meta name="author" content="ä»Šå¤©ç¡å¤Ÿäº†å—"><meta name="copyright" content="ä»Šå¤©ç¡å¤Ÿäº†å—"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ¨¡æ¿VScodeé…ç½®æ¨¡æ¿ cppï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041{  &quot;ROS2 C++ Node Template&quot;: {    &quot;prefix&quot;: &quot;ros2cpp&quot;,    &quot;body&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS2ç†è®º">
<meta property="og:url" content="http://yhblogs.cn/posts/3894864178.html">
<meta property="og:site_name" content="ãŒã‚“ã°ã‚ã†">
<meta property="og:description" content="æ¨¡æ¿VScodeé…ç½®æ¨¡æ¿ cppï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041{  &quot;ROS2 C++ Node Template&quot;: {    &quot;prefix&quot;: &quot;ros2cpp&quot;,    &quot;body&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-5g22q5_1920x1080_compressed.png">
<meta property="article:published_time" content="2025-06-30T15:45:57.000Z">
<meta property="article:modified_time" content="2026-01-31T12:00:30.720Z">
<meta property="article:author" content="ä»Šå¤©ç¡å¤Ÿäº†å—">
<meta property="article:tag" content="ğŸ¤–ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-5g22q5_1920x1080_compressed.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yhblogs.cn/posts/3894864178.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ROS2ç†è®º',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2026-01-31 12:00:30'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_3319458_ks437t3n4r.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/b_2a1aef95f351a5f7ef72eb81e6838fd6.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">81</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">1</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-rili"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> æ ‡ç­¾</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="ãŒã‚“ã°ã‚ã†"><img class="site-icon" src="/img/favicon.png"><span class="site-name">ãŒã‚“ã°ã‚ã†</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-rili"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> æ ‡ç­¾</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">ROS2ç†è®º</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">å‘è¡¨äº</span><time datetime="2025-06-30T15:45:57.000Z" title="å‘è¡¨äº 2025-06-30 15:45:57">2025-06-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">25.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>101åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ROS2ç†è®º"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h2><p>VScodeé…ç½®æ¨¡æ¿</p>
<p>cppï¼š</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"ROS2 C++ Node Template"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"prefix"</span><span class="punctuation">:</span> <span class="string">"ros2cpp"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"body"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">"/*"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  éœ€æ±‚:"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  æ­¥éª¤:"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    1.åŒ…å«å¤´æ–‡ä»¶ï¼›"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    "</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆ;"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    5.é‡Šæ”¾èµ„æºã€‚"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"*/"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"#include \"rclcpp/rclcpp.hpp\""</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"class ${1:MyNode}: public rclcpp::Node{ "</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"public:"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    $1():Node(\"mynode_node_cpp\"){  // èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"        RCLCPP_INFO(this-&gt;get_logger(),\"åˆ›å»ºæˆåŠŸ!\");"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"    }"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"};"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"int main(int argc, char ** argv)"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"{"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  // 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  rclcpp::init(argc,argv);"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  // 4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡;"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  rclcpp::spin(std::make_shared&lt;$1&gt;()); "</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  // 5.é‡Šæ”¾èµ„æºã€‚"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  rclcpp::shutdown();"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"  return 0;"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">"}"</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"A cpp file template"</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>launch.pyï¼š</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"ROS2 Launch Template"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"prefix"</span><span class="punctuation">:</span> <span class="string">"ros2_launch"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"body"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">"from launch import LaunchDescription"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"from launch_ros.actions import Node"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"def generate_launch_description():"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"    return LaunchDescription([])"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"A template for ROS2 launch files"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ROS2ä¸­ï¼š</p>
<ul>
<li>èŠ‚ç‚¹åˆ›å»ºæ–¹æ³•è®¾ä¸ºpublic</li>
<li>å†…éƒ¨ç»„ä»¶(publisher/subscriberç­‰)è®¾ä¸ºprivate</li>
</ul>
<p>ROS ç»„ä»¶é€šå¸¸åŠ ä¸‹åˆ’çº¿åç¼€è¡¨ç¤ºæˆå‘˜å˜é‡(client_)ï¼ŒèŠ‚ç‚¹å®ä¾‹å¸¸ç”¨ç®€å•åç§°è¡¨ç¤ºä¸»è¦å¯¹è±¡(client)</p>
<p><strong>å¸¸è§å‡½æ•°ï¼š</strong></p>
<p><code>std::bind(&amp;MyNode::Fuc,this,_[i])</code>ç»‘å®šæˆå‘˜å‡½æ•°</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºå¯¹è±¡çš„æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆ </li>
<li>ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå¯¹è±¡çš„åœ°å€ </li>
<li>åé¢ä¸ºè¾“å…¥å‚æ•°ç•™ç©º <code>using std::placeholders::_[i]</code></li>
</ul>
<p><code>std::make_shared&lt;MyNode&gt;()</code>åˆ›å»ºèŠ‚ç‚¹æŒ‡é’ˆ</p>
<ul>
<li>&lt;&gt;å†…ä¸ºèŠ‚ç‚¹ç±»å‹</li>
<li>è¿”å›å€¼ä¸º<code>std::shared_ptr</code>ç±»å‹å¯¹è±¡</li>
</ul>
<p><font color="Violetred">æ³¨æ„ï¼Œåˆ›å»ºå‡½æ•°çš„æ—¶å€™<code>SharedPtr</code> å·²ç»ä»£è¡¨æŒ‡é’ˆï¼Œä¸è¦å¸¦&amp;</font></p>
<p><code>using namespace std::placeholders</code> å®ç°å‡½æ•°å ä½ç¬¦</p>
<p><code>using namespace std::chrono_literals</code> å¯ä»¥ç›´æ¥è¾“å…¥æ—¶é—´</p>
<p>C++ lambdaå‡½æ•°ï¼šåŒ¿åå‡½æ•°</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[capture list] (parameter list) -&gt; <span class="keyword">return</span> type { function body }</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ROS2æ¦‚è¿°ä¸ç¯å¢ƒæ­å»º"><a href="#ROS2æ¦‚è¿°ä¸ç¯å¢ƒæ­å»º" class="headerlink" title="ROS2æ¦‚è¿°ä¸ç¯å¢ƒæ­å»º"></a>ROS2æ¦‚è¿°ä¸ç¯å¢ƒæ­å»º</h2><h3 id="ROS2ç®€ä»‹"><a href="#ROS2ç®€ä»‹" class="headerlink" title="ROS2ç®€ä»‹"></a>ROS2ç®€ä»‹</h3><p>æ•´ä¸ªROSç”Ÿæ€ç”±é€šä¿¡ï¼ˆPlumbingï¼‰ã€å·¥å…·ï¼ˆToolsï¼‰ã€åŠŸèƒ½ï¼ˆCapabilitiesï¼‰ä¸ç¤¾åŒºï¼ˆCommunityï¼‰å››å¤§éƒ¨åˆ†ç»„æˆ</p>
<p><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/ROS%E7%BB%84%E6%88%90%E4%BD%93%E7%B3%BB.png" alt="ROSç»„æˆä½“ç³»"></p>
<p>ROS2æ˜¯å…¨æ–°ä¸€ä»£æœºå™¨äººæ“ä½œç³»ç»Ÿï¼Œä¸åªæ˜¯åŠŸèƒ½å¢å¼ºçš„ROS1</p>
<p>æœ¬æ–‡æ¡£é‡‡ç”¨çš„æ˜¯ROS2çš„humbleç‰ˆæœ¬ï¼Œè¿è¡Œåœ¨Linuxï¼ˆUbuntu 22.04ï¼‰æ“ä½œç³»ç»Ÿä¸Š</p>
<h3 id="ROS2å¯¹æ¯”ROS"><a href="#ROS2å¯¹æ¯”ROS" class="headerlink" title="ROS2å¯¹æ¯”ROS"></a>ROS2å¯¹æ¯”ROS</h3><p>ROS 1ï¼šå›´ç»•ä¸€ä¸ªé›†ä¸­å¼çš„ ROS Master èŠ‚ç‚¹æ„å»ºï¼Œå®ƒè´Ÿè´£èŠ‚ç‚¹å‘ç°ã€æ³¨å†Œã€è¿æ¥å»ºç«‹ï¼ˆä¸»é¢˜ã€æœåŠ¡ã€åŠ¨ä½œæœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼‰å’Œå‚æ•°æœåŠ¡å™¨ã€‚èŠ‚ç‚¹é—´é€šä¿¡ä¸»è¦ä½¿ç”¨ <strong>TCPROS/UDPROS</strong> ç­‰è‡ªå®šä¹‰åè®®</p>
<p>ROS 2ï¼šé‡‡ç”¨å®Œå…¨å»ä¸­å¿ƒåŒ–çš„è®¾è®¡ï¼Œå®ƒåŸºäºæ•°æ®åˆ†å‘æœåŠ¡ (DDS) æ ‡å‡†ä½œä¸ºå…¶é»˜è®¤çš„ä¸­é—´ä»¶ã€‚DDS æœ¬èº«å°±æ˜¯ä¸€ä¸ªæˆç†Ÿã€æ ‡å‡†åŒ–ã€å»ä¸­å¿ƒåŒ–çš„å‘å¸ƒ/è®¢é˜…æ¡†æ¶ï¼Œå†…ç½®äº†ä¸°å¯Œçš„æœåŠ¡è´¨é‡å’Œå‘ç°æœºåˆ¶</p>
<p>ROS2ç§»é™¤ Master æ¶ˆé™¤äº†å•ç‚¹æ•…éšœï¼Œæ„å»ºç³»ç»Ÿä»Catkinâ†’Ament / Colcon</p>
<h3 id="ROS2å®‰è£…"><a href="#ROS2å®‰è£…" class="headerlink" title="ROS2å®‰è£…"></a>ROS2å®‰è£…</h3><p>è™šæ‹Ÿæœºéƒ¨åˆ†è½¬ROSæ–‡æ¡£</p>
<p>å®‰è£…Ubuntuåéœ€è¦æŠŠå½“å‰ç”¨æˆ·è®¾ä¸ºç®¡ç†å‘˜ï¼Œå¦åˆ™sudoä¼šå¤±è´¥</p>
<p>å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å‡†å¤‡1ï¼šè®¾ç½®è¯­è¨€ç¯å¢ƒï¼›</li>
<li>å‡†å¤‡2ï¼šå¯åŠ¨Ubuntu universeå­˜å‚¨åº“ï¼›</li>
<li>è®¾ç½®è½¯ä»¶æºï¼›</li>
<li>å®‰è£…ROS2ï¼›</li>
<li>é…ç½®ç¯å¢ƒã€‚</li>
</ol>
<p><strong>å‡†å¤‡1ï¼šè®¾ç½®è¯­è¨€ç¯å¢ƒ</strong></p>
<p>è¯·å…ˆæ£€æŸ¥æœ¬åœ°è¯­è¨€ç¯å¢ƒæ˜¯å¦æ”¯æŒUTF-8ç¼–ç ï¼Œå¯è°ƒç”¨å¦‚ä¸‹æŒ‡ä»¤æ£€æŸ¥å¹¶è®¾ç½®UTF-8ç¼–ç ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">locale  # æ£€æŸ¥æ˜¯å¦æ”¯æŒ UTF-8</span><br><span class="line">sudo apt update &amp;&amp; sudo apt install locales</span><br><span class="line">sudo locale-gen en_US en_US.UTF-8</span><br><span class="line">sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8</span><br><span class="line">export LANG=en_US.UTF-8</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„ï¼šè¯­è¨€ç¯å¢ƒå¯ä»¥ä¸åŒï¼Œä½†å¿…é¡»æ”¯æŒUTF-8ç¼–ç </p>
<p><strong>å‡†å¤‡2ï¼šå¯åŠ¨Ubuntu universeå­˜å‚¨åº“</strong></p>
<p>æ‰“å¼€è½¯ä»¶ä¸æ›´æ–°(Software &amp; Updates)çª—å£ï¼Œç¡®ä¿å¯åŠ¨äº†universeå­˜å‚¨åº“ï¼Œä»¥ä¿è¯å¯ä»¥ä¸‹è½½â€ç¤¾åŒºç»´æŠ¤çš„å…è´¹å’Œå¼€æºè½¯ä»¶â€œ</p>
<p>ä¸‹è½½è‡ªå¯ä»¥æ”¹ä¸ºæ¸…åæº</p>
<p><strong>è®¾ç½®è½¯ä»¶æº</strong></p>
<p>å…ˆå°†ROS 2 aptå­˜å‚¨åº“æ·»åŠ åˆ°ç³»ç»Ÿï¼Œç”¨aptæˆæƒçš„GPGå¯†é’¥ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install curl gnupg lsb-release</span><br><span class="line">sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶åå°†å­˜å‚¨åº“æ·»åŠ åˆ°æºåˆ—è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $(source /etc/os-release &amp;&amp; echo $UBUNTU_CODENAME) main" | sudo tee /etc/apt/sources.list.d/ros2.list &gt; /dev/null</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®‰è£…ROS2</strong></p>
<p>é¦–å…ˆæ›´æ–°aptå­˜å‚¨åº“ç¼“å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶åå‡çº§å·²å®‰è£…çš„è½¯ä»¶(ROS2è½¯ä»¶åŒ…å»ºç«‹åœ¨ç»å¸¸æ›´æ–°çš„Ubuntuç³»ç»Ÿä¸Šï¼Œåœ¨å®‰è£…æ–°è½¯ä»¶åŒ…ä¹‹å‰è¯·ç¡®ä¿ç³»ç»Ÿæ˜¯æœ€æ–°çš„)ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt upgrade</span><br></pre></td></tr></tbody></table></figure>

<p>å®‰è£…æ¡Œé¢ç‰ˆROS2(å»ºè®®)ï¼ŒåŒ…å«ROSã€RVizã€ç¤ºä¾‹ä¸æ•™ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-humble-desktop</span><br></pre></td></tr></tbody></table></figure>

<p>è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæŠ¥é”™ï¼Œå®‰è£…å·¥å…·</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install aptitude </span><br><span class="line">sudo aptitude install xxx  # æ ¹æ®æ–¹æ¡ˆæ¥è§£å†³å®‰è£…æŠ¥é”™é—®é¢˜</span><br></pre></td></tr></tbody></table></figure>

<p><strong>é…ç½®ç¯å¢ƒ</strong></p>
<p>ç»ˆç«¯ä¸‹ï¼Œæ‰§è¡ŒROS2ç¨‹åºæ—¶ï¼Œéœ€è¦è°ƒç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®ç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /opt/ros/humble/setup.bash</span><br></pre></td></tr></tbody></table></figure>

<p>æ¯æ¬¡æ–°å¼€ç»ˆç«¯æ—¶ï¼Œéƒ½å¾—æ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œæˆ–è€…å°†é…ç½®ç¯å¢ƒæŒ‡ä»¤å†™å…¥ â€~/.bashrcâ€œ æ–‡ä»¶ï¼Œåˆ™ä»¥åæ–°å¼€ç»ˆç«¯ä¸å†éœ€è¦æ‰‹åŠ¨é…ç½®ç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "source /opt/ros/humble/setup.bash" &gt;&gt; ~/.bashrc</span><br></pre></td></tr></tbody></table></figure>

<p>å®‰è£…æµ‹è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 run turtlesim turtlesim_node</span><br><span class="line">ros2 run turtlesim turtle_teleop_key</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®‰è£…colconæ„å»ºå·¥å…·</strong></p>
<p>colconæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ”¹è¿›ç¼–è¯‘ï¼Œæµ‹è¯•å’Œä½¿ç”¨å¤šä¸ªè½¯ä»¶åŒ…çš„å·¥ä½œæµç¨‹</p>
<p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-colcon-common-extensions</span><br></pre></td></tr></tbody></table></figure>

<p>å®‰è£…å®Œcolconä¹‹åï¼Œå°±å¯ä»¥åœ¨ROS2ä¸­ç¼–å†™åº”ç”¨ç¨‹åºäº†</p>
<p><strong>è¿è¡Œä¼˜åŒ–</strong></p>
<p>æ¯æ¬¡ç»ˆç«¯ä¸­æ‰§è¡Œå·¥ä½œç©ºé—´ä¸‹çš„èŠ‚ç‚¹æ—¶ï¼Œéƒ½éœ€è¦è°ƒç”¨<code>. install/setup.bash</code>æŒ‡ä»¤ï¼Œä½¿ç”¨ä¸ä¾¿ï¼Œå¯ä»¥å°†è¯¥æŒ‡ä»¤çš„è°ƒç”¨æ·»åŠ è¿›<code>~/setup.bash</code>ï¼Œæ“ä½œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "source /{å·¥ä½œç©ºé—´è·¯å¾„}/install/setup.bash" &gt;&gt; ~/.bashrc</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ROS2é›†æˆå¼€å‘ç¯å¢ƒ"><a href="#ROS2é›†æˆå¼€å‘ç¯å¢ƒ" class="headerlink" title="ROS2é›†æˆå¼€å‘ç¯å¢ƒ"></a>ROS2é›†æˆå¼€å‘ç¯å¢ƒ</h3><p>åœ¨åˆšåˆšçš„è¿‡ç¨‹ä¼šå‘ç°ubuntué¢‘ç¹éœ€è¦å¯†ç ï¼Œæ‰“å¼€terminalï¼Œè¾“å…¥seahorse</p>
<p>å³é”®Loginæ›´æ”¹å¯†ç ï¼Œå°†æ–°å¯†ç è®¾ä¸ºç©ºå³å¯</p>
<h4 id="ç»ˆç«¯"><a href="#ç»ˆç«¯" class="headerlink" title="ç»ˆç«¯"></a>ç»ˆç«¯</h4><p>åœ¨ ROS ä¸­ï¼Œéœ€è¦é¢‘ç¹çš„ä½¿ç”¨åˆ°ç»ˆç«¯ï¼Œä¸”å¯èƒ½éœ€è¦åŒæ—¶å¼€å¯å¤šä¸ªçª—å£ï¼Œæ¨èä½¿ç”¨<strong>Terminator</strong></p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install terminator</span><br></pre></td></tr></tbody></table></figure>

<p>å¸¸ç”¨å¿«æ·é”®ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Alt+Up                          //ç§»åŠ¨åˆ°ä¸Šé¢çš„ç»ˆç«¯</span><br><span class="line">Alt+Down                        //ç§»åŠ¨åˆ°ä¸‹é¢çš„ç»ˆç«¯</span><br><span class="line">Alt+Left                        //ç§»åŠ¨åˆ°å·¦è¾¹çš„ç»ˆç«¯</span><br><span class="line">Alt+Right                       //ç§»åŠ¨åˆ°å³è¾¹çš„ç»ˆç«¯</span><br><span class="line">Ctrl+Shift+O                    //æ°´å¹³åˆ†å‰²ç»ˆç«¯</span><br><span class="line">Ctrl+Shift+E                    //å‚ç›´åˆ†å‰²ç»ˆç«¯</span><br></pre></td></tr></tbody></table></figure>

<h4 id="VScode"><a href="#VScode" class="headerlink" title="VScode"></a>VScode</h4><p>ä¸è¦ä¸‹Ubuntu softwareé‡Œçš„ï¼Œå¯èƒ½æ— æ³•è¾“å…¥ä¸­æ–‡</p>
<p>å»å®˜ç½‘ä¸‹debæ–‡ä»¶ï¼Œä¸‹è½½ååœ¨ç»ˆç«¯ä¸­æ‰“å¼€ï¼Œè¾“å…¥å‘½ä»¤å®‰è£…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i xxxx.deb</span><br></pre></td></tr></tbody></table></figure>

<p>vscode ä¸‹è½½æ’ä»¶ï¼šChineseï¼ŒC++ï¼ŒCMakeï¼ŒCmake Toolsï¼ŒPythonï¼ŒMsg Language Supportï¼ŒURDFï¼Œvscode-pdfï¼ŒYAMLï¼ŒXML</p>
<p>å¿«æ·é”®é…ç½®ï¼šå‘ä¸Šå‘ä¸‹å¤åˆ¶è¡Œï¼›å‘ä¸Šå‘ä¸‹ç§»åŠ¨</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38463737/article/details/125505154">VS Codeè®¾ç½®æ‰“å¼€æ–°çª—å£ä¸è¦†ç›–å‰çª—å£</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_70703397/article/details/129281455">VSCodeè®¾ç½®è‡ªåŠ¨ä¿å­˜</a></p>
<p>åœ¨VSCodeä¸­ï¼Œcppæ–‡ä»¶ä¸­çš„<code>#include "rclcpp/rclcpp.hpp"</code>åŒ…å«è¯­å¥ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰è®¾ç½®VSCodeé…ç½®æ–‡ä»¶ä¸­ includepathå±æ€§ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è§£å†³æ­¤é—®é¢˜ï¼š</p>
<ol>
<li>å°†é¼ æ ‡ç§»åˆ°é”™è¯¯æç¤ºè¯­å¥ï¼Œæ­¤æ—¶ä¼šå‡ºç°å¼¹çª—ï¼›</li>
<li>ç‚¹å‡»å¼¹çª—ä¸­çš„å¿«é€Ÿä¿®å¤ï¼Œä¼šæœ‰æ–°çš„å¼¹çª—ï¼Œå†ç‚¹å‡»<code>ç¼–è¾‘"includePath"è®¾ç½®</code>ï¼›</li>
<li>åœ¨æ–°é¡µé¢ä¸­ï¼ŒåŒ…å«è·¯å¾„å±æ€§å¯¹åº”çš„æ–‡æœ¬åŸŸä¸­ï¼Œæ¢è¡Œè¾“å…¥è¢«åŒ…å«çš„è·¯å¾„<code>/opt/ros/humble/include/**</code></li>
</ol>
<h4 id="git"><a href="#git" class="headerlink" title="git"></a>git</h4><p>å®‰è£…å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨æœ¬æ•™ç¨‹ä¸­ä¼šç»å¸¸ä½¿ç”¨<code>git clone ä»“åº“åœ°å€</code>çš„æ–¹å¼æ¥å°†Gitä»“åº“æ‹·è´åˆ°æœ¬åœ°</p>
<h4 id="æ“ä½œå‘½ä»¤"><a href="#æ“ä½œå‘½ä»¤" class="headerlink" title="æ“ä½œå‘½ä»¤"></a>æ“ä½œå‘½ä»¤</h4><p>å¯ä»¥é€šè¿‡ç¼–è¯‘æŒ‡ä»¤<code>colcon</code>å’ŒROS2å†…ç½®çš„å·¥å…·æŒ‡ä»¤<code>ros2</code>æ¥å®ç°åŠŸèƒ½åŒ…çš„åˆ›å»ºã€ç¼–è¯‘ã€æŸ¥æ‰¾ä¸æ‰§è¡Œç­‰ç›¸å…³æ“ä½œ</p>
<blockquote>
<p><code>colcon</code> æ˜¯å®˜æ–¹æ¨èçš„æ„å»ºå·¥å…·ï¼Œ<code>CMake</code> æ˜¯åº•å±‚çš„æ„å»ºç³»ç»Ÿ</p>
</blockquote>
<p><strong>åˆ›å»º</strong></p>
<p>æ–°å»ºåŠŸèƒ½åŒ…è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create [åŒ…å] --build-type [æ„å»ºç±»å‹] --dependencies [ä¾èµ–åˆ—è¡¨] --node-name [å¯æ‰§è¡Œç¨‹åºåç§°]</span><br></pre></td></tr></tbody></table></figure>

<p>æ ¼å¼è§£é‡Šï¼š</p>
<ul>
<li>â€“build-typeï¼šæ˜¯æŒ‡åŠŸèƒ½åŒ…çš„æ„å»ºç±»å‹ï¼Œæœ‰cmakeã€ament_cmake(c++)ã€ament_python(python)ä¸‰ç§ç±»å‹å¯é€‰ï¼›</li>
<li>â€“dependenciesï¼šæ‰€ä¾èµ–çš„åŠŸèƒ½åŒ…åˆ—è¡¨ï¼Œç©ºæ ¼åˆ†å‰²å¤šä¸ªåŠŸèƒ½åŒ…ï¼›</li>
<li>â€“node-nameï¼šå¯æ‰§è¡Œç¨‹åºçš„åç§°ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„æºæ–‡ä»¶å¹¶ç”Ÿæˆé…ç½®æ–‡ä»¶</li>
</ul>
<p><strong>ç¼–è¯‘</strong></p>
<p>ç¼–è¯‘åŠŸèƒ½åŒ…è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">colcon build</span><br><span class="line">colcon build --packages-select [åŠŸèƒ½åŒ…åˆ—è¡¨]</span><br></pre></td></tr></tbody></table></figure>

<p>å‰è€…ä¼šæ„å»ºå·¥ä½œç©ºé—´ä¸‹çš„æ‰€æœ‰åŠŸèƒ½åŒ…ï¼Œåè€…å¯ä»¥æ„å»ºæŒ‡å®šåŠŸèƒ½åŒ…</p>
<p>ç¼–è¯‘ååˆ·æ–°ç¯å¢ƒå˜é‡æ‰å¯ä»¥æ‰§è¡Œï¼ˆå¦‚æœåœ¨.bashrcæ–‡ä»¶ä¸­å·²ç»æ·»åŠ åˆ™ä¸éœ€è¦ï¼‰</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. install/setup.bash</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>ä»ROS1çš„<code>source ./devel/setup.bash</code> -&gt; . install/setup.bash</p>
</blockquote>
<p><strong>æŸ¥æ‰¾</strong></p>
<p>åœ¨<code>ros2 pkg</code>å‘½ä»¤ä¸‹åŒ…å«äº†å¤šä¸ªæŸ¥è¯¢åŠŸèƒ½åŒ…ç›¸å…³ä¿¡æ¯çš„å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg executables ([åŒ…å]) # è¾“å‡ºæ‰€æœ‰åŠŸèƒ½åŒ…æˆ–æŒ‡å®šåŠŸèƒ½åŒ…ä¸‹çš„å¯æ‰§è¡Œç¨‹åºã€‚</span><br><span class="line">ros2 pkg list # åˆ—å‡ºæ‰€æœ‰åŠŸèƒ½åŒ…</span><br><span class="line">ros2 pkg prefix [åŒ…å] # åˆ—å‡ºåŠŸèƒ½åŒ…è·¯å¾„</span><br><span class="line">ros2 pkg xml # è¾“å‡ºåŠŸèƒ½åŒ…çš„package.xmlå†…å®¹</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ‰§è¡Œ</strong></p>
<p>æ‰§è¡Œå‘½ä»¤è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run [åŠŸèƒ½åŒ…] [å¯æ‰§è¡Œç¨‹åº] [å‚æ•°]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ROS2ä½“ç³»æ¡†æ¶"><a href="#ROS2ä½“ç³»æ¡†æ¶" class="headerlink" title="ROS2ä½“ç³»æ¡†æ¶"></a>ROS2ä½“ç³»æ¡†æ¶</h3><h4 id="ROS2æ–‡ä»¶ç³»ç»Ÿ"><a href="#ROS2æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ROS2æ–‡ä»¶ç³»ç»Ÿ"></a>ROS2æ–‡ä»¶ç³»ç»Ÿ</h4><p>ç«‹è¶³ç³»ç»Ÿæ¶æ„ï¼ŒROS2å¯ä»¥åˆ’åˆ†ä¸ºä¸‰å±‚</p>
<p><strong>æ“ä½œç³»ç»Ÿå±‚ï¼ˆOS Layerï¼‰</strong></p>
<p>ROSè™½ç„¶ç§°ä¹‹ä¸ºæœºå™¨äººæ“ä½œç³»ç»Ÿï¼Œä½†å®è´¨åªæ˜¯æ„å»ºæœºå™¨äººåº”ç”¨ç¨‹åºçš„è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼ŒROSå¿…é¡»ä¾èµ–äºä¼ ç»Ÿæ„ä¹‰çš„æ“ä½œç³»ç»Ÿ</p>
<p><strong>ä¸­é—´å±‚ï¼ˆMiddleware Layerï¼‰</strong></p>
<p>ä¸»è¦ç”±æ•°æ®åˆ†å‘æœåŠ¡DDSä¸ROS2å°è£…çš„å…³äºæœºå™¨äººå¼€å‘çš„ä¸­é—´ä»¶ç»„æˆã€‚DDSæ˜¯ä¸€ç§å»ä¸­å¿ƒåŒ–çš„æ•°æ®é€šè®¯æ–¹å¼ï¼ŒROS2è¿˜å¼•å…¥äº†æœåŠ¡è´¨é‡ç®¡ç† ï¼ˆQuality of Serviceï¼‰æœºåˆ¶ï¼Œå€ŸåŠ©è¯¥æœºåˆ¶å¯ä»¥ä¿è¯åœ¨æŸäº›è¾ƒå·®ç½‘ç»œç¯å¢ƒä¸‹ä¹Ÿå¯ä»¥å…·å¤‡è‰¯å¥½çš„é€šè®¯æ•ˆæœã€‚ROS2ä¸­é—´ä»¶åˆ™ä¸»è¦ç”±å®¢æˆ·ç«¯åº“ã€DDSæŠ½è±¡å±‚ä¸è¿›ç¨‹å†…é€šè®¯APIæ„æˆ</p>
<p><strong>åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰</strong></p>
<p>æŒ‡å¼€å‘è€…æ„å»ºçš„åº”ç”¨ç¨‹åºï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­æ˜¯ä»¥åŠŸèƒ½åŒ…ä¸ºæ ¸å¿ƒçš„ï¼Œåœ¨åŠŸèƒ½åŒ…ä¸­å¯ä»¥åŒ…å«æºç ã€æ•°æ®å®šä¹‰ã€æ¥å£ç­‰å†…å®¹</p>
<p><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/1.5.1%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.webp" alt="1.5.1æ–‡ä»¶ç³»ç»Ÿ"></p>
<p>å¯¹äºä¸€èˆ¬å¼€å‘è€…è€Œè¨€ï¼Œå·¥ä½œå†…å®¹ä¸»è¦é›†ä¸­åœ¨åº”ç”¨å±‚ï¼Œå¼€å‘è€…ä¸€èˆ¬é€šè¿‡å®ç°å…·æœ‰æŸä¸€ç‰¹å®šåŠŸèƒ½çš„åŠŸèƒ½åŒ…æ¥æ„å»ºæœºå™¨äººåº”ç”¨ç¨‹åº</p>
<p>åŠŸèƒ½åŒ…æ˜¯ROS2åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒï¼Œä½†æ˜¯åŠŸèƒ½åŒ…ä¸èƒ½ç›´æ¥æ„å»ºï¼Œå¿…é¡»ä¾èµ–äºå·¥ä½œç©ºé—´ï¼Œä¸€ä¸ªROS2å·¥ä½œç©ºé—´çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">WorkSpace --- è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´ã€‚</span><br><span class="line">    |--- buildï¼šå­˜å‚¨ä¸­é—´æ–‡ä»¶çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹ä¼šä¸ºæ¯ä¸€ä¸ªåŠŸèƒ½åŒ…åˆ›å»ºä¸€ä¸ªå•ç‹¬å­ç›®å½•ã€‚</span><br><span class="line">    |--- installï¼šå®‰è£…ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹ä¼šä¸ºæ¯ä¸€ä¸ªåŠŸèƒ½åŒ…åˆ›å»ºä¸€ä¸ªå•ç‹¬å­ç›®å½•ã€‚</span><br><span class="line">    |--- logï¼šæ—¥å¿—ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ—¥å¿—æ–‡ä»¶ã€‚</span><br><span class="line">    |--- srcï¼šç”¨äºå­˜å‚¨åŠŸèƒ½åŒ…æºç çš„ç›®å½•ã€‚</span><br><span class="line">        |-- C++åŠŸèƒ½åŒ…</span><br><span class="line">            |-- package.xmlï¼šåŒ…ä¿¡æ¯ï¼Œæ¯”å¦‚:åŒ…åã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–é¡¹ã€‚</span><br><span class="line">            |-- CMakeLists.txtï¼šé…ç½®ç¼–è¯‘è§„åˆ™ï¼Œæ¯”å¦‚æºæ–‡ä»¶ã€ä¾èµ–é¡¹ã€ç›®æ ‡æ–‡ä»¶ã€‚</span><br><span class="line">            |-- srcï¼šC++æºæ–‡ä»¶ç›®å½•ã€‚</span><br><span class="line">            |-- includeï¼šå¤´æ–‡ä»¶ç›®å½•ã€‚</span><br><span class="line">            |-- msgï¼šæ¶ˆæ¯æ¥å£æ–‡ä»¶ç›®å½•ã€‚</span><br><span class="line">            |-- srvï¼šæœåŠ¡æ¥å£æ–‡ä»¶ç›®å½•ã€‚</span><br><span class="line">            |-- actionï¼šåŠ¨ä½œæ¥å£æ–‡ä»¶ç›®å½•ã€‚</span><br><span class="line">        |-- PythonåŠŸèƒ½åŒ…</span><br><span class="line">            |-- package.xmlï¼šåŒ…ä¿¡æ¯ï¼Œæ¯”å¦‚:åŒ…åã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–é¡¹ã€‚</span><br><span class="line">            |-- setup.pyï¼šä¸C++åŠŸèƒ½åŒ…çš„CMakeLists.txtç±»ä¼¼ã€‚</span><br><span class="line">            |-- setup.cfgï¼šåŠŸèƒ½åŒ…åŸºæœ¬é…ç½®æ–‡ä»¶ã€‚</span><br><span class="line">            |-- resourceï¼šèµ„æºç›®å½•ã€‚</span><br><span class="line">            |-- testï¼šå­˜å‚¨æµ‹è¯•ç›¸å…³æ–‡ä»¶ã€‚</span><br><span class="line">            |-- åŠŸèƒ½åŒ…åŒåç›®å½•ï¼šPythonæºæ–‡ä»¶ç›®å½•ã€‚</span><br></pre></td></tr></tbody></table></figure>

<p>æ— è®ºæ˜¯PythonåŠŸèƒ½åŒ…è¿˜æ˜¯C++åŠŸèƒ½åŒ…ï¼Œéƒ½å¯ä»¥è‡ªå®šä¹‰ä¸€äº›é…ç½®æ–‡ä»¶ç›¸å…³çš„ç›®å½•</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|-- C++æˆ–PythonåŠŸèƒ½åŒ…</span><br><span class="line">    |-- launchï¼šå­˜å‚¨launchæ–‡ä»¶ã€‚</span><br><span class="line">    |-- rvizï¼šå­˜å‚¨rviz2é…ç½®ç›¸å…³æ–‡ä»¶ã€‚</span><br><span class="line">    |-- urdfï¼šå­˜å‚¨æœºå™¨äººå»ºæ¨¡æ–‡ä»¶ã€‚</span><br><span class="line">    |-- paramsï¼šå­˜å‚¨å‚æ•°æ–‡ä»¶ã€‚</span><br><span class="line">    |-- worldï¼šå­˜å‚¨ä»¿çœŸç¯å¢ƒç›¸å…³æ–‡ä»¶ã€‚</span><br><span class="line">    |-- mapï¼šå­˜å‚¨å¯¼èˆªæ‰€éœ€åœ°å›¾æ–‡ä»¶ã€‚</span><br><span class="line">    |-- ......</span><br></pre></td></tr></tbody></table></figure>

<h5 id="æºæ–‡ä»¶è¯´æ˜"><a href="#æºæ–‡ä»¶è¯´æ˜" class="headerlink" title="æºæ–‡ä»¶è¯´æ˜"></a>æºæ–‡ä»¶è¯´æ˜</h5><p>æ— è®ºæ˜¯C++å®ç°è¿˜æ˜¯Pythonå®ç°ï¼Œéƒ½æ˜¯ç›´æ¥å®ä¾‹åŒ–çš„Nodeå¯¹è±¡</p>
<p>æ›´æ¨èä»¥ç»§æ‰¿Nodeçš„æ–¹å¼æ¥åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡</p>
<p>C++ç»§æ‰¿Nodeå®ç°ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">newNode</span>: <span class="keyword">public</span> rclcpp::Node{ <span class="comment">// newNodeç»§æ‰¿ROS2èŠ‚ç‚¹åŸºç±»</span></span><br><span class="line"><span class="keyword">public</span>: <span class="comment">// å…¬å…±è®¿é—®åŒºåŸŸ</span></span><br><span class="line">    <span class="built_in">newNode</span>():<span class="built_in">Node</span>(<span class="string">"node_name"</span>){ <span class="comment">// è°ƒç”¨çˆ¶ç±»Nodeæ„é€ å‡½æ•°newNode()</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"hello world!"</span>); <span class="comment">// this æ˜¯æŒ‡å‘å½“å‰å¯¹è±¡å®ä¾‹çš„æŒ‡é’ˆ</span></span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc,argv); <span class="comment">// ROS2åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;newNode&gt;(); <span class="comment">// åˆ›å»ºç±»å®ä¾‹,()å†…ä¼ å‚</span></span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>(); <span class="comment">// èµ„æºæ¸…ç†</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Pythonç»§æ‰¿Nodeå®ç°ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">newNode</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">"node_name_py"</span>)</span><br><span class="line">        <span class="variable language_">self</span>.get_logger().info(<span class="string">"hello world!"</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    rclpy.init()</span><br><span class="line">    node = newNode() </span><br><span class="line">    rclpy.shutdown()</span><br></pre></td></tr></tbody></table></figure>

<p>ä¹‹æ‰€ä»¥ç»§æ‰¿æ¯”ç›´æ¥å®ä¾‹åŒ–Nodeæ›´è¢«æ¨èï¼Œæ˜¯å› ä¸ºç»§æ‰¿æ–¹å¼å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹å†…ç»„ç»‡å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™å¯¹äºæé«˜èŠ‚ç‚¹é—´çš„é€šä¿¡æ•ˆç‡æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œä½†æ˜¯ç›´æ¥å®ä¾‹åŒ–åˆ™ä¸è¯¥åŠŸèƒ½ä¸å…¼å®¹</p>
<p><strong>åˆå§‹åŒ–ä¸èµ„æºé‡Šæ”¾åœ¨ç¨‹åºä¸­èµ·ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p>
<ol>
<li><p>å‰æï¼šæ„å»ºçš„ç¨‹åºå¯èƒ½ç”±è‹¥å¹²æ­¥éª¤æˆ–é˜¶æ®µç»„æˆ</p>
<p>åˆå§‹åŒ–â€“&gt;èŠ‚ç‚¹å¯¹è±¡â€“æ—¥å¿—è¾“å‡ºâ€“&gt;æ•°æ®çš„å‘å¸ƒâ€”&gt;æ•°æ®è®¢é˜…â€“&gt;â€¦â€“&gt;èµ„æºé‡Šæ”¾</p>
</li>
<li><p>ä¸åŒæ­¥éª¤æˆ–é˜¶æ®µä¹‹é—´æ¶‰åŠåˆ°æ•°æ®çš„ä¼ é€’</p>
</li>
<li><p>ä½¿ç”¨context(ä¸Šä¸‹æ–‡)å¯¹è±¡è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œè¿™æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥å­˜å‚¨æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä»ä¸­è¯»å–æ•°æ®</p>
</li>
<li><p>åˆå§‹åŒ–å…¶å®å°±æ˜¯è¦åˆ›å»ºcontextå¯¹è±¡ï¼Œèµ„æºé‡Šæ”¾å°±æ˜¯è¦é”€æ¯contextå¯¹è±¡</p>
</li>
</ol>
<h5 id="é…ç½®æ–‡ä»¶è¯´æ˜"><a href="#é…ç½®æ–‡ä»¶è¯´æ˜" class="headerlink" title="é…ç½®æ–‡ä»¶è¯´æ˜"></a>é…ç½®æ–‡ä»¶è¯´æ˜</h5><p>C++åŠŸèƒ½åŒ…çš„æ„å»ºä¿¡æ¯ä¸»è¦åŒ…å«åœ¨package.xmlä¸CMakeLists.txtä¸­</p>
<p>PythonåŠŸèƒ½åŒ…çš„æ„å»ºä¿¡æ¯åˆ™ä¸»è¦åŒ…å«åœ¨package.xmlå’Œsetup.pyä¸­</p>
<p><strong>package.xml</strong></p>
<p>ä¸ç®¡æ˜¯ä½•ç§ç±»å‹çš„åŠŸèƒ½åŒ…ï¼Œpackage.xmlçš„æ ¼å¼éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­åŒ…å«äº†åŒ…åã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–é¡¹çš„ä¿¡æ¯ï¼Œå¯ä»¥ä¸ºcolconæ„å»ºå·¥å…·ç¡®å®šåŠŸèƒ½åŒ…çš„ç¼–è¯‘é¡ºåº</p>
<p>ä¸€ä¸ªç®€å•çš„package.xmlç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-model href=<span class="string">"http://download.ros.org/schema/package_format3.xsd"</span> schematypens=<span class="string">"http://www.w3.org/2001/XMLSchema"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">format</span>=<span class="string">"3"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>pkg01_helloworld_cpp<span class="tag">&lt;/<span class="name">name</span>&gt;</span> åŒ…å</span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> åŒ…çš„ç‰ˆæœ¬å·</span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>TODO: Package description<span class="tag">&lt;/<span class="name">description</span>&gt;</span> åŒ…çš„æè¿°ä¿¡æ¯</span><br><span class="line">  <span class="tag">&lt;<span class="name">maintainer</span> <span class="attr">email</span>=<span class="string">"[è”ç³»è€…é‚®ç®±]"</span>&gt;</span>ros2<span class="tag">&lt;/<span class="name">maintainer</span>&gt;</span> ç»´æŠ¤è€…ä¿¡æ¯</span><br><span class="line">  <span class="tag">&lt;<span class="name">license</span>&gt;</span>TODO: License declaration<span class="tag">&lt;/<span class="name">license</span>&gt;</span> è½¯ä»¶åè®®</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">depend</span>&gt;</span>rclcpp<span class="tag">&lt;/<span class="name">depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_auto<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">test_depend</span>&gt;</span>ament_lint_common<span class="tag">&lt;/<span class="name">test_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">export</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build_type</span>&gt;</span>ament_cmake<span class="tag">&lt;/<span class="name">build_type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">export</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>packageï¼šæ ¹æ ‡ç­¾ï¼Œformatå±æ€§ç”¨æ¥å£°æ˜æ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬</p>
<p>ä¾èµ–é¡¹ï¼š</p>
<ul>
<li><p>buildtool_dependï¼šå£°æ˜ç¼–è¯‘å·¥å…·ä¾èµ–ï¼›</p>
</li>
<li><p>build_dependï¼šå£°æ˜ç¼–è¯‘ä¾èµ–ï¼›</p>
</li>
<li><p>build_export_dependï¼šå£°æ˜æ ¹æ®æ­¤åŒ…æ„å»ºåº“æ‰€éœ€ä¾èµ–ï¼›</p>
</li>
<li><p>exec_dependï¼šå£°æ˜æ‰§è¡Œæ—¶ä¾èµ–ï¼›</p>
<blockquote>
<p>build_dependï¼Œbuild_export_dependï¼Œexec_dependå¾ˆå¤šæ—¶å€™æ˜¯ä¸€æ ·çš„</p>
</blockquote>
</li>
<li><p>dependï¼šç›¸å½“äº<build_depend>ã€<build_export_depend>ã€<exec_depend>ä¸‰è€…çš„é›†æˆï¼›</exec_depend></build_export_depend></build_depend></p>
</li>
<li><p>test_dependï¼šå£°æ˜æµ‹è¯•ä¾èµ–ï¼›</p>
</li>
<li><p>doc_dependï¼šå£°æ˜æ„å»ºæ–‡æ¡£ä¾èµ–</p>
</li>
</ul>
<p><strong>CMakeLists.txt</strong></p>
<p>C++åŠŸèƒ½åŒ…ä¸­éœ€è¦é…ç½®CMakeLists.txtæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æè¿°äº†å¦‚ä½•æ„å»ºC++åŠŸèƒ½åŒ…</p>
<p>ä¸€ä¸ªç®€å•çš„CMakeLists.txtç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># å£°æ˜cmakeçš„æœ€ä½ç‰ˆæœ¬</span><br><span class="line">cmake_minimum_required(VERSION 3.8)</span><br><span class="line"># åŒ…åï¼Œéœ€è¦ä¸package.xmlä¸­çš„åŒ…åä¸€è‡´</span><br><span class="line">project(pkg01_helloworld_cpp)</span><br><span class="line"></span><br><span class="line">if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")</span><br><span class="line">  add_compile_options(-Wall -Wextra -Wpedantic)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"># find dependencies</span><br><span class="line">find_package(ament_cmake REQUIRED)</span><br><span class="line"># å¼•å…¥å¤–éƒ¨ä¾èµ–åŒ…</span><br><span class="line">find_package(rclcpp REQUIRED)</span><br><span class="line"></span><br><span class="line"># æ˜ å°„æºæ–‡ä»¶ä¸å¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">add_executable(helloworld src/helloworld.cpp)</span><br><span class="line"># è®¾ç½®ç›®æ ‡ä¾èµ–åº“</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  helloworld</span><br><span class="line">  "rclcpp"</span><br><span class="line">)</span><br><span class="line"># å®šä¹‰å®‰è£…è§„åˆ™</span><br><span class="line">install(TARGETS helloworld</span><br><span class="line">  DESTINATION lib/${PROJECT_NAME})</span><br><span class="line"></span><br><span class="line">if(BUILD_TESTING)</span><br><span class="line">  find_package(ament_lint_auto REQUIRED)</span><br><span class="line">  # the following line skips the linter which checks for copyrights</span><br><span class="line">  # comment the line when a copyright and license is added to all source files</span><br><span class="line">  set(ament_cmake_copyright_FOUND TRUE)</span><br><span class="line">  # the following line skips cpplint (only works in a git repo)</span><br><span class="line">  # comment the line when this package is in a git repo and when</span><br><span class="line">  # a copyright and license is added to all source files</span><br><span class="line">  set(ament_cmake_cpplint_FOUND TRUE)</span><br><span class="line">  ament_lint_auto_find_test_dependencies()</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">ament_package()</span><br></pre></td></tr></tbody></table></figure>

<p><strong>setup.py</strong></p>
<p>PythonåŠŸèƒ½åŒ…ä¸­éœ€è¦é…ç½®setup.pyæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æè¿°äº†å¦‚ä½•æ„å»ºPythonåŠŸèƒ½åŒ…</p>
<p>ä¸€ä¸ªç®€å•çš„setup.pyç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"></span><br><span class="line">package_name = <span class="string">'pkg02_helloworld_py'</span></span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=package_name, <span class="comment"># åŒ…å</span></span><br><span class="line">    version=<span class="string">'0.0.0'</span>,   <span class="comment"># ç‰ˆæœ¬</span></span><br><span class="line">    packages=[package_name], <span class="comment"># åŠŸèƒ½åŒ…åˆ—è¡¨</span></span><br><span class="line">    data_files=[ <span class="comment">#éœ€è¦è¢«å®‰è£…çš„æ–‡ä»¶ä»¥åŠå®‰è£…è·¯å¾„</span></span><br><span class="line">        (<span class="string">'share/ament_index/resource_index/packages'</span>,</span><br><span class="line">            [<span class="string">'resource/'</span> + package_name]),</span><br><span class="line">        (<span class="string">'share/'</span> + package_name, [<span class="string">'package.xml'</span>]),</span><br><span class="line">    ],</span><br><span class="line">    install_requires=[<span class="string">'setuptools'</span>], <span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">    zip_safe=<span class="literal">True</span>,</span><br><span class="line">    maintainer=<span class="string">'ros2'</span>, <span class="comment"># ç»´æŠ¤è€…</span></span><br><span class="line">    maintainer_email=<span class="string">'ros2@todo.todo'</span>, <span class="comment"># ç»´æŠ¤è€… email</span></span><br><span class="line">    description=<span class="string">'TODO: Package description'</span>, <span class="comment"># åŒ…æè¿°</span></span><br><span class="line">    license=<span class="string">'TODO: License declaration'</span>, <span class="comment"># è½¯ä»¶åè®®</span></span><br><span class="line">    tests_require=[<span class="string">'pytest'</span>], <span class="comment"># æµ‹è¯•ä¾èµ–</span></span><br><span class="line">    entry_points={</span><br><span class="line">        <span class="string">'console_scripts'</span>: [</span><br><span class="line">            <span class="comment"># æ˜ å°„æºæ–‡ä»¶ä¸å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">            <span class="string">'helloworld = pkg02_helloworld_py.helloworld:main'</span></span><br><span class="line">        ],</span><br><span class="line">    },</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰€ä»¥ä¸å»ºè®®ä¿®æ”¹åŒ…å</p>
<h4 id="ROS2æ ¸å¿ƒæ¨¡å—"><a href="#ROS2æ ¸å¿ƒæ¨¡å—" class="headerlink" title="ROS2æ ¸å¿ƒæ¨¡å—"></a>ROS2æ ¸å¿ƒæ¨¡å—</h4><p><strong>é€šä¿¡æ¨¡å—</strong></p>
<p><strong>åŠŸèƒ½åŒ…</strong></p>
<p>å®‰è£…æ–¹å¼ï¼š</p>
<ul>
<li><p>äºŒè¿›åˆ¶å®‰è£…</p>
<p>ROSå®˜æ–¹æˆ–ç¤¾åŒºæä¾›çš„åŠŸèƒ½åŒ…å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡äºŒè¿›åˆ¶æ–¹å¼å®‰è£…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-[ROS2ç‰ˆæœ¬ä»£å·]-[åŠŸèƒ½åŒ…åç§°]</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>å¯ä»¥è°ƒç”¨<code>apt search ros-ROS2ç‰ˆæœ¬ä»£å·-* | grep -i [å…³é”®å­—]</code>æ ¼å¼çš„å‘½ä»¤ï¼Œæ ¹æ®å…³é”®å­—æŸ¥æ‰¾æ‰€éœ€çš„åŠŸèƒ½åŒ…</p>
</blockquote>
</li>
<li><p>æºç å®‰è£…</p>
<p>ä¸€èˆ¬ä»githubè·å–æºç ï¼Œä¸‹è½½å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone [ä»“åº“åœ°å€]</span><br></pre></td></tr></tbody></table></figure>

<p>æºç ä¸‹è½½åï¼Œéœ€è¦è‡ªè¡Œç¼–è¯‘</p>
</li>
</ul>
<p><strong>åˆ†å¸ƒå¼</strong></p>
<p>ROS2æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„ï¼Œä¸åŒçš„ROS2è®¾å¤‡ä¹‹é—´å¯ä»¥æ–¹ä¾¿çš„å®ç°é€šä¿¡ï¼Œè¿™åœ¨å¤šæœºå™¨äººè®¾å¤‡ååŒä¸­æ˜¯æå…¶é‡è¦çš„</p>
<p><strong>ç»ˆç«¯å‘½ä»¤ä¸rqt</strong></p>
<p>rqtæ˜¯ä¸€ä¸ªå›¾å½¢åŒ–å·¥å…·ï¼Œå®ƒçš„åŠŸèƒ½ä¸å‘½ä»¤è¡Œå·¥å…·ç±»ä¼¼ï¼Œä½†æ˜¯å›¾å½¢åŒ–çš„äº¤äº’æ–¹å¼æ›´ä¸ºå‹å¥½</p>
<p><strong>launchæ–‡ä»¶</strong></p>
<p>é€šè¿‡launchæ–‡ä»¶ï¼Œå¯ä»¥æ‰¹é‡çš„å¯åŠ¨ROS2èŠ‚ç‚¹ï¼Œè¿™æ˜¯åœ¨æ„å»ºå¤§å‹é¡¹ç›®æ—¶å¯åŠ¨å¤šèŠ‚ç‚¹çš„å¸¸ç”¨æ–¹å¼</p>
<p><strong>TFåæ ‡å˜æ¢</strong></p>
<p>TFåæ ‡å˜æ¢å¯ä»¥å®ç°æœºå™¨äººä¸åŒéƒ¨ä»¶æˆ–ä¸åŒæœºå™¨äººä¹‹é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»çš„è½¬æ¢</p>
<p><strong>å¯è§†åŒ–</strong></p>
<p>ROS2å†…ç½®äº†ä¸‰ç»´å¯è§†åŒ–å·¥å…·rviz2ï¼Œå®ƒå¯ä»¥å›¾å½¢åŒ–çš„æ–¹å¼æ˜¾ç¤ºæœºå™¨äººæ¨¡å‹æˆ–æ˜¾ç¤ºæœºå™¨äººç³»ç»Ÿä¸­çš„ä¸€äº›æŠ½è±¡æ•°æ®</p>
<h4 id="ROS2æŠ€æœ¯æ”¯æŒ"><a href="#ROS2æŠ€æœ¯æ”¯æŒ" class="headerlink" title="ROS2æŠ€æœ¯æ”¯æŒ"></a>ROS2æŠ€æœ¯æ”¯æŒ</h4><p><a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/">ROS 2 æ–‡æ¡£ â€” ROS 2 æ–‡æ¡£ï¼šHumble æ–‡æ¡£</a></p>
<h4 id="ROS2åº”ç”¨æ–¹å‘"><a href="#ROS2åº”ç”¨æ–¹å‘" class="headerlink" title="ROS2åº”ç”¨æ–¹å‘"></a>ROS2åº”ç”¨æ–¹å‘</h4><p><strong>NAV2</strong></p>
<p>Nav2é¡¹ç›®ç»§æ‰¿è‡ªROS Navigation Stackã€‚è¯¥é¡¹ç›®æ—¨åœ¨å¯ä»¥è®©ç§»åŠ¨æœºå™¨äººä»Aç‚¹å®‰å…¨çš„ç§»åŠ¨åˆ°Bç‚¹ã€‚å®ƒä¹Ÿå¯ä»¥åº”ç”¨äºæ¶‰åŠæœºå™¨äººå¯¼èˆªçš„å…¶ä»–åº”ç”¨ï¼Œä¾‹å¦‚è·ŸéšåŠ¨æ€ç‚¹ã€‚Nav2å°†ç”¨äºå®ç°è·¯å¾„è§„åˆ’ã€è¿åŠ¨æ§åˆ¶ã€åŠ¨æ€é¿éšœå’Œæ¢å¤è¡Œä¸ºç­‰ä¸€ç³»åˆ—åŠŸèƒ½</p>
<p><strong>OpenCV</strong></p>
<p><a target="_blank" rel="noopener" href="https://opencv.org/">OpenCV</a>ï¼ˆOpen Source Computer Vision Libraryï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„è®¡ç®—æœºè§†è§‰å’Œæœºå™¨å­¦ä¹ è½¯ä»¶åº“ã€‚OpenCVæ—¨åœ¨ä¸ºè®¡ç®—æœºè§†è§‰åº”ç”¨ç¨‹åºæä¾›é€šç”¨åŸºç¡€æ¶æ„ï¼Œå¹¶åŠ é€Ÿæœºå™¨æ„ŸçŸ¥åœ¨å•†ä¸šäº§å“ä¸­çš„ä½¿ç”¨ã€‚OpenCVå…è®¸ä¼ä¸šè½»æ¾åœ°ä½¿ç”¨å’Œä¿®æ”¹ä»£ç </p>
<p><strong>MoveIt</strong></p>
<p><a target="_blank" rel="noopener" href="https://moveit.ros.org/">MoveIt</a>æ˜¯ä¸€ç»„ROSè½¯ä»¶åŒ…ï¼Œ ä¸»è¦åŒ…å«è¿åŠ¨è§„åˆ’ã€ç¢°æ’æ£€æµ‹ã€è¿åŠ¨å­¦ã€3Dæ„ŸçŸ¥ã€æ“ä½œæ§åˆ¶ç­‰åŠŸèƒ½ã€‚å®ƒå¯ä»¥ç”¨äºæ„å»ºæœºæ¢°è‡‚çš„é«˜çº§è¡Œä¸ºã€‚MoveItç°åœ¨å¯ä»¥ç”¨äºå¸‚é¢ä¸Šçš„å¤§å¤šæ•°æœºæ¢°è‡‚ï¼Œå¹¶è¢«è®¸å¤šå¤§å…¬å¸ä½¿ç”¨</p>
<p><strong>The Autoware Foundation</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.autoware.org/">Autoware Foundation</a>æ˜¯ROSä¸‹å±çš„éè¥åˆ©ç»„ç»‡ï¼Œæ”¯æŒå®ç°è‡ªåŠ¨é©¾é©¶çš„å¼€æºé¡¹ç›®ã€‚AutowareåŸºé‡‘ä¼šåœ¨ä¼ä¸šå‘å±•å’Œå­¦æœ¯ç ”ç©¶ä¹‹é—´åˆ›é€ ååŒæ•ˆåº”ï¼Œä¸ºæ¯ä¸ªäººæä¾›è‡ªåŠ¨é©¾é©¶æŠ€æœ¯</p>
<p><strong>F1 Tenth</strong></p>
<p><a target="_blank" rel="noopener" href="https://f1tenth.org/">F1 Tenth</a>æ˜¯å°†æ¨¡å‹è½¦æ”¹ä¸ºæ— äººè½¦çš„ç«é€Ÿèµ›äº‹ï¼Œæ˜¯ä¸€ä¸ªç”±ç ”ç©¶äººå‘˜ã€å·¥ç¨‹å¸ˆå’Œè‡ªä¸»ç³»ç»Ÿçˆ±å¥½è€…ç»„æˆçš„å›½é™…ç¤¾åŒºã€‚å®ƒæœ€åˆäº 2016 å¹´åœ¨å®¾å¤•æ³•å°¼äºšå¤§å­¦æˆç«‹ï¼Œä½†åæ¥æ‰©å±•åˆ°å…¨çƒè®¸å¤šå…¶ä»–æœºæ„</p>
<p><strong>microROS</strong></p>
<p>åœ¨åŸºäºROSçš„æœºå™¨äººåº”ç”¨ä¸­ï¼Œ<a target="_blank" rel="noopener" href="https://micro.ros.org/">micro-ROS</a>æ­£åœ¨å¼¥åˆæ€§èƒ½æœ‰é™çš„å¾®æ§åˆ¶å™¨å’Œä¸€èˆ¬å¤„ç†å™¨ä¹‹é—´çš„å·®è·ã€‚micro-ROSåœ¨å„ç§åµŒå…¥å¼ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œä½¿ROSèƒ½ç›´æ¥åº”ç”¨äºæœºå™¨äººç¡¬ä»¶</p>
<p><strong>Open Robotics</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.openrobotics.org/">Open Robotics</a>ä¸å…¨çƒROSç¤¾åŒºåˆä½œï¼Œä¸ºæœºå™¨äººåˆ›å»ºå¼€æ”¾çš„è½¯ä»¶å’Œç¡¬ä»¶å¹³å°ï¼ŒåŒ…æ‹¬ ROS1ã€ROS2ã€Gazeboæ¨¡æ‹Ÿå™¨å’ŒIgnitionæ¨¡æ‹Ÿå™¨ã€‚Open Roboticsä½¿ç”¨è¿™äº›å¹³å°è§£å†³ä¸€äº›é‡è¦é—®é¢˜ï¼Œå¹¶é€šè¿‡ä¸ºå„ç§å®¢æˆ·ç»„ç»‡æä¾›è½¯ä»¶å’Œç¡¬ä»¶å¼€å‘æœåŠ¡æ¥å¸®åŠ©å…¶ä»–äººåšåŒæ ·çš„äº‹æƒ…ã€‚</p>
<p><strong>PX4</strong></p>
<p><a target="_blank" rel="noopener" href="https://px4.io/">PX4</a>æ˜¯ä¸€æ¬¾ç”¨äºæ— äººæœºå’Œå…¶ä»–æ— äººé©¾é©¶è½¦è¾†çš„å¼€æºé£è¡Œæ§åˆ¶è½¯ä»¶ã€‚è¯¥é¡¹ç›®ä¸ºæ— äººæœºå¼€å‘äººå‘˜æä¾›äº†ä¸€å¥—çµæ´»çš„å·¥å…·ï¼Œç”¨äºå…±äº«æŠ€æœ¯å¹¶ä¸ºæ— äººæœºåº”ç”¨ç¨‹åºåˆ›å»ºé‡èº«å®šåˆ¶è§£å†³æ–¹æ¡ˆ</p>
<h2 id="ROS2é€šä¿¡æœºåˆ¶æ ¸å¿ƒ"><a href="#ROS2é€šä¿¡æœºåˆ¶æ ¸å¿ƒ" class="headerlink" title="ROS2é€šä¿¡æœºåˆ¶æ ¸å¿ƒ"></a>ROS2é€šä¿¡æœºåˆ¶æ ¸å¿ƒ</h2><h3 id="é€šä¿¡æœºåˆ¶ç®€ä»‹"><a href="#é€šä¿¡æœºåˆ¶ç®€ä»‹" class="headerlink" title="é€šä¿¡æœºåˆ¶ç®€ä»‹"></a>é€šä¿¡æœºåˆ¶ç®€ä»‹</h3><p><strong>èŠ‚ç‚¹</strong></p>
<p>åœ¨é€šä¿¡æ—¶ï¼Œä¸è®ºé‡‡ç”¨ä½•ç§æ–¹å¼ï¼Œé€šä¿¡å¯¹è±¡çš„æ„å»ºéƒ½ä¾èµ–äºèŠ‚ç‚¹(Node)ï¼Œåœ¨ROS2ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº”æŸä¸€å•ä¸€çš„åŠŸèƒ½æ¨¡å—</p>
<p>ä¸€ä¸ªå®Œæ•´çš„æœºå™¨äººç³»ç»Ÿå¯èƒ½ç”±è®¸å¤šååŒå·¥ä½œçš„èŠ‚ç‚¹ç»„æˆï¼ŒROS2ä¸­çš„å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶(C++ç¨‹åºæˆ–Pythonç¨‹åº)å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹</p>
<p><strong>è¯é¢˜</strong></p>
<p>è¯é¢˜(Topic)æ˜¯ä¸€ä¸ªçº½å¸¦ï¼Œå…·æœ‰ç›¸åŒè¯é¢˜çš„èŠ‚ç‚¹å¯ä»¥å…³è”åœ¨ä¸€èµ·ï¼Œè¿™æ­£æ˜¯é€šä¿¡çš„å‰æã€‚ROS2æ˜¯è·¨è¯­è¨€çš„ï¼Œåªè¦äºŒè€…ä½¿ç”¨äº†ç›¸åŒçš„è¯é¢˜ï¼Œå°±å¯ä»¥å®ç°æ•°æ®çš„äº¤äº’ã€‚</p>
<p><strong>é€šä¿¡æ¨¡å‹</strong></p>
<p>åœ¨ROS2ä¸­ï¼Œå¸¸ç”¨çš„é€šä¿¡æ¨¡å‹æœ‰å››ç§ï¼š</p>
<ol>
<li>è¯é¢˜é€šä¿¡ï¼šæ˜¯ä¸€ç§å•å‘é€šä¿¡æ¨¡å‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­ï¼Œå‘å¸ƒæ–¹å‘å¸ƒæ•°æ®ï¼Œè®¢é˜…æ–¹è®¢é˜…æ•°æ®ï¼Œæ•°æ®æµå•å‘çš„ç”±å‘å¸ƒæ–¹ä¼ è¾“åˆ°è®¢é˜…æ–¹</li>
<li>æœåŠ¡é€šä¿¡ï¼šæ˜¯ä¸€ç§åŸºäºè¯·æ±‚å“åº”çš„é€šä¿¡æ¨¡å‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚æ•°æ®åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å“åº”ç»“æœç»™å®¢æˆ·ç«¯</li>
<li>åŠ¨ä½œé€šä¿¡ï¼šæ˜¯ä¸€ç§å¸¦æœ‰è¿ç»­åé¦ˆçš„é€šä¿¡æ¨¡å‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚æ•°æ®åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å“åº”ç»“æœç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åˆ°äº§ç”Ÿæœ€ç»ˆå“åº”çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‘é€è¿ç»­çš„åé¦ˆä¿¡æ¯åˆ°å®¢æˆ·ç«¯</li>
<li>å‚æ•°æœåŠ¡ï¼šæ˜¯ä¸€ç§åŸºäºå…±äº«çš„é€šä¿¡æ¨¡å‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­ï¼ŒæœåŠ¡ç«¯å¯ä»¥è®¾ç½®æ•°æ®ï¼Œè€Œå®¢æˆ·ç«¯å¯ä»¥è¿æ¥æœåŠ¡ç«¯å¹¶æ“ä½œæœåŠ¡ç«¯æ•°æ®</li>
</ol>
<p><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/Snipaste_2025-06-30_22-06-00.webp" alt="Snipaste_2025-06-30_22-06-00"></p>
<p><strong>æ¥å£</strong></p>
<p>åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¼ è¾“æ•°æ®ï¼Œå°±å¿…ç„¶æ¶‰åŠåˆ°æ•°æ®è½½ä½“ï¼Œå³è¦ä»¥ç‰¹å®šæ ¼å¼ä¼ è¾“æ•°æ®</p>
<p>åœ¨ROS2ä¸­ï¼Œæ•°æ®è½½ä½“ç§°ä¹‹ä¸ºæ¥å£(interfaces)ï¼Œé€šä¿¡æ—¶ä½¿ç”¨çš„æ•°æ®è½½ä½“ä¸€èˆ¬éœ€è¦ä½¿ç”¨æ¥å£æ–‡ä»¶å®šä¹‰</p>
<p>å¸¸ç”¨çš„æ¥å£æ–‡ä»¶æœ‰ä¸‰ç§ï¼šmsgæ–‡ä»¶ã€srvæ–‡ä»¶ä¸actionæ–‡ä»¶ï¼Œæ¯ç§æ–‡ä»¶éƒ½å¯ä»¥æŒ‰ç…§ä¸€å®šæ ¼å¼å®šä¹‰ç‰¹å®šæ•°æ®ç±»å‹çš„â€œå˜é‡â€</p>
<ul>
<li><p>msgæ–‡ä»¶</p>
<p>ç”¨äºå®šä¹‰è¯é¢˜é€šä¿¡ä¸­æ•°æ®è½½ä½“çš„æ¥å£æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int64 num1</span><br><span class="line">int64 num2</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨æ–‡ä»¶ä¸­å£°æ˜äº†ä¸€äº›è¢«ä¼ è¾“çš„å˜é‡æ•°æ®</p>
</li>
<li><p>srvæ–‡ä»¶</p>
<p>ç”¨äºå®šä¹‰æœåŠ¡é€šä¿¡ä¸­æ•°æ®è½½ä½“çš„æ¥å£æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int64 num1</span><br><span class="line">int64 num2</span><br><span class="line">---</span><br><span class="line">int64 sum</span><br></pre></td></tr></tbody></table></figure>

<p>æ–‡ä»¶ä¸­å£°æ˜çš„æ•°æ®è¢«<code>---</code>åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸ŠåŠéƒ¨åˆ†ç”¨äºå£°æ˜è¯·æ±‚æ•°æ®ï¼Œä¸‹åŠéƒ¨åˆ†ç”¨äºå£°æ˜å“åº”æ•°æ®</p>
</li>
<li><p>actionæ–‡ä»¶</p>
<p>ç”¨äºå®šä¹‰åŠ¨ä½œé€šä¿¡ä¸­æ•°æ®è½½ä½“çš„æ¥å£æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int64 num</span><br><span class="line">---</span><br><span class="line">int64 sum</span><br><span class="line">---</span><br><span class="line">float64 progress</span><br></pre></td></tr></tbody></table></figure>

<p>æ–‡ä»¶ä¸­å£°æ˜çš„æ•°æ®è¢«<code>---</code>åˆ†å‰²ä¸ºä¸‰éƒ¨åˆ†ï¼Œä¸ŠåŠéƒ¨åˆ†ç”¨äºå£°æ˜è¯·æ±‚æ•°æ®ï¼Œä¸­é—´éƒ¨åˆ†ç”¨äºå£°æ˜å“åº”æ•°æ®ï¼Œä¸‹åŠéƒ¨åˆ†ç”¨äºå£°æ˜è¿ç»­åé¦ˆæ•°æ®</p>
</li>
</ul>
<p>å¯ä»¥ä½¿ç”¨çš„å­—æ®µç±»å‹æœ‰ï¼š</p>
<ul>
<li>int8, int16, int32, int64 (æˆ–è€…æ— ç¬¦å·ç±»å‹: uint*)</li>
<li>float32, float64</li>
<li>string</li>
<li>time, duration</li>
<li>å…¶ä»–msgæ–‡ä»¶</li>
<li>å˜é•¿æ•°ç»„å’Œå®šé•¿æ•°ç»„</li>
</ul>
<p>ROSä¸­è¿˜æœ‰ä¸€ç§ç‰¹æ®Šç±»å‹ï¼š<code>Header</code>ï¼Œæ ‡å¤´åŒ…å«æ—¶é—´æˆ³å’ŒROS2ä¸­å¸¸ç”¨çš„åæ ‡å¸§ä¿¡æ¯ï¼Œè®¸å¤šæ¥å£æ–‡ä»¶çš„ç¬¬ä¸€è¡ŒåŒ…å«<code>Header</code>æ ‡å¤´</p>
<p><font color="Violetred">å‚æ•°é€šä¿¡çš„æ•°æ®æ— éœ€å®šä¹‰æ¥å£æ–‡ä»¶</font>ï¼Œå‚æ•°é€šä¿¡æ—¶æ•°æ®ä¼šè¢«å°è£…ä¸ºå‚æ•°å¯¹è±¡ï¼Œå‚æ•°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ“ä½œçš„éƒ½æ˜¯å‚æ•°å¯¹è±¡</p>
<h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><ol>
<li><p>è¯·å…ˆåˆ›å»ºå·¥ä½œç©ºé—´<code>ws01_plumbing</code>ï¼Œæœ¬ç« ä»¥åŠç¬¬3ç« ä»£ç éƒ¨åˆ†å†…å®¹å­˜å‚¨åœ¨è¯¥å·¥ä½œç©ºé—´ä¸‹</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ws01_plumbing/src</span><br><span class="line">cd ws01_plumbing/src</span><br><span class="line">colcon build</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å®é™…åº”ç”¨ä¸­ä¸€èˆ¬å»ºè®®åˆ›å»ºä¸“é—¨çš„æ¥å£åŠŸèƒ½åŒ…å®šä¹‰æ¥å£æ–‡ä»¶ï¼Œå½“å‰æ•™ç¨‹ä¹Ÿéµå¾ªè¿™ä¸€å»ºè®®ï¼Œé¢„å…ˆåˆ›å»ºæ•™ç¨‹æ‰€éœ€ä½¿ç”¨çš„æ¥å£åŠŸèƒ½åŒ…</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰ä¸ºæ­¢æ— æ³•åœ¨PythonåŠŸèƒ½åŒ…ä¸­å®šä¹‰æ¥å£æ–‡ä»¶</p>
</blockquote>
<p>ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´çš„<code>src</code>ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create --build-type ament_cmake [base_interfaces]</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥åŠŸèƒ½åŒ…å°†ç”¨äºä¿å­˜æœ¬ç« æ•™ç¨‹ä¸­è‡ªå®šä¹‰çš„æ¥å£æ–‡ä»¶</p>
</li>
</ol>
<p><font color="Violetred">æ³¨æ„</font>ï¼šåŠŸèƒ½åŒ…å¯ä»¥åœ¨vscodeé‡Œåˆ›å»ºï¼Œä½†æ˜¯å·¥ä½œç©ºé—´å»ºè®®åœ¨ç»ˆç«¯å…ˆåˆ›å»ºå¥½ï¼Œå†ç”¨vscodeæ‰“å¼€</p>
<h3 id="è¯é¢˜é€šä¿¡"><a href="#è¯é¢˜é€šä¿¡" class="headerlink" title="è¯é¢˜é€šä¿¡"></a>è¯é¢˜é€šä¿¡</h3><p>è¯é¢˜é€šä¿¡æ˜¯ROSä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ä¸€ç§é€šä¿¡æ¨¡å¼ï¼Œè¯é¢˜é€šä¿¡æ˜¯åŸºäº<strong>å‘å¸ƒè®¢é˜…</strong>æ¨¡å¼</p>
<blockquote>
<p>ä¸€ä¸ªèŠ‚ç‚¹å‘å¸ƒæ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªèŠ‚ç‚¹è®¢é˜…è¯¥æ¶ˆæ¯</p>
</blockquote>
<p>åƒé›·è¾¾ã€æ‘„åƒå¤´ã€GPSâ€¦. ç­‰ç­‰ä¼ æ„Ÿå™¨æ•°æ®çš„é‡‡é›†éƒ½æ˜¯ä½¿ç”¨è¯é¢˜é€šä¿¡</p>
<p>æ•°æ®å‘å¸ƒå¯¹è±¡ç§°ä¸ºå‘å¸ƒæ–¹ï¼Œæ•°æ®è®¢é˜…å¯¹è±¡ç§°ä¹‹ä¸ºè®¢é˜…æ–¹ï¼Œå‘å¸ƒæ–¹å’Œè®¢é˜…æ–¹é€šè¿‡è¯é¢˜ç›¸å…³è”ï¼Œæ¶ˆæ¯çš„æµå‘æ˜¯å•å‘çš„</p>
<p>è¯é¢˜é€šä¿¡çš„å‘å¸ƒæ–¹ä¸è®¢é˜…æ–¹æ˜¯ä¸€ç§å¤šå¯¹å¤šçš„å…³ç³»ï¼Œè¿™æ„å‘³ç€æ•°æ®ä¼šå‡ºç°äº¤å‰ä¼ è¾“çš„æƒ…å†µ</p>
<p><font color="Violetred">å¯ä»¥é€šè¿‡<code>rqt</code>å‘½ä»¤æŸ¥çœ‹è¯é¢˜ä¹‹é—´çš„å…³ç³»</font></p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/2.2è¯é¢˜é€šä¿¡æ¨¡å‹2 (1).gif" alt="2.2è¯é¢˜é€šä¿¡æ¨¡å‹2 (1)" style="zoom: 80%;">

<blockquote>
<p>ä¸ROS1ä¸åŒçš„æ˜¯ï¼Œç°åœ¨ä¸éœ€è¦masteräº†ï¼Œä¸å­˜åœ¨masteræŒ‚äº†æ•´ä¸ªç³»ç»Ÿå´©æºƒçš„æƒ…å†µ</p>
</blockquote>
<p><font color="Violetred">è¯é¢˜é€šä¿¡ä¸€èˆ¬åº”ç”¨äºä¸æ–­æ›´æ–°çš„ã€å°‘é€»è¾‘å¤„ç†çš„æ•°æ®ä¼ è¾“åœºæ™¯</font></p>
<p>å…³äºæ¶ˆæ¯æ¥å£çš„ä½¿ç”¨æœ‰å¤šç§æ–¹å¼ï¼š</p>
<ol>
<li>åœ¨ROS2ä¸­é€šè¿‡std_msgsåŒ…å°è£…äº†ä¸€äº›åŸç”Ÿçš„æ•°æ®ç±»å‹ï¼Œè¿™äº›åŸç”Ÿæ•°æ®ç±»å‹ä¹Ÿå¯ä»¥ä½œä¸ºè¯é¢˜é€šä¿¡çš„è½½ä½“ï¼Œä¸è¿‡è¿™äº›æ•°æ®ä¸€èˆ¬åªåŒ…å«ä¸€ä¸ª data å­—æ®µï¼Œè€Œstd_msgsåŒ…ä¸­å…¶ä»–çš„æ¥å£æ–‡ä»¶ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç»“æ„çš„å•ä¸€æ„å‘³ç€åŠŸèƒ½ä¸Šçš„å±€é™æ€§ï¼Œå½“ä¼ è¾“ä¸€äº›ç»“æ„å¤æ‚çš„æ•°æ®æ—¶ï¼Œå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ï¼›</li>
<li>åœ¨ROS2ä¸­è¿˜é¢„å®šä¹‰äº†è®¸å¤šæ ‡å‡†è¯é¢˜æ¶ˆæ¯æ¥å£ï¼Œè¿™åœ¨å®é™…å·¥ä½œä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œæ¯”å¦‚ï¼šsensor_msgsåŒ…ä¸­å®šä¹‰äº†è®¸å¤šå…³äºä¼ æ„Ÿå™¨æ¶ˆæ¯çš„æ¥å£ï¼ˆé›·è¾¾ã€æ‘„åƒå¤´ã€ç‚¹äº‘â€¦â€¦ï¼‰ï¼Œgeometry_msgsåŒ…ä¸­åˆ™å®šä¹‰äº†è®¸å¤šå‡ ä½•æ¶ˆæ¯ç›¸å…³çš„æ¥å£ï¼ˆåæ ‡ç‚¹ã€åæ ‡ç³»ã€é€Ÿåº¦æŒ‡ä»¤â€¦â€¦ï¼‰ï¼›</li>
<li>å¦‚æœä¸Šè¿°æ¥å£æ–‡ä»¶éƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‡ªå®šä¹‰æ¥å£æ¶ˆæ¯ï¼›</li>
</ol>
<h4 id="æ¡ˆä¾‹éœ€æ±‚"><a href="#æ¡ˆä¾‹éœ€æ±‚" class="headerlink" title="æ¡ˆä¾‹éœ€æ±‚"></a>æ¡ˆä¾‹éœ€æ±‚</h4><p>éœ€æ±‚1ï¼šç¼–å†™è¯é¢˜é€šä¿¡å®ç°ï¼Œå‘å¸ƒæ–¹ä»¥æŸä¸ªé¢‘ç‡å‘å¸ƒä¸€æ®µæ–‡æœ¬ï¼Œè®¢é˜…æ–¹è®¢é˜…æ¶ˆæ¯ï¼Œå¹¶è¾“å‡ºåœ¨ç»ˆç«¯</p>
<p>éœ€æ±‚2ï¼šç¼–å†™è¯é¢˜é€šä¿¡å®ç°ï¼Œå‘å¸ƒæ–¹ä»¥æŸä¸ªé¢‘ç‡å‘å¸ƒè‡ªå®šä¹‰æ¥å£æ¶ˆæ¯ï¼Œè®¢é˜…æ–¹è®¢é˜…æ¶ˆæ¯ï¼Œå¹¶è¾“å‡ºåœ¨ç»ˆç«¯</p>
<p>éœ€æ±‚1å’Œéœ€æ±‚2çš„ä¸»è¦åŒºåˆ«åœ¨äºæ¶ˆæ¯è½½ä½“ï¼Œå‰è€…å¯ä»¥ä½¿ç”¨åŸç”Ÿçš„æ•°æ®ç±»å‹ï¼Œåè€…éœ€è¦è‡ªå®šä¹‰æ¥å£æ¶ˆæ¯</p>
<p>ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´çš„srcç›®å½•ï¼Œè°ƒç”¨å‘½ä»¤åˆ†åˆ«åˆ›å»ºC++åŠŸèƒ½åŒ…å’ŒPythonåŠŸèƒ½åŒ…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create cpp01_topic --build-type ament_cmake --dependencies rclcpp std_msgs base_interfaces [--node-name demo01_talker]</span><br><span class="line">ros2 pkg create py01_topic --build-type ament_python --dependencies rclpy std_msgs base_interfaces [--node-name demo01_talker_str_py]</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>å¯¹æ¯”ros1å¥½å¤„ï¼šCMakeListé‡Œè‡ªåŠ¨é…ç½®ï¼Œpythonç°åœ¨ä¾èµ–çš„setup.pyä¹Ÿä¼šè‡ªåŠ¨é…ç½®</p>
<p>æœ¬ç¬”è®°ä¸è®°å½•pythonï¼Œåªé’ˆå¯¹C++è¿›è¡Œå­¦ä¹ </p>
</blockquote>
<h4 id="åŸç”Ÿæ¶ˆæ¯"><a href="#åŸç”Ÿæ¶ˆæ¯" class="headerlink" title="åŸç”Ÿæ¶ˆæ¯"></a>åŸç”Ÿæ¶ˆæ¯</h4><p><strong>å‘å¸ƒæ–¹å®ç°</strong></p>
<p>åŠŸèƒ½åŒ…cpp01_topicçš„srcç›®å½•ä¸‹</p>
<p>demo01_talker_str.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šä»¥æŸä¸ªå›ºå®šé¢‘ç‡å‘é€æ–‡æœ¬â€œhello world!â€ï¼Œæ–‡æœ¬åç¼€ç¼–å·ï¼Œæ¯å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œç¼–å·é€’å¢1ã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºå‘å¸ƒæ–¹ï¼›</span></span><br><span class="line"><span class="comment">      3-2.åˆ›å»ºå®šæ—¶å™¨ï¼›</span></span><br><span class="line"><span class="comment">      3-3.ç»„ç»‡æ¶ˆæ¯å¹¶å‘å¸ƒã€‚</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/msg/string.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals; <span class="comment">// å¯ä»¥ç›´æ¥è¾“å…¥æ—¶é—´å•ä½</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Talker</span>: <span class="keyword">public</span> rclcpp::Node{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Talker</span>():<span class="built_in">Node</span>(<span class="string">"talker_node_cpp"</span>),<span class="built_in">count</span>(<span class="number">0</span>){ <span class="comment">// è°ƒç”¨åŸºç±»æ„é€ å‡½æ•°è®¾ç½®èŠ‚ç‚¹å</span></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‘å¸ƒèŠ‚ç‚¹åˆ›å»ºï¼"</span>);</span><br><span class="line">    <span class="comment">// 3-1.åˆ›å»ºå‘å¸ƒæ–¹ï¼›</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">      æ¨¡æ¿ï¼šè¢«å‘å¸ƒçš„æ¶ˆæ¯ç±»å‹ï¼›</span></span><br><span class="line"><span class="comment">      &lt;&gt;å†…ä¸ºæ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="comment">      å‚æ•°:</span></span><br><span class="line"><span class="comment">        1.è¯é¢˜åç§°;</span></span><br><span class="line"><span class="comment">        2.QOS(æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦ï¼‰</span></span><br><span class="line"><span class="comment">      è¿”å›å€¼ï¼šå‘å¸ƒå¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    publisher_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;std_msgs::msg::String&gt;(<span class="string">"chatter"</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 3-2.åˆ›å»ºå®šæ—¶å™¨ï¼›</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    å‚æ•°:</span></span><br><span class="line"><span class="comment">      1.æ—¶é—®é—´éš”;-&gt; å¼•å…¥ using namespace std::chrono_literals</span></span><br><span class="line"><span class="comment">      2.å›è°ƒå‡½æ•°;</span></span><br><span class="line"><span class="comment">    è¿”å›å€¼ï¼šå®šæ—¶å™¨å¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(<span class="number">1</span>s,std::<span class="built_in">bind</span>(&amp;Talker::on_timer,<span class="keyword">this</span>));</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    std::bind()</span></span><br><span class="line"><span class="comment">    å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">      1.è¦ç»‘å®šçš„å‡½æ•°æŒ‡é’ˆï¼ˆ&amp;Talker::on_timerï¼‰</span></span><br><span class="line"><span class="comment">      2.è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡ï¼ˆthiså½“å‰èŠ‚ç‚¹ï¼‰</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">on_timer</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="comment">// 3-3.ç»„ç»‡æ¶ˆæ¯å¹¶å‘å¸ƒ</span></span><br><span class="line">    <span class="keyword">auto</span> message =std_msgs::msg::<span class="built_in">String</span>();</span><br><span class="line">    message.data = <span class="string">"hello world!"</span>+std::<span class="built_in">to_string</span>(count++);</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‘å¸ƒæ–¹æ•°æ®:%s"</span>,message.data.<span class="built_in">c_str</span>());</span><br><span class="line">    publisher_-&gt;<span class="built_in">publish</span>(message);</span><br><span class="line">  }</span><br><span class="line">  rclcpp::Publisher&lt;std_msgs::msg::String&gt;::SharedPtr publisher_;</span><br><span class="line">  rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">  <span class="type">size_t</span> count;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;Talker&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>è®¢é˜…æ–¹å®ç°</strong></p>
<p>åŠŸèƒ½åŒ…cpp01_topicçš„srcç›®å½•ä¸‹</p>
<p>demo02_listener_str.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    éœ€æ±‚ï¼šè®¢é˜…å‘å¸ƒæ–¹å‘å¸ƒçš„æ¶ˆæ¯ï¼Œå¹¶è¾“å‡ºåˆ°ç»ˆç«¯ã€‚</span></span><br><span class="line"><span class="comment">    æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">        1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">        2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">        3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">            3-1.åˆ›å»ºè®¢é˜…æ–¹ï¼›</span></span><br><span class="line"><span class="comment">            3-2.å¤„ç†è®¢é˜…åˆ°çš„æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment">        4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">        5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"std_msgs/msg/string.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1; <span class="comment">// å¼•å…¥å‡½æ•°å‚æ•°å ä½ç¬¦</span></span><br><span class="line"><span class="comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨ _1 å’Œ _2 ä»£æ›¿å†—é•¿çš„ std::placeholders::_1</span></span><br><span class="line"><span class="comment">// _1 è¡¨ç¤ºæ–°å‡½æ•°å¯¹è±¡çš„ç¬¬ä¸€ä¸ªå‚æ•° _2 è¡¨ç¤ºæ–°å‡½æ•°å¯¹è±¡çš„ ç¬¬äºŒä¸ªå‚æ•° ä»¥æ­¤ç±»æ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Listener</span>: <span class="keyword">public</span> rclcpp::Node{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Listener</span>(): <span class="built_in">Node</span>(<span class="string">"listener_node_cpp"</span>){</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è®¢é˜…æ–¹åˆ›å»ºï¼"</span>);</span><br><span class="line">        <span class="comment">// 3-1.åˆ›å»ºè®¢é˜…æ–¹ï¼›</span></span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">            æ¨¡æ¿ï¼šæ¶ˆæ¯ç±»å‹;</span></span><br><span class="line"><span class="comment">            å‚æ•°:</span></span><br><span class="line"><span class="comment">                1.è¯é¢˜åç§°;</span></span><br><span class="line"><span class="comment">                2.QOSï¼Œé˜Ÿåˆ—é•¿åº¦ï¼›</span></span><br><span class="line"><span class="comment">            è¿”å›å€¼ï¼šè®¢é˜…å¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        subcription_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::String&gt;(<span class="string">"chatter"</span>,<span class="number">10</span>,</span><br><span class="line">            std::<span class="built_in">bind</span>(&amp;Listener::do_cb,<span class="keyword">this</span>,_1));</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">do_cb</span><span class="params">(<span class="type">const</span> std_msgs::msg::String &amp;msg)</span></span>{</span><br><span class="line">        <span class="comment">// 3-2.è§£æå¹¶è¾“å‡ºæ•°æ®</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è®¢é˜…çš„æ¶ˆæ¯ï¼š'%s'"</span>,msg.data.<span class="built_in">c_str</span>());</span><br><span class="line">    }</span><br><span class="line">    rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr subcription_;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">    <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;Listener&gt;());</span><br><span class="line">    <span class="comment">// 5.é‡Šæ”¾èµ„æºï¼›</span></span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>CMakeLists.txtä¸­å‘å¸ƒå’Œè®¢é˜…ç¨‹åºæ ¸å¿ƒé…ç½®å¦‚ä¸‹ï¼Œæ³¨æ„å¢åŠ listeneréƒ¨åˆ†</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">add_executable(demo01_talker_str src/demo01_talker_str.cpp)</span><br><span class="line">add_executable(demo02_listener_str src/demo02_listener_str.cpp)</span><br><span class="line"></span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  demo01_talker_str</span><br><span class="line">  "rclcpp"</span><br><span class="line">  "std_msgs"</span><br><span class="line">)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  demo02_listener_str</span><br><span class="line">  "rclcpp"</span><br><span class="line">  "std_msgs"</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">install(TARGETS </span><br><span class="line">  demo01_talker_str</span><br><span class="line">  demo02_listener_str</span><br><span class="line">  DESTINATION lib/${PROJECT_NAME})</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>CMakeListsé…ç½®åŒ…æ‹¬<code>add_executable</code>ã€<code>ament_target_dependencies</code>ã€<code>install</code>ä¸‰éƒ¨åˆ†</p>
</blockquote>
<p><strong>ç¼–è¯‘</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --packages-select cpp01_topic</span><br></pre></td></tr></tbody></table></figure>

<h4 id="é…ç½®æ¥å£æ¶ˆæ¯"><a href="#é…ç½®æ¥å£æ¶ˆæ¯" class="headerlink" title="é…ç½®æ¥å£æ¶ˆæ¯"></a>é…ç½®æ¥å£æ¶ˆæ¯</h4><p><strong>åˆ›å»ºå¹¶ç¼–è¾‘ .msg æ–‡ä»¶</strong></p>
<p>åŠŸèƒ½åŒ…base_interfacesä¸‹æ–°å»º msg æ–‡ä»¶å¤¹ï¼Œmsgæ–‡ä»¶å¤¹ä¸‹æ–°å»ºStudent.msgæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string   name</span><br><span class="line">int32    age</span><br><span class="line">float64  height</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç¼–è¾‘é…ç½®æ–‡ä»¶</strong></p>
<p>åœ¨package.xmlä¸­éœ€è¦æ·»åŠ ä¸€äº›ä¾èµ–åŒ…</p>
<blockquote>
<p>ä¸ç”¨ç‰¹åˆ«è®°å¿†ï¼Œè°ƒç”¨<code>ros2 pkg list | grep -i rosidl</code></p>
<p><code>rosidl</code> æ˜¯ ROS 2 çš„æ ¸å¿ƒç»„ä»¶ï¼Œä»£è¡¨äº†ROS æ¥å£å®šä¹‰è¯­è¨€</p>
</blockquote>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¼–è¯‘ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rosidl_default_generators<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ‰§è¡Œä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rosidl_default_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å£°æ˜å½“å‰åŒ…æ‰€å±çš„åŠŸèƒ½åŒ…ç»„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">member_of_group</span>&gt;</span>rosidl_interface_packages<span class="tag">&lt;/<span class="name">member_of_group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- åˆ é™¤éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">&lt;test_depend&gt;ament_lint_auto&lt;/test_depend&gt;</span></span><br><span class="line"><span class="comment">&lt;test_depend&gt;ament_lint_common&lt;/test_depend&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ºäº†å°†<code>.msg</code>æ–‡ä»¶è½¬æ¢æˆå¯¹åº”çš„C++å’ŒPythonä»£ç ï¼Œè¿˜éœ€è¦åœ¨CMakeLists.txtä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ ä¾èµ–</span><br><span class="line">find_package(rosidl_default_generators REQUIRED)</span><br><span class="line"></span><br><span class="line"># ä¸ºæ¥å£æ–‡ä»¶ç”Ÿæˆæºç </span><br><span class="line">rosidl_generate_interfaces(${PROJECT_NAME}</span><br><span class="line">  "msg/Student.msg"</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç¼–è¯‘åŠŸèƒ½åŒ…</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --packages-select base_interfaces</span><br></pre></td></tr></tbody></table></figure>

<p>ç¼–è¯‘å®Œæˆä¹‹åï¼Œåœ¨å·¥ä½œç©ºé—´ä¸‹çš„nstallç›®å½•ä¸‹å°†ç”Ÿæˆ<code>Student.msg</code>æ–‡ä»¶å¯¹åº”çš„C++å’ŒPythonæ–‡ä»¶</p>
<p><strong>æµ‹è¯•</strong></p>
<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å®šä¹‰ä»¥åŠç¼–è¯‘æ˜¯å¦æ­£å¸¸</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. install/setup.bash</span><br><span class="line">ros2 interface show base_interfaces/msg/Student</span><br></pre></td></tr></tbody></table></figure>

<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œç»ˆç«¯å°†ä¼šè¾“å‡ºä¸<code>Student.msg</code>æ–‡ä»¶ä¸€è‡´çš„å†…å®¹</p>
<h4 id="è‡ªå®šä¹‰æ¶ˆæ¯"><a href="#è‡ªå®šä¹‰æ¶ˆæ¯" class="headerlink" title="è‡ªå®šä¹‰æ¶ˆæ¯"></a>è‡ªå®šä¹‰æ¶ˆæ¯</h4><p><strong>å‡†å¤‡</strong></p>
<p>C++æ–‡ä»¶ä¸­åŒ…å«è‡ªå®šä¹‰æ¶ˆæ¯ç›¸å…³å¤´æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥é…ç½®VSCodeä¸­c_cpp_properties.jsonæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­çš„ includePathå±æ€§ä¸‹æ·»åŠ </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">${workspaceFolder}/install/base_interfaces/include/**</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä»–æ¥å£æ–‡ä»¶æˆ–æ¥å£åŒ…çš„ä½¿ç”¨ä¹Ÿä¸æ­¤åŒç†</p>
<p><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p>
<p>package.xmlæ— éœ€ä¿®æ”¹ï¼ŒCMakeLists.txtæ–‡ä»¶éœ€è¦ä¿®æ”¹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">add_executable(demo03_talker_stu src/demo03_talker_stu.cpp)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  demo03_talker_stu</span><br><span class="line">  "rclcpp"</span><br><span class="line">  "std_msgs"</span><br><span class="line">  "base_interfaces"</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">add_executable(demo04_listener_stu src/demo04_listener_stu.cpp)</span><br><span class="line">ament_target_dependencies(</span><br><span class="line">  demo04_listener_stu</span><br><span class="line">  "rclcpp"</span><br><span class="line">  "std_msgs"</span><br><span class="line">  "base_interfaces"</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">install(TARGETS </span><br><span class="line">  demo01_talker_str</span><br><span class="line">  demo02_listener_str</span><br><span class="line">  demo03_talker_stu</span><br><span class="line">  demo04_listener_stu</span><br><span class="line">  DESTINATION lib/${PROJECT_NAME})</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å‘å¸ƒæ–¹å®ç°</strong></p>
<p>åŠŸèƒ½åŒ…cpp01_topicçš„srcç›®å½•ä¸‹</p>
<p>demo03_talker_stu.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šä»¥æŸä¸ªå›ºå®šé¢‘ç‡å‘é€æ–‡æœ¬å­¦ç”Ÿä¿¡æ¯ï¼ŒåŒ…å«å­¦ç”Ÿçš„å§“åã€å¹´é¾„ã€èº«é«˜ç­‰æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/msg/student.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals; <span class="comment">// å¯ä»¥ç›´æ¥è¾“å…¥æ—¶é—´å•ä½</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TalkerStu</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">TalkerStu</span>():<span class="built_in">Node</span>(<span class="string">"talkerstu_node_cpp"</span>),<span class="built_in">count</span>(<span class="number">0</span>){ <span class="comment">// è°ƒç”¨åŸºç±»æ„é€ å‡½æ•°è®¾ç½®èŠ‚ç‚¹</span></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‘å¸ƒèŠ‚ç‚¹åˆ›å»ºï¼"</span>);</span><br><span class="line">    <span class="comment">// 3-1.åˆ›å»ºå‘å¸ƒæ–¹ï¼›</span></span><br><span class="line">    publisher_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;base_interfaces::msg::Student&gt;(<span class="string">"chatter_stu"</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 3-2.åˆ›å»ºå®šæ—¶å™¨ï¼›</span></span><br><span class="line">    timer_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_wall_timer</span>(<span class="number">1</span>s,std::<span class="built_in">bind</span>(&amp;TalkerStu::on_timer,<span class="keyword">this</span>));</span><br><span class="line">  }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">on_timer</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="comment">// 3-3.ç»„ç»‡æ¶ˆæ¯å¹¶å‘å¸ƒ</span></span><br><span class="line">    <span class="keyword">auto</span> stu = base_interfaces::msg::<span class="built_in">Student</span>();</span><br><span class="line">    stu.name = <span class="string">"å¼ ä¸‰"</span>;</span><br><span class="line">    stu.age = count++;</span><br><span class="line">    stu.height = <span class="number">1.65</span>;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å­¦ç”Ÿä¿¡æ¯:name=%s,age=%d,height=%.2f"</span>,</span><br><span class="line">    stu.name.<span class="built_in">c_str</span>(),stu.age,stu.height);</span><br><span class="line">    publisher_-&gt;<span class="built_in">publish</span>(stu);</span><br><span class="line">  }</span><br><span class="line">  rclcpp::Publisher&lt;base_interfaces::msg::Student&gt;::SharedPtr publisher_;</span><br><span class="line">  rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">  <span class="type">size_t</span> count;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;TalkerStu&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>è®¢é˜…æ–¹å®ç°</strong></p>
<p>åŠŸèƒ½åŒ…cpp01_topicçš„srcç›®å½•ä¸‹</p>
<p>demo04_listener_stu.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    éœ€æ±‚ï¼šè®¢é˜…å‘å¸ƒæ–¹å‘å¸ƒçš„å­¦ç”Ÿæ¶ˆæ¯ï¼Œå¹¶è¾“å‡ºåˆ°ç»ˆç«¯ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/msg/student.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1; <span class="comment">// è¡¨ç¤º"è¿™é‡Œä¿ç•™ä¸€ä¸ªä½ç½®ï¼Œå®é™…å‚æ•°å°†åœ¨è°ƒç”¨æ—¶ä¼ å…¥"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListenerStu</span>: <span class="keyword">public</span> rclcpp::Node{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ListenerStu</span>(): <span class="built_in">Node</span>(<span class="string">"listenerstu_node_cpp"</span>){</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è®¢é˜…æ–¹åˆ›å»ºï¼"</span>);</span><br><span class="line">        <span class="comment">// 3-1.åˆ›å»ºè®¢é˜…æ–¹ï¼›</span></span><br><span class="line">        subcription_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;base_interfaces::msg::Student&gt;(<span class="string">"chatter_stu"</span>,<span class="number">10</span>,</span><br><span class="line">            std::<span class="built_in">bind</span>(&amp;ListenerStu::do_cb,<span class="keyword">this</span>,_1));</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">do_cb</span><span class="params">(<span class="type">const</span> base_interfaces::msg::Student &amp;stu)</span></span>{</span><br><span class="line">        <span class="comment">// 3-2.è§£æå¹¶è¾“å‡ºæ•°æ®</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è®¢é˜…çš„å­¦ç”Ÿæ¶ˆæ¯:name=%s,age=%d,height=%.2f"</span>,</span><br><span class="line">        stu.name.<span class="built_in">c_str</span>(),stu.age,stu.height);</span><br><span class="line">    }</span><br><span class="line">    rclcpp::Subscription&lt;base_interfaces::msg::Student&gt;::SharedPtr subcription_;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">    <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;ListenerStu&gt;());</span><br><span class="line">    <span class="comment">// 5.é‡Šæ”¾èµ„æºï¼›</span></span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç¼–è¯‘æ‰§è¡Œå³å¯</p>
<h3 id="æœåŠ¡é€šä¿¡"><a href="#æœåŠ¡é€šä¿¡" class="headerlink" title="æœåŠ¡é€šä¿¡"></a>æœåŠ¡é€šä¿¡</h3><p>æœåŠ¡é€šä¿¡ä¹Ÿæ˜¯ROSä¸­ä¸€ç§æå…¶å¸¸ç”¨çš„é€šä¿¡æ¨¡å¼ï¼ŒæœåŠ¡é€šä¿¡æ˜¯åŸºäº<strong>è¯·æ±‚å“åº”</strong>æ¨¡å¼çš„ï¼Œæ˜¯ä¸€ç§åº”ç­”æœºåˆ¶</p>
<blockquote>
<p>ä¸€ä¸ªèŠ‚ç‚¹Aå‘å¦ä¸€ä¸ªèŠ‚ç‚¹Bå‘é€è¯·æ±‚ï¼ŒBæ¥æ”¶å¤„ç†è¯·æ±‚å¹¶äº§ç”Ÿå“åº”ç»“æœè¿”å›ç»™A</p>
</blockquote>
<p>æœåŠ¡é€šä¿¡æ›´é€‚ç”¨äºå¯¹å®æ—¶æ€§æœ‰è¦æ±‚ã€å…·æœ‰ä¸€å®šé€»è¾‘å¤„ç†çš„åº”ç”¨åœºæ™¯</p>
<p>å‘é€è¯·æ±‚æ•°æ®çš„å¯¹è±¡ç§°ä¸ºå®¢æˆ·ç«¯ï¼Œæ¥æ”¶è¯·æ±‚å¹¶å‘é€å“åº”çš„å¯¹è±¡ç§°ä¹‹ä¸ºæœåŠ¡ç«¯ï¼ŒåŒè¯é¢˜é€šä¿¡ä¸€æ ·ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹Ÿé€šè¿‡è¯é¢˜ç›¸å…³è”ï¼Œä¸åŒçš„æ˜¯æœåŠ¡é€šä¿¡çš„æ•°æ®ä¼ è¾“æ˜¯åŒå‘äº¤äº’å¼çš„</p>
<p>ä¸€èˆ¬æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»(ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¤šä¸ªæœåŠ¡ç«¯)</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/2.3æœåŠ¡é€šä¿¡æ¨¡å‹2 (1).gif" alt="2.3æœåŠ¡é€šä¿¡æ¨¡å‹2 (1)" style="zoom:80%;">

<h4 id="æ¡ˆä¾‹éœ€æ±‚-1"><a href="#æ¡ˆä¾‹éœ€æ±‚-1" class="headerlink" title="æ¡ˆä¾‹éœ€æ±‚"></a>æ¡ˆä¾‹éœ€æ±‚</h4><p>éœ€æ±‚ï¼šç¼–å†™æœåŠ¡é€šä¿¡ï¼Œå®¢æˆ·ç«¯å¯ä»¥æäº¤ä¸¤ä¸ªæ•´æ•°åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚å¹¶è§£æä¸¤ä¸ªæ•´æ•°æ±‚å’Œï¼Œç„¶åå°†ç»“æœå“åº”å›å®¢æˆ·ç«¯</p>
<p>ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´çš„srcç›®å½•ï¼Œè°ƒç”¨å‘½ä»¤åˆ›å»ºC++åŠŸèƒ½åŒ…ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªcppæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create cpp02_service --build-type ament_cmake --dependencies rclcpp base_interfaces --node-name demo01_server</span><br></pre></td></tr></tbody></table></figure>

<h4 id="é…ç½®æ¥å£æ¶ˆæ¯-1"><a href="#é…ç½®æ¥å£æ¶ˆæ¯-1" class="headerlink" title="é…ç½®æ¥å£æ¶ˆæ¯"></a>é…ç½®æ¥å£æ¶ˆæ¯</h4><p><strong>åˆ›å»ºå¹¶ç¼–è¾‘ .srv æ–‡ä»¶</strong></p>
<p>åŠŸèƒ½åŒ…base_interfacesä¸‹æ–°å»ºsrvæ–‡ä»¶å¤¹ï¼Œsrvæ–‡ä»¶å¤¹ä¸‹æ–°å»ºAddInts.srvæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int32 num1</span><br><span class="line">int32 num2</span><br><span class="line">---</span><br><span class="line">int32 sum</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç¼–è¾‘é…ç½®æ–‡ä»¶</strong></p>
<p>srvæ–‡ä»¶ä¸msgæ–‡ä»¶çš„åŒ…ä¾èµ–ä¸€è‡´</p>
<p>å¦‚æœæ˜¯æ–°å»ºçš„åŠŸèƒ½åŒ…æ·»åŠ srvæ–‡ä»¶ï¼Œé‚£ä¹ˆç›´æ¥å‚è€ƒå®šä¹‰msgæ–‡ä»¶æ—¶package.xml é…ç½®å³å¯</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç¼–è¯‘ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rosidl_default_generators<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ‰§è¡Œä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rosidl_default_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å£°æ˜å½“å‰åŒ…æ‰€å±çš„åŠŸèƒ½åŒ…ç»„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">member_of_group</span>&gt;</span>rosidl_interface_packages<span class="tag">&lt;/<span class="name">member_of_group</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç”±äºä½¿ç”¨çš„åŒä¸€ä¸ªå·¥ä½œç©ºé—´ï¼Œæ— éœ€ä¿®æ”¹</p>
<p>ä¸ºäº†å°†<code>.srv</code>æ–‡ä»¶è½¬æ¢æˆå¯¹åº”çš„C++å’ŒPythonä»£ç ï¼Œè¿˜éœ€è¦åœ¨CMakeLists.txtä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find_package(rosidl_default_generators REQUIRED) # æ·»åŠ ä¾èµ–</span><br><span class="line">rosidl_generate_interfaces(${PROJECT_NAME}</span><br><span class="line">  "msg/Student.msg"</span><br><span class="line">  "srv/AddInts.srv" # å¢æ·»éƒ¨åˆ†</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç¼–è¯‘</strong></p>
<p>ç»ˆç«¯ä¸­è¿›å…¥å½“å‰å·¥ä½œç©ºé—´ï¼Œç¼–è¯‘åŠŸèƒ½åŒ…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --packages-select base_interfaces</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<p>ç¼–è¯‘å®Œæˆä¹‹åï¼Œåœ¨å·¥ä½œç©ºé—´ä¸‹çš„ install ç›®å½•ä¸‹å°†ç”Ÿæˆ<code>AddInts.srv</code>æ–‡ä»¶å¯¹åº”çš„C++å’ŒPythonæ–‡ä»¶</p>
<p>å¯ä»¥åœ¨ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å®šä¹‰ä»¥åŠç¼–è¯‘æ˜¯å¦æ­£å¸¸</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. install/setup.bash</span><br><span class="line">ros2 interface show base_interfaces/srv/AddInts</span><br></pre></td></tr></tbody></table></figure>

<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œç»ˆç«¯å°†ä¼šè¾“å‡ºä¸<code>AddInts.srv</code>æ–‡ä»¶ä¸€è‡´çš„å†…å®¹</p>
<h4 id="æ¡ˆä¾‹å®ç°"><a href="#æ¡ˆä¾‹å®ç°" class="headerlink" title="æ¡ˆä¾‹å®ç°"></a>æ¡ˆä¾‹å®ç°</h4><p>CMakeListsé…ç½®å‚è€ƒè¯é¢˜é€šä¿¡</p>
<p><strong>æœåŠ¡ç«¯å®ç°</strong></p>
<p>åŠŸèƒ½åŒ…cpp02_serviceçš„srcç›®å½•ä¸‹</p>
<p>demo01_server.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šç¼–å†™æœåŠ¡ç«¯ï¼Œæ¥æ”¶å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œæå–å…¶ä¸­ä¸¤ä¸ªæ•´å‹æ•°æ®ï¼Œç›¸åŠ åå°†ç»“æœå“åº”å›å®¢æˆ·ç«¯ã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºæœåŠ¡ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-2.å¤„ç†è¯·æ±‚æ•°æ®å¹¶å“åº”ç»“æœã€‚</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/srv/add_ints.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> base_interfaces::srv::AddInts;</span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1;</span><br><span class="line"><span class="keyword">using</span> std::placeholders::_2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddIntsServer</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">AddIntsServer</span>():<span class="built_in">Node</span>(<span class="string">"addints_server_node_cpp"</span>){ </span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœåŠ¡ç«¯åˆ›å»ºæˆåŠŸï¼"</span>);</span><br><span class="line">    <span class="comment">// 3-1.åˆ›å»ºæœåŠ¡ç«¯ï¼›</span></span><br><span class="line">    <span class="comment">/* æ¨¡æ¿ï¼šæœåŠ¡æ¥å£ç±»å‹;</span></span><br><span class="line"><span class="comment">	     å‚æ•°:</span></span><br><span class="line"><span class="comment">		    1.æœåŠ¡è¯é¢˜;</span></span><br><span class="line"><span class="comment">		    2.å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">	     è¿”å›å€¼ï¼šæœåŠ¡å¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">    server = <span class="keyword">this</span>-&gt;<span class="built_in">create_service</span>&lt;AddInts&gt;(<span class="string">"add_ints"</span>,</span><br><span class="line">        std::<span class="built_in">bind</span>(&amp;AddIntsServer::add,<span class="keyword">this</span>,_1,_2));</span><br><span class="line">  }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// 3-2.å¤„ç†è¯·æ±‚æ•°æ®å¹¶å“åº”ç»“æœã€‚</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">const</span> AddInts::Request::SharedPtr req,<span class="type">const</span> AddInts::Response::SharedPtr res)</span></span></span><br><span class="line"><span class="function">  </span>{</span><br><span class="line">    res-&gt;sum = req-&gt;num1 + req-&gt;num2;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è¯·æ±‚æ•°æ®:(%d,%d),å“åº”ç»“æœ:%d"</span>, req-&gt;num1, req-&gt;num2, res-&gt;sum);</span><br><span class="line">  }</span><br><span class="line">  rclcpp::Service&lt;AddInts&gt;::SharedPtr server;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;AddIntsServer&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>éªŒè¯å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 service call /add_ints base_interfaces/srv/AddInts "{'num1':10,'num2':2}"</span><br></pre></td></tr></tbody></table></figure>

<p>/add_intsæ˜¯æœåŠ¡çš„è¯é¢˜åç§°ï¼Œåé¢è·Ÿæ•°æ®ç±»å‹ï¼Œå¯ä»¥[TAB]æŸ¥çœ‹</p>
<p>è¾“å…¥å‚æ•°çš„å†™æ³•éœ€è¦æ³¨æ„</p>
<p><strong>å®¢æˆ·ç«¯å®ç°</strong></p>
<p>æ³¨æ„å®¢æˆ·ç«¯ä¸éœ€è¦æŒ‚èµ·ï¼Œä¸éœ€è¦spin</p>
<p>åŠŸèƒ½åŒ…cpp02_serviceçš„srcç›®å½•ä¸‹</p>
<p>demo02_client.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šç¼–å†™å®¢æˆ·ç«¯ï¼Œå‘é€ä¸¤ä¸ªæ•´å‹å˜é‡ä½œä¸ºè¯·æ±‚æ•°æ®ï¼Œå¹¶å¤„ç†å“åº”ç»“æœã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    å‰æï¼šmainä¸­éœ€è¦éªŒè¯æäº¤å‚æ•°æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºå®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-2.ç­‰å¾…æœåŠ¡è¿æ¥ï¼›</span></span><br><span class="line"><span class="comment">      3-3.ç»„ç»‡è¯·æ±‚æ•°æ®å¹¶å‘é€ï¼›</span></span><br><span class="line"><span class="comment">    4.åˆ›å»ºå¯¹è±¡æŒ‡é’ˆè°ƒç”¨å…¶åŠŸèƒ½</span></span><br><span class="line"><span class="comment">      è°ƒç”¨è¿æ¥æœåŠ¡å‡½æ•°ï¼Œæ ¹æ®è¿æ¥ç»“æœè¿›è¡Œä¸‹ä¸€æ­¥</span></span><br><span class="line"><span class="comment">      è¿æ¥æˆåŠŸåï¼Œè°ƒç”¨è¯·æ±‚å‘é€å‡½æ•°</span></span><br><span class="line"><span class="comment">      å¤„ç†å“åº”ç»“æœ</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æº</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/srv/add_ints.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> base_interfaces::srv::AddInts;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals; <span class="comment">// å¯ä»¥ç›´æ¥è¾“å…¥æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddIntsClient</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">AddIntsClient</span>():<span class="built_in">Node</span>(<span class="string">"addints_client_node_cpp"</span>){  </span><br><span class="line">	  <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸï¼"</span>); </span><br><span class="line">    <span class="comment">// 3-1.åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line">    client_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_client</span>&lt;AddInts&gt;(<span class="string">"add_ints"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 3-2.ç­‰å¾…æœåŠ¡è¿æ¥ï¼›</span></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">connect_server</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="comment">// å¾ªç¯ä»¥5sæ—¶é—´è¿æ¥æœåŠ¡å™¨ï¼Œç›´åˆ°æœåŠ¡å™¨è¿æ¥æˆåŠŸ</span></span><br><span class="line">      <span class="keyword">while</span>(!client_-&gt;<span class="built_in">wait_for_service</span>(<span class="number">5</span>s)) <span class="comment">// è¿æ¥ä¸Šè¿”å›trueï¼Œè¶…è¿‡æ—¶é—´è¿”å›false</span></span><br><span class="line">      {</span><br><span class="line">        <span class="comment">// å¯¹ctrl+cä½œå‡ºç‰¹æ®Šå¤„ç†</span></span><br><span class="line">        <span class="comment">// æŒ‰ä¸‹ctrl+cæ˜¯ç»“æŸR0S2ç¨‹åºï¼Œæ„å‘³ç€è¦é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚å…³é—­contextï¼Œæ— æ³•å†è°ƒç”¨ç±»this</span></span><br><span class="line">        <span class="comment">// rclcpp::get_logger("name")åˆ›å»º logger å¯¹è±¡ä¸ä¾èµ–äºcontext</span></span><br><span class="line">        <span class="keyword">if</span> (!rclcpp::<span class="built_in">ok</span>())</span><br><span class="line">        {</span><br><span class="line">          <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"å¼ºåˆ¶é€€å‡ºï¼"</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"æœåŠ¡è¿æ¥ä¸­ï¼Œè¯·ç¨å€™..."</span>);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-3.ç»„ç»‡è¯·æ±‚æ•°æ®å¹¶å‘é€ï¼›</span></span><br><span class="line">    <span class="comment">//ç¼–å†™å‘é€è¯·æ±‚å‡½æ•°ï¼Œå‚æ•°æ˜¯ä¸¤ä¸ªæ•´å‹æ•°æ®ï¼Œè¿”å›å€¼æ˜¯æäº¤è¯·æ±‚åæœåŠ¡ç«¯çš„è¿”å›ç»“æœ</span></span><br><span class="line">    rclcpp::Client&lt;AddInts&gt;::<span class="function">FutureAndRequestId <span class="title">send_request</span><span class="params">(<span class="type">int32_t</span> num1,<span class="type">int32_t</span> num2)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">      <span class="keyword">auto</span> request = std::<span class="built_in">make_shared</span>&lt;AddInts::Request&gt;();</span><br><span class="line">      request-&gt;num1 = num1;</span><br><span class="line">      request-&gt;num2 = num2;</span><br><span class="line">      <span class="keyword">return</span> client_-&gt;<span class="built_in">async_send_request</span>(request);</span><br><span class="line">      <span class="comment">// async_send_requestè¿”å›: a FutureAndRequestId instance.</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp::Client&lt;AddInts&gt;::SharedPtr client_;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="keyword">if</span>(argc!=<span class="number">3</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_ERROR</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"è¯·æäº¤ä¸¤ä¸ªintæ•°æ®"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// å®¢æˆ·ç«¯ä¸éœ€è¦spin</span></span><br><span class="line">  <span class="comment">// 3-1 åˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">auto</span> client = std::<span class="built_in">make_shared</span>&lt;AddIntsClient&gt;(); </span><br><span class="line">  <span class="comment">// æ ¹æ®è¿æ¥ç»“æœåšè¿›ä¸€æ­¥å¤„ç†</span></span><br><span class="line">  <span class="type">bool</span> flag = client-&gt;<span class="built_in">connect_server</span>();</span><br><span class="line">  <span class="keyword">if</span>(!flag)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_ERROR</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"æœåŠ¡å™¨è¿æ¥å¤±è´¥"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// è°ƒç”¨è¯·æ±‚æäº¤å‡½æ•°ï¼Œæ¥æ”¶å¹¶å¤„ç†å“åº”ç»“æœã€‚</span></span><br><span class="line">  <span class="comment">// å‘é€å¼‚æ­¥è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">auto</span> response = client-&gt;<span class="built_in">send_request</span>(<span class="built_in">atoi</span>(argv[<span class="number">1</span>]),<span class="built_in">atoi</span>(argv[<span class="number">2</span>]));</span><br><span class="line">  <span class="comment">// å¤„ç†å“åº”</span></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">  <span class="keyword">if</span> (rclcpp::<span class="built_in">spin_until_future_complete</span>(client,response) == rclcpp::FutureReturnCode::SUCCESS)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(client-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è¯·æ±‚æ­£å¸¸å¤„ç†"</span>);</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(client-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å“åº”ç»“æœ:%d!"</span>, response.<span class="built_in">get</span>()-&gt;sum);</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(client-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è¯·æ±‚å¼‚å¸¸"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="åŠ¨ä½œé€šä¿¡"><a href="#åŠ¨ä½œé€šä¿¡" class="headerlink" title="åŠ¨ä½œé€šä¿¡"></a>åŠ¨ä½œé€šä¿¡</h3><p>å¯¼èˆªæ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œæ˜¯è€—æ—¶æ“ä½œï¼Œå¦‚æœä½¿ç”¨æœåŠ¡é€šä¿¡ï¼Œé‚£ä¹ˆåªæœ‰åœ¨å¯¼èˆªç»“æŸæ—¶ï¼Œæ‰ä¼šäº§ç”Ÿå“åº”ç»“æœï¼Œè€Œåœ¨å¯¼èˆªè¿‡ç¨‹ä¸­ï¼ŒèŠ‚ç‚¹Aæ˜¯ä¸ä¼šè·å–åˆ°ä»»ä½•åé¦ˆçš„ï¼Œä»è€Œå¯èƒ½å‡ºç°ç¨‹åºâ€å‡æ­»â€çš„ç°è±¡</p>
<p>æ›´åˆç†çš„æ–¹æ¡ˆåº”è¯¥æ˜¯ï¼šå¯¼èˆªè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¿ç»­åé¦ˆå½“å‰æœºå™¨äººçŠ¶æ€ä¿¡æ¯ï¼Œå½“å¯¼èˆªç»ˆæ­¢æ—¶ï¼Œå†è¿”å›æœ€ç»ˆçš„æ‰§è¡Œç»“æœ</p>
<p>åœ¨ROSä¸­ï¼Œè¯¥å®ç°ç­–ç•¥ç§°ä¸ºaction é€šä¿¡ï¼Œé€‚ç”¨äºè€—æ—¶çš„è¯·æ±‚å“åº”åœºæ™¯ï¼Œç”¨ä»¥è·å–è¿ç»­çš„çŠ¶æ€åé¦ˆ</p>
<p>åŠŸèƒ½è€Œè¨€åŠ¨ä½œé€šä¿¡ç±»ä¼¼äºæœåŠ¡é€šä¿¡ï¼ŒåŠ¨ä½œå®¢æˆ·ç«¯å¯ä»¥å‘é€è¯·æ±‚åˆ°åŠ¨ä½œæœåŠ¡ç«¯ï¼Œå¹¶æ¥æ”¶åŠ¨ä½œæœåŠ¡ç«¯å“åº”çš„æœ€ç»ˆç»“æœï¼Œä¸è¿‡åŠ¨ä½œé€šä¿¡å¯ä»¥åœ¨è¯·æ±‚å“åº”è¿‡ç¨‹ä¸­è·å–è¿ç»­åé¦ˆï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å‘åŠ¨ä½œæœåŠ¡ç«¯å‘é€ä»»åŠ¡å–æ¶ˆè¯·æ±‚</p>
<p>åº•å±‚å®ç°è€Œè¨€åŠ¨ä½œé€šä¿¡æ˜¯å»ºç«‹åœ¨è¯é¢˜é€šä¿¡å’ŒæœåŠ¡é€šä¿¡ä¹‹ä¸Šçš„ï¼Œç›®æ ‡å‘é€å®ç°æ˜¯å¯¹æœåŠ¡é€šä¿¡çš„å°è£…ï¼Œç»“æœçš„è·å–ä¹Ÿæ˜¯å¯¹æœåŠ¡é€šä¿¡çš„å°è£…ï¼Œè€Œè¿ç»­åé¦ˆåˆ™æ˜¯å¯¹è¯é¢˜é€šä¿¡çš„å°è£…</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/2.4actioné€šä¿¡æ¨¡å‹ (1).gif" alt="2.4actioné€šä¿¡æ¨¡å‹ (1)" style="zoom: 80%;">

<h4 id="æ¡ˆä¾‹éœ€æ±‚-2"><a href="#æ¡ˆä¾‹éœ€æ±‚-2" class="headerlink" title="æ¡ˆä¾‹éœ€æ±‚"></a>æ¡ˆä¾‹éœ€æ±‚</h4><p>éœ€æ±‚ï¼šç¼–å†™åŠ¨ä½œé€šä¿¡ï¼ŒåŠ¨ä½œå®¢æˆ·ç«¯æäº¤ä¸€ä¸ªæ•´å‹æ•°æ®Nï¼ŒåŠ¨ä½œæœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚æ•°æ®å¹¶ç´¯åŠ 1-Nä¹‹é—´çš„æ‰€æœ‰æ•´æ•°ï¼Œå°†æœ€ç»ˆç»“æœè¿”å›ç»™åŠ¨ä½œå®¢æˆ·ç«¯ï¼Œä¸”æ¯ç´¯åŠ ä¸€æ¬¡éƒ½éœ€è¦è®¡ç®—å½“å‰è¿ç®—è¿›åº¦å¹¶åé¦ˆç»™åŠ¨ä½œå®¢æˆ·ç«¯</p>
<p>ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´çš„srcç›®å½•ï¼Œè°ƒç”¨å‘½ä»¤åˆ›å»ºC++åŠŸèƒ½åŒ…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create cpp03_action --build-type ament_cmake --dependencies rclcpp rclcpp_action base_interfaces --node-name demo01_action_server</span><br></pre></td></tr></tbody></table></figure>

<h4 id="é…ç½®æ¥å£æ¶ˆæ¯-2"><a href="#é…ç½®æ¥å£æ¶ˆæ¯-2" class="headerlink" title="é…ç½®æ¥å£æ¶ˆæ¯"></a>é…ç½®æ¥å£æ¶ˆæ¯</h4><p><strong>åˆ›å»ºå¹¶ç¼–è¾‘ .action æ–‡ä»¶</strong></p>
<p>åŠŸèƒ½åŒ…base_interfacesä¸‹æ–°å»ºactionæ–‡ä»¶å¤¹ï¼Œactionæ–‡ä»¶å¤¹ä¸‹æ–°å»ºProgress.actionæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int64 num</span><br><span class="line">---</span><br><span class="line">int64 sum</span><br><span class="line">---</span><br><span class="line">float64 progress</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç¼–è¾‘é…ç½®æ–‡ä»¶</strong></p>
<p>å¦‚æœå•ç‹¬æ„å»ºactionåŠŸèƒ½åŒ…ï¼Œéœ€è¦åœ¨package.xmlä¸­éœ€è¦æ·»åŠ ä¸€äº›ä¾èµ–åŒ…ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;buildtool_depend&gt;rosidl_default_generators&lt;/buildtool_depend&gt;</span><br><span class="line">&lt;depend&gt;action_msgs&lt;/depend&gt;</span><br><span class="line">&lt;member_of_group&gt;rosidl_interface_packages&lt;/member_of_group&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨çš„æ˜¯ä¹‹å‰çš„åŒ…ï¼Œå·²ç»ä¸º msg ã€srv æ–‡ä»¶æ·»åŠ è¿‡äº†ä¸€äº›ä¾èµ–ï¼Œæ‰€ä»¥ package.xml ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹å³å¯</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;buildtool_depend&gt;rosidl_default_generators&lt;/buildtool_depend&gt;</span><br><span class="line">&lt;depend&gt;action_msgs&lt;/depend&gt;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>æ³¨æ„ï¼Œå’Œä¹‹å‰çš„æ˜¯æœ‰å·®å¼‚çš„ï¼Œä¹‹å‰æ˜¯<code>  &lt;build_depend&gt;rosidl_default_generators&lt;/build_depend&gt;</code></p>
</blockquote>
<p>ä¸ºäº†å°†<code>.action</code>æ–‡ä»¶è½¬æ¢æˆå¯¹åº”çš„C++å’ŒPythonä»£ç ï¼Œè¿˜éœ€è¦åœ¨CMakeLists.txt ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find_package(rosidl_default_generators REQUIRED) # æ·»åŠ ä¾èµ–</span><br><span class="line"></span><br><span class="line">rosidl_generate_interfaces(${PROJECT_NAME}</span><br><span class="line">  "msg/Student.msg"</span><br><span class="line">  "srv/AddInts.srv"</span><br><span class="line">  "action/Progress.action" # å¢æ·»çš„éƒ¨åˆ†</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç¼–è¯‘</strong></p>
<p>ç»ˆç«¯ä¸­è¿›å…¥å½“å‰å·¥ä½œç©ºé—´ï¼Œç¼–è¯‘åŠŸèƒ½åŒ…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --packages-select base_interfaces</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<p>ç¼–è¯‘å®Œæˆä¹‹åï¼Œåœ¨å·¥ä½œç©ºé—´ä¸‹çš„ install ç›®å½•ä¸‹å°†ç”Ÿæˆ<code>Progress.action</code>æ–‡ä»¶å¯¹åº”çš„C++å’ŒPythonæ–‡ä»¶</p>
<p>ä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å®šä¹‰ä»¥åŠç¼–è¯‘æ˜¯å¦æ­£å¸¸</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. install/setup.bash</span><br><span class="line">ros2 interface show base_interfaces/action/Progress</span><br></pre></td></tr></tbody></table></figure>

<h4 id="æ¡ˆä¾‹å®ç°-1"><a href="#æ¡ˆä¾‹å®ç°-1" class="headerlink" title="æ¡ˆä¾‹å®ç°"></a>æ¡ˆä¾‹å®ç°</h4><p>CMakeListsé…ç½®å‚è€ƒè¯é¢˜é€šä¿¡</p>
<p><strong>åŠ¨ä½œæœåŠ¡ç«¯å®ç°</strong></p>
<p>cpp03_actionçš„srcç›®å½•ä¸‹</p>
<p>demo01_action_server.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šç¼–å†™åŠ¨ä½œæœåŠ¡ç«¯ï¼Œéœ€è¦è§£æå®¢æˆ·ç«¯æäº¤çš„æ•°å­—ï¼Œéå†è¯¥æ•°å­—å¹¶ç´¯åŠ æ±‚å’Œï¼Œæœ€ç»ˆç»“æœå“åº”å›</span></span><br><span class="line"><span class="comment">       å®¢æˆ·ç«¯ï¼Œä¸”è¯·æ±‚å“åº”è¿‡ç¨‹ä¸­éœ€è¦ç”Ÿæˆè¿ç»­åé¦ˆã€‚</span></span><br><span class="line"><span class="comment">  åˆ†æ:</span></span><br><span class="line"><span class="comment">    1.åˆ›å»ºåŠ¨ä½œæœåŠ¡ç«¯å¯¹è±¡;</span></span><br><span class="line"><span class="comment">    2. å¤„ç†æäº¤çš„ç›®æ ‡å€¼;</span></span><br><span class="line"><span class="comment">    3.ç”Ÿæˆè¿ç»­åé¦ˆ;</span></span><br><span class="line"><span class="comment">    4.å“åº”æœ€ç»ˆç»“æœï¼›</span></span><br><span class="line"><span class="comment">    5.å¤„ç†å–æ¶ˆè¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºåŠ¨ä½œæœåŠ¡ç«¯å¯¹è±¡ï¼›</span></span><br><span class="line"><span class="comment">      3-2.å¤„ç†æäº¤çš„ç›®æ ‡å€¼ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼›</span></span><br><span class="line"><span class="comment">      3-3.å¤„ç†å–æ¶ˆè¯·æ±‚ï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment">      3-4.ç”Ÿæˆè¿ç»­åé¦ˆä¸æœ€ç»ˆå“åº”ï¼ˆå›è°ƒæ¶µæ•°ï¼‰</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp_action/rclcpp_action.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/action/progress.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> base_interfaces::action::Progress;</span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1;</span><br><span class="line"><span class="keyword">using</span> std::placeholders::_2;</span><br><span class="line"><span class="comment">// using namespace std::placeholders; æˆ–è€…ç›´æ¥è¿™ä¸€å¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProgressActionServer</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ProgressActionServer</span>():<span class="built_in">Node</span>(<span class="string">"progressa_action_server_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">	<span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"action æœåŠ¡ç«¯åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">  <span class="comment">// 3-1.åˆ›å»ºåŠ¨ä½œæœåŠ¡ç«¯å¯¹è±¡ï¼›</span></span><br><span class="line">  <span class="comment">/* å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">      (NodeT node, </span></span><br><span class="line"><span class="comment">      const std::string &amp;name, </span></span><br><span class="line"><span class="comment">      rclcpp_action::Server&lt;ActionT&gt;::GoalCallback handle_goal, </span></span><br><span class="line"><span class="comment">      rclcpp_action::Server&lt;ActionT&gt;::CancelCallback handle_cancel, </span></span><br><span class="line"><span class="comment">      rclcpp_action::Server&lt;ActionT&gt;::AcceptedCallback handle_accepted</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  server_ = rclcpp_action::<span class="built_in">create_server</span>&lt;Progress&gt;(</span><br><span class="line">      <span class="keyword">this</span>,</span><br><span class="line">      <span class="string">"get_sum"</span>,</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;ProgressActionServer::handle_goal,<span class="keyword">this</span>,_1,_2),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;ProgressActionServer::handle_cancel,<span class="keyword">this</span>,_1),</span><br><span class="line">      std::<span class="built_in">bind</span>(&amp;ProgressActionServer::handle_accepted,<span class="keyword">this</span>,_1));</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åŠ¨ä½œæœåŠ¡ç«¯åˆ›å»ºï¼Œç­‰å¾…è¯·æ±‚..."</span>);</span><br><span class="line">  }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp_action::Server&lt;Progress&gt;::SharedPtr server_;</span><br><span class="line">  <span class="comment">// 3-2.å¤„ç†æäº¤çš„ç›®æ ‡å€¼ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼›</span></span><br><span class="line">  <span class="comment">// GoalCallback =  std::function&lt;GoalResponse(const GoalUUID &amp;, std::shared_ptr&lt;const typename ActionT::Goal&gt;)&gt;;</span></span><br><span class="line">  <span class="function">rclcpp_action::GoalResponse <span class="title">handle_goal</span><span class="params">(<span class="type">const</span> rclcpp_action::GoalUUID &amp; uuid, std::shared_ptr&lt;<span class="type">const</span> Progress::Goal&gt; goal)</span></span></span><br><span class="line"><span class="function">  </span>{</span><br><span class="line">    (<span class="type">void</span>)uuid; <span class="comment">// æ ‡è¯†ç›®å‰æ²¡ç”¨ä¸Š,é¿å…è­¦å‘Š</span></span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘ï¼šåˆ¤æ–­çš„ç«¯æäº¤æ•°å­—æ˜¯å¦å¤§äº1ï¼Œæ˜¯æ¥å—ï¼Œä¸æ˜¯æ‹’ç»</span></span><br><span class="line">    <span class="keyword">if</span>(goal-&gt;num&lt;=<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æäº¤çš„ç›®æ ‡å€¼å¿…é¡»å¤§äº1"</span>);</span><br><span class="line">      <span class="keyword">return</span> rclcpp_action::GoalResponse::REJECT;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æäº¤ç›®æ ‡æˆåŠŸ"</span>);</span><br><span class="line">    <span class="keyword">return</span> rclcpp_action::GoalResponse::ACCEPT_AND_EXECUTE;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 3-3.å¤„ç†å–æ¶ˆè¯·æ±‚ï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line">  <span class="comment">// CancelCallback = std::function&lt;CancelResponse(std::shared_ptr&lt;ServerGoalHandle&lt;ActionT&gt;&gt;)&gt;;</span></span><br><span class="line">  <span class="function">rclcpp_action::CancelResponse <span class="title">handle_cancel</span><span class="params">(std::shared_ptr&lt;rclcpp_action::ServerGoalHandle&lt;Progress&gt;&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">  </span>{</span><br><span class="line">    (<span class="type">void</span>)goal_handle;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æ¥æ”¶åˆ°å–æ¶ˆè¯·æ±‚"</span>);</span><br><span class="line">    <span class="keyword">return</span> rclcpp_action::CancelResponse::ACCEPT;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3-4.ç”Ÿæˆè¿ç»­åé¦ˆä¸æœ€ç»ˆå“åº”ï¼ˆå›è°ƒæ¶µæ•°ï¼‰  </span></span><br><span class="line">  <span class="comment">// AcceptedCallback = std::function&lt;void (std::shared_ptr&lt;ServerGoalHandle&lt;ActionT&gt;&gt;)&gt;</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">(std::shared_ptr&lt;rclcpp_action::ServerGoalHandle&lt;Progress&gt;&gt; goal_handle)</span></span>{</span><br><span class="line">    <span class="comment">// 1. ç”Ÿæˆè¿ç»­åé¦ˆ</span></span><br><span class="line">    <span class="comment">// é¦–å…ˆè¦è·å–ç›®æ ‡å€¼ï¼Œç„¶åéå†ï¼Œè¿½å†ä¸­è¿›è¡Œç´¯åŠ ï¼Œä¸”æ¯å¾ªç¯ä¸€æ¬¡å°±è®¡ç®—è¿›åº¦ï¼Œå¹¶ä½œä¸ºè¿ç»­åé¦ˆå‘å¸ƒ</span></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"å¼€å§‹æ‰§è¡Œä»»åŠ¡"</span>);</span><br><span class="line">    <span class="type">int</span> num = goal_handle-&gt;<span class="built_in">get_goal</span>()-&gt;num;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> progress = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">double</span> progress_pro;</span><br><span class="line">    <span class="comment">// void publish_feedback(std::shared_ptr&lt;base_interfaces::action::Progress_Feedback&gt; feedback_msg)</span></span><br><span class="line">    <span class="keyword">auto</span> feedback = std::<span class="built_in">make_shared</span>&lt;Progress::Feedback&gt;();</span><br><span class="line">    <span class="keyword">auto</span> result = std::<span class="built_in">make_shared</span>&lt;Progress::Result&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ä¼‘çœ </span></span><br><span class="line">    <span class="function">rclcpp::Rate <span class="title">rate</span><span class="params">(<span class="number">1.0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= num; i++)</span><br><span class="line">    {</span><br><span class="line">      <span class="comment">// æ£€æŸ¥å–æ¶ˆè¯·æ±‚</span></span><br><span class="line">      <span class="keyword">if</span> (goal_handle-&gt;<span class="built_in">is_canceling</span>()) {</span><br><span class="line">        result-&gt;sum = sum;</span><br><span class="line">		    <span class="comment">// void canceled(std::shared_ptr&lt;base_interfaces::action::Progress_Result&gt; result_msg)</span></span><br><span class="line">        goal_handle-&gt;<span class="built_in">canceled</span>(result);</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"ä»»åŠ¡å–æ¶ˆ!å½“å‰è®¡ç®—ç»“æœä¸º%d"</span>, sum);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">      sum += i; </span><br><span class="line">      progress = i/ (<span class="type">double</span>) num; <span class="comment">// è®¡ç®—è¿›åº¦</span></span><br><span class="line">      feedback-&gt;progress = progress;</span><br><span class="line">      progress_pro = progress * <span class="number">100</span>;</span><br><span class="line">      goal_handle-&gt;<span class="built_in">publish_feedback</span>(feedback);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ä»»åŠ¡è¿›è¡Œä¸­ï¼Œå½“å‰è¿›åº¦%.2f%%"</span>,progress_pro);</span><br><span class="line">      rate.<span class="built_in">sleep</span>();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. å½¢æˆæœ€ç»ˆå“åº”ç»“æœ</span></span><br><span class="line">    <span class="comment">// void succeed(std::shared_ptr&lt;base_interfaces::action::Progress_Result&gt; result_msg)</span></span><br><span class="line">    <span class="keyword">if</span>(rclcpp::<span class="built_in">ok</span>())</span><br><span class="line">    {</span><br><span class="line">      result-&gt;sum = sum;</span><br><span class="line">      goal_handle-&gt;<span class="built_in">succeed</span>(result);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ä»»åŠ¡å®Œæˆï¼Œæœ€ç»ˆç»“æœ:%d"</span>,sum);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">handle_accepted</span><span class="params">(std::shared_ptr&lt;rclcpp_action::ServerGoalHandle&lt;Progress&gt;&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">  </span>{</span><br><span class="line">    <span class="comment">// æ–°å»ºçº¿ç¨‹å¤„ç†è€—æ—¶çš„ä¸»é€»è¾‘</span></span><br><span class="line">    std::thread{std::<span class="built_in">bind</span>(&amp;ProgressActionServer::execute,<span class="keyword">this</span>,_1),goal_handle}.<span class="built_in">detach</span>();</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;ProgressActionServer&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>ç¼–å†™å›è°ƒå‡½æ•°æŸ¥çœ‹æºç </p>
<p>create_server -&gt; Server</p>
</blockquote>
<p><strong>åŠ¨ä½œå®¢æˆ·ç«¯å®ç°</strong></p>
<p>cpp03_actionçš„srcç›®å½•ä¸‹</p>
<p>demo02_action_client.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šç¼–å†™åŠ¨ä½œå®¢æˆ·ç«¯ï¼Œå¯ä»¥å‘é€ä¸€ä¸ªæ•´å‹æ•°æ®åˆ°æœåŠ¡ç«¯ï¼Œå¹¶å¤„ç†æœåŠ¡ç«¯çš„è¿ç»­åé¦ˆå’Œæœ€ç»ˆå“åº”ç»“æœã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    å‰æï¼šå¯ä»¥è§£æç»ˆç«¯ä¸‹åŠ¨æ€ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºåŠ¨ä½œå®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-2.å‘é€è¯·æ±‚;</span></span><br><span class="line"><span class="comment">      3-3.å¤„ç†å…³äºç›®æ ‡å€¼çš„æœåŠ¡ç«¯å“åº”ï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment">      3-4.å¤„ç†è¿ç»­åé¦ˆï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment">      3-5.å¤„ç†æœ€ç»ˆå“åº”ï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp_action/rclcpp_action.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/action/progress.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> base_interfaces::action::Progress;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals; <span class="comment">// å¯ä»¥ç›´æ¥è¾“å…¥æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProgressActionClient</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ProgressActionClient</span>():<span class="built_in">Node</span>(<span class="string">"progress_action_client_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">	<span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"action å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">  <span class="comment">// 3-1.åˆ›å»ºåŠ¨ä½œå®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  <span class="comment">/* å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">  NodeT node, </span></span><br><span class="line"><span class="comment">  const std::string &amp;name</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  client_ = rclcpp_action::<span class="built_in">create_client</span>&lt;Progress&gt;(<span class="keyword">this</span>,<span class="string">"get_sum"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 3-2.å‘é€è¯·æ±‚;</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">send_goal</span><span class="params">(<span class="type">int</span> num)</span></span>{</span><br><span class="line">    <span class="comment">// 1.éœ€è¦è¿æ¥åˆ°æœåŠ¡ç«¯</span></span><br><span class="line">    <span class="keyword">if</span>(!client_-&gt;<span class="built_in">wait_for_action_server</span>(<span class="number">5</span>s))</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 2. å‘é€å…·ä½“è¯·æ±‚</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    std::shared_future&lt;rclcpp_action::ClientGoalHandle&lt;base_interfaces::action::Progress&gt;::SharedPtr&gt; </span></span><br><span class="line"><span class="comment">    async_send_goal(</span></span><br><span class="line"><span class="comment">        const base_interfaces::action::Progress::Goal &amp;goal,</span></span><br><span class="line"><span class="comment">        const rclcpp_action::Client&lt;base_interfaces::action::Progress&gt;::SendGoalOptions &amp;options)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">auto</span> goal = Progress::<span class="built_in">Goal</span>();</span><br><span class="line">    goal.num = num;</span><br><span class="line">    rclcpp_action::Client&lt;Progress&gt;::SendGoalOptions options;</span><br><span class="line">    options.goal_response_callback = std::<span class="built_in">bind</span>(&amp;ProgressActionClient::goal_response_callback,<span class="keyword">this</span>,_1);</span><br><span class="line">    options.feedback_callback = std::<span class="built_in">bind</span>(&amp;ProgressActionClient::feedback_callback,<span class="keyword">this</span>,_1,_2);</span><br><span class="line">    options.result_callback = std::<span class="built_in">bind</span>(&amp;ProgressActionClient::result_callback,<span class="keyword">this</span>,_1);</span><br><span class="line">    <span class="keyword">auto</span> future = client_ -&gt; <span class="built_in">async_send_goal</span>(goal,options);</span><br><span class="line">  }</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">cancel_goal</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (client_) {</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"å‘é€å–æ¶ˆè¯·æ±‚"</span>);</span><br><span class="line">      client_-&gt;<span class="built_in">async_cancel_all_goals</span>();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp_action::Client&lt;Progress&gt;::SharedPtr client_;</span><br><span class="line">  <span class="comment">// 3-3.å¤„ç†å…³äºç›®æ ‡å€¼çš„æœåŠ¡ç«¯å“åº”ï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">    using GoalHandle = ClientGoalHandle&lt;ActionT&gt;;</span></span><br><span class="line"><span class="comment">    using GoalResponseCallback = std::function&lt;void (typename GoalHandle::SharedPtr)&gt;;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">goal_response_callback</span><span class="params">(rclcpp_action::ClientGoalHandle&lt;Progress&gt;::SharedPtr goal_handle)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!goal_handle){</span><br><span class="line">      <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ç›®æ ‡è¯·æ±‚è¢«æœåŠ¡ç«¯æ‹’ç»!"</span>);</span><br><span class="line">      rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    } <span class="keyword">else</span>{</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ç›®æ ‡å¤„ç†ä¸­!ç›®æ ‡ID: %s"</span>,<span class="built_in">goal_uuid_to_string</span>(goal_handle-&gt;<span class="built_in">get_goal_id</span>()).<span class="built_in">c_str</span>());</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 3-4.å¤„ç†è¿ç»­åé¦ˆï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">    using GoalHandle = ClientGoalHandle&lt;ActionT&gt;;</span></span><br><span class="line"><span class="comment">    using FeedbackCallback =</span></span><br><span class="line"><span class="comment">    std::function&lt;void (</span></span><br><span class="line"><span class="comment">        typename ClientGoalHandle&lt;ActionT&gt;::SharedPtr,</span></span><br><span class="line"><span class="comment">        const std::shared_ptr&lt;const Feedback&gt;)&gt;;</span></span><br><span class="line"><span class="comment">    using FeedbackCallback = typename GoalHandle::FeedbackCallback;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">feedback_callback</span><span class="params">(rclcpp_action::ClientGoalHandle&lt;Progress&gt;::SharedPtr goal_handle, <span class="type">const</span> std::shared_ptr&lt;<span class="type">const</span> Progress::Feedback&gt; feedback)</span></span>{</span><br><span class="line">    (<span class="type">void</span>)goal_handle;</span><br><span class="line">    <span class="type">double</span> progress = feedback-&gt;progress;</span><br><span class="line">    <span class="type">double</span> progress_pro = progress * <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å½“å‰è¿›åº¦:%.2f%%"</span>,progress_pro);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 3-5.å¤„ç†æœ€ç»ˆå“åº”ï¼ˆå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">    using ResultCallback = typename GoalHandle::ResultCallback;</span></span><br><span class="line"><span class="comment">    template&lt;typename ActionT&gt;</span></span><br><span class="line"><span class="comment">    class ClientGoalHandle { struct WrappedResult }</span></span><br><span class="line"><span class="comment">    using ResultCallback = std::function&lt;void (const WrappedResult &amp; result)&gt;;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">result_callback</span><span class="params">(<span class="type">const</span> rclcpp_action::ClientGoalHandle&lt;Progress&gt;::WrappedResult &amp; result)</span></span>{</span><br><span class="line">    <span class="comment">// result.code</span></span><br><span class="line">    <span class="comment">// é€šè¿‡çŠ¶æ€ç åˆ¤æ–­ç»“æœçŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span>(result.code == rclcpp_action::ResultCode::SUCCEEDED)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœ€ç»ˆç»“æœ:%ld"</span>,result.result-&gt;sum);</span><br><span class="line"></span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span>(result.code == rclcpp_action::ResultCode::ABORTED)</span><br><span class="line">    {</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ä»»åŠ¡è¢«ä¸­æ­¢!"</span>);</span><br><span class="line"></span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span>(result.code == rclcpp_action::ResultCode::CANCELED){</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ä»»åŠ¡è¢«å–æ¶ˆ!"</span>);</span><br><span class="line"></span><br><span class="line">    } <span class="keyword">else</span>{</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœªçŸ¥å¼‚å¸¸!"</span>);</span><br><span class="line">    }</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†UUIDè½¬æ¢ä¸ºå¯è¯»å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="function">std::string <span class="title">goal_uuid_to_string</span><span class="params">(<span class="type">const</span> rclcpp_action::GoalUUID&amp; uuid)</span> </span>{</span><br><span class="line">      std::stringstream ss;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> byte : uuid) {</span><br><span class="line">          ss &lt;&lt; std::hex &lt;&lt; std::<span class="built_in">setw</span>(<span class="number">2</span>) &lt;&lt; std::<span class="built_in">setfill</span>(<span class="string">'0'</span>) &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(byte);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> ss.<span class="built_in">str</span>();</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="keyword">if</span>(argc!= <span class="number">2</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_ERROR</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"è¯·æäº¤ä¸€ä¸ª&gt;1çš„æ•´å‹æ•°æ®!"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;ProgressActionClient&gt;();</span><br><span class="line">  node-&gt;<span class="built_in">send_goal</span>(<span class="built_in">atoi</span>(argv[<span class="number">1</span>]));</span><br><span class="line">  <span class="comment">// æ·»åŠ é”®ç›˜ç›‘å¬çº¿ç¨‹</span></span><br><span class="line">  <span class="function">std::thread <span class="title">input_thread</span><span class="params">([node]() {</span></span></span><br><span class="line"><span class="params"><span class="function">    RCLCPP_INFO(node-&gt;get_logger(), <span class="string">"æŒ‰ 'c' é”®å–æ¶ˆç›®æ ‡"</span>);</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">while</span> (rclcpp::ok()) {</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="type">char</span> c = std::cin.get();</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="keyword">if</span> (c == <span class="string">'c'</span> || c == <span class="string">'C'</span>) {</span></span></span><br><span class="line"><span class="params"><span class="function">        node-&gt;cancel_goal();</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">break</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">      }</span></span></span><br><span class="line"><span class="params"><span class="function">    }</span></span></span><br><span class="line"><span class="params"><span class="function">  })</span></span>;</span><br><span class="line">  input_thread.<span class="built_in">detach</span>();</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(node); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>ç¼–å†™å›è°ƒå‡½æ•°æŸ¥çœ‹æºç </p>
<p>SendGoalOptions</p>
</blockquote>
<h3 id="å‚æ•°æœåŠ¡"><a href="#å‚æ•°æœåŠ¡" class="headerlink" title="å‚æ•°æœåŠ¡"></a>å‚æ•°æœåŠ¡</h3><p>å‚æ•°æœåŠ¡æ˜¯ä»¥å…±äº«çš„æ–¹å¼å®ç°ä¸åŒèŠ‚ç‚¹ä¹‹é—´æ•°æ®äº¤äº’çš„ä¸€ç§é€šä¿¡æ¨¡å¼</p>
<p>ä¿å­˜å‚æ•°çš„èŠ‚ç‚¹ç§°ä¹‹ä¸ºå‚æ•°æœåŠ¡ç«¯ï¼Œè°ƒç”¨å‚æ•°çš„èŠ‚ç‚¹ç§°ä¹‹ä¸ºå‚æ•°å®¢æˆ·ç«¯</p>
<p>å‚æ•°å®¢æˆ·ç«¯ä¸å‚æ•°æœåŠ¡ç«¯çš„äº¤äº’æ˜¯åŸºäºè¯·æ±‚å“åº”çš„ï¼Œä¸”å‚æ•°é€šä¿¡çš„å®ç°æœ¬è´¨ä¸Šå¯¹æœåŠ¡é€šä¿¡çš„è¿›ä¸€æ­¥å°è£…</p>
<p>å‚æ•°æœåŠ¡ä¿å­˜çš„æ•°æ®ç±»ä¼¼äºç¼–ç¨‹ä¸­â€œå…¨å±€å˜é‡â€çš„æ¦‚å¿µï¼Œå¯ä»¥åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¹‹é—´å…±äº«æ•°æ®</p>
<h4 id="æ¡ˆä¾‹éœ€æ±‚-3"><a href="#æ¡ˆä¾‹éœ€æ±‚-3" class="headerlink" title="æ¡ˆä¾‹éœ€æ±‚"></a>æ¡ˆä¾‹éœ€æ±‚</h4><p>éœ€æ±‚ï¼šåœ¨å‚æ•°æœåŠ¡ç«¯è®¾ç½®ä¸€äº›å‚æ•°ï¼Œå‚æ•°å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯å¹¶æ“ä½œè¿™äº›å‚æ•°</p>
<p>ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´çš„srcç›®å½•ï¼Œè°ƒç”¨å‘½ä»¤åˆ›å»ºC++åŠŸèƒ½åŒ…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create cpp04_param --build-type ament_cmake --dependencies rclcpp --node-name demo00_param</span><br></pre></td></tr></tbody></table></figure>

<h4 id="å‚æ•°æ•°æ®ç±»å‹"><a href="#å‚æ•°æ•°æ®ç±»å‹" class="headerlink" title="å‚æ•°æ•°æ®ç±»å‹"></a>å‚æ•°æ•°æ®ç±»å‹</h4><p>åœ¨ROS2ä¸­ï¼Œå‚æ•°ç”±é”®ã€å€¼å’Œæè¿°ç¬¦ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­é”®æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå€¼å¯ä»¥æ˜¯boolã€int64ã€float64ã€stringã€byte[]ã€bool[]ã€int64[]ã€float64[]ã€string[]ä¸­çš„ä»»ä¸€ç±»å‹ï¼Œæè¿°ç¬¦é»˜è®¤æƒ…å†µä¸‹ä¸ºç©ºï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®å‚æ•°æè¿°ã€å‚æ•°æ•°æ®ç±»å‹ã€å–å€¼èŒƒå›´æˆ–å…¶ä»–çº¦æŸç­‰ä¿¡æ¯</p>
<p>C++å®¢æˆ·ç«¯å¯¹åº”çš„ç±»æ˜¯<code>rclcpp::Parameter</code></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼š</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1 å‚æ•°å¯¹è±¡åˆ›å»º</span></span><br><span class="line"><span class="comment">      3-2 å‚æ•°å¯¹è±¡è§£æ</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyParam</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MyParam</span>():<span class="built_in">Node</span>(<span class="string">"my_param_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">	  <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‚æ•°APIåˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">    <span class="comment">// 3-1 å‚æ•°å¯¹è±¡åˆ›å»º</span></span><br><span class="line">    <span class="function">rclcpp::Parameter <span class="title">p1</span><span class="params">(<span class="string">"car"</span>,<span class="string">"tiger"</span>)</span></span>;</span><br><span class="line">    <span class="function">rclcpp::Parameter <span class="title">p2</span><span class="params">(<span class="string">"width"</span>,<span class="number">0.15</span>)</span></span>; <span class="comment">//å‚æ•°å€¼ä¸ºæµ®ç‚¹ç±»å‹</span></span><br><span class="line">    <span class="function">rclcpp::Parameter <span class="title">p3</span><span class="params">(<span class="string">"wheels"</span>,<span class="number">2</span>)</span></span>; <span class="comment">//å‚æ•°å€¼ä¸ºæ•´å‹</span></span><br><span class="line">    <span class="comment">// 3-2 å‚æ•°å¯¹è±¡è§£æ</span></span><br><span class="line">    <span class="comment">// è·å–å‚æ•°å€¼</span></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"car_name = %s"</span>, p<span class="number">1.</span><span class="built_in">as_string</span>().<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"car_width = %.2f"</span>, p<span class="number">2.</span><span class="built_in">as_double</span>());</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"wheels = %ld"</span>, p<span class="number">3.</span><span class="built_in">as_int</span>());</span><br><span class="line">    <span class="comment">// è·å–å‚æ•°é”®</span></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"p1 name = %s"</span>,p<span class="number">1.</span><span class="built_in">get_name</span>().<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// è·å–å‚æ•°æ•°æ®ç±»å‹</span></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"p1 type_name = %s"</span>, p<span class="number">1.</span><span class="built_in">get_type_name</span>().<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="comment">// å°†å‚æ•°å€¼è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"p2 value_to_msg = %s"</span>, p<span class="number">2.</span><span class="built_in">value_to_string</span>().<span class="built_in">c_str</span>());</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;MyParam&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="æ¡ˆä¾‹å®ç°-2"><a href="#æ¡ˆä¾‹å®ç°-2" class="headerlink" title="æ¡ˆä¾‹å®ç°"></a>æ¡ˆä¾‹å®ç°</h4><p>packages.xmlæ— éœ€ä¿®æ”¹ï¼Œé…ç½®CMakeList</p>
<p><strong>å‚æ•°æœåŠ¡ç«¯</strong></p>
<p>cpp04_paramçš„srcç›®å½•ä¸‹</p>
<p>demo01_param_server.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼š</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">        3-1.å£°æ˜å‚æ•°ï¼›</span></span><br><span class="line"><span class="comment">        3-2.æŸ¥è¯¢å‚æ•°ï¼›</span></span><br><span class="line"><span class="comment">        3-3.ä¿®æ”¹å‚æ•°ï¼›</span></span><br><span class="line"><span class="comment">        3-4.åˆ é™¤å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ParamServer</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// å…è®¸åˆ é™¤ éœ€è¦é€šè¿‡NodeOptionså£°æ˜</span></span><br><span class="line">    <span class="built_in">ParamServer</span>():<span class="built_in">Node</span>(<span class="string">"param_server_node_cpp"</span>,rclcpp::<span class="built_in">NodeOptions</span>().<span class="built_in">allow_undeclared_parameters</span>(<span class="literal">true</span>)){  </span><br><span class="line">		<span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‚æ•°æœåŠ¡å™¨åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">	}</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">declare_param</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"----------å¢åŠ ----------"</span>);</span><br><span class="line">        <span class="comment">// å£°æ˜å‚æ•°å¹¶è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">declare_parameter</span>(<span class="string">"car_name"</span>,<span class="string">"tiger"</span>);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">declare_parameter</span>(<span class="string">"height"</span>,<span class="number">1.50</span>); </span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">declare_parameter</span>(<span class="string">"wheels"</span>,<span class="number">4</span>); </span><br><span class="line">        <span class="comment">// set_parameteræ‰å¯åˆ é™¤</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">set_parameter</span>(rclcpp::<span class="built_in">Parameter</span>(<span class="string">"undcl_test"</span>,<span class="number">100</span>));</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">get_param</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"----------æŸ¥è¯¢----------"</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæŸ¥è¯¢</span></span><br><span class="line">        rclcpp::Parameter car_name = <span class="keyword">this</span>-&gt;<span class="built_in">get_parameter</span>(<span class="string">"car_name"</span>);</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"car_name:%s"</span>,car_name.<span class="built_in">as_string</span>().<span class="built_in">c_str</span>());</span><br><span class="line">        <span class="comment">// åˆ¤æ–­åŒ…å«</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åŒ…å«car_name? %d"</span>,<span class="keyword">this</span>-&gt;<span class="built_in">has_parameter</span>(<span class="string">"car_name"</span>));</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åŒ…å«car_type? %d"</span>,<span class="keyword">this</span>-&gt;<span class="built_in">has_parameter</span>(<span class="string">"car_type"</span>));</span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰</span></span><br><span class="line">        <span class="keyword">auto</span> params = <span class="keyword">this</span>-&gt;<span class="built_in">get_parameters</span>({<span class="string">"car_name"</span>,<span class="string">"height"</span>,<span class="string">"wheels"</span>});</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;param : params)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"name = %s, value = %s"</span>, param.<span class="built_in">get_name</span>().<span class="built_in">c_str</span>(), param.<span class="built_in">value_to_string</span>().<span class="built_in">c_str</span>());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update_param</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"----------ä¿®æ”¹----------"</span>);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">set_parameter</span>(rclcpp::<span class="built_in">Parameter</span>(<span class="string">"height"</span>,<span class="number">1.75</span>));</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">del_param</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"----------åˆ é™¤----------"</span>);</span><br><span class="line">        <span class="comment">//this-&gt;undeclare_parameter("car_name"); //ä¼šæŠ¥é”™ï¼Œæ— æ³•åˆ é™¤</span></span><br><span class="line">        <span class="comment">// RCLCPP_INFO(this-&gt;get_logger(),"åˆ é™¤åè¿˜åŒ…å«car_nameå—? %d",this-&gt;has_parameter("car_name")); </span></span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">undeclare_parameter</span>(<span class="string">"undcl_test"</span>);</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ é™¤åè¿˜åŒ…å«undcl_testå—? %d"</span>,<span class="keyword">this</span>-&gt;<span class="built_in">has_parameter</span>(<span class="string">"undcl_test"</span>)); </span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  <span class="keyword">auto</span> paramServer = std::<span class="built_in">make_shared</span>&lt;ParamServer&gt;();</span><br><span class="line">  paramServer-&gt;<span class="built_in">declare_param</span>();</span><br><span class="line">  paramServer-&gt;<span class="built_in">get_param</span>();</span><br><span class="line">  paramServer-&gt;<span class="built_in">update_param</span>();</span><br><span class="line">  paramServer-&gt;<span class="built_in">del_param</span>();</span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(paramServer); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å‚æ•°å®¢æˆ·ç«¯</strong></p>
<p>cpp04_paramçš„srcç›®å½•ä¸‹</p>
<p>demo02_param_client.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    éœ€æ±‚ï¼šç¼–å†™å‚æ•°å®¢æˆ·ç«¯ï¼Œè·å–æˆ–ä¿®æ”¹æœåŠ¡ç«¯å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">    æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">        1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">        2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">        3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">            3-1.åˆ›å»ºå‚æ•°å®¢æˆ·ç«¯å¯¹è±¡</span></span><br><span class="line"><span class="comment">            3-2.è¿æ¥åˆ°å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">            3-3.æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="comment">            3-4.ä¿®æ”¹å‚æ•°</span></span><br><span class="line"><span class="comment">        4.åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆï¼Œè°ƒç”¨å‚æ•°æ“ä½œå‡½æ•°ï¼›</span></span><br><span class="line"><span class="comment">        5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ParamClient</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ParamClient</span>():<span class="built_in">Node</span>(<span class="string">"param_client_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">		<span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‚æ•°å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">    <span class="comment">// 3-1.åˆ›å»ºå‚æ•°å®¢æˆ·ç«¯å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// å‚æ•°1: å½“å‰å¯¹è±¡èŠ‚ç‚¹ å‚æ•°2: è¿œç¨‹è¿æ¥èŠ‚ç‚¹</span></span><br><span class="line">    param_client = std::<span class="built_in">make_shared</span>&lt;rclcpp::SyncParametersClient&gt;(<span class="keyword">this</span>,<span class="string">"param_server_node_cpp"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-2.è¿æ¥åˆ°å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">connect_server</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="keyword">while</span>(!param_client-&gt;<span class="built_in">wait_for_service</span>(<span class="number">5</span>s)){</span><br><span class="line">        <span class="keyword">if</span>(!rclcpp::<span class="built_in">ok</span>()){</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœåŠ¡è¿æ¥ä¸­..."</span>);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">get_param</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"-----------å‚æ•°å®¢æˆ·ç«¯æŸ¥è¯¢å‚æ•°-----------"</span>);</span><br><span class="line">      <span class="comment">// è·å–æŸä¸ªå‚æ•°</span></span><br><span class="line">      std::string car_name = param_client-&gt;<span class="built_in">get_parameter</span>&lt;std::string&gt;(<span class="string">"car_name"</span>);</span><br><span class="line">      <span class="type">double</span> height = param_client-&gt;<span class="built_in">get_parameter</span>&lt;<span class="type">double</span>&gt;(<span class="string">"height"</span>);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"car_name=%s,height=%.2f"</span>,car_name.<span class="built_in">c_str</span>(),height);</span><br><span class="line">      <span class="comment">// è·å–å¤šä¸ªå‚æ•°</span></span><br><span class="line">      <span class="keyword">auto</span> params = param_client-&gt;<span class="built_in">get_parameters</span>({<span class="string">"car_name"</span>,<span class="string">"height"</span>,<span class="string">"wheels"</span>});</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;param : params)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"%s = %s"</span>,param.<span class="built_in">get_name</span>().<span class="built_in">c_str</span>(),param.<span class="built_in">value_to_string</span>().<span class="built_in">c_str</span>());</span><br><span class="line">      }</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åŒ…å«car_nameå—?%d"</span>,param_client-&gt;<span class="built_in">has_parameter</span>(<span class="string">"car_name"</span>));</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update_param</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"-----------å‚æ•°å®¢æˆ·ç«¯ä¿®æ”¹å‚æ•°-----------"</span>);</span><br><span class="line">      param_client-&gt;<span class="built_in">set_parameters</span>({rclcpp::<span class="built_in">Parameter</span>(<span class="string">"car_name"</span>,<span class="string">"Mouse"</span>),</span><br><span class="line">      rclcpp::<span class="built_in">Parameter</span>(<span class="string">"height"</span>,<span class="number">2.0</span>),</span><br><span class="line">      rclcpp::<span class="built_in">Parameter</span>(<span class="string">"width"</span>,<span class="number">0.15</span>),  <span class="comment">// è®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„å‚æ•°ï¼Œå¿…é¡»åœ¨å‚æ•°æœåŠ¡ç«¯å£°æ˜allow_undeclared_parameters(true)</span></span><br><span class="line">      rclcpp::<span class="built_in">Parameter</span>(<span class="string">"wheels"</span>,<span class="number">6</span>)});</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æ–°è®¾ç½®çš„å‚æ•°:%.2f"</span>,param_client-&gt;<span class="built_in">get_parameter</span>&lt;<span class="type">double</span>&gt;(<span class="string">"width"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  rclcpp::SyncParametersClient::SharedPtr param_client;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡ï¼›</span></span><br><span class="line">  <span class="keyword">auto</span> client = std::<span class="built_in">make_shared</span>&lt;ParamClient&gt;();</span><br><span class="line">  <span class="type">bool</span> flag = client-&gt;<span class="built_in">connect_server</span>();</span><br><span class="line">  <span class="keyword">if</span>(!flag){</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  client-&gt;<span class="built_in">get_param</span>();</span><br><span class="line">  client-&gt;<span class="built_in">update_param</span>();</span><br><span class="line">  client-&gt;<span class="built_in">get_param</span>();</span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é—®é¢˜ï¼šæœåŠ¡é€šä¿¡ä¸æ˜¯é€šè¿‡æœåŠ¡è¯é¢˜å…³è”å—ï¼Ÿä¸ºä»€ä¹ˆå‚æ•°å®¢æˆ·ç«¯æ˜¯é€šè¿‡å‚æ•°æœåŠ¡ç«¯çš„èŠ‚ç‚¹åç§°å…³è”ï¼Ÿ</p>
<ol>
<li>å‚æ•°æœåŠ¡ç«¯å¯åŠ¨åï¼Œåº•å±‚å°è£…äº†å¤šä¸ªæœåŠ¡é€šä¿¡çš„æœåŠ¡ç«¯ï¼›</li>
<li>æ¯ä¸ªæœåŠ¡ç«¯çš„è¯é¢˜ï¼Œéƒ½æ˜¯é‡‡ç”¨/æœåŠ¡ç«¯èŠ‚ç‚¹åç§°/XXXX;</li>
<li>å‚æ•°å®¢æˆ·ç«¯åˆ›å»ºåï¼Œä¹Ÿä¼šå°è£…å¤šä¸ªæœåŠ¡é€šä¿¡çš„å®¢æˆ·ç«¯ï¼›</li>
<li>è¿™äº›å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç›¸å‘¼åº”ï¼Œä¹Ÿè¦ä½¿ç”¨ç›¸åŒçš„è¯é¢˜ï¼Œå› æ­¤å®¢æˆ·ç«¯å†åˆ›å»ºæ—¶éœ€è¦ä½¿ç”¨æœåŠ¡ç«¯èŠ‚ç‚¹åç§°</li>
</ol>
<h3 id="æœ¬ç« å°èŠ‚"><a href="#æœ¬ç« å°èŠ‚" class="headerlink" title="æœ¬ç« å°èŠ‚"></a>æœ¬ç« å°èŠ‚</h3><p>æ— è®ºä½•ç§é€šä¿¡æœºåˆ¶ï¼Œå®ç°æ¡†æ¶éƒ½æ˜¯ç±»ä¼¼çš„</p>
<p>æ¯”å¦‚ï¼šé€šä¿¡å¿…ç„¶æ¶‰åŠåˆ°åŒæ–¹ï¼ŒåŒæ–¹éœ€è¦é€šè¿‡â€œè¯é¢˜â€å…³è”ï¼Œé€šä¿¡è¿˜éƒ½å¿…ç„¶æ¶‰åŠåˆ°æ•°æ®ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡æ¥å£æ–‡ä»¶æ¥å®šä¹‰æ•°æ®æ ¼å¼</p>
<p>ä¸åŒçš„é€šä¿¡æœºåˆ¶å…¶å®ç°æ¨¡å‹ä¹Ÿå­˜åœ¨æ˜æ˜¾å·®å¼‚</p>
<ul>
<li>è¯é¢˜é€šä¿¡æ˜¯åŸºäºå¹¿æ’­çš„å•å‘æ•°æ®äº¤äº’æ¨¡å¼</li>
<li>æœåŠ¡é€šä¿¡æ˜¯åŸºäºè¯·æ±‚å“åº”çš„é—®ç­”å¼äº¤æ•°æ®äº’æ¨¡å¼</li>
<li>åŠ¨ä½œé€šä¿¡åˆ™æ˜¯åœ¨è¯·æ±‚å“åº”çš„è¿‡ç¨‹ä¸­åˆåŒ…å«è¿ç»­åé¦ˆçš„æ•°æ®äº¤äº’æ¨¡å¼</li>
<li>å‚æ•°æœåŠ¡æ˜¯åŸºäºæœåŠ¡é€šä¿¡çš„ï¼Œå¯ä»¥åœ¨ä¸åŒèŠ‚ç‚¹é—´å®ç°æ•°æ®å…±äº«</li>
</ul>
<h2 id="ROS2é€šä¿¡æœºåˆ¶è¡¥å……"><a href="#ROS2é€šä¿¡æœºåˆ¶è¡¥å……" class="headerlink" title="ROS2é€šä¿¡æœºåˆ¶è¡¥å……"></a>ROS2é€šä¿¡æœºåˆ¶è¡¥å……</h2><p>ROS2ç¨‹åºæ„å»ºæ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š</p>
<ol>
<li>æ€ä¹ˆå®ç°åˆ†å¸ƒå¼æ¶æ„ï¼Ÿ</li>
<li>ä¸åŒå·¥ä½œç©ºé—´ä¸‹çš„åŠŸèƒ½åŒ…é‡åæ—¶ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>
<li>æ€ä¹ˆç®¡ç†åŠŸèƒ½åŒ…ï¼Ÿ</li>
<li>èŠ‚ç‚¹é‡åæ€ä¹ˆå¤„ç†ï¼Ÿ</li>
<li>è¯é¢˜é‡åæ€ä¹ˆå¤„ç†ï¼Ÿ</li>
</ol>
<h3 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h3><p>åˆ†å¸ƒå¼é€šä¿¡æ˜¯æŒ‡å¯ä»¥é€šè¿‡ç½‘ç»œåœ¨ä¸åŒä¸»æœºä¹‹é—´å®ç°æ•°æ®äº¤äº’çš„ä¸€ç§é€šä¿¡ç­–ç•¥</p>
<p>ROS2æ‰€åŸºäºçš„ä¸­é—´ä»¶æ˜¯DDSï¼Œå½“å¤„äºåŒä¸€ç½‘ç»œä¸­æ—¶ï¼Œé€šè¿‡DDSçš„åŸŸIDæœºåˆ¶(ROS_DOMAIN_ID)å¯ä»¥å®ç°åˆ†å¸ƒå¼</p>
<p>å¤§è‡´æµç¨‹ï¼šåœ¨å¯åŠ¨èŠ‚ç‚¹ä¹‹å‰ï¼Œå¯ä»¥è®¾ç½®åŸŸIDçš„å€¼ï¼Œä¸åŒèŠ‚ç‚¹å¦‚æœåŸŸIDç›¸åŒï¼Œé‚£ä¹ˆå¯ä»¥è‡ªç”±å‘ç°å¹¶é€šä¿¡</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨æ—¶æ‰€ä½¿ç”¨çš„åŸŸIDä¸º0ï¼Œæ¢è¨€ä¹‹ï¼Œåªè¦ä¿è¯åœ¨åŒä¸€ç½‘ç»œï¼Œä¸éœ€è¦åšä»»ä½•é…ç½®ï¼Œä¸åŒROS2è®¾å¤‡ä¸Šçš„ä¸åŒèŠ‚ç‚¹å³å¯å®ç°åˆ†å¸ƒå¼é€šä¿¡</p>
<p>å¦‚æœè¦å°†ä¸åŒèŠ‚ç‚¹åˆ’åˆ†ä¸ºå¤šä¸ªç»„ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç»ˆç«¯ä¸­å¯åŠ¨èŠ‚ç‚¹å‰è®¾ç½®è¯¥èŠ‚ç‚¹çš„åŸŸID(æ¯”å¦‚è®¾ç½®ä¸º6)ï¼Œå…·ä½“æ‰§è¡Œå‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ROS_DOMAIN_ID=6</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šè¿°æŒ‡ä»¤æ‰§è¡Œåï¼Œè¯¥èŠ‚ç‚¹å°†è¢«åˆ’åˆ†åˆ°IDä¸º6çš„åŸŸå†…</p>
<p>å¦‚æœè¦ä¸ºå½“å‰è®¾å¤‡ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®ç»Ÿä¸€çš„åŸŸIDï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "export ROS_DOMAIN_ID=6" &gt;&gt; ~/.bashrc</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œå®Œæ¯•åå†é‡æ–°å¯åŠ¨ç»ˆç«¯ï¼Œè¿è¡Œçš„æ‰€æœ‰èŠ‚ç‚¹å°†è‡ªåŠ¨è¢«åˆ’åˆ†åˆ°IDä¸º6çš„åŸŸå†…</p>
<p><strong>æ³¨æ„</strong></p>
<p>åœ¨è®¾ç½®ROS_DOMAIN_IDçš„å€¼æ—¶å¹¶ä¸æ˜¯éšæ„çš„ï¼Œä¹Ÿæ˜¯æœ‰ä¸€å®šçº¦æŸçš„ï¼š</p>
<ol>
<li>å»ºè®®ROS_DOMAIN_IDçš„å–å€¼åœ¨[0,101] ä¹‹é—´ï¼ŒåŒ…å«0å’Œ101ï¼›</li>
<li>æ¯ä¸ªåŸŸIDå†…çš„èŠ‚ç‚¹æ€»æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œéœ€è¦å°äºç­‰äº120ä¸ªï¼›</li>
<li>å¦‚æœåŸŸIDä¸º101ï¼Œé‚£ä¹ˆè¯¥åŸŸçš„èŠ‚ç‚¹æ€»æ•°éœ€è¦å°äºç­‰äº54ä¸ª</li>
</ol>
<p><strong>DDS åŸŸ ID å€¼çš„è®¡ç®—è§„åˆ™</strong>(è¡¥å……å†…å®¹)</p>
<p>DDSæ˜¯åŸºäºTCP/IPæˆ–UDP/IPç½‘ç»œé€šä¿¡åè®®çš„ï¼Œç½‘ç»œé€šä¿¡æ—¶éœ€è¦æŒ‡å®šç«¯å£å·ï¼Œç«¯å£å·ç”±2ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°è¡¨ç¤ºï¼Œå…¶å–å€¼èŒƒå›´åœ¨[0,65535]ä¹‹é—´</p>
<p>ç«¯å£å·çš„åˆ†é…ä¹Ÿæ˜¯æœ‰å…¶è§„åˆ™çš„ï¼Œå¹¶éå¯ä»¥ä»»æ„ä½¿ç”¨çš„ï¼Œæ ¹æ®DDSåè®®è§„å®š<font color="Violetred">ä»¥7400ä½œä¸ºèµ·å§‹ç«¯å£</font>ï¼Œä¹Ÿå³å¯ç”¨ç«¯å£ä¸º[7400,65535]ï¼Œåˆå·²çŸ¥æŒ‰ç…§DDSåè®®é»˜è®¤æƒ…å†µä¸‹ï¼Œ<font color="Violetred">æ¯ä¸ªåŸŸIDå ç”¨250ä¸ªç«¯å£</font>ï¼Œé‚£ä¹ˆåŸŸIDçš„ä¸ªæ•°ä¸ºï¼š(65535-7400)/250 = 232(ä¸ª)ï¼Œå¯¹åº”çš„å…¶å–å€¼èŒƒå›´ä¸º[0,231]</p>
<p>æ“ä½œç³»ç»Ÿè¿˜ä¼šè®¾ç½®ä¸€äº›é¢„ç•™ç«¯å£ï¼Œåœ¨DDSä¸­ä½¿ç”¨ç«¯å£æ—¶ï¼Œè¿˜éœ€è¦é¿å¼€è¿™äº›é¢„ç•™ç«¯å£ï¼Œä»¥å…ä½¿ç”¨ä¸­äº§ç”Ÿå†²çªï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿé¢„ç•™ç«¯å£åˆæœ‰æ‰€å·®å¼‚ï¼Œå…¶æœ€ç»ˆç»“æœæ˜¯ï¼Œåœ¨Linuxä¸‹ï¼Œå¯ç”¨çš„åŸŸIDä¸º[0,101]ä¸[215-231]ï¼Œåœ¨Windowså’ŒMacä¸­å¯ç”¨çš„åŸŸIDä¸º[0,166]</p>
<p>ç»¼ä¸Šï¼Œä¸ºäº†å…¼å®¹å¤šå¹³å°ï¼Œå»ºè®®<font color="Violetred">åŸŸIDåœ¨[0,101] èŒƒå›´å†…å–å€¼</font></p>
<p>æ¯ä¸ªåŸŸIDé»˜è®¤å ç”¨250ä¸ªç«¯å£ï¼Œä¸”æ¯ä¸ªROS2èŠ‚ç‚¹éœ€è¦å ç”¨ä¸¤ä¸ªç«¯å£ï¼Œå¦å¤–ï¼ŒæŒ‰ç…§DDSåè®®æ¯ä¸ªåŸŸIDçš„ç«¯å£æ®µå†…ï¼Œç¬¬1ã€2ä¸ªç«¯å£æ˜¯Discovery Multicastç«¯å£ä¸User Multicastç«¯å£ï¼Œä»ç¬¬11ã€12ä¸ªç«¯å£å¼€å§‹æ˜¯åŸŸå†…ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„Discovery Unicastç«¯å£ä¸User Unicastï¼Œåç»­èŠ‚ç‚¹æ‰€å ç”¨ç«¯å£ä¾æ¬¡é¡ºå»¶ï¼Œé‚£ä¹ˆä¸€ä¸ªåŸŸIDä¸­çš„æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°ä¸ºï¼š(250-10)/2 = 120(ä¸ª)</p>
<p>ç‰¹æ®Šæƒ…å†µï¼šåŸŸIDå€¼ä¸º101æ—¶ï¼Œå…¶ååŠæ®µç«¯å£å±äºæ“ä½œç³»ç»Ÿçš„é¢„ç•™ç«¯å£ï¼Œå…¶èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°ä¸º54ä¸ª</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">åŸŸ ID ä¸èŠ‚ç‚¹æ‰€å ç”¨ç«¯å£ç¤ºæ„</span><br><span class="line"></span><br><span class="line">Domain ID:      0</span><br><span class="line">Participant ID: 0</span><br><span class="line"></span><br><span class="line">Discovery Multicast Port: 7400</span><br><span class="line">User Multicast Port:      7401</span><br><span class="line">Discovery Unicast Port:   7410</span><br><span class="line">User Unicast Port:        7411</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Domain ID:      1</span><br><span class="line">Participant ID: 2</span><br><span class="line">Discovery Multicast Port: 7650</span><br><span class="line">User Multicast Port:      7651</span><br><span class="line">Discovery Unicast Port:   7664</span><br><span class="line">User Unicast Port:        7665</span><br><span class="line"></span><br><span class="line"># ç¬¬1ä¸ªåŸŸ+250 èŠ‚ç‚¹IDä¸º2-&gt;ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ 7660å¼€å§‹ (7660 7661) (7662 7663) (7664 7665) </span><br></pre></td></tr></tbody></table></figure>

<h3 id="å·¥ä½œç©ºé—´è¦†ç›–"><a href="#å·¥ä½œç©ºé—´è¦†ç›–" class="headerlink" title="å·¥ä½œç©ºé—´è¦†ç›–"></a>å·¥ä½œç©ºé—´è¦†ç›–</h3><p>åŒä¸€å·¥ä½œç©ºé—´ä¸‹ä¸å…è®¸å‡ºç°åŠŸèƒ½åŒ…é‡åçš„æƒ…å†µï¼Œä½†æ˜¯å½“å­˜åœ¨å¤šä¸ªå·¥ä½œç©ºé—´æ—¶ï¼Œä¸åŒå·¥ä½œç©ºé—´ä¸‹çš„åŠŸèƒ½åŒ…æ˜¯å¯ä»¥é‡åçš„ï¼Œé‚£ä¹ˆå½“åŠŸèƒ½åŒ…é‡åæ—¶ï¼Œä¼šè°ƒç”¨å“ªä¸€ä¸ªå‘¢ï¼Ÿ</p>
<p>æ‰€è°“å·¥ä½œç©ºé—´è¦†ç›–ï¼Œæ˜¯æŒ‡ä¸åŒå·¥ä½œç©ºé—´å­˜åœ¨é‡ååŠŸèƒ½åŒ…æ—¶ï¼Œé‡ååŠŸèƒ½åŒ…çš„è°ƒç”¨ä¼šäº§ç”Ÿè¦†ç›–çš„æƒ…å†µï¼Œ<font color="Violetred">éœ€è¦æåŠ›é¿å…</font></p>
<p><strong>æ¼”ç¤º</strong></p>
<p>åœ¨ä¸åŒçš„å·¥ä½œç©ºé—´ä¸‹åˆ›å»ºturtlesimåŠŸèƒ½åŒ…</p>
<p>ws00_helloworld -&gt; turtlesim_node |  ws01_plumbing -&gt; turtlesim_node</p>
<p>åœ¨ ~/.bashrc æ–‡ä»¶ä¸‹è¿½åŠ å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /home/ros2/ws00_helloworld/install/setup.bash</span><br><span class="line">source /home/ros2/ws01_plumbing/install/setup.bash</span><br></pre></td></tr></tbody></table></figure>

<p>æ–°å»ºç»ˆç«¯è¿è¡Œ ros2 run turtlesim turtlesim_node</p>
<p>ä¼šå‘ç°æ‰§è¡Œçš„æ˜¯ ws01_plumbing åŠŸèƒ½åŒ…ä¸‹çš„ turtlesim</p>
<p>è¿™ä¸~/.bashrcä¸­ä¸åŒå·¥ä½œç©ºé—´çš„setup.bashæ–‡ä»¶çš„åŠ è½½é¡ºåºæœ‰å…³ï¼š</p>
<ol>
<li>ROS2 ä¼šè§£æ ~/.bashrc æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆå…¨å±€ç¯å¢ƒå˜é‡ AMENT_PREFIX_PATH ä¸ PYTHONPATHï¼Œä¸¤ä¸ªç¯å¢ƒå˜é‡å–å€¼åˆ†åˆ«å¯¹åº”äº† ROS2 ä¸­ C++ å’Œ Python åŠŸèƒ½åŒ…ï¼Œç¯å¢ƒå˜é‡çš„å€¼ç”±åŠŸèƒ½åŒ…åç§°ç»„æˆ</li>
<li><font color="Violetred">å¯¹äºè‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´è€Œè¨€ï¼ŒååŠ è½½çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æ›´é«˜ï¼Œåé…ç½®çš„å·¥ä½œç©ºé—´çš„åŠŸèƒ½åŒ…åœ¨ç¯å¢ƒå˜é‡å€¼ç»„æˆçš„å‰éƒ¨ï¼Œä½†æ˜¯ROS2ç³»ç»Ÿçš„setup.bashæ–‡ä»¶ä¸é€‚ç”¨æ­¤è§„åˆ™ï¼Œæ— è®ºè¯¥æ–‡ä»¶åœ¨å“ªåŠ è½½ï¼Œä¼˜å…ˆçº§å§‹ç»ˆæœ€ä½</font></li>
<li>è°ƒç”¨åŠŸèƒ½åŒ…æ—¶ï¼Œä¼šæŒ‰ç…§ AMENT_PREFIX_PATH æˆ– PYTHONPATH ä¸­åŒ…é…ç½®é¡ºåºä»å‰å¾€åä¾æ¬¡æŸ¥æ‰¾ç›¸å…³åŠŸèƒ½åŒ…ï¼ŒæŸ¥æ‰¾åˆ°åŠŸèƒ½åŒ…æ—¶ä¼šåœæ­¢æœç´¢</li>
</ol>
<p><strong>éšæ‚£</strong></p>
<ol>
<li>å¯èƒ½ä¼šå‡ºç°åŠŸèƒ½åŒ…è°ƒç”¨æ··ä¹±ï¼Œå‡ºç°å®é™…è°ƒç”¨ä¸é¢„æœŸè°ƒç”¨ç»“æœä¸ç¬¦çš„æƒ…å†µï¼›</li>
<li>å³ä¾¿å¯ä»¥é€šè¿‡ ~/.bashrc æ¥é…ç½®ä¸åŒå·¥ä½œç©ºé—´çš„ä¼˜å…ˆçº§ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œä¿®æ”¹ ~/.bashrc æ–‡ä»¶ä¹‹åä¸ä¸€å®šé©¬ä¸Šç”Ÿæ•ˆï¼Œè¿˜éœ€è¦åˆ é™¤å·¥ä½œç©ºé—´ä¸‹buildä¸installç›®å½•é‡æ–°ç¼–è¯‘ï¼Œæ‰èƒ½ç”Ÿæ•ˆï¼Œè¿™ä¸ªè¿‡ç¨‹ç¹çä¸”æœ‰ä¸ç¡®å®šæ€§</li>
</ol>
<h3 id="å…ƒåŠŸèƒ½åŒ…"><a href="#å…ƒåŠŸèƒ½åŒ…" class="headerlink" title="å…ƒåŠŸèƒ½åŒ…"></a>å…ƒåŠŸèƒ½åŒ…</h3><p>åœ¨ROS2ä¸­ï¼Œæä¾›äº†ä¸€ç§æ–¹å¼å¯ä»¥å°†ä¸åŒçš„åŠŸèƒ½åŒ…æ‰“åŒ…æˆä¸€ä¸ªåŠŸèƒ½åŒ…ï¼Œå½“å®‰è£…æŸä¸ªåŠŸèƒ½æ¨¡å—æ—¶ï¼Œç›´æ¥è°ƒç”¨æ‰“åŒ…åçš„åŠŸèƒ½åŒ…å³å¯ï¼Œè¯¥åŒ…åˆç§°ä¹‹ä¸ºå…ƒåŠŸèƒ½åŒ…(metapackage)</p>
<p>ä¾‹å¦‚ï¼š<code>sudo apt install ros-&lt;ros2-distro&gt;-desktop</code> å‘½ä»¤å®‰è£… ros2 æ—¶å°±ä½¿ç”¨äº†å…ƒåŠŸèƒ½åŒ…ï¼Œè¯¥å…ƒåŠŸèƒ½åŒ…ä¾èµ–äº ROS2 ä¸­çš„å…¶ä»–ä¸€äº›åŠŸèƒ½åŒ…ï¼Œå®‰è£…è¯¥åŒ…æ—¶ä¼šä¸€å¹¶å®‰è£…ä¾èµ–</p>
<p>æ–°å»ºä¸€ä¸ªåŠŸèƒ½åŒ…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create tutorails_plumbing</span><br></pre></td></tr></tbody></table></figure>

<p>ä¿®æ”¹ package.xml æ–‡ä»¶ï¼Œæ·»åŠ æ‰§è¡Œæ—¶æ‰€ä¾èµ–çš„åŒ…ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>base_interfaces<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>cpp01_topic<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>cpp02_service<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>cpp03_action<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>cpp04_param<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å­¦ä¹ å¦‚ä½•æŸ¥çœ‹åˆ«äººçš„åŒ…</p>
<h3 id="èŠ‚ç‚¹é‡å"><a href="#èŠ‚ç‚¹é‡å" class="headerlink" title="èŠ‚ç‚¹é‡å"></a>èŠ‚ç‚¹é‡å</h3><p>ç”±äºèŠ‚ç‚¹åç§°ä¸€è‡´ï¼Œè™½ç„¶å®é™…æœ‰å¤šä¸ªèŠ‚ç‚¹ä½†æ˜¯åœ¨è®¡ç®—å›¾ä¸Šæ˜¾ç¤ºä¸€ä¸ªï¼Œå¹¶ä¸”èŠ‚ç‚¹åç§°ä¹Ÿä¼šå’Œè¯é¢˜åç§°ã€æœåŠ¡åç§°ã€åŠ¨ä½œåç§°ã€å‚æ•°ç­‰äº§ç”Ÿå…³è”ï¼Œå±Šæ—¶ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´é€šä¿¡é€»è¾‘ä¸Šçš„æ··ä¹±</p>
<p>é¿å…é‡åé—®é¢˜ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p>
<ol>
<li>åç§°é‡æ˜ å°„ï¼Œä¹Ÿå³ä¸ºèŠ‚ç‚¹èµ·åˆ«åï¼›</li>
<li>å‘½åç©ºé—´ï¼Œæ˜¯ä¸ºèŠ‚ç‚¹åç§°æ·»åŠ å‰ç¼€ï¼Œå¯ä»¥æœ‰å¤šçº§ï¼Œæ ¼å¼ï¼š/xxx/yyy/zzz</li>
</ol>
<p>è¿™ä¹Ÿæ˜¯åœ¨ ROS2 ä¸­è§£å†³é‡åé—®é¢˜çš„å¸¸ç”¨ç­–ç•¥</p>
<p>ä¸Šè¿°ä¸¤ç§ç­–ç•¥çš„å®ç°é€”å¾„ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p>
<ol>
<li>ros2 run å‘½ä»¤å®ç°ï¼›</li>
<li>launch æ–‡ä»¶å®ç°ï¼›</li>
<li>ç¼–ç å®ç°</li>
</ol>
<h4 id="run2-run"><a href="#run2-run" class="headerlink" title="run2 run"></a>run2 run</h4><p><strong>è®¾ç½®å‘½åç©ºé—´</strong></p>
<p>è¯­æ³•ï¼šros2 run åŒ…å èŠ‚ç‚¹å â€“ros-args â€“remap __ns:=å‘½åç©ºé—´</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run turtlesim turtlesim_node --ros-args --remap __ns:=/t1</span><br></pre></td></tr></tbody></table></figure>

<p><strong>åç§°é‡æ˜ å°„</strong></p>
<p>è¯­æ³•ï¼š</p>
<ul>
<li>ros2 run åŒ…å èŠ‚ç‚¹å â€“ros-args â€“remap __name:=æ–°åç§°</li>
<li>ros2 run åŒ…å èŠ‚ç‚¹å â€“ros-args â€“remap __node:=æ–°åç§°</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run turtlesim turtlesim_node --ros-args --remap __name:=turtle1</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å‘½åç©ºé—´ä¸åç§°é‡æ˜ å°„å åŠ </strong></p>
<p>è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run turtlesim turtlesim_node --ros-args --remap __ns:=/t1 --remap __name:=turtle1</span><br></pre></td></tr></tbody></table></figure>

<h4 id="launch"><a href="#launch" class="headerlink" title="launch"></a>launch</h4><p>å…³äºlaunchæ–‡ä»¶çš„åŸºæœ¬ä½¿ç”¨å¯ä»¥å‚è€ƒlaunchéƒ¨åˆ†</p>
<p><strong>pythonæ–¹å¼</strong></p>
<p>å¯ä»¥é€šè¿‡ç±» <code>launch_ros.actions.Node</code>æ¥åˆ›å»ºè¢«å¯åŠ¨çš„èŠ‚ç‚¹å¯¹è±¡ï¼Œåœ¨å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­æä¾›äº† name å’Œ namespace å‚æ•°æ¥è®¾ç½®èŠ‚ç‚¹çš„åç§°ä¸å‘½åç©ºé—´ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([</span><br><span class="line">        Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>,name=<span class="string">"turtle1"</span>),</span><br><span class="line">        Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>,namespace=<span class="string">"t1"</span>),</span><br><span class="line">        Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>,namespace=<span class="string">"t1"</span>, name=<span class="string">"turtle1"</span>)</span><br><span class="line">    ])</span><br></pre></td></tr></tbody></table></figure>

<p><strong>XMLæ–¹å¼</strong></p>
<p>å¯ä»¥é€šè¿‡ node æ ‡ç­¾ä¸­ name å’Œ namespace å±æ€§æ¥è®¾ç½®èŠ‚ç‚¹çš„åç§°ä¸å‘½åç©ºé—´ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"turtlesim"</span> <span class="attr">exec</span>=<span class="string">"turtlesim_node"</span> <span class="attr">name</span>=<span class="string">"turtle1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"turtlesim"</span> <span class="attr">exec</span>=<span class="string">"turtlesim_node"</span> <span class="attr">namespace</span>=<span class="string">"t1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"turtlesim"</span> <span class="attr">exec</span>=<span class="string">"turtlesim_node"</span> <span class="attr">namespace</span>=<span class="string">"t1"</span> <span class="attr">name</span>=<span class="string">"turtle1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>YAMLæ–¹å¼</strong></p>
<p>å¯ä»¥é€šè¿‡ node å±æ€§ä¸­ name å’Œ namespace å±æ€§æ¥è®¾ç½®èŠ‚ç‚¹çš„åç§°ä¸å‘½åç©ºé—´ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">launch:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">node:</span></span><br><span class="line">    <span class="attr">pkg:</span> <span class="string">turtlesim</span></span><br><span class="line">    <span class="attr">exec:</span> <span class="string">turtlesim_node</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">turtle1</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">node:</span></span><br><span class="line">    <span class="attr">pkg:</span> <span class="string">turtlesim</span></span><br><span class="line">    <span class="attr">exec:</span> <span class="string">turtlesim_node</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">t1</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">node:</span></span><br><span class="line">    <span class="attr">pkg:</span> <span class="string">turtlesim</span></span><br><span class="line">    <span class="attr">exec:</span> <span class="string">turtlesim_node</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">t1</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">turtle1</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œæ–¹å¼</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 launch [åŒ…å] [å¯æ‰§è¡Œç¨‹åº]</span><br></pre></td></tr></tbody></table></figure>

<h4 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h4><p>åœ¨ rclcpp å’Œ rclpy ä¸­ï¼ŒèŠ‚ç‚¹ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œéƒ½åˆ†åˆ«æä¾›äº†è®¾ç½®èŠ‚ç‚¹åç§°ä¸å‘½åç©ºé—´çš„å‚æ•°</p>
<p>rclcppä¸­èŠ‚ç‚¹ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Node</span> (<span class="type">const</span> std::string &amp;node_name, <span class="type">const</span> NodeOptions &amp;options=<span class="built_in">NodeOptions</span>())</span><br><span class="line"><span class="built_in">Node</span> (<span class="type">const</span> std::string &amp;node_name, <span class="type">const</span> std::string &amp;namespace_, <span class="type">const</span> NodeOptions &amp;options=<span class="built_in">NodeOptions</span>())</span><br></pre></td></tr></tbody></table></figure>

<p>æ„é€ å‡½æ•°1ä¸­å¯ä»¥ç›´æ¥é€šè¿‡node_nameè®¾ç½®èŠ‚ç‚¹åç§°ï¼Œæ„é€ å‡½æ•°2æ—¢å¯ä»¥é€šè¿‡node_nameè®¾ç½®èŠ‚ç‚¹åç§°ä¹Ÿå¯ä»¥é€šè¿‡namespace_è®¾ç½®å‘½åç©ºé—´</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MyNode</span>():<span class="built_in">Node</span>(<span class="string">"my_node_cpp"</span>,<span class="string">"ns"</span>)</span><br></pre></td></tr></tbody></table></figure>

<h3 id="è¯é¢˜é‡å"><a href="#è¯é¢˜é‡å" class="headerlink" title="è¯é¢˜é‡å"></a>è¯é¢˜é‡å</h3><p>åœ¨ ROS2 ä¸åŒçš„èŠ‚ç‚¹ä¹‹é—´é€šä¿¡éƒ½ä¾èµ–äºè¯é¢˜ï¼Œè¯é¢˜åç§°ä¹Ÿå¯èƒ½å‡ºç°é‡åçš„æƒ…å†µï¼Œè¯é¢˜é‡åæ—¶ï¼Œç³»ç»Ÿè™½ç„¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯é€šè¿‡ç›¸åŒè¯é¢˜åç§°å…³è”åˆ°ä¸€èµ·çš„èŠ‚ç‚¹å¯èƒ½å¹¶ä¸å±äºåŒä¸€é€šä¿¡é€»è¾‘ï¼Œä»è€Œå¯¼è‡´é€šä¿¡é”™ä¹±ï¼Œç”šè‡³å‡ºç°å¼‚å¸¸,è¿™ç§æƒ…å†µä¸‹å¯èƒ½å°±éœ€è¦å°†ç›¸åŒçš„è¯é¢˜åç§°è®¾ç½®ä¸ºä¸åŒ</p>
<p>åˆæˆ–è€…ï¼Œä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å±äºåŒä¸€é€šä¿¡é€»è¾‘çš„ï¼Œä½†æ˜¯èŠ‚ç‚¹ä¹‹é—´è¯é¢˜åç§°ä¸åŒï¼Œå¯¼è‡´é€šä¿¡å¤±è´¥ã€‚è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦å°†ä¸¤ä¸ªèŠ‚ç‚¹çš„è¯é¢˜åç§°ç”±ä¸åŒä¿®æ”¹ä¸ºç›¸åŒ</p>
<p>ä¸èŠ‚ç‚¹é‡åçš„è§£å†³æ€è·¯ç±»ä¼¼çš„ï¼Œä¸ºäº†é¿å…è¯é¢˜é‡åé—®é¢˜ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§ç­–ç•¥ï¼š</p>
<ol>
<li>åç§°é‡æ˜ å°„ï¼Œä¹Ÿå³ä¸ºè¯é¢˜åç§°èµ·åˆ«åï¼›</li>
<li>å‘½åç©ºé—´ï¼Œæ˜¯ä¸ºè¯é¢˜åç§°æ·»åŠ å‰ç¼€ï¼Œå¯ä»¥æœ‰å¤šçº§ï¼Œæ ¼å¼ï¼š/xxx/yyy/zzz</li>
</ol>
<p><font color="Violetred">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡å‘½åç©ºé—´è®¾ç½®è¯é¢˜åç§°æ—¶ï¼Œéœ€è¦ä¿è¯è¯é¢˜æ˜¯éå…¨å±€è¯é¢˜</font></p>
<p>ä¸èŠ‚ç‚¹é‡åè§£å†³æ–¹æ¡ˆç±»ä¼¼çš„ï¼Œä¿®æ”¹è¯é¢˜åç§°çš„æ–¹å¼ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p>
<ol>
<li>ros2 run å‘½ä»¤å®ç°ï¼›</li>
<li>launch æ–‡ä»¶å®ç°ï¼›</li>
<li>ç¼–ç å®ç°</li>
</ol>
<h4 id="run2-run-1"><a href="#run2-run-1" class="headerlink" title="run2 run"></a>run2 run</h4><p><strong>è®¾ç½®å‘½åç©ºé—´</strong></p>
<p>è¯¥å®ç°ä¸èŠ‚ç‚¹é‡åçš„æ–¹æ³•ç›¸åŒ</p>
<p>è¯­æ³•ï¼šros2 run åŒ…å èŠ‚ç‚¹å â€“ros-args â€“remap __ns:=å‘½åç©ºé—´</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run turtlesim turtlesim_node --ros-args --remap __ns:=/t1</span><br></pre></td></tr></tbody></table></figure>

<p><strong>è¯é¢˜åç§°é‡æ˜ å°„</strong></p>
<p>è¯­æ³•ï¼šros2 run åŒ…å èŠ‚ç‚¹å â€“ros-args â€“remap åŸè¯é¢˜åç§°:=æ–°è¯é¢˜åç§°</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run turtlesim turtlesim_node --ros-args --remap /turtle1/cmd_vel:=/cmd_vel</span><br></pre></td></tr></tbody></table></figure>

<p>å½“ä¸ºèŠ‚ç‚¹æ·»åŠ å‘½åç©ºé—´æ—¶ï¼ŒèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰éå…¨å±€è¯é¢˜éƒ½ä¼šå‰ç¼€å‘½åç©ºé—´ï¼Œè€Œé‡æ˜ å°„çš„æ–¹å¼åªæ˜¯ä¿®æ”¹æŒ‡å®šè¯é¢˜</p>
<h4 id="launch-1"><a href="#launch-1" class="headerlink" title="launch"></a>launch</h4><p><strong>pythonæ–¹å¼</strong></p>
<p>å¯ä»¥é€šè¿‡ç±» <code>launch_ros.actions.Node</code>çš„æ„é€ å‡½æ•°ä¸­çš„å‚æ•° remappings ä¿®æ”¹è¯é¢˜åç§°ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([</span><br><span class="line">        Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>,namespace=<span class="string">"t1"</span>),</span><br><span class="line">        Node(package=<span class="string">"turtlesim"</span>,</span><br><span class="line">            executable=<span class="string">"turtlesim_node"</span>,</span><br><span class="line">            remappings=[(<span class="string">"/turtle1/cmd_vel"</span>,<span class="string">"/cmd_vel"</span>)]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    ])</span><br></pre></td></tr></tbody></table></figure>

<p><strong>XMLæ–¹å¼</strong></p>
<p>é€šè¿‡ node æ ‡ç­¾çš„å­æ ‡ç­¾ remapï¼ˆå±æ€§fromå–å€¼ä¸ºè¢«ä¿®æ”¹çš„è¯é¢˜åç§°ï¼Œå±æ€§toçš„å–å€¼ä¸ºä¿®æ”¹åçš„è¯é¢˜åç§°ï¼‰ ä¿®æ”¹è¯é¢˜åç§°</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"turtlesim"</span> <span class="attr">exec</span>=<span class="string">"turtlesim_node"</span> <span class="attr">namespace</span>=<span class="string">"t1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"turtlesim"</span> <span class="attr">exec</span>=<span class="string">"turtlesim_node"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">"/turtle1/cmd_vel"</span> <span class="attr">to</span>=<span class="string">"/cmd_vel"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>YAMLæ–¹å¼</strong></p>
<p>é€šè¿‡ node å±æ€§ä¸­ remapï¼ˆå±æ€§fromå–å€¼ä¸ºè¢«ä¿®æ”¹çš„è¯é¢˜åç§°ï¼Œå±æ€§toçš„å–å€¼ä¸ºä¿®æ”¹åçš„è¯é¢˜åç§°ï¼‰ ä¿®æ”¹è¯é¢˜åç§°</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">launch:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">node:</span></span><br><span class="line">    <span class="attr">pkg:</span> <span class="string">turtlesim</span></span><br><span class="line">    <span class="attr">exec:</span> <span class="string">turtlesim_node</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">t1</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">node:</span></span><br><span class="line">    <span class="attr">pkg:</span> <span class="string">turtlesim</span></span><br><span class="line">    <span class="attr">exec:</span> <span class="string">turtlesim_node</span></span><br><span class="line">    <span class="attr">remap:</span></span><br><span class="line">    <span class="bullet">-</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">"/turtle1/cmd_vel"</span></span><br><span class="line">        <span class="attr">to:</span> <span class="string">"/cmd_vel</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="ç¼–ç -1"><a href="#ç¼–ç -1" class="headerlink" title="ç¼–ç "></a>ç¼–ç </h4><p>è¯é¢˜åç§°å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹:</p>
<ul>
<li>å…¨å±€è¯é¢˜(è¯é¢˜å‚è€ƒROSç³»ç»Ÿï¼Œä¸èŠ‚ç‚¹å‘½åç©ºé—´å¹³çº§)ï¼›</li>
<li>ç›¸å¯¹è¯é¢˜(è¯é¢˜å‚è€ƒçš„æ˜¯èŠ‚ç‚¹çš„å‘½åç©ºé—´ï¼Œä¸èŠ‚ç‚¹åç§°å¹³çº§)ï¼›</li>
<li>ç§æœ‰è¯é¢˜(è¯é¢˜å‚è€ƒèŠ‚ç‚¹åç§°ï¼Œæ˜¯èŠ‚ç‚¹åç§°çš„å­çº§)</li>
</ul>
<p><strong>å…¨å±€è¯é¢˜</strong></p>
<p>å®šä¹‰æ—¶ä»¥<code>/</code>å¼€å¤´çš„åç§°ï¼Œå’Œå‘½åç©ºé—´ã€èŠ‚ç‚¹åç§°æ— å…³</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publisher_ = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;("/topic/chatter", 10);</span><br></pre></td></tr></tbody></table></figure>

<p>è¯é¢˜åç§°ä¸º /topic/chatterï¼Œä¸å‘½åç©ºé—´ xxx ä»¥åŠèŠ‚ç‚¹åç§° yyy æ— å…³</p>
<p><strong>ç›¸å¯¹è¯é¢˜</strong></p>
<p>é<code>/</code>å¼€å¤´çš„åç§°ï¼Œå‚è€ƒå‘½åç©ºé—´è®¾ç½®è¯é¢˜åç§°ï¼Œå’ŒèŠ‚ç‚¹åç§°æ— å…³</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publisher_ = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;("topic/chatter", 10);</span><br></pre></td></tr></tbody></table></figure>

<p>è¯é¢˜åç§°ä¸º /xxx/topic/chatterï¼Œä¸å‘½åç©ºé—´ xxx æœ‰å…³ï¼Œä¸èŠ‚ç‚¹åç§° yyy æ— å…³</p>
<p><strong>ç§æœ‰è¯é¢˜</strong></p>
<p>ä»¥<code>~/</code>å¼€å¤´çš„åç§°ï¼Œå’Œå‘½åç©ºé—´ã€èŠ‚ç‚¹åç§°éƒ½æœ‰å…³ç³»</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publisher_ = this-&gt;create_publisher&lt;std_msgs::msg::String&gt;("~/topic/chatter", 10);</span><br></pre></td></tr></tbody></table></figure>

<p>è¯é¢˜åç§°ä¸º /xxx/yyy/topic/chatterï¼Œä½¿ç”¨å‘½åç©ºé—´ xxx ä»¥åŠèŠ‚ç‚¹åç§° yyy ä½œä¸ºè¯é¢˜åç§°å‰ç¼€</p>
<p>è¯é¢˜åç§°è®¾ç½®è§„åˆ™åœ¨rclcppä¸rclpyä¸­åŸºæœ¬ä¸€è‡´ï¼Œä¸”ä¸Šè¿°è§„åˆ™ä¹ŸåŒæ ·é€‚ç”¨äºros2 runæŒ‡ä»¤ä¸launchæ–‡ä»¶</p>
<h3 id="æ—¶é—´ç›¸å…³API"><a href="#æ—¶é—´ç›¸å…³API" class="headerlink" title="æ—¶é—´ç›¸å…³API"></a>æ—¶é—´ç›¸å…³API</h3><h4 id="Rate"><a href="#Rate" class="headerlink" title="Rate"></a>Rate</h4><p>ç¤ºä¾‹ï¼šå‘¨æœŸæ€§è¾“å‡ºä¸€æ®µæ–‡æœ¬</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyNode</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyNode</span>():<span class="built_in">Node</span>(<span class="string">"time_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="built_in">demo_rate</span>();</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">demo_rate</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="comment">// 1. åˆ›å»ºRateå¯¹è±¡</span></span><br><span class="line">      <span class="function">rclcpp::Rate <span class="title">rate</span><span class="params">(<span class="number">500</span>ms)</span></span>;  <span class="comment">// è®¾ç½®æ—¶é—´é—´éš”</span></span><br><span class="line">      <span class="comment">// rclcpp::Rate rate(1.0); // è®¾ç½®é¢‘ç‡ï¼Œè¾“å…¥æµ®ç‚¹å‹æ•°æ®</span></span><br><span class="line">      <span class="comment">// 2. è°ƒç”¨Rateçš„sleepå‡½æ•°</span></span><br><span class="line">      <span class="keyword">while</span> (rclcpp::<span class="built_in">ok</span>())</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"---------"</span>);</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡;</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;MyNode&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h4><p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyNode</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyNode</span>():<span class="built_in">Node</span>(<span class="string">"time_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="comment">// demo_rate();</span></span><br><span class="line">        <span class="built_in">demo_time</span>();</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">demo_time</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="comment">// 1. åˆ›å»º Time å¯¹è±¡</span></span><br><span class="line">      <span class="function">rclcpp::Time <span class="title">t1</span><span class="params">(<span class="number">500000000L</span>)</span></span>; <span class="comment">// 0.5s</span></span><br><span class="line">      <span class="function">rclcpp::Time <span class="title">t2</span><span class="params">(<span class="number">2</span>,<span class="number">500000000L</span>)</span></span>; <span class="comment">// 2.5s</span></span><br><span class="line">      <span class="comment">// rclcpp::Time right_now = this-&gt;get_clock()-&gt;now();</span></span><br><span class="line">      rclcpp::Time right_now = <span class="keyword">this</span>-&gt;<span class="built_in">now</span>();</span><br><span class="line">      <span class="comment">// 2. è°ƒç”¨Timeå¯¹è±¡å‡½æ•°</span></span><br><span class="line">      <span class="comment">// ç§’ä¸ºå•ä½çš„è¾“å‡º å’Œ çº³ç§’ä¸ºå•ä½çš„è¾“å‡º</span></span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"s = %.2f, ns = %ld"</span>,t<span class="number">1.</span><span class="built_in">seconds</span>(),t<span class="number">1.</span><span class="built_in">nanoseconds</span>());  </span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"s = %.2f, ns = %ld"</span>,t<span class="number">2.</span><span class="built_in">seconds</span>(),t<span class="number">2.</span><span class="built_in">nanoseconds</span>());</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"s = %.2f, ns = %ld"</span>,right_now.<span class="built_in">seconds</span>(),right_now.<span class="built_in">nanoseconds</span>());</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡;</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;MyNode&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>Time</code> çš„å…¸å‹åœºæ™¯</p>
<ul>
<li>ä¸ºæ¶ˆæ¯æ·»åŠ æ—¶é—´æˆ³ï¼ˆå¦‚ <code>sensor_msgs/msg/Image</code> çš„ <code>header.stamp</code>ï¼‰</li>
<li>è®°å½•äº‹ä»¶å‘ç”Ÿçš„å…·ä½“æ—¶åˆ»ï¼ˆå¦‚æœºå™¨äººåˆ°è¾¾æŸä¸ªä½ç½®çš„æ—¶é—´ï¼‰</li>
</ul>
<h4 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a>Duration</h4><p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyNode</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyNode</span>():<span class="built_in">Node</span>(<span class="string">"time_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="comment">// demo_rate();</span></span><br><span class="line">        <span class="comment">// demo_time();</span></span><br><span class="line">        <span class="built_in">demo_duration</span>();</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">demo_duration</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="comment">// 1. åˆ›å»º Duraiton å¯¹è±¡</span></span><br><span class="line">      <span class="function">rclcpp::Duration <span class="title">du1</span><span class="params">(<span class="number">1</span>s)</span></span>; <span class="comment">// 1s</span></span><br><span class="line">      <span class="function">rclcpp::Duration <span class="title">du2</span><span class="params">(<span class="number">2</span>,<span class="number">500000000</span>)</span></span>; <span class="comment">// 2.5s</span></span><br><span class="line">      <span class="comment">// 2. è°ƒç”¨ Duration å‡½æ•°</span></span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"s = %.2f, ns = %ld"</span>,du<span class="number">1.</span><span class="built_in">seconds</span>(),du<span class="number">1.</span><span class="built_in">nanoseconds</span>());</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"s = %.2f, ns = %ld"</span>,du<span class="number">2.</span><span class="built_in">seconds</span>(),du<span class="number">2.</span><span class="built_in">nanoseconds</span>());</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p><code>Duration</code> çš„å…¸å‹åœºæ™¯</p>
<ul>
<li>è®¾ç½®å®šæ—¶å™¨å‘¨æœŸ</li>
<li>å®ç°å»¶æ—¶ç­‰å¾…</li>
</ul>
<p>é—®é¢˜ï¼šTimeä¸Durationæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>APIä½¿ç”¨ç±»ä¼¼ï¼Œä½†äºŒè€…æœ‰ç€æœ¬è´¨åŒºåˆ«ï¼š</p>
<p>rclcpp:Time t2(2,500000000L) â€“&gt; æŒ‡çš„æ˜¯ä¸€ä¸ªå…·ä½“æ—¶åˆ»(æ—¶é—´ç‚¹)</p>
<p>rclcpp::Duration du2(2,500000000) â€“&gt; æŒ‡çš„æ˜¯ä¸€ä¸ªæ—¶é—´æ®µ</p>
<h4 id="è¿ç®—"><a href="#è¿ç®—" class="headerlink" title="è¿ç®—"></a>è¿ç®—</h4><p>Time Â± Duration â†’ Timeï¼šæ—¶é—´ç‚¹åŠ å‡æ—¶é—´æ®µ â†’ æ–°æ—¶é—´ç‚¹</p>
<p>Time - Time â†’ Durationï¼šä¸¤ä¸ªæ—¶é—´ç‚¹ç›¸å‡ â†’ æ—¶é—´æ®µ</p>
<p>Duration Â± Duration â†’ Durationï¼šæ—¶é—´æ®µåŠ å‡ â†’ æ–°æ—¶é—´æ®µ</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyNode</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyNode</span>():<span class="built_in">Node</span>(<span class="string">"time_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="comment">// demo_rate();</span></span><br><span class="line">        <span class="comment">// demo_time();</span></span><br><span class="line">        <span class="comment">// demo_duration();</span></span><br><span class="line">        <span class="built_in">demo_opt</span>();</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">demo_opt</span><span class="params">()</span></span>{</span><br><span class="line">      <span class="function">rclcpp::Time <span class="title">t1</span><span class="params">(<span class="number">10</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">      <span class="function">rclcpp::Time <span class="title">t2</span><span class="params">(<span class="number">30</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">      <span class="function">rclcpp::Duration <span class="title">du1</span><span class="params">(<span class="number">8</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">      <span class="function">rclcpp::Duration <span class="title">du2</span><span class="params">(<span class="number">17</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">      <span class="comment">// æ¯”è¾ƒ</span></span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"t1 &gt;= t2 ? %d"</span>,t1 &gt;= t2);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"t1 &lt; t2 ? %d"</span>,t1 &lt; t2);</span><br><span class="line">      rclcpp::Duration du3 = t2 - t1;</span><br><span class="line">      rclcpp::Time t3 = t1 + du1;</span><br><span class="line">      rclcpp::Time t4 = t1 - du1;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"t3 = %.2f"</span>,t<span class="number">3.</span><span class="built_in">seconds</span>());  </span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"t4 = %.2f"</span>,t<span class="number">4.</span><span class="built_in">seconds</span>()); </span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"du3 = %.2f"</span>,du<span class="number">3.</span><span class="built_in">seconds</span>()); </span><br><span class="line">      <span class="comment">// æ¯”è¾ƒ</span></span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"du1 &gt;= du2 ? %d"</span>, du1 &gt;= du2);</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"du1 &lt; du2 ? %d"</span>, du1 &lt; du2);</span><br><span class="line">      <span class="comment">// æ•°å­¦è¿ç®—</span></span><br><span class="line">      rclcpp::Duration du4 = du1 * <span class="number">3.0</span>;</span><br><span class="line">      rclcpp::Duration du5 = du1 + du2;</span><br><span class="line">      rclcpp::Duration du6 = du1 - du2;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"du4 = %.2f"</span>,du<span class="number">4.</span><span class="built_in">seconds</span>()); </span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"du5 = %.2f"</span>,du<span class="number">5.</span><span class="built_in">seconds</span>()); </span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(), <span class="string">"du6 = %.2f"</span>,du<span class="number">6.</span><span class="built_in">seconds</span>()); </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>Duration å¯ä»¥è´Ÿæ•°ï¼Œä½† Time ä¸å¯ä»¥è´Ÿæ•°</p>
<h3 id="é€šä¿¡æœºåˆ¶å·¥å…·"><a href="#é€šä¿¡æœºåˆ¶å·¥å…·" class="headerlink" title="é€šä¿¡æœºåˆ¶å·¥å…·"></a>é€šä¿¡æœºåˆ¶å·¥å…·</h3><p>åœ¨ROS2ä¸­ï¼Œé€šä¿¡æœºåˆ¶ç›¸å…³çš„å·¥å…·æœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å‘½ä»¤è¡Œå·¥å…·å’Œå›¾å½¢åŒ–å·¥å…·ï¼ˆrqtï¼‰</p>
<p>å‰è€…æ˜¯ä¸€ç³»åˆ—ç»ˆç«¯å‘½ä»¤çš„é›†åˆï¼Œåè€…åˆ™æ˜¯ROS2åŸºäºQTæ¡†æ¶ï¼Œé’ˆå¯¹æœºå™¨äººå¼€å‘çš„ä¸€ç³»åˆ—å¯è§†åŒ–å·¥å…·çš„é›†åˆ</p>
<h4 id="å‘½ä»¤å·¥å…·"><a href="#å‘½ä»¤å·¥å…·" class="headerlink" title="å‘½ä»¤å·¥å…·"></a>å‘½ä»¤å·¥å…·</h4><p>å…³äºå‘½ä»¤çš„ä½¿ç”¨ä¸€èˆ¬éƒ½ä¼šæä¾›å¸®åŠ©æ–‡æ¡£</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å‘½ä»¤ -h -&gt; ros2 node -h</span><br><span class="line">å‘½ä»¤ --help -&gt; ros2 node -help</span><br></pre></td></tr></tbody></table></figure>

<p>å¸¸ç”¨å‘½ä»¤æ•´åˆï¼š</p>
<blockquote>
<p>ros2 interace æ•´åˆäº†rosmsg</p>
<p>ROS2 å°†æ¶ˆæ¯ã€æœåŠ¡ã€åŠ¨ä½œç­‰æŠ½è±¡ä¸ºâ€œæ¥å£â€ï¼Œç®€åŒ–å·¥å…·é“¾</p>
</blockquote>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>å‚æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>ros2 node</td>
<td>info â†’ è¾“å‡ºèŠ‚ç‚¹ä¿¡æ¯<br>list â†’ è¾“å‡ºè¿è¡Œä¸­çš„èŠ‚ç‚¹çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>ros2 interace</td>
<td>list â†’ è¾“å‡ºæ‰€æœ‰å¯ç”¨çš„æ¥å£æ¶ˆæ¯<br>package â†’ è¾“å‡ºæŒ‡å®šåŠŸèƒ½åŒ…ä¸‹çš„æ¥å£<br>packages â†’ è¾“å‡ºå…¨éƒ¨åŒ…å«æ¥å£æ¶ˆæ¯çš„åŠŸèƒ½åŒ…<br>proto â†’ è¾“å‡ºæ¥å£æ¶ˆæ¯åŸå‹<br>show â†’ è¾“å‡ºæ¥å£æ¶ˆæ¯å®šä¹‰æ ¼å¼</td>
</tr>
<tr>
<td>ros2 topic</td>
<td>bw â†’ è¾“å‡ºè¯é¢˜æ¶ˆæ¯ä¼ è¾“å ç”¨çš„å¸¦å®½<br>delay â†’ è¾“å‡ºå¸¦æœ‰ header çš„è¯é¢˜å»¶è¿Ÿ<br>echo â†’ è¾“å‡ºæŸä¸ªè¯é¢˜ä¸‹çš„æ¶ˆæ¯<br>find â†’ æ ¹æ®ç±»å‹æŸ¥æ‰¾è¯é¢˜<br>hz â†’ è¾“å‡ºæ¶ˆæ¯å‘å¸ƒé¢‘ç‡<br>info â†’ è¾“å‡ºè¯é¢˜ç›¸å…³ä¿¡æ¯<br>list â†’ è¾“å‡ºè¿è¡Œä¸­çš„è¯é¢˜åˆ—è¡¨<br>pub â†’ å‘æŒ‡å®šè¯é¢˜å‘å¸ƒæ¶ˆæ¯<br>type â†’ è¾“å‡ºè¯é¢˜ä½¿ç”¨çš„æ¥å£ç±»å‹</td>
</tr>
<tr>
<td>ros2 service</td>
<td>call â†’ å‘æŸä¸ªæœåŠ¡å‘é€è¯·æ±‚<br>find â†’ æ ¹æ®ç±»å‹æŸ¥æ‰¾æœåŠ¡<br>list â†’ è¾“å‡ºè¿è¡Œä¸­çš„æœåŠ¡åˆ—è¡¨<br>type â†’ è¾“å‡ºæœåŠ¡ä½¿ç”¨çš„æ¥å£ç±»å‹</td>
</tr>
<tr>
<td>ros2 action</td>
<td>info â†’ è¾“å‡ºæŒ‡å®šåŠ¨ä½œçš„ç›¸å…³ä¿¡æ¯<br>list â†’ è¾“å‡ºè¿è¡Œä¸­çš„åŠ¨ä½œçš„åˆ—è¡¨<br>send_goal â†’ å‘æŒ‡å®šåŠ¨ä½œå‘é€è¯·æ±‚</td>
</tr>
<tr>
<td>ros2 param</td>
<td>delete â†’ åˆ é™¤å‚æ•°<br>describe â†’ è¾“å‡ºå‚æ•°çš„æè¿°ä¿¡æ¯<br>dump â†’ å°†èŠ‚ç‚¹å‚æ•°å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶<br>get â†’ è·å–æŸä¸ªå‚æ•°<br>list â†’ è¾“å‡ºå¯ç”¨çš„å‚æ•°çš„åˆ—è¡¨<br>load â†’ ä»ç£ç›˜æ–‡ä»¶åŠ è½½å‚æ•°åˆ°èŠ‚ç‚¹<br>set â†’ è®¾ç½®å‚æ•°</td>
</tr>
</tbody></table>
<h4 id="rqtå·¥å…·ç®±"><a href="#rqtå·¥å…·ç®±" class="headerlink" title="rqtå·¥å…·ç®±"></a>rqtå·¥å…·ç®±</h4><p>ä¸€èˆ¬åªè¦å®‰è£…çš„æ˜¯desktopç‰ˆæœ¬å°±ä¼šé»˜è®¤å®‰è£…rqtå·¥å…·ç®±</p>
<p>å¸¸ç”¨çš„å¯åŠ¨å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rqt</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨rqtä¹‹åï¼Œå¯ä»¥é€šè¿‡pluginsæ·»åŠ æ‰€éœ€çš„æ’ä»¶</p>
<p>å¯ä»¥åœ¨rqtä¸­å‘è¯é¢˜å‘é€æ¶ˆæ¯</p>
<h2 id="ROS2é€šä¿¡æœºåˆ¶å®æ“"><a href="#ROS2é€šä¿¡æœºåˆ¶å®æ“" class="headerlink" title="ROS2é€šä¿¡æœºåˆ¶å®æ“"></a>ROS2é€šä¿¡æœºåˆ¶å®æ“</h2><p>ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´çš„srcç›®å½•ï¼Œè°ƒç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºC++åŠŸèƒ½åŒ…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg create cpp07_exercise --build-type ament_cmake --dependencies rclcpp turtlesim base_interfaces geometry_msgs rclcpp_action</span><br></pre></td></tr></tbody></table></figure>

<h3 id="è¯é¢˜é€šä¿¡æ¡ˆä¾‹"><a href="#è¯é¢˜é€šä¿¡æ¡ˆä¾‹" class="headerlink" title="è¯é¢˜é€šä¿¡æ¡ˆä¾‹"></a>è¯é¢˜é€šä¿¡æ¡ˆä¾‹</h3><p>éœ€æ±‚ï¼šå¯åŠ¨ä¸¤ä¸ªturtlesim_nodeèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹2ä¸­çš„ä¹Œé¾Ÿè‡ªåŠ¨è°ƒå¤´180Â°ï¼Œå¯ä»¥é€šè¿‡é”®ç›˜æ§åˆ¶èŠ‚ç‚¹1ä¸­çš„ä¹Œé¾Ÿè¿åŠ¨ï¼Œä½†æ˜¯ä¸èƒ½æ§åˆ¶èŠ‚ç‚¹2çš„ä¹Œé¾Ÿï¼Œéœ€è¦è‡ªå®ç°åŠŸèƒ½ï¼šå¯ä»¥æ ¹æ®ä¹Œé¾Ÿ1çš„é€Ÿåº¦ç”Ÿæˆå¹¶å‘å¸ƒæ§åˆ¶ä¹Œé¾Ÿ2è¿åŠ¨çš„é€Ÿåº¦æŒ‡ä»¤ï¼Œæœ€ç»ˆä¸¤åªä¹Œé¾Ÿåšé•œåƒè¿åŠ¨</p>
<p>æ ¸å¿ƒå®ç°æ˜¯å¦‚ä½•è®¢é˜…ä¹Œé¾Ÿ1çš„é€Ÿåº¦å¹¶ç”Ÿæˆå‘å¸ƒæ§åˆ¶ä¹Œé¾Ÿ2è¿åŠ¨çš„é€Ÿåº¦æŒ‡ä»¤çš„ï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹éœ€è¦åœ¨æ‰å¤´å®Œæ¯•åå¯åŠ¨</p>
<p>package.xmlæ–‡ä»¶æ— éœ€ä¿®æ”¹</p>
<p>CMakeLists.txtä¸­é…ç½®launchæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">install(TARGETS </span><br><span class="line">  test01_topic</span><br><span class="line">  DESTINATION lib/${PROJECT_NAME})</span><br><span class="line"># å¢åŠ </span><br><span class="line">install(DIRECTORY launch DESTINATION share/${PROJECT_NAME})</span><br></pre></td></tr></tbody></table></figure>

<p><strong>launchæ–‡ä»¶</strong></p>
<p>å¯åŠ¨å°ä¹Œé¾ŸèŠ‚ç‚¹ï¼ŒæŸ¥çœ‹actionç±»å‹</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ros2 action list</span><br><span class="line">ros2 action info /turtle1/rotate_absolute</span><br><span class="line">ros2 action send_goal /turtle1/rotate_absolute </span><br></pre></td></tr></tbody></table></figure>

<p>åé¢ä¸æ¸…æ¥šçš„å°±[TAB]è¡¥é½å³å¯</p>
<p>æ˜ç¡®åœ¨ç»ˆç«¯å¦‚ä½•é€šè¿‡å‘½ä»¤æ§åˆ¶ä¹Œé¾Ÿè¿åŠ¨</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> launch.actions <span class="keyword">import</span> ExecuteProcess,RegisterEventHandler</span><br><span class="line"><span class="keyword">from</span> launch.event_handlers <span class="keyword">import</span> OnProcessExit</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="comment"># 1. å¯åŠ¨ä¸¤ä¸ªturtlesim_nodeï¼Œå…¶ä¸­ä¸€ä¸ªè®¾ç½®å‘½åç©ºé—´</span></span><br><span class="line">    t1 = Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>)</span><br><span class="line">    t2 = Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>,namespace=<span class="string">"t2"</span>)</span><br><span class="line">    <span class="comment"># 2. æ§åˆ¶ç¬¬äºŒä¸ªä¹Œé¾Ÿæ‰å¤´</span></span><br><span class="line">    rotate = ExecuteProcess(</span><br><span class="line">        cmd = [<span class="string">"ros2 action send_goal /t2/turtle1/rotate_absolute turtlesim/action/RotateAbsolute \"{'theta':3.14}\""</span>], <span class="comment"># è®°å¾—è½¬ä¹‰å­—ç¬¦</span></span><br><span class="line">        output = <span class="string">"both"</span>,</span><br><span class="line">        shell = <span class="literal">True</span>  <span class="comment"># cmdå½“æˆç»ˆç«¯æŒ‡ä»¤æ‰§è¡Œ</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 3. è°ƒç”¨è‡ªå®šä¹‰çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”èŠ‚ç‚¹è°ƒç”¨é¡ºåºæœ‰è¦æ±‚</span></span><br><span class="line">    test01 = Node(package=<span class="string">"cpp07_exercise"</span>,executable=<span class="string">"test01_topic"</span>)</span><br><span class="line">    <span class="comment"># 4. æ§åˆ¶èŠ‚ç‚¹å¯åŠ¨,éœ€è¦é€šè¿‡æ³¨å†Œäº‹ä»¶å®Œæˆ</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºäº‹ä»¶æ³¨å†Œå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ä¸­å£°æ˜é’ˆå¯¹å“ªä¸ªç›®æ ‡èŠ‚ç‚¹ï¼Œåœ¨å“ªä¸ªäº‹ä»¶è§¦å‘æ—¶ï¼Œæ‰§è¡Œå“ªç§æ“ä½œ</span></span><br><span class="line">    register_rotate_exit_event = RegisterEventHandler(</span><br><span class="line">        <span class="comment"># åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç›‘å¬rotateçš„å¯åŠ¨ï¼Œé€€å‡ºåå¯åŠ¨test01</span></span><br><span class="line">        event_handler = OnProcessExit(</span><br><span class="line">            target_action=rotate, <span class="comment"># ç›®æ ‡èŠ‚ç‚¹</span></span><br><span class="line">            on_exit=test01) <span class="comment"># è§¦å‘äº‹ä»¶</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([t1,t2,rotate,register_rotate_exit_event])</span><br></pre></td></tr></tbody></table></figure>

<p><strong>é€Ÿåº¦è®¢é˜…ä¸å‘å¸ƒ</strong></p>
<p>test01_topic.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šè®¢é˜…çª—å£1ä¸­ä¹Œé¾Ÿçš„ä½å§¿ä¿¡æ¯ï¼Œè§£æå‡ºçº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦ï¼Œç”Ÿæˆæ§åˆ¶çª—å£2ä¹Œé¾Ÿè¿åŠ¨çš„æŒ‡ä»¤å¹¶å‘å¸ƒ</span></span><br><span class="line"><span class="comment">  æ˜ç¡®ï¼š</span></span><br><span class="line"><span class="comment">      è®¢é˜…è¯é¢˜ï¼š/turtle1/pose</span></span><br><span class="line"><span class="comment">      è®¢é˜…æ¶ˆæ¯ï¼šturtlesim/msg/Pose</span></span><br><span class="line"><span class="comment">              x: 0.0</span></span><br><span class="line"><span class="comment">              y: 0.0</span></span><br><span class="line"><span class="comment">              theta: 0.0</span></span><br><span class="line"><span class="comment">              linear_velocity: 0.0</span></span><br><span class="line"><span class="comment">              angular_velocity: 0.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      å‘å¸ƒè¯é¢˜ï¼š/t2/turtle1/cmd_vel</span></span><br><span class="line"><span class="comment">      å‘å¸ƒæ¶ˆæ¯ï¼šgeometry_msgs/msg/Twist</span></span><br><span class="line"><span class="comment">              linear:</span></span><br><span class="line"><span class="comment">                x: 0.0</span></span><br><span class="line"><span class="comment">                y: 0.0</span></span><br><span class="line"><span class="comment">                z: 0.0</span></span><br><span class="line"><span class="comment">              angular:</span></span><br><span class="line"><span class="comment">                x: 0.0  ç¿»æ»š</span></span><br><span class="line"><span class="comment">                y: 0.0  ä¿¯ä»°</span></span><br><span class="line"><span class="comment">                z: 0.0  å·¦å³è½¬</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1 åˆ›å»ºå‘å¸ƒæ–¹</span></span><br><span class="line"><span class="comment">      3-2 åˆ›å»ºè®¢é˜…æ–¹(è®¢é˜…ä¹Œé¾Ÿ1ä½å§¿ï¼Œè§£æé€Ÿåº¦)</span></span><br><span class="line"><span class="comment">      3-3 è®¢é˜…æ–¹å›è°ƒå‡½æ•°å¤„ç†é€Ÿåº¦ï¼Œå¹¶ç”Ÿæˆå‘å¸ƒæ§åˆ¶ä¹Œé¾Ÿ2çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆ;</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/msg/twist.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/msg/pose.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test01PubSub</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Test01PubSub</span>():<span class="built_in">Node</span>(<span class="string">"test01_pub_sub_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="comment">// 3-1 åˆ›å»ºå‘å¸ƒæ–¹</span></span><br><span class="line">        twist_pub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;geometry_msgs::msg::Twist&gt;(<span class="string">"/t2/turtle1/cmd_vel"</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 3-2 åˆ›å»ºè®¢é˜…æ–¹(è®¢é˜…ä¹Œé¾Ÿ1ä½å§¿ï¼Œè§£æé€Ÿåº¦)</span></span><br><span class="line">        pose_sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;turtlesim::msg::Pose&gt;(<span class="string">"/turtle1/pose"</span>,<span class="number">10</span>,std::<span class="built_in">bind</span>(&amp;Test01PubSub::do_pose,<span class="keyword">this</span>,_1));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">do_pose</span><span class="params">(<span class="type">const</span> turtlesim::msg::Pose &amp; pose)</span></span>{</span><br><span class="line">      <span class="comment">// å¤„ç†é€Ÿåº¦ï¼Œå¹¶ç”Ÿæˆå‘å¸ƒæ§åˆ¶ä¹Œé¾Ÿ2çš„æŒ‡ä»¤</span></span><br><span class="line">      geometry_msgs::msg::Twist twist;</span><br><span class="line">      twist.linear.x = (pose.linear_velocity); <span class="comment">// çº¿é€Ÿåº¦ä¸å˜</span></span><br><span class="line">      twist.angular.z = -(pose.angular_velocity); <span class="comment">// è§’é€Ÿåº¦å–å</span></span><br><span class="line">      twist_pub_-&gt;<span class="built_in">publish</span>(twist);</span><br><span class="line">    }</span><br><span class="line">    rclcpp::Publisher&lt;geometry_msgs::msg::Twist&gt;::SharedPtr twist_pub_;</span><br><span class="line">    rclcpp::Subscription&lt;turtlesim::msg::Pose&gt;::SharedPtr pose_sub_;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡;</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;Test01PubSub&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>BUGæè¿°ï¼šä¹Œé¾Ÿ1åé€€æ—¶ï¼Œä¹Œé¾Ÿ2ä»ç„¶å‰è¿›</p>
<p>BUGåŸå› ï¼š</p>
<ol>
<li>å’Œä¹Œé¾Ÿä½å§¿å‘å¸ƒæœ‰å…³ï¼Œå½“ä¹Œé¾Ÿå®é™…é€Ÿåº¦ä¸ºè´Ÿæ•°æ—¶ï¼Œä½å§¿ä¸­çš„é€Ÿåº¦ä»æ˜¯æ­£æ•°ï¼›</li>
<li>å‘å¸ƒçš„ä¹Œé¾Ÿ2çš„é€Ÿåº¦ï¼Œä¸ä½å§¿ä¸­çš„çº¿é€Ÿåº¦ä¸€è‡´</li>
</ol>
<p>BUGä¿®å¤ï¼š(ä¿®æ”¹æºç )</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// p-&gt;linear_velocity = std::sqrt(lin_vel_x_ * lin_vel_x_ + lin_vel_y_ * lin_vel_y_);</span></span><br><span class="line">p-&gt;linear_velocity = lin_vel_x_;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æœåŠ¡é€šä¿¡æ¡ˆä¾‹"><a href="#æœåŠ¡é€šä¿¡æ¡ˆä¾‹" class="headerlink" title="æœåŠ¡é€šä¿¡æ¡ˆä¾‹"></a>æœåŠ¡é€šä¿¡æ¡ˆä¾‹</h3><p>éœ€æ±‚ï¼šåœ¨turtlesim_nodeèŠ‚ç‚¹çš„çª—ä½“ä¸­åœ¨æŒ‡å®šä½ç½®ç”Ÿæˆä¸€åªæ–°ä¹Œé¾Ÿå¹¶å¯ä»¥è¾“å‡ºä¸¤åªä¹Œé¾Ÿä¹‹é—´çš„ç›´çº¿è·ç¦»</p>
<p>éœ€è¦å…³æ³¨çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li>å¦‚ä½•åœ¨æŒ‡å®šä½ç½®ç”Ÿæˆä¸€åªæ–°ä¹Œé¾Ÿï¼Ÿ</li>
<li>è®¡ç®—ä¸¤åªä¹Œé¾Ÿçš„è·ç¦»åº”è¯¥ä½¿ç”¨ä½•ç§é€šä¿¡æ¨¡å¼åˆå¦‚ä½•å®ç°ï¼Ÿ</li>
</ol>
<p>é—®é¢˜1å¯ä»¥é€šè¿‡è°ƒç”¨turtlesim_nodeå†…ç½®çš„åç§°ä¸º/spawnçš„æœåŠ¡åŠŸèƒ½æ¥å®ç°æ–°ä¹Œé¾Ÿçš„åˆ›å»ºï¼›</p>
<p>é—®é¢˜2å¯ä»¥é€šè¿‡æœåŠ¡é€šä¿¡æ¥å®ç°ï¼Œå®¢æˆ·ç«¯å‘é€æ–°ç”Ÿæˆçš„ä¹Œé¾Ÿçš„ä½å§¿åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ ¹æ®è¯¥åæ ‡ä»¥åŠåŸç”Ÿä¹Œé¾Ÿçš„åæ ‡è®¡ç®—è·ç¦»å¹¶å“åº”ã€‚å½“ç„¶å¦‚æœä½¿ç”¨æœåŠ¡é€šä¿¡ï¼Œè¿˜éœ€è¦è‡ªå®šä¹‰æœåŠ¡æ¥å£</p>
<p><strong>è‡ªå®šä¹‰æ¥å£æ¶ˆæ¯</strong></p>
<p>åŠŸèƒ½åŒ…base_interfaces_demoçš„srvç›®å½•ä¸‹ï¼Œæ–°å»ºsrvæ–‡ä»¶Distance.srv</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">float32 x</span><br><span class="line">float32 y</span><br><span class="line">float32 theta</span><br><span class="line">---</span><br><span class="line">float32 distance</span><br></pre></td></tr></tbody></table></figure>

<p>CMakeList.txté…ç½®(å…¶ä½™éƒ¨åˆ†ä¹‹å‰é…ç½®è¿‡)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ä¸ºæ¥å£æ–‡ä»¶ç”Ÿæˆæºç </span><br><span class="line">rosidl_generate_interfaces(${PROJECT_NAME}</span><br><span class="line">  "msg/Student.msg"</span><br><span class="line">  "srv/AddInts.srv"</span><br><span class="line">  "action/Progress.action"</span><br><span class="line">  "srv/Distance.srv" # æ–°å¢</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸï¼›</p>
<p>å…ˆåˆ›å»ºcppå’Œlaunch.pyæ–‡ä»¶ï¼Œé…ç½®åŠŸèƒ½åŒ…ç›®å½•ä¸‹çš„CMakeListï¼Œlaunchæ–‡ä»¶çš„é…ç½®å› ä¸ºç”¨çš„æ˜¯åŒä¸€åŠŸèƒ½åŒ…ä¸éœ€è¦é‡å¤</p>
<p><strong>launchæ–‡ä»¶</strong></p>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="comment"># 1. turtlesim node</span></span><br><span class="line">    t1 = Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>)</span><br><span class="line">    <span class="comment"># 2. è‡ªå®šä¹‰çš„æœåŠ¡ç«¯</span></span><br><span class="line">    server = Node(package=<span class="string">"cpp07_exercise"</span>,executable=<span class="string">"test02_server"</span>)</span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([t1,server])</span><br></pre></td></tr></tbody></table></figure>

<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> launch.actions <span class="keyword">import</span> ExecuteProcess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="comment"># 1. æŒ‡å®šä½ç½®ç”Ÿæˆä¸€åªæ–°ä¹Œé¾Ÿ</span></span><br><span class="line">    x = <span class="number">6.0</span></span><br><span class="line">    y = <span class="number">9.0</span></span><br><span class="line">    theta = <span class="number">1.57</span></span><br><span class="line">    name = <span class="string">"t2"</span></span><br><span class="line">    spawn = ExecuteProcess(</span><br><span class="line">        cmd = [<span class="string">"ros2 service call /spawn turtlesim/srv/Spawn \"{'x': "</span></span><br><span class="line">               + <span class="built_in">str</span>(x) +<span class="string">",'y': "</span>+ <span class="built_in">str</span>(y) +</span><br><span class="line">               <span class="string">",'theta': "</span>+ <span class="built_in">str</span>(theta) +</span><br><span class="line">               <span class="string">",'name':'"</span>+ name +<span class="string">"'}\""</span>], <span class="comment"># è®°å¾—è½¬ä¹‰å­—ç¬¦</span></span><br><span class="line">        output = <span class="string">"both"</span>,</span><br><span class="line">        shell = <span class="literal">True</span>  <span class="comment"># cmdå½“æˆç»ˆç«¯æŒ‡ä»¤æ‰§è¡Œ</span></span><br><span class="line">    )</span><br><span class="line">    client = Node(package=<span class="string">"cpp07_exercise"</span>,</span><br><span class="line">                  executable=<span class="string">"test02_client"</span>,</span><br><span class="line">                  arguments=[<span class="built_in">str</span>(x),<span class="built_in">str</span>(y),<span class="built_in">str</span>(theta)])</span><br><span class="line">    <span class="comment"># ç›¸å½“äºros2 run cpp07_exercise test02_client 6 9 0.0 --ros-args</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. è°ƒç”¨å®¢æˆ·ç«¯å‘é€ç›®æ ‡ç‚¹åæ ‡ </span></span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([spawn,client])</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æœåŠ¡ç«¯å®ç°</strong></p>
<p>test02_server.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  éœ€æ±‚:è§£æå®¢æˆ·ç«¯æäº¤çš„ç›®æ ‡ç‚¹åæ ‡ï¼Œè·å–åŸç”Ÿä¹Œé¾Ÿåæ ‡ï¼Œè®¡ç®—äºŒè€…è·ç¦»å¹¶å“åº”å›å®¢æˆ·ç«¯ã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤:</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºä¸€ä¸ªè®¢é˜…æ–¹ï¼ˆåŸç”Ÿä¹Œé¾Ÿä½å§¿/turtlel/pose)ï¼›</span></span><br><span class="line"><span class="comment">      3-2.åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-3.å›è°ƒå‡½æ•°éœ€è¦è§£æå®¢æˆ·ç«¯æ•°æ®å¹¶å“åº”ç»“æœåˆ°å®¢æˆ·ç«¯ã€‚</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆ;</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/msg/pose.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/srv/distance.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::placeholders::_1;</span><br><span class="line"><span class="keyword">using</span> std::placeholders::_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> base_interfaces::srv::Distance;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test02Server</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Test02Server</span>():<span class="built_in">Node</span>(<span class="string">"test02_server_node_cpp"</span>),<span class="built_in">x</span>(<span class="number">0.0</span>),<span class="built_in">y</span>(<span class="number">0.0</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        pose_sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;turtlesim::msg::Pose&gt;(<span class="string">"/turtle1/pose"</span>,<span class="number">10</span>,std::<span class="built_in">bind</span>(&amp;Test02Server::pose_cb,<span class="keyword">this</span>,_1));</span><br><span class="line">        server_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_service</span>&lt;Distance&gt;(<span class="string">"distance"</span>,std::<span class="built_in">bind</span>(&amp;Test02Server::distance_cb,<span class="keyword">this</span>,_1,_2));</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    rclcpp::Subscription&lt;turtlesim::msg::Pose&gt;::SharedPtr pose_sub_;</span><br><span class="line">    rclcpp::Service&lt;Distance&gt;::SharedPtr server_;</span><br><span class="line">    <span class="type">float</span> x,y;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pose_cb</span><span class="params">(<span class="type">const</span> turtlesim::msg::Pose::SharedPtr pose)</span></span>{</span><br><span class="line">      x = pose-&gt;x;</span><br><span class="line">      y = pose-&gt;y;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">distance_cb</span><span class="params">(<span class="type">const</span> Distance::Request::SharedPtr request,<span class="type">const</span> Distance::Response::SharedPtr response)</span></span>{</span><br><span class="line">      <span class="comment">// è§£æç›®æ ‡ç‚¹åæ ‡</span></span><br><span class="line">      <span class="type">float</span> goal_x = request-&gt;x;</span><br><span class="line">      <span class="type">float</span> goal_y = request-&gt;y;</span><br><span class="line">      <span class="comment">// è®¡ç®—è·ç¦»</span></span><br><span class="line">      <span class="type">float</span> distance_x = goal_x - x;</span><br><span class="line">      <span class="type">float</span> distance_y = goal_y - y;</span><br><span class="line">      <span class="type">float</span> distance = std::<span class="built_in">sqrt</span>(distance_x * distance_x + distance_y * distance_y);</span><br><span class="line">      <span class="comment">// è®¾ç½®è¿›å“åº”</span></span><br><span class="line">      response-&gt;distance = distance;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ç›®æ ‡åæ ‡:(%.2f,%.2f),è·ç¦»:%.2f"</span>,goal_x,goal_y,response-&gt;distance);</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡;</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;Test02Server&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®¢æˆ·ç«¯å®ç°</strong></p>
<p>test02_client.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  éœ€æ±‚ï¼šå®¢æˆ·ç«¯éœ€è¦æäº¤ç›®æ ‡ç‚¹åæ ‡ï¼Œå¹¶è§£æå“åº”ç»“æœã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">    0.è§£æä¼ å…¥çš„æ•°æ®</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.æ„é€ å‡½æ•°åˆ›å»ºå®¢æˆ·ç«¯;</span></span><br><span class="line"><span class="comment">      3-2.å®¢æˆ·ç«¯éœ€è¦è¿æ¥æœåŠ¡ç«¯;</span></span><br><span class="line"><span class="comment">      3-3.å‘é€è¯·æ±‚æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨å¯¹è±¡æœåŠ¡è¿æ¥ã€å‘é€è¯·æ±‚ã€å¤„ç†å“åº”ç›¸å…³å‡½æ•°;</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/srv/distance.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> base_interfaces::srv::Distance;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test02Client</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Test02Client</span>():<span class="built_in">Node</span>(<span class="string">"test02_client_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="comment">// 3-1.æ„é€ å‡½æ•°åˆ›å»ºå®¢æˆ·ç«¯;</span></span><br><span class="line">        distance_client_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_client</span>&lt;Distance&gt;(<span class="string">"distance"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-2.å®¢æˆ·ç«¯éœ€è¦è¿æ¥æœåŠ¡ç«¯;</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">connect_server</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">while</span>(!distance_client_-&gt;<span class="built_in">wait_for_service</span>(<span class="number">1</span>s)){</span><br><span class="line">          <span class="keyword">if</span> (!rclcpp::<span class="built_in">ok</span>())</span><br><span class="line">          {</span><br><span class="line">          <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"å®¢æˆ·ç«¯é€€å‡ºï¼"</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          }</span><br><span class="line">          <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœåŠ¡è¿æ¥ä¸­"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    rclcpp::Client&lt;Distance&gt;::<span class="function">FutureAndRequestId <span class="title">send_goal</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">float</span> theta)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">      <span class="keyword">auto</span> request = std::<span class="built_in">make_shared</span>&lt;Distance::Request&gt;();</span><br><span class="line">      request-&gt;x = x;</span><br><span class="line">      request-&gt;y = y;</span><br><span class="line">      request-&gt;theta = theta;</span><br><span class="line">      <span class="keyword">return</span> distance_client_-&gt;<span class="built_in">async_send_request</span>(request);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    rclcpp::Client&lt;Distance&gt;::SharedPtr distance_client_;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  <span class="keyword">if</span> (argc != <span class="number">5</span>) <span class="comment">// 5æ˜¯å› ä¸ºè¿˜æœ‰nameï¼Œä¸€å…±å…¶å®æ˜¯4ä¸ªå‚æ•°</span></span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"è¯·ä¼ å…¥ç›®æ ‡çš„ä½å§¿å‚æ•°:(x,y,theta)"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨å¯¹è±¡æœåŠ¡è¿æ¥ã€å¤„ç†å“åº”ç›¸å…³å‡½æ•°</span></span><br><span class="line">  <span class="keyword">auto</span> client = std::<span class="built_in">make_shared</span>&lt;Test02Client&gt;();</span><br><span class="line">  <span class="comment">// è§£ææäº¤çš„å‚æ•°</span></span><br><span class="line">  <span class="type">float</span> goal_x = <span class="built_in">atoi</span>(argv[<span class="number">1</span>]);</span><br><span class="line">  <span class="type">float</span> goal_y = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line">  <span class="type">float</span> goal_theta = <span class="built_in">atoi</span>(argv[<span class="number">3</span>]);</span><br><span class="line">  <span class="type">bool</span> flag = client-&gt;<span class="built_in">connect_server</span>();</span><br><span class="line">  <span class="keyword">if</span>(!flag)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"æœåŠ¡è¿æ¥å¤±è´¥!"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">auto</span> distance_future = client-&gt;<span class="built_in">send_goal</span>(goal_x,goal_y,goal_theta);</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å“åº”çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span>(rclcpp::<span class="built_in">spin_until_future_complete</span>(client,distance_future)==rclcpp::FutureReturnCode::SUCCESS)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(client-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ä¸¤åªä¹Œé¾Ÿç›¸è·%.2fç±³ã€‚"</span>,distance_future.<span class="built_in">get</span>()-&gt;distance);</span><br><span class="line">  } <span class="keyword">else</span>{</span><br><span class="line">    <span class="built_in">RCLCPP_ERROR</span>(client-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è·å–è·ç¦»æœåŠ¡å¤±è´¥!"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="åŠ¨ä½œé€šä¿¡æ¡ˆä¾‹"><a href="#åŠ¨ä½œé€šä¿¡æ¡ˆä¾‹" class="headerlink" title="åŠ¨ä½œé€šä¿¡æ¡ˆä¾‹"></a>åŠ¨ä½œé€šä¿¡æ¡ˆä¾‹</h3><p>éœ€æ±‚ï¼šå¤„ç†è¯·æ±‚å‘é€çš„ç›®æ ‡ç‚¹ï¼Œæ§åˆ¶ä¹Œé¾Ÿå‘è¯¥ç›®æ ‡ç‚¹è¿åŠ¨ï¼Œå¹¶è¿ç»­åé¦ˆä¹Œé¾Ÿä¸ç›®æ ‡ç‚¹ä¹‹é—´çš„å‰©ä½™è·ç¦»</p>
<p>åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸æœåŠ¡é€šä¿¡æ¡ˆä¾‹ç±»ä¼¼ï¼Œéœ€è¦å…³æ³¨æ§åˆ¶åŸç”Ÿä¹Œé¾Ÿå‘ç›®æ ‡ä¹Œé¾Ÿè¿åŠ¨å¹¶è¿ç»­åé¦ˆå‰©ä½™è·ç¦»åº”è¯¥ä½¿ç”¨ä½•ç§é€šä¿¡æ¨¡å¼åˆå¦‚ä½•å®ç°ï¼Ÿ</p>
<p>æ€è·¯ï¼šå¯ä»¥é€šè¿‡åŠ¨ä½œé€šä¿¡æ¥å®ç°ï¼ŒåŠ¨ä½œå®¢æˆ·ç«¯å‘é€ç›®æ ‡ä¿¡æ¯åˆ°åŠ¨ä½œæœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ ¹æ®è¯¥åæ ‡ä»¥åŠåŸç”Ÿä¹Œé¾Ÿçš„åæ ‡è®¡è®¡ç®—å‡ºäºŒè€…è·ç¦»ï¼Œè®¡ç®—é€Ÿåº¦å¹¶æ§åˆ¶åŸç”Ÿä¹Œé¾Ÿè¿åŠ¨ã€‚å½“ç„¶å¦‚æœä½¿ç”¨åŠ¨ä½œé€šä¿¡ï¼Œè¿˜éœ€è¦è‡ªå®šä¹‰åŠ¨ä½œæ¥å£ã€‚</p>
<p><strong>åŠ¨ä½œæ¥å£æ–‡ä»¶</strong></p>
<p>åŠŸèƒ½åŒ…base_interfaces_demoçš„actionç›®å½•ä¸‹ï¼Œæ–°å»ºactionæ–‡ä»¶Nav.action</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">float32 goal_x</span><br><span class="line">float32 goal_y</span><br><span class="line">float32 goal_theta</span><br><span class="line">---</span><br><span class="line">float32 turtle_x</span><br><span class="line">float32 turtle_y</span><br><span class="line">float32 turtle_theta</span><br><span class="line">---</span><br><span class="line">float32 distance</span><br></pre></td></tr></tbody></table></figure>

<p>ç¼–è¾‘CMakeList(å…¶ä½™ä¹‹å‰é…ç½®è¿‡)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ä¸ºæ¥å£æ–‡ä»¶ç”Ÿæˆæºç </span><br><span class="line">rosidl_generate_interfaces(${PROJECT_NAME}</span><br><span class="line">  "msg/Student.msg"</span><br><span class="line">  "srv/AddInts.srv"</span><br><span class="line">  "srv/Distance.srv"</span><br><span class="line">  "action/Progress.action"</span><br><span class="line">  "action/Nav.action" #æ–°å¢</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p><strong>launchæ–‡ä»¶</strong></p>
<p>launchå’ŒæœåŠ¡é€šä¿¡çš„åŸºæœ¬ç›¸åŒï¼Œå¤åˆ¶å†…å®¹ä¿®æ”¹èŠ‚ç‚¹å³å¯</p>
<p>æœåŠ¡ç«¯ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    <span class="comment"># 1. turtlesim node</span></span><br><span class="line">    t1 = Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>)</span><br><span class="line">    <span class="comment"># 2. è‡ªå®šä¹‰çš„æœåŠ¡ç«¯</span></span><br><span class="line">    server = Node(package=<span class="string">"cpp07_exercise"</span>,executable=<span class="string">"test03_action_server"</span>)</span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([t1,server])</span><br></pre></td></tr></tbody></table></figure>

<p>å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> launch.actions <span class="keyword">import</span> ExecuteProcess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    x = <span class="number">6.0</span></span><br><span class="line">    y = <span class="number">9.0</span></span><br><span class="line">    theta = <span class="number">1.57</span></span><br><span class="line">    client = Node(package=<span class="string">"cpp07_exercise"</span>,</span><br><span class="line">                  executable=<span class="string">"test03_action_client"</span>,</span><br><span class="line">                  arguments=[<span class="built_in">str</span>(x),<span class="built_in">str</span>(y),<span class="built_in">str</span>(theta)])</span><br><span class="line">    <span class="comment"># ç›¸å½“äºros2 run cpp07_exercise test02_client 6 9 0.0 --ros-args</span></span><br><span class="line">    <span class="comment"># è°ƒç”¨å®¢æˆ·ç«¯å‘é€ç›®æ ‡ç‚¹åæ ‡ </span></span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([client])</span><br></pre></td></tr></tbody></table></figure>

<p><strong>åŠ¨ä½œæœåŠ¡ç«¯</strong></p>
<p>æŒ‰ä½ctrl  ç‚¹å‡»create_serverâ†’Server</p>
<p>æ ¹æ®æ¨¡æ¿ç¼–å†™actionæœåŠ¡ç«¯çš„åˆ›å»ºä»£ç </p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> GoalCallback = std::function&lt;<span class="built_in">GoalResponse</span>(</span><br><span class="line">      <span class="type">const</span> GoalUUID &amp;, std::shared_ptr&lt;<span class="type">const</span> <span class="keyword">typename</span> ActionT::Goal&gt;)&gt;;</span><br><span class="line"><span class="keyword">using</span> CancelCallback = std::function&lt;<span class="built_in">CancelResponse</span>(std::shared_ptr&lt;ServerGoalHandle&lt;ActionT&gt;&gt;)&gt;;</span><br><span class="line"><span class="keyword">using</span> AcceptedCallback = std::function&lt;<span class="built_in">void</span> (std::shared_ptr&lt;ServerGoalHandle&lt;ActionT&gt;&gt;)&gt;;</span><br></pre></td></tr></tbody></table></figure>

<p>test03_action_server.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  éœ€æ±‚:å¤„ç†å®¢æˆ·ç«¯å‘é€çš„æ§åˆ¶ä¹Œé¾Ÿå‘ç›®æ ‡ç‚¹è¿åŠ¨ï¼Œä¸”è¦è¿ç»­åé¦ˆå‰©ä½™è·ç¦»</span></span><br><span class="line"><span class="comment">  æ­¥éª¤:</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºåŸç”Ÿä¹Œé¾Ÿä½å§¿è®¢é˜…æ–¹ï¼Œå›è°ƒå‡½æ•°ä¸­è·å–ä¹Œé¾Ÿä½å§¿ï¼›</span></span><br><span class="line"><span class="comment">      3-2.åˆ›å»ºåŸç”Ÿä¹Œé¾Ÿé€Ÿåº¦å‘å¸ƒæ–¹ï¼›</span></span><br><span class="line"><span class="comment">      3-3.åˆ›å»ºåŠ¨ä½œæœåŠ¡ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-4.è§£æåŠ¨ä½œå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼›</span></span><br><span class="line"><span class="comment">      3-5.å¤„ç†åŠ¨ä½œå®¢æˆ·ç«¯å‘é€çš„å–æ¶ˆè¯·æ±‚ï¼›</span></span><br><span class="line"><span class="comment">      3-6.åˆ›å»ºæ–°çº¿ç¨‹å¤„ç†ä¸»é€»è¾‘è¯·æ±‚ï¼›</span></span><br><span class="line"><span class="comment">      3-7.æ–°çº¿ç¨‹äº§ç”Ÿè¿ç»­åé¦ˆå¹¶å“åº”æœ€ç»ˆç»“æœã€‚</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆ;</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"turtlesim/msg/pose.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"geometry_msgs/msg/twist.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp_action/rclcpp_action.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/action/nav.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"><span class="keyword">using</span> base_interfaces::action::Nav;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test03ActionServer</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Test03ActionServer</span>():<span class="built_in">Node</span>(<span class="string">"test03_action_server_node_cpp"</span>),<span class="built_in">x</span>(<span class="number">0.0</span>),<span class="built_in">y</span>(<span class="number">0.0</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åŠ¨ä½œæœåŠ¡ç«¯åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="comment">// 3-1.åˆ›å»ºåŸç”Ÿä¹Œé¾Ÿä½å§¿è®¢é˜…æ–¹ï¼Œå›è°ƒå‡½æ•°ä¸­è·å–ä¹Œé¾Ÿä½å§¿</span></span><br><span class="line">        pose_sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;turtlesim::msg::Pose&gt;(<span class="string">"/turtle1/pose"</span>,<span class="number">10</span>,std::<span class="built_in">bind</span>(&amp;Test03ActionServer::pose_cb,<span class="keyword">this</span>,_1));</span><br><span class="line">        <span class="comment">// 3-2.åˆ›å»ºåŸç”Ÿä¹Œé¾Ÿé€Ÿåº¦å‘å¸ƒæ–¹ï¼›</span></span><br><span class="line">        cmd_vel_pub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_publisher</span>&lt;geometry_msgs::msg::Twist&gt;(<span class="string">"/turtle1/cmd_vel"</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 3-3.åˆ›å»ºåŠ¨ä½œæœåŠ¡ç«¯ï¼›</span></span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">        (NodeT node, </span></span><br><span class="line"><span class="comment">        const std::string &amp;name,</span></span><br><span class="line"><span class="comment">        rclcpp_action::Server&lt;ActionT&gt;::GoalCallback handle_goal, </span></span><br><span class="line"><span class="comment">        rclcpp_action::Server&lt;ActionT&gt;::CancelCallback handle_cancel, </span></span><br><span class="line"><span class="comment">        rclcpp_action::Server&lt;ActionT&gt;::AcceptedCallback handle_accepted</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        action_server_ = rclcpp_action::<span class="built_in">create_server</span>&lt;Nav&gt;(</span><br><span class="line">          <span class="keyword">this</span>,</span><br><span class="line">          <span class="string">"nav"</span>,</span><br><span class="line">          std::<span class="built_in">bind</span>(&amp;Test03ActionServer::handle_goal,<span class="keyword">this</span>,_1,_2),</span><br><span class="line">          std::<span class="built_in">bind</span>(&amp;Test03ActionServer::handle_cancel,<span class="keyword">this</span>,_1),</span><br><span class="line">          std::<span class="built_in">bind</span>(&amp;Test03ActionServer::handle_accepted,<span class="keyword">this</span>,_1));</span><br><span class="line">          <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åŠ¨ä½œæœåŠ¡ç«¯åˆ›å»ºï¼Œç­‰å¾…è¯·æ±‚..."</span>);</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    rclcpp::Subscription&lt;turtlesim::msg::Pose&gt;::SharedPtr pose_sub_;</span><br><span class="line">    rclcpp::Publisher&lt;geometry_msgs::msg::Twist&gt;::SharedPtr cmd_vel_pub_;</span><br><span class="line">    rclcpp_action::Server&lt;Nav&gt;::SharedPtr action_server_;</span><br><span class="line">    <span class="type">float</span> x,y;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pose_cb</span><span class="params">(<span class="type">const</span> turtlesim::msg::Pose::SharedPtr pose)</span></span>{</span><br><span class="line">      x = pose-&gt;x;</span><br><span class="line">      y = pose-&gt;y;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-4.è§£æåŠ¨ä½œå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼›</span></span><br><span class="line">    <span class="function">rclcpp_action::GoalResponse <span class="title">handle_goal</span><span class="params">(<span class="type">const</span> rclcpp_action::GoalUUID &amp; uuid, std::shared_ptr&lt;<span class="type">const</span> Nav::Goal&gt; goal)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">      (<span class="type">void</span>)uuid; <span class="comment">// æ ‡è¯†ç›®å‰æ²¡ç”¨ä¸Š,é¿å…è­¦å‘Š</span></span><br><span class="line">      <span class="comment">// åˆ¤æ–­ç›®æ ‡çš„x,yå€¼æ˜¯å¦è¶…å‡ºæ¡†</span></span><br><span class="line">      <span class="type">float</span> goal_x = goal-&gt;goal_x;</span><br><span class="line">      <span class="type">float</span> goal_y = goal-&gt;goal_y;</span><br><span class="line">      <span class="keyword">if</span>(goal_x &lt; <span class="number">0</span> || goal_x &gt; <span class="number">11.08</span> || goal_y &lt; <span class="number">0</span> || goal_y &gt; <span class="number">11.08</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æ— æ•ˆç›®æ ‡å€¼!"</span>);</span><br><span class="line">        <span class="keyword">return</span> rclcpp_action::GoalResponse::REJECT;</span><br><span class="line">      }</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ç›®æ ‡ç‚¹åˆæ³•!"</span>);</span><br><span class="line">      <span class="keyword">return</span> rclcpp_action::GoalResponse::ACCEPT_AND_EXECUTE;</span><br><span class="line">    }</span><br><span class="line">    <span class="function">rclcpp_action::CancelResponse <span class="title">handle_cancel</span><span class="params">(std::shared_ptr&lt;rclcpp_action::ServerGoalHandle&lt;Nav&gt;&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">      (<span class="type">void</span>)goal_handle;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æ¥æ”¶åˆ°å–æ¶ˆè¯·æ±‚!"</span>);</span><br><span class="line">      <span class="keyword">return</span> rclcpp_action::CancelResponse::ACCEPT;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ä¸»é€»è¾‘å¤„ç†</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">(std::shared_ptr&lt;rclcpp_action::ServerGoalHandle&lt;Nav&gt;&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å¼€å§‹æ‰§è¡Œä»»åŠ¡......"</span>);</span><br><span class="line">      <span class="comment">// åˆ›å»ºè¿ç»­åé¦ˆå¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line">      <span class="keyword">auto</span> feedback = std::<span class="built_in">make_shared</span>&lt;Nav::Feedback&gt;();</span><br><span class="line">      <span class="comment">// åˆ›å»ºæœ€ç»ˆç»“æœå¯¹è±¡æŒ‡é’ˆï¼›</span></span><br><span class="line">      <span class="keyword">auto</span> result = std::<span class="built_in">make_shared</span>&lt;Nav::Result&gt;();</span><br><span class="line">      <span class="comment">// ç”Ÿæˆè¿ç»­åé¦ˆ</span></span><br><span class="line">      <span class="function">rclcpp::Rate <span class="title">rate</span><span class="params">(<span class="number">1.0</span>)</span></span>;</span><br><span class="line">      <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">      {</span><br><span class="line">        <span class="comment">// ä»»åŠ¡æ‰§è¡Œä¸­ï¼Œå…³äºå®¢æˆ·ç«¯å‘é€å–æ¶ˆè¯·æ±‚çš„å¤„ç†ï¼›</span></span><br><span class="line">        <span class="keyword">if</span>(goal_handle-&gt;<span class="built_in">is_canceling</span>()){</span><br><span class="line">          goal_handle-&gt;<span class="built_in">canceled</span>(result);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è§£æç›®æ ‡ç‚¹åæ ‡ä¸åŸç”Ÿä¹Œé¾Ÿä½å§¿æ•°æ®ï¼›</span></span><br><span class="line">        <span class="type">float</span> goal_x = goal_handle-&gt;<span class="built_in">get_goal</span>()-&gt;goal_x;</span><br><span class="line">        <span class="type">float</span> goal_y = goal_handle-&gt;<span class="built_in">get_goal</span>()-&gt;goal_y;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—å‰©ä½™è·ç¦»å¹¶å‘å¸ƒ</span></span><br><span class="line">        <span class="type">float</span> distance_x = goal_x - x;</span><br><span class="line">        <span class="type">float</span> distance_y = goal_y - y;</span><br><span class="line">        <span class="type">float</span> distance = std::<span class="built_in">sqrt</span>(distance_x * distance_x + distance_y * distance_y);</span><br><span class="line">        feedback-&gt;distance = distance;</span><br><span class="line">        goal_handle-&gt;<span class="built_in">publish_feedback</span>(feedback);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¡ç®—é€Ÿåº¦æŒ‡ä»¤å¹¶å‘å¸ƒ</span></span><br><span class="line">        <span class="type">float</span> scale = <span class="number">0.5</span>;</span><br><span class="line">        geometry_msgs::msg::Twist twist;</span><br><span class="line">        twist.linear.x = scale * distance_x;</span><br><span class="line">        twist.linear.y = scale * distance_y;</span><br><span class="line">        cmd_vel_pub_-&gt;<span class="built_in">publish</span>(twist);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯ç»“æŸæ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(distance &lt; <span class="number">0.05</span>)</span><br><span class="line">        {</span><br><span class="line">          <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å¯¼èˆªè‡³ç›®æ ‡ç‚¹ï¼"</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// ç”Ÿæˆæœ€ç»ˆå“åº”</span></span><br><span class="line">      <span class="keyword">if</span>(rclcpp::<span class="built_in">ok</span>()){</span><br><span class="line">        result-&gt;turtle_x = x;</span><br><span class="line">        result-&gt;turtle_y = y;</span><br><span class="line">        goal_handle-&gt;<span class="built_in">succeed</span>(result);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle_accepted</span><span class="params">(std::shared_ptr&lt;rclcpp_action::ServerGoalHandle&lt;Nav&gt;&gt; goal_handle)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">      <span class="comment">// æ–°å»ºçº¿ç¨‹å¤„ç†è€—æ—¶çš„ä¸»é€»è¾‘</span></span><br><span class="line">      std::thread{std::<span class="built_in">bind</span>(&amp;Test03ActionServer::execute,<span class="keyword">this</span>,_1),goal_handle}.<span class="built_in">detach</span>();</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡;</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(std::<span class="built_in">make_shared</span>&lt;Test03ActionServer&gt;()); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>test03_action_client.cpp</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  éœ€æ±‚:å‘åŠ¨ä½œæœåŠ¡ç«¯å‘é€ç›®æ ‡ç‚¹æ•°æ®ï¼Œå¹¶å¤„ç†å“åº”æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">  æ­¥éª¤:</span></span><br><span class="line"><span class="comment">    0.è§£ælaunchæ–‡ä»¶ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºåŠ¨ä½œå®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-2.å‘é€è¯·æ±‚æ•°æ®ï¼Œå¹¶å¤„ç†æœåŠ¡ç«¯å“åº”ï¼›</span></span><br><span class="line"><span class="comment">      3-3.å¤„ç†ç›®æ ‡å“åº”ï¼›</span></span><br><span class="line"><span class="comment">      3-4.å¤„ç†å“åº”çš„è¿ç»­åé¦ˆï¼›</span></span><br><span class="line"><span class="comment">      3-5.å¤„ç†æœ€ç»ˆå“åº”ã€‚</span></span><br><span class="line"><span class="comment">    4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡æŒ‡é’ˆ;</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp_action/rclcpp_action.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"base_interfaces/action/nav.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"><span class="keyword">using</span> base_interfaces::action::Nav;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test03ActionClient</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Test03ActionClient</span>():<span class="built_in">Node</span>(<span class="string">"test03_action_client_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"åŠ¨ä½œå®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">      <span class="comment">// 3-1.åˆ›å»ºåŠ¨ä½œå®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">      client_ = rclcpp_action::<span class="built_in">create_client</span>&lt;Nav&gt;(<span class="keyword">this</span>,<span class="string">"nav"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-2.å‘é€è¯·æ±‚æ•°æ®ï¼Œå¹¶å¤„ç†æœåŠ¡ç«¯å“åº”ï¼›</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">send_goal</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">float</span> theta)</span></span>{</span><br><span class="line">      <span class="comment">// è¿æ¥æœåŠ¡ç«¯</span></span><br><span class="line">      <span class="keyword">if</span>(!client_ -&gt; <span class="built_in">wait_for_action_server</span>(<span class="number">10</span>s))</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"è¿æ¥è¶…æ—¶!"</span>);</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// ç»„ç»‡å‘é€æ•°æ®</span></span><br><span class="line">      Nav::Goal goal;</span><br><span class="line">      goal.goal_x = x;</span><br><span class="line">      goal.goal_y = y;</span><br><span class="line">      goal.goal_theta = theta;</span><br><span class="line">      rclcpp_action::Client&lt;Nav&gt;::SendGoalOptions options;</span><br><span class="line">      options.goal_response_callback = std::<span class="built_in">bind</span>(&amp;Test03ActionClient::goal_response_callback,<span class="keyword">this</span>,_1);</span><br><span class="line">      options.feedback_callback = std::<span class="built_in">bind</span>(&amp;Test03ActionClient::feedback_callback,<span class="keyword">this</span>,_1,_2);</span><br><span class="line">      options.result_callback = std::<span class="built_in">bind</span>(&amp;Test03ActionClient::result_callback,<span class="keyword">this</span>,_1);</span><br><span class="line">      client_-&gt;<span class="built_in">async_send_goal</span>(goal,options);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>: </span><br><span class="line">    rclcpp_action::Client&lt;Nav&gt;::SharedPtr client_;</span><br><span class="line">    <span class="comment">// å°†UUIDè½¬æ¢ä¸ºå¯è¯»å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="function">std::string <span class="title">goal_uuid_to_string</span><span class="params">(<span class="type">const</span> rclcpp_action::GoalUUID&amp; uuid)</span> </span>{</span><br><span class="line">      std::stringstream ss;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> byte : uuid) {</span><br><span class="line">          ss &lt;&lt; std::hex &lt;&lt; std::<span class="built_in">setw</span>(<span class="number">2</span>) &lt;&lt; std::<span class="built_in">setfill</span>(<span class="string">'0'</span>) &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(byte);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> ss.<span class="built_in">str</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-3.å¤„ç†ç›®æ ‡å“åº”ï¼›</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">goal_response_callback</span><span class="params">(rclcpp_action::ClientGoalHandle&lt;Nav&gt;::SharedPtr goal_handle)</span></span>{</span><br><span class="line">      <span class="keyword">if</span>(!goal_handle){</span><br><span class="line">        <span class="built_in">RCLCPP_ERROR</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ç›®æ ‡è¯·æ±‚è¢«æœåŠ¡ç«¯æ‹’ç»!"</span>);</span><br><span class="line">        rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">      } <span class="keyword">else</span>{</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ç›®æ ‡å¤„ç†ä¸­!ç›®æ ‡ID: %s"</span>,<span class="built_in">goal_uuid_to_string</span>(goal_handle-&gt;<span class="built_in">get_goal_id</span>()).<span class="built_in">c_str</span>());</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-4.å¤„ç†å“åº”çš„è¿ç»­åé¦ˆï¼›</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">feedback_callback</span><span class="params">(rclcpp_action::ClientGoalHandle&lt;Nav&gt;::SharedPtr goal_handle, <span class="type">const</span> std::shared_ptr&lt;<span class="type">const</span> Nav::Feedback&gt; feedback)</span></span>{</span><br><span class="line">      (<span class="type">void</span>)goal_handle;</span><br><span class="line">      <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‰©ä½™è·ç¦»:%.2f"</span>,feedback-&gt;distance);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-5.å¤„ç†æœ€ç»ˆå“åº”ã€‚</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">result_callback</span><span class="params">(<span class="type">const</span> rclcpp_action::ClientGoalHandle&lt;Nav&gt;::WrappedResult &amp; result)</span></span>{</span><br><span class="line">      <span class="comment">// é€šè¿‡çŠ¶æ€ç åˆ¤æ–­ç»“æœçŠ¶æ€</span></span><br><span class="line">      <span class="keyword">if</span>(result.code == rclcpp_action::ResultCode::SUCCEEDED)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),</span><br><span class="line">          <span class="string">"ä¹Œé¾Ÿæœ€ç»ˆåæ ‡:(%.2f,%.2f),èˆªå‘:%.2f"</span>,</span><br><span class="line">          result.result-&gt;turtle_x,</span><br><span class="line">          result.result-&gt;turtle_y,</span><br><span class="line">          result.result-&gt;turtle_theta);</span><br><span class="line">      } <span class="keyword">else</span> <span class="keyword">if</span>(result.code == rclcpp_action::ResultCode::ABORTED)</span><br><span class="line">      {</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ä»»åŠ¡è¢«ä¸­æ­¢!"</span>);</span><br><span class="line"></span><br><span class="line">      } <span class="keyword">else</span> <span class="keyword">if</span>(result.code == rclcpp_action::ResultCode::CANCELED){</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"ä»»åŠ¡è¢«å–æ¶ˆ!"</span>);</span><br><span class="line"></span><br><span class="line">      } <span class="keyword">else</span>{</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœªçŸ¥å¼‚å¸¸!"</span>);</span><br><span class="line">      }</span><br><span class="line">      rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  <span class="keyword">if</span> (argc != <span class="number">5</span>)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"è¯·ä¼ å…¥åˆæ³•çš„ç›®æ ‡ä½å§¿å‚æ•°:(x,y,theta)"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// ä¸èƒ½ç›´æ¥spin</span></span><br><span class="line">  <span class="keyword">auto</span> client = std::<span class="built_in">make_shared</span>&lt;Test03ActionClient&gt;();</span><br><span class="line">  client-&gt;<span class="built_in">send_goal</span>(<span class="built_in">atof</span>(argv[<span class="number">1</span>]),<span class="built_in">atof</span>(argv[<span class="number">2</span>]),<span class="built_in">atof</span>(argv[<span class="number">3</span>]));</span><br><span class="line">  <span class="comment">// 4.è°ƒç”¨spinå‡½æ•°,å¹¶ä¼ å…¥èŠ‚ç‚¹ç±»å¯¹è±¡;</span></span><br><span class="line">  rclcpp::<span class="built_in">spin</span>(client); </span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å‚æ•°æœåŠ¡æ¡ˆä¾‹åˆ†æ"><a href="#å‚æ•°æœåŠ¡æ¡ˆä¾‹åˆ†æ" class="headerlink" title="å‚æ•°æœåŠ¡æ¡ˆä¾‹åˆ†æ"></a>å‚æ•°æœåŠ¡æ¡ˆä¾‹åˆ†æ</h3><p>éœ€æ±‚ï¼šåŠ¨æ€ä¿®æ”¹ä¹Œé¾Ÿçª—å£çš„èƒŒæ™¯é¢œè‰²</p>
<p>é…ç½®è‡ªé…</p>
<p><strong>launchæ–‡ä»¶</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_launch_description</span>():</span><br><span class="line">    t = Node(package=<span class="string">"turtlesim"</span>,executable=<span class="string">"turtlesim_node"</span>)</span><br><span class="line">    param = Node(package=<span class="string">"cpp07_exercise"</span>,executable=<span class="string">"test04_param"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> LaunchDescription([t,param])</span><br></pre></td></tr></tbody></table></figure>

<p>test04_param.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  éœ€æ±‚: ä¿®æ”¹turtlesim_nodeçš„èƒŒæ™¯é¢œè‰²</span></span><br><span class="line"><span class="comment">  æ­¥éª¤:</span></span><br><span class="line"><span class="comment">    1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="comment">    2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">    3.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›</span></span><br><span class="line"><span class="comment">      3-1.åˆ›å»ºå‚æ•°å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-2.è¿æ¥å‚æ•°æœåŠ¡ç«¯ï¼›</span></span><br><span class="line"><span class="comment">      3-3.æ›´æ–°å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">    4.åˆ›å»ºå¯¹è±¡æŒ‡é’ˆ,å¹¶è°ƒç”¨å…¶å‡½æ•°;</span></span><br><span class="line"><span class="comment">    5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono_literals;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test04Param</span>: <span class="keyword">public</span> rclcpp::Node{ </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Test04Param</span>():<span class="built_in">Node</span>(<span class="string">"test04_param_node_cpp"</span>){  <span class="comment">// èŠ‚ç‚¹åç§°ä¸€èˆ¬å°å†™</span></span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"å‚æ•°æœåŠ¡å™¨åˆ›å»ºæˆåŠŸ!"</span>);</span><br><span class="line">        <span class="comment">// 3-1.åˆ›å»ºå‚æ•°å®¢æˆ·ç«¯</span></span><br><span class="line">        client_ = std::<span class="built_in">make_shared</span>&lt;rclcpp::SyncParametersClient&gt;(<span class="keyword">this</span>,<span class="string">"/turtlesim"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-2.è¿æ¥å‚æ•°æœåŠ¡ç«¯</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">connect_server</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">while</span>(!client_-&gt;<span class="built_in">wait_for_service</span>(<span class="number">5</span>s)){</span><br><span class="line">            <span class="keyword">if</span>(!rclcpp::<span class="built_in">ok</span>())</span><br><span class="line">            {</span><br><span class="line">              <span class="built_in">RCLCPP_INFO</span>(rclcpp::<span class="built_in">get_logger</span>(<span class="string">"rclcpp"</span>),<span class="string">"å¼ºåˆ¶é€€å‡ºï¼"</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"æœåŠ¡è¿æ¥ä¸­..."</span>);</span><br><span class="line">        }</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 3-3.æ›´æ–°å‚æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update_param</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">// èƒŒæ™¯è‰²æ¸å˜ä¿®æ”¹</span></span><br><span class="line">        <span class="comment">// background_r[0,255]</span></span><br><span class="line">        <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">        red = client_-&gt;<span class="built_in">get_parameter</span>&lt;<span class="type">int32_t</span>&gt;(<span class="string">"background_r"</span>);</span><br><span class="line">        <span class="function">rclcpp::Rate <span class="title">rate</span><span class="params">(<span class="number">30.0</span>)</span></span>;</span><br><span class="line">        <span class="comment">// ç¼–å†™å¾ªç¯ï¼Œä¿®æ”¹å‚æ•°</span></span><br><span class="line">        <span class="type">int</span> count = red;</span><br><span class="line">        <span class="keyword">while</span>(rclcpp::<span class="built_in">ok</span>())</span><br><span class="line">        {</span><br><span class="line">          <span class="comment">/* </span></span><br><span class="line"><span class="comment">            è®¡æ•°å™¨åœ¨[0,255)é€’å¢ï¼Œ[255,510]é€’å‡ï¼Œå¤§äºç­‰äº510æ—¶å½’0</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">          count &lt; <span class="number">255</span> ? red +=  <span class="number">5</span> : red -= <span class="number">5</span>;</span><br><span class="line">          count += <span class="number">5</span>;</span><br><span class="line">          <span class="keyword">if</span>(count&gt;=<span class="number">510</span>) count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// ä¿®æ”¹æœåŠ¡å™¨å‚æ•°</span></span><br><span class="line">          client_-&gt;<span class="built_in">set_parameters</span>({rclcpp::<span class="built_in">Parameter</span>(<span class="string">"background_r"</span>,red)});</span><br><span class="line">          <span class="built_in">RCLCPP_INFO</span>(<span class="keyword">this</span>-&gt;<span class="built_in">get_logger</span>(),<span class="string">"red = %d"</span>, red);</span><br><span class="line">          rate.<span class="built_in">sleep</span>();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    rclcpp::SyncParametersClient::SharedPtr client_;</span><br><span class="line">    <span class="type">int32_t</span> red;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="comment">// 2.åˆå§‹åŒ– ROS2 å®¢æˆ·ç«¯ï¼›</span></span><br><span class="line">  rclcpp::<span class="built_in">init</span>(argc,argv);</span><br><span class="line">  <span class="comment">// 4.åˆ›å»ºå¯¹è±¡æŒ‡é’ˆ,å¹¶è°ƒç”¨å…¶å‡½æ•°</span></span><br><span class="line">  <span class="keyword">auto</span> client = std::<span class="built_in">make_shared</span>&lt;Test04Param&gt;();</span><br><span class="line">  <span class="comment">// åˆ¤æ–­è¿æ¥çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span>(!client-&gt;<span class="built_in">connect_server</span>())</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  client-&gt;<span class="built_in">update_param</span>();</span><br><span class="line">  <span class="comment">// 5.é‡Šæ”¾èµ„æºã€‚</span></span><br><span class="line">  rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://yhblogs.cn">ä»Šå¤©ç¡å¤Ÿäº†å—</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://yhblogs.cn/posts/3894864178.html">http://yhblogs.cn/posts/3894864178.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://yhblogs.cn" target="_blank">ãŒã‚“ã°ã‚ã†</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%F0%9F%A4%96ROS/">ğŸ¤–ROS</a></div><div class="post_share"><div class="social-share" data-image="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-5g22q5_1920x1080_compressed.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2426107671.html" title="C++èŒå·¥ç®¡ç†ç³»ç»Ÿ"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-zywe5j_1920x1080_compressed.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">C++èŒå·¥ç®¡ç†ç³»ç»Ÿ</div></div></a></div><div class="next-post pull-right"><a href="/posts/2715330630.html" title="ç§¦çš‡å²›å‡ºæ¸¸"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-4996q1_compressed.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ç§¦çš‡å²›å‡ºæ¸¸</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/626062709.html" title="ROSåŸºç¡€çŸ¥è¯†"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/ros-logo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-19</div><div class="title">ROSåŸºç¡€çŸ¥è¯†</div></div></a></div><div><a href="/posts/3254549402.html" title="ROSæœºå™¨äººç³»ç»Ÿ"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-1q83qg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-10</div><div class="title">ROSæœºå™¨äººç³»ç»Ÿ</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/b_2a1aef95f351a5f7ef72eb81e6838fd6.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">ä»Šå¤©ç¡å¤Ÿäº†å—</div><div class="author-info__description">ç›¸é‡æ˜¯æœ€å°å•ä½çš„å¥‡è¿¹</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">81</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">1</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/202206071549233.webp" target="_blank" title="QQ"><i class="iconfont icon-QQ"></i></a><a class="social-icon" href="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/202206071549234.webp" target="_blank" title="å¾®ä¿¡"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://space.bilibili.com/277953459?spm_id_from=333.1007.0.0" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="https://github.com/YaoHui-Wu06022" target="_blank" title="Github"><i class="iconfont icon-GitHub"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ä¿æŒç†æ™ºï¼Œç›¸ä¿¡æ˜å¤©</div><div class="twopeople"><div class="twopeople"><div class="container" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div> <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script> <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script> <script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script> <style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.</span> <span class="toc-text">æ¨¡æ¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS2%E6%A6%82%E8%BF%B0%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">ROS2æ¦‚è¿°ä¸ç¯å¢ƒæ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS2%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.</span> <span class="toc-text">ROS2ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS2%E5%AF%B9%E6%AF%94ROS"><span class="toc-number">2.2.</span> <span class="toc-text">ROS2å¯¹æ¯”ROS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS2%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">ROS2å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS2%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">2.4.</span> <span class="toc-text">ROS2é›†æˆå¼€å‘ç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%88%E7%AB%AF"><span class="toc-number">2.4.1.</span> <span class="toc-text">ç»ˆç«¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VScode"><span class="toc-number">2.4.2.</span> <span class="toc-text">VScode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#git"><span class="toc-number">2.4.3.</span> <span class="toc-text">git</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.4.4.</span> <span class="toc-text">æ“ä½œå‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ROS2%E4%BD%93%E7%B3%BB%E6%A1%86%E6%9E%B6"><span class="toc-number">2.5.</span> <span class="toc-text">ROS2ä½“ç³»æ¡†æ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ROS2%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.5.1.</span> <span class="toc-text">ROS2æ–‡ä»¶ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BA%90%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">2.5.1.1.</span> <span class="toc-text">æºæ–‡ä»¶è¯´æ˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">2.5.1.2.</span> <span class="toc-text">é…ç½®æ–‡ä»¶è¯´æ˜</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ROS2%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="toc-number">2.5.2.</span> <span class="toc-text">ROS2æ ¸å¿ƒæ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ROS2%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81"><span class="toc-number">2.5.3.</span> <span class="toc-text">ROS2æŠ€æœ¯æ”¯æŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ROS2%E5%BA%94%E7%94%A8%E6%96%B9%E5%90%91"><span class="toc-number">2.5.4.</span> <span class="toc-text">ROS2åº”ç”¨æ–¹å‘</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS2%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E6%A0%B8%E5%BF%83"><span class="toc-number">3.</span> <span class="toc-text">ROS2é€šä¿¡æœºåˆ¶æ ¸å¿ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%AE%80%E4%BB%8B"><span class="toc-number">3.1.</span> <span class="toc-text">é€šä¿¡æœºåˆ¶ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">3.2.</span> <span class="toc-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="toc-number">3.3.</span> <span class="toc-text">è¯é¢˜é€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E9%9C%80%E6%B1%82"><span class="toc-number">3.3.1.</span> <span class="toc-text">æ¡ˆä¾‹éœ€æ±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E6%B6%88%E6%81%AF"><span class="toc-number">3.3.2.</span> <span class="toc-text">åŸç”Ÿæ¶ˆæ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%B6%88%E6%81%AF"><span class="toc-number">3.3.3.</span> <span class="toc-text">é…ç½®æ¥å£æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF"><span class="toc-number">3.3.4.</span> <span class="toc-text">è‡ªå®šä¹‰æ¶ˆæ¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1"><span class="toc-number">3.4.</span> <span class="toc-text">æœåŠ¡é€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E9%9C%80%E6%B1%82-1"><span class="toc-number">3.4.1.</span> <span class="toc-text">æ¡ˆä¾‹éœ€æ±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%B6%88%E6%81%AF-1"><span class="toc-number">3.4.2.</span> <span class="toc-text">é…ç½®æ¥å£æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.4.3.</span> <span class="toc-text">æ¡ˆä¾‹å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E4%BD%9C%E9%80%9A%E4%BF%A1"><span class="toc-number">3.5.</span> <span class="toc-text">åŠ¨ä½œé€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E9%9C%80%E6%B1%82-2"><span class="toc-number">3.5.1.</span> <span class="toc-text">æ¡ˆä¾‹éœ€æ±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%B6%88%E6%81%AF-2"><span class="toc-number">3.5.2.</span> <span class="toc-text">é…ç½®æ¥å£æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">3.5.3.</span> <span class="toc-text">æ¡ˆä¾‹å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.6.</span> <span class="toc-text">å‚æ•°æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E9%9C%80%E6%B1%82-3"><span class="toc-number">3.6.1.</span> <span class="toc-text">æ¡ˆä¾‹éœ€æ±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.6.2.</span> <span class="toc-text">å‚æ•°æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">3.6.3.</span> <span class="toc-text">æ¡ˆä¾‹å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E7%AB%A0%E5%B0%8F%E8%8A%82"><span class="toc-number">3.7.</span> <span class="toc-text">æœ¬ç« å°èŠ‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS2%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E8%A1%A5%E5%85%85"><span class="toc-number">4.</span> <span class="toc-text">ROS2é€šä¿¡æœºåˆ¶è¡¥å……</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">åˆ†å¸ƒå¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E8%A6%86%E7%9B%96"><span class="toc-number">4.2.</span> <span class="toc-text">å·¥ä½œç©ºé—´è¦†ç›–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-number">4.3.</span> <span class="toc-text">å…ƒåŠŸèƒ½åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E9%87%8D%E5%90%8D"><span class="toc-number">4.4.</span> <span class="toc-text">èŠ‚ç‚¹é‡å</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#run2-run"><span class="toc-number">4.4.1.</span> <span class="toc-text">run2 run</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#launch"><span class="toc-number">4.4.2.</span> <span class="toc-text">launch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81"><span class="toc-number">4.4.3.</span> <span class="toc-text">ç¼–ç </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E9%87%8D%E5%90%8D"><span class="toc-number">4.5.</span> <span class="toc-text">è¯é¢˜é‡å</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#run2-run-1"><span class="toc-number">4.5.1.</span> <span class="toc-text">run2 run</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#launch-1"><span class="toc-number">4.5.2.</span> <span class="toc-text">launch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81-1"><span class="toc-number">4.5.3.</span> <span class="toc-text">ç¼–ç </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B8%E5%85%B3API"><span class="toc-number">4.6.</span> <span class="toc-text">æ—¶é—´ç›¸å…³API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Rate"><span class="toc-number">4.6.1.</span> <span class="toc-text">Rate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Time"><span class="toc-number">4.6.2.</span> <span class="toc-text">Time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Duration"><span class="toc-number">4.6.3.</span> <span class="toc-text">Duration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97"><span class="toc-number">4.6.4.</span> <span class="toc-text">è¿ç®—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E5%B7%A5%E5%85%B7"><span class="toc-number">4.7.</span> <span class="toc-text">é€šä¿¡æœºåˆ¶å·¥å…·</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E5%B7%A5%E5%85%B7"><span class="toc-number">4.7.1.</span> <span class="toc-text">å‘½ä»¤å·¥å…·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rqt%E5%B7%A5%E5%85%B7%E7%AE%B1"><span class="toc-number">4.7.2.</span> <span class="toc-text">rqtå·¥å…·ç®±</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS2%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E5%AE%9E%E6%93%8D"><span class="toc-number">5.</span> <span class="toc-text">ROS2é€šä¿¡æœºåˆ¶å®æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E6%A1%88%E4%BE%8B"><span class="toc-number">5.1.</span> <span class="toc-text">è¯é¢˜é€šä¿¡æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.</span> <span class="toc-text">æœåŠ¡é€šä¿¡æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E4%BD%9C%E9%80%9A%E4%BF%A1%E6%A1%88%E4%BE%8B"><span class="toc-number">5.3.</span> <span class="toc-text">åŠ¨ä½œé€šä¿¡æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%9C%8D%E5%8A%A1%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">5.4.</span> <span class="toc-text">å‚æ•°æœåŠ¡æ¡ˆä¾‹åˆ†æ</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">Â©2022 - 2026 By ä»Šå¤©ç¡å¤Ÿäº†å—</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">You must always have faith in who you areï¼</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>