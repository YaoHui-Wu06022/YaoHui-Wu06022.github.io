<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ROS机器人系统 | がんばろう</title><meta name="author" content="今天睡够了吗"><meta name="copyright" content="今天睡够了吗"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="机器人系统仿真在 ROS 中，仿真实现主要涉及的内容：  对机器人建模(URDF) 创建仿真环境(Gazebo) 感知环境(Rviz)  如果安装的是完整版ros，Gazebo和Rviz默认安装 URDF：Unified Robot Description Format 可以以一种 XML 的方式描述机器人的部分结构，比如底盘、摄像头、激光雷达、机械臂以及不同关节的自由度…..，该文件可以被 C+">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS机器人系统">
<meta property="og:url" content="http://yhblogs.cn/posts/3254549402.html">
<meta property="og:site_name" content="がんばろう">
<meta property="og:description" content="机器人系统仿真在 ROS 中，仿真实现主要涉及的内容：  对机器人建模(URDF) 创建仿真环境(Gazebo) 感知环境(Rviz)  如果安装的是完整版ros，Gazebo和Rviz默认安装 URDF：Unified Robot Description Format 可以以一种 XML 的方式描述机器人的部分结构，比如底盘、摄像头、激光雷达、机械臂以及不同关节的自由度…..，该文件可以被 C+">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-1q83qg.jpg">
<meta property="article:published_time" content="2025-06-10T16:04:57.000Z">
<meta property="article:modified_time" content="2025-11-01T15:04:06.750Z">
<meta property="article:author" content="今天睡够了吗">
<meta property="article:tag" content="🤖ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-1q83qg.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yhblogs.cn/posts/3254549402.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ROS机器人系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-11-01 15:04:06'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_3319458_ks437t3n4r.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/b_2a1aef95f351a5f7ef72eb81e6838fd6.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-rili"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="がんばろう"><img class="site-icon" src="/img/favicon.png"><span class="site-name">がんばろう</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-rili"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">ROS机器人系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-06-10T16:04:57.000Z" title="发表于 2025-06-10 16:04:57">2025-06-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">23.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>102分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ROS机器人系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="机器人系统仿真"><a href="#机器人系统仿真" class="headerlink" title="机器人系统仿真"></a>机器人系统仿真</h2><p>在 ROS 中，仿真实现主要涉及的内容：</p>
<ul>
<li>对机器人建模(URDF)</li>
<li>创建仿真环境(Gazebo)</li>
<li>感知环境(Rviz)</li>
</ul>
<p>如果安装的是完整版ros，Gazebo和Rviz默认安装</p>
<p><strong>URDF</strong>：Unified Robot Description Format</p>
<p>可以以一种 XML 的方式描述机器人的部分结构，比如底盘、摄像头、激光雷达、机械臂以及不同关节的自由度…..，该文件可以被 C++ 内置的解释器转换成可视化的机器人模型，是 ROS 中实现机器人仿真的重要组件</p>
<p><strong>rviz</strong>：ROS Visualization Tool</p>
<p>以三维方式显示ROS消息，可以将数据进行可视化表达</p>
<p><strong>Gazebo</strong>：</p>
<p>Gazebo是一款3D动态模拟器，用于显示机器人模型并创建仿真环境，能够在复杂的室内和室外环境中准确有效地模拟机器人</p>
<p>三者应用中，只是创建 URDF 意义不大，一般需要结合 Gazebo 或 Rviz 使用，在 Gazebo 或 Rviz 中可以将 URDF 文件解析为图形化的机器人模型，一般的使用组合为:</p>
<ul>
<li>如果非仿真环境，那么使用 URDF 结合 Rviz 直接显示感知的真实环境信息</li>
<li>如果是仿真环境，那么需要使用 URDF 结合 Gazebo 搭建仿真环境，并结合 Rviz 显示感知的虚拟环境信息</li>
</ul>
<p>仿真缺陷：</p>
<p>机器人在仿真环境与实际环境下的表现差异较大，仿真并不能完全做到模拟真实的物理世界，存在一些”失真”的情况</p>
<ol>
<li><p>仿真器所使用的物理引擎目前还不能够完全精确模拟真实世界的物理情况</p>
</li>
<li><p>仿真器构建的是关节驱动器（电机&amp;齿轮箱）、传感器与信号通信的绝对理想情况，目前不支持模拟实际硬件缺陷或者一些临界状态等情形</p>
</li>
</ol>
<p>素材链接:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/zx595306686/sim_demo.git">https://github.com/zx595306686/sim_demo.git</a></p>
<blockquote>
<p>在虚拟机中git clone下载</p>
</blockquote>
</li>
</ul>
<h3 id="URDF集成Rviz"><a href="#URDF集成Rviz" class="headerlink" title="URDF集成Rviz"></a>URDF集成Rviz</h3><p>URDF与Rviz的集成较之于URDF与Gazebo的集成更为简单</p>
<p>需求描述：在 Rviz 中显示一个盒状机器人</p>
<p>实现流程：</p>
<ol>
<li>新建功能包，导入依赖</li>
<li>核心：编写 urdf 文件</li>
<li>核心：在 launch 文件集成 URDF 与 Rviz</li>
<li>在 Rviz 中显示机器人模型</li>
</ol>
<p><strong>创建功能包</strong>：</p>
<p>创建一个新的功能包，名称自定义，导入依赖包：<code>urdf</code>与<code>xacro</code></p>
<blockquote>
<p>这个时候目录下是没有src文件的，因为不需要编码</p>
<p><code>xacro</code>(XML Macros)是 ROS中用于简化机器人模型描述的核心工具包，专门用于处理 URDF文件</p>
</blockquote>
<p>在当前功能包下，再新建几个目录：</p>
<p><code>urdf</code>: 存储 urdf 文件的目录</p>
<p><code>meshes</code>:机器人模型渲染文件(暂不使用)</p>
<p><code>config</code>: 配置文件</p>
<p><code>launch</code>: 存储 launch 启动文件</p>
<p><strong>编写 URDF 文件</strong>：</p>
<p>在urdf文件夹下新建子级文件夹urdf和xacro</p>
<p>urdf文件夹中添加一个<code>.urdf</code>文件，复制如下内容：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"mycar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.5 0.2 0.1"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>在 launch 文件中集成 URDF 与 Rviz</strong>：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 在参数服务器载入urdf文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 参数名name固定 robot_description --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span> = <span class="string">"robot_description"</span> <span class="attr">textfile</span>= <span class="string">"$(find urdf01_rviz)/urdf/urdf/demo01.urdf"</span>  /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2. 启动 rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span>  <span class="attr">pkg</span> = <span class="string">"rviz"</span> <span class="attr">type</span> = <span class="string">"rviz"</span> <span class="attr">name</span> = <span class="string">"rviz"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>在 Rviz 中显示机器人模型</strong>：</p>
<p>rviz 启动后，会发现并没有盒装的机器人模型，这是因为默认情况下没有添加机器人显示组件，需要手动添加，添加方式如下</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/01_URDF文件执行rviz配置01.webp" alt="01_URDF文件执行rviz配置01" style="zoom: 67%;">

<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/02_URDF文件执行rviz配置02.webp" alt="02_URDF文件执行rviz配置02" style="zoom:67%;">

<p><strong>优化 rviz 启动</strong></p>
<p>重复启动<code>launch</code>文件时，Rviz 之前的组件配置信息不会自动保存，需要重复执行显示操作，为了方便使用，可以使用如下方式优化：</p>
<p>首先，将当前配置保存进<code>config</code>目录</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/10_rviz配置保存.webp" alt="10_rviz配置保存" style="zoom:67%;">

<p>launch文件中 Rviz 的启动配置添加参数：<code>args</code>，值设置为 <code>-d 配置文件路径</code></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span>  <span class="attr">pkg</span> = <span class="string">"rviz"</span> <span class="attr">type</span> = <span class="string">"rviz"</span> <span class="attr">name</span> = <span class="string">"rviz"</span> <span class="attr">args</span> = <span class="string">"-d $(find urdf01_rviz)/config/show_car.rviz"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>再启动时，就可以包含之前的组件配置了，使用更方便快捷</p>
<h3 id="URDF语法"><a href="#URDF语法" class="headerlink" title="URDF语法"></a>URDF语法</h3><p>URDF 文件是一个标准的 XML 文件，在 ROS 中预定义了一系列的标签用于描述机器人模型</p>
<p>机器人模型可能较为复杂，但是 ROS 的 URDF 中机器人的组成却是较为简单，</p>
<p>URDF主要有四类标签</p>
<ul>
<li>robot 根标签，类似于 launch文件中的launch标签</li>
<li>link 连杆标签</li>
<li>joint 关节标签</li>
<li>gazebo</li>
</ul>
<p>joint标签对应的数据在模型中是不可见的</p>
<p>gazebo标签不是机器人模型必须的，只有在仿真时才需设置，用于配置仿真环境所需参数</p>
<p><font color="Violetred">属性跟在标签的&lt;&gt;内</font></p>
<p><strong>robot</strong></p>
<p>urdf 中为了保证 xml 语法的完整性，使用了<code>robot</code>标签作为根标签</p>
<p>所有的 link 和 joint 以及其他标签都必须包含在 robot 标签内</p>
<p>在该标签内可以通过 name 属性设置机器人模型的名称</p>
<h4 id="link"><a href="#link" class="headerlink" title="link"></a>link</h4><p>urdf 中的 link 标签用于描述机器人某个部件(也即刚体部分)的外观和物理属性</p>
<p>比如: 机器人底座、轮子、激光雷达、摄像头…</p>
<p>每一个部件都对应一个 link，在 link 标签内，可以设计该部件的形状、尺寸、颜色、惯性(inertial)矩阵、碰撞(collision)参数等一系列属性</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/20250610link.webp" alt="20250610link" style="zoom:50%;">

<p>属性：name —&gt; 为连杆命名</p>
<p>子标签：</p>
<p>visual —&gt; 描述外观(对应的数据是可视的)</p>
<ul>
<li><p>geometry 设置连杆的形状</p>
<ul>
<li><p>标签1: box(盒状)</p>
<ul>
<li>属性：size = “[x] [y] [z]”  单位为m</li>
</ul>
</li>
<li><p>标签2: cylinder(圆柱)</p>
<ul>
<li>属性：radius=“ ” length=“ ”</li>
</ul>
</li>
<li><p>标签3: sphere(球体)</p>
<ul>
<li>属性：radius=“ ”</li>
</ul>
</li>
<li><p>标签4: mesh(为连杆添加皮肤)</p>
<ul>
<li><p>属性：filename=资源路径</p>
<p>资源路径格式如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package://&lt;packagename&gt;/&lt;path&gt;/文件</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>origin 设置偏移量与倾斜弧度</p>
<ul>
<li><p>属性1：xyz=”[x] [y] [z]”</p>
</li>
<li><p>属性2：rpy=”[翻滚] [俯仰] [偏航]”</p>
<blockquote>
<p>逆着轴方向看逆时针旋转为正</p>
<p>偏移多在joint中实现</p>
</blockquote>
</li>
</ul>
</li>
<li><p>metrial 设置材料属性(颜色)</p>
<ul>
<li>属性: name</li>
<li>标签: color<ul>
<li>属性: rgba=”[红] [绿] [蓝] [透明度]”  取值均[0,1]</li>
</ul>
</li>
</ul>
</li>
<li><p>collision —&gt; 连杆的碰撞属性</p>
</li>
<li><p>Inertial —&gt; 连杆的惯性矩阵</p>
</li>
</ul>
<p>urdf文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span> = <span class="string">"car"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span> =<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 可视化标签 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 1.形状 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 立方体 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- &lt;box size = "0.2 0.2 0.2" /&gt; --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 圆柱 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- &lt;cylinder radius = "0.2" length = "2" /&gt; --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 球体 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- &lt;sphere radius = "0.2" /&gt; --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 皮肤 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span> = <span class="string">"package://urdf01_rviz/meshes/autolabor_mini.stl"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 2. 偏移量和倾斜弧度 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"1.57 0 1.57"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 3. 颜色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span> = <span class="string">"car_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span> = <span class="string">"0.3 0.4 0.2 1"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="joint"><a href="#joint" class="headerlink" title="joint"></a>joint</h4><p>urdf 中的 joint 标签用于描述机器人关节的运动学和动力学属性，还可以指定关节运动的安全极限</p>
<p>机器人的两个部件(分别称之为 parent link 与 child link)以”关节”的形式相连接</p>
<p>不同的关节有不同的运动形式：旋转、滑动、固定、旋转速度、旋转角度限制….</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/官方02_link.webp" alt="官方02_link" style="zoom:50%;">

<p>属性：</p>
<ul>
<li>name —&gt; 为关节命名</li>
<li>type —&gt; 关节运动形式<ul>
<li><font color="Violetred">continuous</font>：旋转关节，可以绕单轴无限旋转</li>
<li>revolute：旋转关节，类似于 continues，但是有旋转角度限制</li>
<li>prismatic：滑动关节，沿某一轴线移动的关节，有位置极限</li>
<li>planer：平面关节，允许在平面正交方向上平移或旋转</li>
<li>floating：浮动关节，允许进行平移、旋转运动</li>
<li><font color="Violetred">fixed</font>：固定关节，不允许运动的特殊关节</li>
</ul>
</li>
</ul>
<p>子标签</p>
<ul>
<li><p>parent(必需的)</p>
<p>parent link的名字是一个强制的属性：</p>
<ul>
<li>link：父级连杆的名字，是这个link在机器人结构树中的名字</li>
</ul>
</li>
<li><p>child(必需的)</p>
<p>child link的名字是一个强制的属性：</p>
<ul>
<li>link：子级连杆的名字，是这个link在机器人结构树中的名字</li>
</ul>
</li>
<li><p>origin</p>
<ul>
<li>属性：xyz=各轴线上的偏移量 rpy=各轴线上的偏移弧度</li>
</ul>
</li>
<li><p>axis</p>
<ul>
<li>属性：xyz用于设置围绕哪个关节轴运动</li>
</ul>
</li>
</ul>
<p>需求：创建机器人模型，底盘为长方体，在长方体的前面添加一摄像头，摄像头可以沿着 Z 轴 360 度旋转</p>
<p>urdf文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span> = <span class="string">"car"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 底盘link --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span> = <span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span> = <span class="string">"0.3 0.2 0.1"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span> = <span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span> = <span class="string">"car_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span> = <span class="string">"0.3 0.4 0.2 0.5"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2. 摄像头link --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span> = <span class="string">"camera"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.02 0.05 0.05"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.027"</span> <span class="attr">rpy</span> = <span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span> = <span class="string">"camere_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span> = <span class="string">"0 0 1 0.5"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3. 关节 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span>  <span class="attr">name</span> = <span class="string">"camerabase"</span> <span class="attr">type</span> = <span class="string">"continuous"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 父级link --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span> = <span class="string">"base_link"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 子级link --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span> = <span class="string">"camera"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置偏移量 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注意这里的偏移是两个坐标系之间的偏移, 要考虑不嵌入需要另外增加偏移量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span> = <span class="string">"-0.12 0 0.05"</span> <span class="attr">rpy</span> =<span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置关节旋转参考的坐标轴 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 0 1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>launch文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 在参数服务器载入urdf文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 参数名name固定 robot_description --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span> = <span class="string">"robot_description"</span> <span class="attr">textfile</span>= <span class="string">"$(find urdf01_rviz)/urdf/urdf/demo03.urdf"</span>  /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2. 启动 rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span>  <span class="attr">pkg</span> = <span class="string">"rviz"</span> <span class="attr">type</span> = <span class="string">"rviz"</span> <span class="attr">name</span> = <span class="string">"rviz"</span> <span class="attr">args</span> = <span class="string">"-d $(find urdf01_rviz)/config/show_car.rviz"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        只有这两句:</span></span><br><span class="line"><span class="comment">            表现:设置显示的位置与颜色异常</span></span><br><span class="line"><span class="comment">            提示:No transform from [camera] to [base_link]   </span></span><br><span class="line"><span class="comment">            原因:rviz中显示URDF时，必须发布不同部件之间的坐标系关系</span></span><br><span class="line"><span class="comment">            解决:ROS中提供了关于机器人模型显示的坐标发布相关节点（两个）</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  关节状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  机器人状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>状态发布节点在此是必须的</p>
<p>关节运动控制节点(可选)，会生成关节控制的UI，用于测试关节运动是否正常</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 可选:用于控制关节运动的节点 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher_gui"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意，摄像头的偏移设置为0.027是为了避免旋转控制时0.025和底盘贴合可能出现旋转抖动现象</p>
</blockquote>
<p><strong>base_footprint优化urdf</strong></p>
<p>前面实现的机器人模型是半沉到地下的，因为默认情况下底盘的中心点位于地图原点上</p>
<p>可以将初始 link 设置为一个尺寸极小的 link(比如半径为 0.001m 的球体，或边长为 0.001m 的立方体)，然后再在初始 link 上添加底盘等刚体，这样虽然仍然存在初始link半沉的现象，但是基本可以忽略了</p>
<p>这个初始 link 一般称之为 base_footprint，在rviz中将坐标系换为base_footprint发现机器人已经回到地面，这种方法避免了偏移导致的混乱</p>
<p>修改后的urdf文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span> = <span class="string">"car"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加一个尺寸极小的link,再去关联base_link,</span></span><br><span class="line"><span class="comment">    关节高度和base_link下沉一致(半个底盘高度)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span> = <span class="string">"base_footprint"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span> = <span class="string">"0.001 0.001 0.001"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 底盘link --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span> = <span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span> = <span class="string">"0.3 0.2 0.1"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span> = <span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span> = <span class="string">"car_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span> = <span class="string">"0.3 0.4 0.2 0.5"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2. 摄像头link --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span> = <span class="string">"camera"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.02 0.05 0.05"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.027"</span> <span class="attr">rpy</span> = <span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span> = <span class="string">"camere_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span> = <span class="string">"0 0 1 0.5"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 关联base_footprint 与base_link--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span>  <span class="attr">name</span> = <span class="string">"link2footfrint"</span> <span class="attr">type</span> = <span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 父级link --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span> = <span class="string">"base_footprint"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 子级link --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span> = <span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置偏移量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span> = <span class="string">"0 0 0.05"</span> <span class="attr">rpy</span> =<span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span>   </span><br><span class="line">    <span class="comment">&lt;!-- 3. 关节 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span>  <span class="attr">name</span> = <span class="string">"camera2base"</span> <span class="attr">type</span> = <span class="string">"continuous"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 父级link --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span> = <span class="string">"base_link"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 子级link --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span> = <span class="string">"camera"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置偏移量 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注意这里的偏移是两个坐标系之间的偏移, 要考虑不嵌入需要另外增加偏移量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span> = <span class="string">"-0.12 0 0.05"</span> <span class="attr">rpy</span> =<span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置关节旋转参考的坐标轴 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 0 1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="urdf实操"><a href="#urdf实操" class="headerlink" title="urdf实操"></a>urdf实操</h4><p>需求描述：创建一个四轮圆柱状机器人模型，底盘为圆柱状，半径 10cm，高 8cm，四轮由两个驱动轮和两个万向支撑轮组成，两个驱动轮半径为 3.25cm，轮胎宽度1.5cm，两个万向轮为球状，半径 0.75cm，底盘离地间距为 1.5cm(与万向轮直径一致)</p>
<p>偏移多使用joint来实现，link内origin一般都设为0，这样能保证坐标原点在物体中心</p>
<blockquote>
<p>可以这么理解，joint改变了两个坐标系原点的位置，link不改变原点位置，只是改变了偏移量</p>
</blockquote>
<p>实现流程：</p>
<p>创建机器人模型可以分步骤实现</p>
<ol>
<li>新建 urdf 文件，并与 launch 文件集成</li>
<li>搭建底盘</li>
<li>在底盘上添加两个驱动轮</li>
<li>在底盘上添加两个万向轮</li>
</ol>
<p>launch文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">textfile</span>=<span class="string">"$(find urdf01_rviz)/urdf/urdf/test.urdf"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span> = <span class="string">"rviz"</span> <span class="attr">type</span> = <span class="string">"rviz"</span> <span class="attr">name</span> = <span class="string">"rviz"</span> <span class="attr">args</span> = <span class="string">"-d $(find urdf01_rviz)/config/show_car.rviz"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  关节状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  机器人状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加控制关节运动的节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher_gui"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>urdf文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"mycar"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置 base_footprint  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_footprint"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"0.001"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加底盘 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        参数</span></span><br><span class="line"><span class="comment">            形状:圆柱 </span></span><br><span class="line"><span class="comment">            半径:10cm -&gt; 0.1m</span></span><br><span class="line"><span class="comment">            高度:8cm  -&gt; 0.08m</span></span><br><span class="line"><span class="comment">            离地:1.5cm-&gt; 0.015m</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"0.1"</span> <span class="attr">length</span>=<span class="string">"0.08"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 偏移尽量去joint设置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"base_link_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.8 0.3 0.1 0.5"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加关节 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"base_link2base_footprint"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_footprint"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 关节z设置: 车身高度/2 + 离地距离 0.08/2+0.015--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.055"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加驱动轮 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        驱动轮是侧翻的圆柱</span></span><br><span class="line"><span class="comment">        参数</span></span><br><span class="line"><span class="comment">            半径: 3.25 cm -&gt; 0.0325m</span></span><br><span class="line"><span class="comment">            宽度: 1.5  cm -&gt; 0.015m</span></span><br><span class="line"><span class="comment">            颜色: 黑色 -&gt; (0,0,0)</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"left_wheel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"0.0325"</span> <span class="attr">length</span>=<span class="string">"0.015"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"1.5707 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"wheel_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.0 0.0 0.0 1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"right_wheel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"0.0325"</span> <span class="attr">length</span>=<span class="string">"0.015"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"-1.5707 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"wheel_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.0 0.0 0.0 1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加关节 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 关节设置:</span></span><br><span class="line"><span class="comment">            x = 0</span></span><br><span class="line"><span class="comment">            y = 底盘的半径 + 轮胎宽度 / 2 = 10 + 1.5/2 = 10.75cm = 0.1075m</span></span><br><span class="line"><span class="comment">            z = 离地间距 + 底盘长度 / 2 - 轮胎半径 = 1.5 + 4 - 3.25 = 2.25(cm)</span></span><br><span class="line"><span class="comment">            axis = 0 1 0</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"left_wheel2base_link"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"left_wheel"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.1075 -0.0225"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 1 0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"right_wheel2base_link"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"right_wheel"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 -0.1075 -0.0225"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 1 0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加万向轮(支撑轮) --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        参数</span></span><br><span class="line"><span class="comment">            形状: 球体</span></span><br><span class="line"><span class="comment">            半径: 0.75 cm</span></span><br><span class="line"><span class="comment">            颜色: 黑色</span></span><br><span class="line"><span class="comment">    --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"front_wheel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"0.0075"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"wheel_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.0 0.0 0.0 1.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"back_wheel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"0.0075"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"wheel_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.0 0.0 0.0 1.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        关节设置:</span></span><br><span class="line"><span class="comment">        x = 自定义</span></span><br><span class="line"><span class="comment">        y = 0</span></span><br><span class="line"><span class="comment">        z = 底盘长度 / 2 + 离地间距 - 轮胎半径 = 0.08 / 2 + 0.015 / 2 = 0.0475 </span></span><br><span class="line"><span class="comment">        axis= 1 1 1</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"front_wheel2base_link"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"front_wheel"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.08 0.0 -0.0475"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"1 1 1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"back_wheel2base_link"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"back_wheel"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.08 0.0 -0.0475"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"1 1 1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>代码似乎有些冗长，复用性差</p>
<h4 id="urdf工具"><a href="#urdf工具" class="headerlink" title="urdf工具"></a>urdf工具</h4><p>在 ROS 中，提供了一些工具来方便 URDF 文件的编写</p>
<ul>
<li><code>check_urdf</code>命令可以检查复杂的 urdf 文件是否存在语法问题</li>
<li><code>urdf_to_graphiz</code>命令可以查看 urdf 模型结构，显示不同 link 的层级关系</li>
</ul>
<p>首先需要安装，安装命令：<code>sudo apt install liburdfdom-tools</code></p>
<p>在urdf所在文件夹打开终端，调用<code>check_urdf [urdf文件]</code>，如果不抛出异常，说明文件合法，否则非法</p>
<p>进入urdf文件所属目录，调用:<code>urdf_to_graphiz [urdf文件]</code>，当前目录下会生成 pdf 文件，使用<code>evince</code>命令可以查看pdf</p>
<h3 id="URDF优化"><a href="#URDF优化" class="headerlink" title="URDF优化"></a>URDF优化</h3><p>前面 URDF 文件构建机器人模型的过程中，存在若干问题</p>
<ol>
<li>在设计关节的位置时，需要按照一定的公式计算，公式是固定的，但是在 URDF 中依赖于人工计算，存在不便，容易计算失误，且当某些参数发生改变时，还需要重新计算</li>
<li>URDF 中的部分内容是高度重复的，驱动轮与支撑轮的设计实现，不同轮子只是部分参数不同，形状、颜色、翻转量都是一致的，在实际应用中，构建复杂的机器人模型时，更是易于出现高度重复的设计，按照一般的编程涉及到重复代码应该考虑封装</li>
</ol>
<p>在 ROS 中，已经给出了类似编程的优化方案，称之为<strong>Xacro</strong></p>
<p>Xacro 是 XML Macros 的缩写，Xacro 是一种 XML 宏语言，是可编程的 XML</p>
<p>Xacro 可以声明变量，可以通过数学运算求解，使用流程控制控制执行顺序，还可以通过类似函数的实现，封装固定的逻辑，将逻辑中需要的可变的数据以参数的方式暴露出去，从而提高代码复用率以及程序的安全性。</p>
<h4 id="Xacro体验"><a href="#Xacro体验" class="headerlink" title="Xacro体验"></a>Xacro体验</h4><p><font color="Violetred">注意：该案例编写生成的是非法的 URDF 文件，目的在于演示 Xacro 的极简使用以及优点</font></p>
<p>编写 Xacro 文件，以变量的方式封装属性(常量半径、高度、车轮半径…)，以函数的方式封装重复实现(车轮的添加)</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"mycar"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 属性封装 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"wheel_radius"</span> <span class="attr">value</span>=<span class="string">"0.0325"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"wheel_length"</span> <span class="attr">value</span>=<span class="string">"0.0015"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"PI"</span> <span class="attr">value</span>=<span class="string">"3.1415927"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"base_link_length"</span> <span class="attr">value</span>=<span class="string">"0.08"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"lidi_space"</span> <span class="attr">value</span>=<span class="string">"0.015"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 宏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"wheel_func"</span> <span class="attr">params</span>=<span class="string">"wheel_name flag"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"${wheel_name}_wheel"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${wheel_radius}"</span> <span class="attr">length</span>=<span class="string">"${wheel_length}"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"${PI / 2} 0 0"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"wheel_color"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0 0 0 0.3"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 3-2.joint --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"${wheel_name}2link"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>  /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"${wheel_name}_wheel"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">                x 无偏移</span></span><br><span class="line"><span class="comment">                y 车体半径</span></span><br><span class="line"><span class="comment">                z z= 车体高度 / 2 + 离地间距 - 车轮半径</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 ${0.1 * flag} ${(base_link_length / 2 + lidi_space - wheel_radius) * -1}"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 1 0"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:wheel_func</span> <span class="attr">wheel_name</span>=<span class="string">"left"</span> <span class="attr">flag</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:wheel_func</span> <span class="attr">wheel_name</span>=<span class="string">"right"</span> <span class="attr">flag</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>命令行进入 xacro文件所属目录，执行:<code>rosrun xacro xacro xxx.xacro &gt; xxx.urdf</code>, 会将 xacro 文件解析为 urdf 文件(同一目录下)</p>
<h4 id="Xacro语法详解"><a href="#Xacro语法详解" class="headerlink" title="Xacro语法详解"></a>Xacro语法详解</h4><p>xacro 提供了可编程接口，类似于计算机语言，包括变量声明调用、函数声明与调用等语法实现</p>
<p>在使用 xacro 生成 urdf 时，根标签<code>robot</code>中必须包含命名空间声明</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:xacro="http://wiki.ros.org/xacro"</span><br></pre></td></tr></tbody></table></figure>

<p><strong>属性与算数运算</strong></p>
<p>用于封装 URDF 中的一些字段，比如：PAI 值，小车的尺寸，轮子半径 ….</p>
<p>属性定义：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"PI"</span> <span class="attr">value</span>=<span class="string">"3.1415927"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>属性调用：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ${属性名称} --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">UseProperty</span> <span class="attr">name</span> = <span class="string">"${PI}"</span>/&gt;</span> </span><br></pre></td></tr></tbody></table></figure>

<p>算术运算：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--${数学表达式}--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">UseProperty1</span> <span class="attr">result</span> = <span class="string">"${PI/2}"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>宏</strong></p>
<p>类似于函数实现，提高代码复用率，优化代码结构，提高安全性</p>
<p>宏定义：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"宏名称"</span> <span class="attr">params</span>=<span class="string">"参数列表(多参数之间使用空格分隔)"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    .....</span><br><span class="line"></span><br><span class="line">    参数调用格式: ${参数名}</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>宏调用：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:宏名称</span> <span class="attr">参数1</span>=<span class="string">""</span> <span class="attr">参数2</span>=<span class="string">""</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>文件包含</strong></p>
<p>机器人由多部件组成，不同部件可能封装为单独的 xacro 文件，最后再将不同的文件集成，组合为完整机器人，可以使用文件包含实现</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"my_base.xacro"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"my_camera.xacro"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"my_laser.xacro"</span> /&gt;</span></span><br><span class="line">      ....</span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="Xacro完整使用"><a href="#Xacro完整使用" class="headerlink" title="Xacro完整使用"></a>Xacro完整使用</h4><p>需求描述：使用 Xacro 优化 URDF 版的小车底盘模型实现</p>
<p>编写 Xacro 文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://www.ros.org/wiki/xacro"</span> <span class="attr">name</span>=<span class="string">"mycar"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 封装常量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"PI"</span> <span class="attr">value</span>=<span class="string">"3.1415927"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"footprint_radius"</span> <span class="attr">value</span>=<span class="string">"0.001"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 宏:黑色设置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"black"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.0 0.0 0.0 1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 底盘属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"base_radius"</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"base_length"</span> <span class="attr">value</span>=<span class="string">"0.08"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"ground_distance"</span> <span class="attr">value</span>=<span class="string">"0.015"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 设置 base_footprint  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_footprint"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"${footprint_radius}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span>    </span><br><span class="line">    <span class="comment">&lt;!-- 添加底盘 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${base_radius}"</span> <span class="attr">length</span>=<span class="string">"${base_length}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"base_link_color"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.8 0.3 0.1 0.5"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加关节 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"base_link2base_footprint"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_footprint"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 关节z设置: 车身高度/2 + 离地距离--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 ${base_length/2 + ground_distance}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 驱动轮属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"wheel_radius"</span> <span class="attr">value</span>=<span class="string">"0.0325"</span> /&gt;</span><span class="comment">&lt;!-- 半径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"wheel_length"</span> <span class="attr">value</span>=<span class="string">"0.015"</span> /&gt;</span><span class="comment">&lt;!-- 宽度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"wheel_joint_z"</span> <span class="attr">value</span>=<span class="string">"${-(base_length/2 + ground_distance - wheel_radius)}"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 驱动轮宏 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        direction: left or right</span></span><br><span class="line"><span class="comment">        flag: 1 or -1</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span> = <span class="string">"wheel_func"</span> <span class="attr">params</span>=<span class="string">"direction flag"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"${direction}_wheel"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${wheel_radius}"</span> <span class="attr">length</span>=<span class="string">"${wheel_length}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"${flag*PI/2} 0.0 0.0"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"black"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span>   </span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"${direction}_wheel2base_link"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"${direction}_wheel"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 ${flag*(base_radius)} ${wheel_joint_z}"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 1 0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:wheel_func</span> <span class="attr">direction</span>=<span class="string">"left"</span> <span class="attr">flag</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:wheel_func</span> <span class="attr">direction</span>=<span class="string">"right"</span> <span class="attr">flag</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 万向轮属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span> = <span class="string">"support_wheel_radius"</span> <span class="attr">value</span> =<span class="string">"0.0075"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"support_wheel_joint_z"</span> <span class="attr">value</span>=<span class="string">"${-(base_length/2 + ground_distance - support_wheel_radius)}"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 万向轮(支撑轮)宏 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span> = <span class="string">"add_support_wheel"</span> <span class="attr">params</span>=<span class="string">"direction flag"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"${direction}_wheel"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"${support_wheel_radius}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"black"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"${direction}_wheel2base_link"</span> <span class="attr">type</span>=<span class="string">"continuous"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"${direction}_wheel"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"${flag*(base_radius - support_wheel_radius)} 0.0 ${support_wheel_joint_z}"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"1 1 1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:add_support_wheel</span> <span class="attr">direction</span>=<span class="string">"front"</span> <span class="attr">flag</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:add_support_wheel</span> <span class="attr">direction</span>=<span class="string">"back"</span> <span class="attr">flag</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>对比之前的版本实现了代码复用</p>
<p>集成launch文件：<font color="Violetred">在 launch 文件中直接加载 xacro</font></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;param name="robot_description" textfile="$(find urdf01_rviz)/urdf/urdf/test.urdf" /&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">command</span> = <span class="string">"$(find xacro)/xacro $(find urdf01_rviz)/urdf/xacro/test.urdf.xacro"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span> = <span class="string">"rviz"</span> <span class="attr">type</span> = <span class="string">"rviz"</span> <span class="attr">name</span> = <span class="string">"rviz"</span> <span class="attr">args</span> = <span class="string">"-d $(find urdf01_rviz)/config/show_car.rviz"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  关节状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  机器人状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加控制关节运动的节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher_gui"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>核心代码：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">command</span> = <span class="string">"$(find xacro)/xacro $(find urdf01_rviz)/urdf/xacro/test.urdf.xacro"</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>加载<code>robot_description</code>时使用<code>command</code>属性，属性值就是调用 xacro 功能包的 xacro 程序直接解析 xacro 文件</p>
<h4 id="Xacro实操"><a href="#Xacro实操" class="headerlink" title="Xacro实操"></a>Xacro实操</h4><p>需求描述：在前面小车底盘基础之上，添加摄像头和雷达传感器</p>
<p>实现分析：</p>
<p>机器人模型由多部件组成，可以将不同组件设置进单独文件，最终通过文件包含实现组件的拼装。</p>
<p>实现流程：</p>
<ol>
<li>首先编写摄像头和雷达的 xacro 文件</li>
<li>然后再编写一个组合文件，组合底盘、摄像头与雷达</li>
<li>最后，通过 launch 文件启动 Rviz 并显示模型</li>
</ol>
<p>**摄像头Xacro **</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://www.ros.org/wiki/xacro"</span> <span class="attr">name</span>=<span class="string">"camera"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 摄像头属性 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        连杆属性：厚度、宽度、高度</span></span><br><span class="line"><span class="comment">        关节属性：x y z</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"camera_length"</span> <span class="attr">value</span>=<span class="string">"0.02"</span> /&gt;</span> <span class="comment">&lt;!-- 摄像头长度(x) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"camera_width"</span> <span class="attr">value</span>=<span class="string">"0.02"</span> /&gt;</span> <span class="comment">&lt;!-- 摄像头宽度(y) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"camera_height"</span> <span class="attr">value</span>=<span class="string">"0.02"</span> /&gt;</span> <span class="comment">&lt;!-- 摄像头高度(z) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"camera_x"</span> <span class="attr">value</span>=<span class="string">"0.08"</span> /&gt;</span> <span class="comment">&lt;!-- 摄像头安装的x坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"camera_y"</span> <span class="attr">value</span>=<span class="string">"0.0"</span> /&gt;</span> <span class="comment">&lt;!-- 摄像头安装的y坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"camera_z"</span> <span class="attr">value</span>=<span class="string">"${base_length / 2 + camera_height / 2}"</span> /&gt;</span> <span class="comment">&lt;!-- 摄像头安装的z坐标:底盘高度 / 2 + 摄像头高度 / 2  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 摄像头关节以及link --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"camera"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"${camera_length} ${camera_width} ${camera_height}"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"black"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"camera2base_link"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"camera"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"${camera_x} ${camera_y} ${camera_z}"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>雷达Xacro</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://www.ros.org/wiki/xacro"</span> <span class="attr">name</span>=<span class="string">"laser"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 雷达支架 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"support_length"</span> <span class="attr">value</span>=<span class="string">"0.15"</span> /&gt;</span> <span class="comment">&lt;!-- 支架长度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"support_radius"</span> <span class="attr">value</span>=<span class="string">"0.01"</span> /&gt;</span> <span class="comment">&lt;!-- 支架半径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"support_x"</span> <span class="attr">value</span>=<span class="string">"0.0"</span> /&gt;</span> <span class="comment">&lt;!-- 支架安装的x坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"support_y"</span> <span class="attr">value</span>=<span class="string">"0.0"</span> /&gt;</span> <span class="comment">&lt;!-- 支架安装的y坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"support_z"</span> <span class="attr">value</span>=<span class="string">"${base_length / 2 + support_length / 2}"</span> /&gt;</span> <span class="comment">&lt;!-- 支架安装的z坐标:底盘高度 / 2 + 支架高度 / 2  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"support"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${support_radius}"</span> <span class="attr">length</span>=<span class="string">"${support_length}"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"red"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.8 0.2 0.0 0.8"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"support2base_link"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"support"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"${support_x} ${support_y} ${support_z}"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 雷达属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"laser_length"</span> <span class="attr">value</span>=<span class="string">"0.05"</span> /&gt;</span> <span class="comment">&lt;!-- 雷达长度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"laser_radius"</span> <span class="attr">value</span>=<span class="string">"0.03"</span> /&gt;</span> <span class="comment">&lt;!-- 雷达半径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"laser_x"</span> <span class="attr">value</span>=<span class="string">"0.0"</span> /&gt;</span> <span class="comment">&lt;!-- 雷达安装的x坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"laser_y"</span> <span class="attr">value</span>=<span class="string">"0.0"</span> /&gt;</span> <span class="comment">&lt;!-- 雷达安装的y坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"laser_z"</span> <span class="attr">value</span>=<span class="string">"${support_length / 2 + laser_length / 2}"</span> /&gt;</span> <span class="comment">&lt;!-- 雷达安装的z坐标:支架高度 / 2 + 雷达高度 / 2  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 雷达关节以及link --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"laser"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${laser_radius}"</span> <span class="attr">length</span>=<span class="string">"${laser_length}"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"black"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"laser2support"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"support"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"laser"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"${laser_x} ${laser_y} ${laser_z}"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>组合底盘摄像头与雷达</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_car_camera"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组合小车底盘与摄像头与雷达 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"base.urdf.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"camera.urdf.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"laser.urdf.xacro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>launch 文件</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">command</span>=<span class="string">"$(find xacro)/xacro $(find urdf01_rviz)/urdf/xacro/combination.urdf.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span> = <span class="string">"rviz"</span> <span class="attr">type</span> = <span class="string">"rviz"</span> <span class="attr">name</span> = <span class="string">"rviz"</span> <span class="attr">args</span> = <span class="string">"-d $(find urdf01_rviz)/config/show_car.rviz"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  关节状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  机器人状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加控制关节运动的节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher_gui"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher_gui"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="Rviz控制运动"><a href="#Rviz控制运动" class="headerlink" title="Rviz控制运动"></a>Rviz控制运动</h3><p>Arbotix 是一款控制电机、舵机的控制板，并提供相应的 ros 功能包</p>
<p>这个功能包不仅可以驱动真实的 Arbotix 控制板，它还提供一个差速控制器，通过接受速度控制指令更新机器人的 joint 状态，从而帮助我们实现机器人在 rviz 中的运动</p>
<p>Arbotix使用流程：</p>
<ol>
<li>安装 Arbotix</li>
<li>创建新功能包，准备机器人 urdf、xacro 文件</li>
<li>添加 Arbotix 配置文件</li>
<li>编写 launch 文件配置 Arbotix</li>
<li>启动 launch 文件并控制机器人模型运动</li>
</ol>
<p><strong>安装 Arbotix</strong></p>
<p>方式1：命令行调用</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-&lt;&lt;VersionName()&gt;&gt;-arbotix</span><br><span class="line">sudo apt-get install ros-noetic-arbotix</span><br></pre></td></tr></tbody></table></figure>

<p>将 &lt;&lt;VsersionName()&gt;&gt; 替换成当前 ROS 版本名称，如果提示功能包无法定位，请采用方式2</p>
<p>方式2：源码安装</p>
<p>先从 github 下载源码，然后调用 catkin_make 编译</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/vanadiumlabs/arbotix_ros.git</span><br></pre></td></tr></tbody></table></figure>

<p><strong>创建新功能包，准备机器人 urdf、xacro</strong></p>
<p>urdf 和 xacro 调用上一讲实现即可</p>
<p><strong>添加 arbotix 所需的配置文件</strong></p>
<p>在config文件夹下增加文件<code>control.yaml</code></p>
<p>范本：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该文件是控制器配置,一个机器人模型可能有多个控制器，比如: 底盘、机械臂、夹持器(机械手)....</span></span><br><span class="line"><span class="comment"># 因此，根 name 是 controller</span></span><br><span class="line"><span class="attr">controllers:</span> {</span><br><span class="line">   <span class="comment"># 单控制器设置</span></span><br><span class="line">   <span class="attr">base_controller:</span> {</span><br><span class="line">          <span class="comment">#类型: 差速控制器</span></span><br><span class="line">       <span class="attr">type:</span> <span class="string">diff_controller</span>,</span><br><span class="line">       <span class="comment">#参考坐标(一般是根坐标系)</span></span><br><span class="line">       <span class="attr">base_frame_id:</span> <span class="string">base_footprint</span>, </span><br><span class="line">       <span class="comment">#两个轮子之间的间距</span></span><br><span class="line">       <span class="attr">base_width:</span> <span class="number">0.2</span>,</span><br><span class="line">       <span class="comment">#控制频率</span></span><br><span class="line">       <span class="attr">ticks_meter:</span> <span class="number">2000</span>, </span><br><span class="line">       <span class="comment">#PID控制参数，使机器人车轮快速达到预期速度</span></span><br><span class="line">       <span class="attr">Kp:</span> <span class="number">12</span>, </span><br><span class="line">       <span class="attr">Kd:</span> <span class="number">12</span>, </span><br><span class="line">       <span class="attr">Ki:</span> <span class="number">0</span>, </span><br><span class="line">       <span class="attr">Ko:</span> <span class="number">50</span>, </span><br><span class="line">       <span class="comment">#加速限制</span></span><br><span class="line">       <span class="attr">accel_limit:</span> <span class="number">1.0</span> </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>launch 文件中配置 arbotix 节点</strong></p>
<p>增添部分</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"arbotix"</span> <span class="attr">pkg</span>=<span class="string">"arbotix_python"</span> <span class="attr">type</span>=<span class="string">"arbotix_driver"</span> <span class="attr">output</span>=<span class="string">"screen"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find my_urdf05_rviz)/config/hello.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"sim"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>node 调用了 arbotix_python 功能包下的 arbotix_driver 节点</p>
</li>
<li><p>rosparam：arbotix 驱动机器人运行时，需要获取机器人信息，可以通过 file 加载配置文件</p>
</li>
<li><p>param：在仿真环境下，需要配置 sim 为 true</p>
</li>
</ul>
<p><strong>启动 launch 文件并控制机器人模型运动</strong></p>
<p>配置 rviz：</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/Snipaste_2025-06-15_19-48-15.webp" alt="Snipaste_2025-06-15_19-48-15" style="zoom: 50%;">

<p>控制小车运动：</p>
<p>发布 cmd_vel 话题消息控制小车运动</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic pub -r 10 /cmd_vel [TAB] [TAB]</span><br></pre></td></tr></tbody></table></figure>

<h3 id="URDF集成Gazebo"><a href="#URDF集成Gazebo" class="headerlink" title="URDF集成Gazebo"></a>URDF集成Gazebo</h3><h4 id="基本集成流程"><a href="#基本集成流程" class="headerlink" title="基本集成流程"></a>基本集成流程</h4><p><strong>创建功能包</strong></p>
<p>导入依赖包: urdf、xacro、gazebo_ros、gazebo_ros_control、gazebo_plugins</p>
<p><strong>编写URDF文件</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"mycar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.5 0.2 0.1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"yellow"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"1 1 0.0 0.5"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置碰撞参数 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果是标准几何物体,直接复制 visual 的 geometry 和 origin 即可--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.5 0.2 0.1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置惯性矩阵 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 相当于设置重心偏移,如果质量均匀基本就和关节一样 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 不同维度上的惯性值 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"1"</span> <span class="attr">ixy</span>=<span class="string">"0.0"</span> <span class="attr">ixz</span>=<span class="string">"0.0"</span> <span class="attr">iyy</span>=<span class="string">"1"</span> <span class="attr">iyz</span>=<span class="string">"0.0"</span> <span class="attr">izz</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- gzebo有自己的颜色设置标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span> =<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注意这里Gazobo和颜色首字母必须大写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Red<span class="tag">&lt;/<span class="name">material</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>当 URDF 需要与 Gazebo 集成时，和 Rviz 有明显区别：</p>
<p>1.必须使用 collision 标签，因为既然是仿真环境，那么必然涉及到碰撞检测，collision 提供碰撞检测的依据。</p>
<p>2.必须使用 inertial 标签，此标签标注了当前机器人某个刚体部分的惯性矩阵，用于一些力学相关的仿真计算。</p>
<p>3.颜色设置，也需要重新使用 gazebo 标签标注，因为之前的颜色设置为了方便调试包含透明度，仿真环境下没有此选项</p>
<p><strong>启动Gazebo并显示模型</strong></p>
<p>launch 文件实现</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将 Urdf 文件的内容加载到参数服务器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">textfile</span> = <span class="string">"$(find urdf02_gazebo)/urdf/demo01_helloworld.urdf"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动 gazebo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find gazebo_ros)/launch/empty_world.launch"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 在 gazebo 中显示机器人模型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"gazebo_ros"</span> <span class="attr">type</span>=<span class="string">"spawn_model"</span> <span class="attr">name</span>=<span class="string">"model"</span> <span class="attr">args</span>=<span class="string">"-urdf -model mycar -param robot_description"</span>  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>代码解释：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find gazebo_ros)/launch/empty_world.launch"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 启动 Gazebo 的仿真环境，当前环境为空环境 --&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"gazebo_ros"</span> <span class="attr">type</span>=<span class="string">"spawn_model"</span> <span class="attr">name</span>=<span class="string">"model"</span> <span class="attr">args</span>=<span class="string">"-urdf -model mycar -param robot_description"</span>  /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    在 Gazebo 中加载一个机器人模型，该功能由 gazebo_ros 下的 spawn_model 提供:</span></span><br><span class="line"><span class="comment">    -urdf 加载的是 urdf 文件</span></span><br><span class="line"><span class="comment">    -model mycar 模型名称是 mycar</span></span><br><span class="line"><span class="comment">    -param robot_description 从参数 robot_description 中载入模型</span></span><br><span class="line"><span class="comment">    -x 模型载入的 x 坐标</span></span><br><span class="line"><span class="comment">    -y 模型载入的 y 坐标</span></span><br><span class="line"><span class="comment">    -z 模型载入的 z 坐标</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="相关设置"><a href="#相关设置" class="headerlink" title="相关设置"></a>相关设置</h4><p>较之于 rviz，gazebo在集成 URDF 时，需要做些许修改</p>
<p>比如：必须添加 collision 碰撞属性相关参数、必须添加 inertial 惯性矩阵相关参数</p>
<p>另外，如果直接移植 Rviz 中机器人的颜色设置是没有显示的，颜色设置也必须做相应的变更</p>
<p><strong>collision</strong></p>
<p>如果机器人link是标准的几何体形状，和link的visual属性设置一致即可</p>
<p><strong>inertial</strong></p>
<p>惯性矩阵的设置需要结合link的质量与外形参数动态生成，标准的球体、圆柱与立方体的惯性矩阵公式如下(封装为 xacro 实现)：</p>
<p>球体惯性矩阵：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Macro for inertia matrix --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"sphere_inertial_matrix"</span> <span class="attr">params</span>=<span class="string">"m r"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"${m}"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"${2*m*r*r/5}"</span> <span class="attr">ixy</span>=<span class="string">"0"</span> <span class="attr">ixz</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">iyy</span>=<span class="string">"${2*m*r*r/5}"</span> <span class="attr">iyz</span>=<span class="string">"0"</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">izz</span>=<span class="string">"${2*m*r*r/5}"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>圆柱惯性矩阵：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"cylinder_inertial_matrix"</span> <span class="attr">params</span>=<span class="string">"m r h"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"${m}"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"${m*(3*r*r+h*h)/12}"</span> <span class="attr">ixy</span> = <span class="string">"0"</span> <span class="attr">ixz</span> = <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">iyy</span>=<span class="string">"${m*(3*r*r+h*h)/12}"</span> <span class="attr">iyz</span> = <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">izz</span>=<span class="string">"${m*r*r/2}"</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>立方体惯性矩阵：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"Box_inertial_matrix"</span> <span class="attr">params</span>=<span class="string">"m l w h"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"${m}"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"${m*(w*w + h*h)/12}"</span> <span class="attr">ixy</span> = <span class="string">"0"</span> <span class="attr">ixz</span> = <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">iyy</span>=<span class="string">"${m*(h*h + l*l)/12}"</span> <span class="attr">iyz</span>= <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">izz</span>=<span class="string">"${m*(l*l + w*w)/12}"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>原则上，除了 base_footprint 外，机器人的每个刚体部分都需要设置惯性矩阵，且惯性矩阵必须经计算得出，如果随意定义刚体部分的惯性矩阵，那么可能会导致机器人在 Gazebo 中出现抖动，移动等现象</p>
<p>在 gazebo 中显示 link 的颜色，必须要使用指定的标签</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"link节点名称"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Blue<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>material 标签中，设置的值区分大小写，颜色可以设置为 Red Blue Green Black</p>
<h4 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h4><p>需求描述：将之前的机器人模型(xacro版)显示在 gazebo 中</p>
<p>实现流程：</p>
<ol>
<li>需要编写封装惯性矩阵算法的 xacro 文件</li>
<li>为机器人模型中的每一个 link 添加 collision 和 inertial 标签，并且重置颜色属性</li>
<li>在 launch 文件中启动 gazebo 并添加机器人模型</li>
</ol>
<p><strong>编写封装惯性矩阵算法的 xacro 文件</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://www.ros.org/wiki/xacro"</span> <span class="attr">name</span>=<span class="string">"base"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Macro for inertia matrix --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"sphere_inertial_matrix"</span> <span class="attr">params</span>=<span class="string">"m r"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"${m}"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"${2*m*r*r/5}"</span> <span class="attr">ixy</span>=<span class="string">"0"</span> <span class="attr">ixz</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">iyy</span>=<span class="string">"${2*m*r*r/5}"</span> <span class="attr">iyz</span>=<span class="string">"0"</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">izz</span>=<span class="string">"${2*m*r*r/5}"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"cylinder_inertial_matrix"</span> <span class="attr">params</span>=<span class="string">"m r h"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"${m}"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"${m*(3*r*r+h*h)/12}"</span> <span class="attr">ixy</span> = <span class="string">"0"</span> <span class="attr">ixz</span> = <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">iyy</span>=<span class="string">"${m*(3*r*r+h*h)/12}"</span> <span class="attr">iyz</span> = <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">izz</span>=<span class="string">"${m*r*r/2}"</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"Box_inertial_matrix"</span> <span class="attr">params</span>=<span class="string">"m l w h"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"${m}"</span> /&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"${m*(w*w + h*h)/12}"</span> <span class="attr">ixy</span> = <span class="string">"0"</span> <span class="attr">ixz</span> = <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">iyy</span>=<span class="string">"${m*(h*h + l*l)/12}"</span> <span class="attr">iyz</span>= <span class="string">"0"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">izz</span>=<span class="string">"${m*(l*l + w*w)/12}"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>复制相关 xacro 文件，并设置 collision inertial 以及 color 等参数</strong></p>
<p>将上一节的xacro文件复制一份进行修改</p>
<p>以底盘为例：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">...  </span><br><span class="line">	<span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"base_mass"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加底盘 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${base_radius}"</span> <span class="attr">length</span>=<span class="string">"${base_length}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${base_radius}"</span> <span class="attr">length</span>=<span class="string">"${base_length}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 调用惯性矩阵函数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xacro:cylinder_inertial_matrix</span> <span class="attr">m</span>=<span class="string">"${base_mass}"</span> <span class="attr">r</span>=<span class="string">"${base_radius}"</span> <span class="attr">h</span>=<span class="string">"${base_length}"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Yellow<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">    <span class="comment">&lt;!-- 驱动轮属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"wheel_mass"</span> <span class="attr">value</span>=<span class="string">"0.05"</span> /&gt;</span><span class="comment">&lt;!-- 质量 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 驱动轮宏 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        direction: left or right</span></span><br><span class="line"><span class="comment">        flag: 1 or -1</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span> = <span class="string">"wheel_func"</span> <span class="attr">params</span>=<span class="string">"direction flag"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"${direction}_wheel"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${wheel_radius}"</span> <span class="attr">length</span>=<span class="string">"${wheel_length}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"${flag*PI/2} 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"${wheel_radius}"</span> <span class="attr">length</span>=<span class="string">"${wheel_length}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"${flag*PI/2} 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xacro:cylinder_inertial_matrix</span> <span class="attr">m</span>=<span class="string">"${wheel_mass}"</span> <span class="attr">r</span>=<span class="string">"${wheel_radius}"</span> <span class="attr">h</span>=<span class="string">"${wheel_length}"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"${direction}_wheel"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Red<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:wheel_func</span> <span class="attr">direction</span>=<span class="string">"left"</span> <span class="attr">flag</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:wheel_func</span> <span class="attr">direction</span>=<span class="string">"right"</span> <span class="attr">flag</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line">...</span><br><span class="line">    <span class="comment">&lt;!-- 万向轮属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span> = <span class="string">"support_wheel_mass"</span> <span class="attr">value</span> =<span class="string">"0.01"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 万向轮(支撑轮)宏 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span> = <span class="string">"add_support_wheel"</span> <span class="attr">params</span>=<span class="string">"direction flag"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"${direction}_wheel"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"${support_wheel_radius}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"${support_wheel_radius}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.0 0.0 0.0"</span> <span class="attr">rpy</span>=<span class="string">"0.0 0.0 0.0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xacro:sphere_inertial_matrix</span> <span class="attr">m</span>=<span class="string">"${support_wheel_mass}"</span> <span class="attr">r</span>=<span class="string">"${support_wheel_radius}"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"${direction}_wheel"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Red<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:add_support_wheel</span> <span class="attr">direction</span>=<span class="string">"front"</span> <span class="attr">flag</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:add_support_wheel</span> <span class="attr">direction</span>=<span class="string">"back"</span> <span class="attr">flag</span>=<span class="string">"-1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>主要删除原有visual下的material标签，然后在link标签内增加collision标签以及调用惯性矩阵函数，在link标签外使用gazebo下的material附加颜色</p>
<p>如果机器人模型在 Gazebo 中产生了抖动，滑动，缓慢位移诸如此类情况，需要考虑：</p>
<ol>
<li>惯性矩阵是否设置了，且设置是否正确合理</li>
<li>车轮翻转需要依赖于 PI 值，如果 PI 值精度偏低，也可能导致上述情况产生</li>
</ol>
<p>同理修改camera和laser，具体代码不附</p>
<h4 id="仿真环境搭建"><a href="#仿真环境搭建" class="headerlink" title="仿真环境搭建"></a>仿真环境搭建</h4><p>到目前为止，我们已经可以将机器人模型显示在 Gazebo 之中了，但是当前默认情况下，在 Gazebo 中机器人模型是在 empty world 中，并没有类似于房间、家具、道路、树木… 之类的仿真物</p>
<p>Gazebo 中创建仿真实现方式有两种：</p>
<ul>
<li>方式1: 直接添加内置组件创建仿真环境</li>
<li>方式2: 手动绘制仿真环境(更为灵活)</li>
</ul>
<p>也还可以直接下载使用官方或第三方提高的仿真环境插件</p>
<p>将之前下载的资源中box_house.world移动到当前功能包目录下的worlds文件夹中</p>
<p>改写launch文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">command</span>=<span class="string">"$(find xacro)/xacro $(find urdf02_gazebo)/urdf/xacro/combination.urdf.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动 gazebo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find gazebo_ros)/launch/empty_world.launch"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"world_name"</span> <span class="attr">value</span>=<span class="string">"$(find urdf02_gazebo)/worlds/box_house.world"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 在 gazebo 中显示机器人模型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"gazebo_ros"</span> <span class="attr">type</span>=<span class="string">"spawn_model"</span> <span class="attr">name</span>=<span class="string">"model"</span> <span class="attr">args</span>=<span class="string">"-urdf -model mycar -param robot_description"</span>  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>核心代码：启动 empty_world 后，再根据<code>arg</code>加载自定义的仿真环境</p>
<p>注意，<font color="Violetred">arg的name固定，只能是<code>world_name</code></font></p>
<p>当前 Gazebo 提供的仿真道具有限，还可以下载官方支持，可以提供更为丰富的仿真实现</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/osrf/gazebo_models</span><br></pre></td></tr></tbody></table></figure>

<p>将得到的gazebo_models文件夹内容复制到 /usr/share/gazebo-*/models</p>
<p>重启 Gazebo，选择左侧菜单栏的 insert 可以选择并插入相关道具了</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun gazebo_ros gazebo</span><br></pre></td></tr></tbody></table></figure>

<h3 id="URDF、Gazebo与Rviz综合应用"><a href="#URDF、Gazebo与Rviz综合应用" class="headerlink" title="URDF、Gazebo与Rviz综合应用"></a>URDF、Gazebo与Rviz综合应用</h3><p>本节中大量配置文件来源于官方网站，但是网站已经更新到ROS2了，可能有的直接复制教程里面的了</p>
<h4 id="机器人运动控制"><a href="#机器人运动控制" class="headerlink" title="机器人运动控制"></a>机器人运动控制</h4><p>gazebo 中已经可以正常显示机器人模型了，那么如何像在 rviz 中一样控制机器人运动呢？</p>
<p>需要涉及到ros中的组件：ros_control</p>
<p>ros_control 是一组软件包，它包含了控制器接口，控制器管理器，传输和硬件接口</p>
<p>ros_control 是一套规范，不同的机器人平台只要按照这套规范实现，那么就可以保证与ROS 程序兼容，通过这套规范，实现了一种可插拔的架构设计，大大提高了程序设计的效率与灵活性</p>
<p>运动控制实现流程Gazebo：</p>
<ol>
<li>编写一个单独的 xacro 文件，为机器人模型添加传动装置以及控制器</li>
<li>将此文件集成进xacro文件</li>
<li>启动 Gazebo 并发布 /cmd_vel 消息控制机器人运动</li>
</ol>
<p>为 joint 添加传动装置以及控制器：</p>
<p>新建 Xacro 文件，配置两轮差速：(直接复制)</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_car_move"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 传动实现:用于连接控制器与关节 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"joint_trans"</span> <span class="attr">params</span>=<span class="string">"joint_name"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Transmission is important to link the joints and the controller --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transmission</span> <span class="attr">name</span>=<span class="string">"${joint_name}_trans"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>transmission_interface/SimpleTransmission<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"${joint_name}"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardware_interface/VelocityJointInterface<span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">actuator</span> <span class="attr">name</span>=<span class="string">"${joint_name}_motor"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardware_interface/VelocityJointInterface<span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mechanicalReduction</span>&gt;</span>1<span class="tag">&lt;/<span class="name">mechanicalReduction</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">actuator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">transmission</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 每一个驱动轮都需要配置传动装置 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 需要修改的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:joint_trans</span> <span class="attr">joint_name</span>=<span class="string">"left_wheel2base_link"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:joint_trans</span> <span class="attr">joint_name</span>=<span class="string">"right_wheel2base_link"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">"differential_drive_controller"</span> <span class="attr">filename</span>=<span class="string">"libgazebo_ros_diff_drive.so"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rosDebugLevel</span>&gt;</span>Debug<span class="tag">&lt;/<span class="name">rosDebugLevel</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">publishWheelTF</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publishWheelTF</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">robotNamespace</span>&gt;</span>/<span class="tag">&lt;/<span class="name">robotNamespace</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">publishTf</span>&gt;</span>1<span class="tag">&lt;/<span class="name">publishTf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">publishWheelJointState</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publishWheelJointState</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">alwaysOn</span>&gt;</span>true<span class="tag">&lt;/<span class="name">alwaysOn</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">updateRate</span>&gt;</span>100.0<span class="tag">&lt;/<span class="name">updateRate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">legacyMode</span>&gt;</span>true<span class="tag">&lt;/<span class="name">legacyMode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">leftJoint</span>&gt;</span>left_wheel2base_link<span class="tag">&lt;/<span class="name">leftJoint</span>&gt;</span> <span class="comment">&lt;!-- 左轮 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rightJoint</span>&gt;</span>right_wheel2base_link<span class="tag">&lt;/<span class="name">rightJoint</span>&gt;</span> <span class="comment">&lt;!-- 右轮 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">wheelSeparation</span>&gt;</span>${base_link_radius * 2}<span class="tag">&lt;/<span class="name">wheelSeparation</span>&gt;</span> <span class="comment">&lt;!-- 车轮间距 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">wheelDiameter</span>&gt;</span>${wheel_radius * 2}<span class="tag">&lt;/<span class="name">wheelDiameter</span>&gt;</span> <span class="comment">&lt;!-- 车轮直径 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">broadcastTF</span>&gt;</span>1<span class="tag">&lt;/<span class="name">broadcastTF</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">wheelTorque</span>&gt;</span>30<span class="tag">&lt;/<span class="name">wheelTorque</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">wheelAcceleration</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">wheelAcceleration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">commandTopic</span>&gt;</span>cmd_vel<span class="tag">&lt;/<span class="name">commandTopic</span>&gt;</span> <span class="comment">&lt;!-- 运动控制话题 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">odometryFrame</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometryFrame</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">odometryTopic</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometryTopic</span>&gt;</span> <span class="comment">&lt;!-- 里程计话题 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">robotBaseFrame</span>&gt;</span>base_footprint<span class="tag">&lt;/<span class="name">robotBaseFrame</span>&gt;</span> <span class="comment">&lt;!-- 根坐标系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>将上述 xacro 文件集成进总的机器人模型xacro文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_car_camera"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 包含惯性矩阵 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"head.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组合小车底盘与摄像头与雷达 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"base.urdf.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"camera.urdf.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"laser.urdf.xacro"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运动控制 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"$(find urdf02_gazebo)/urdf/gazebo/move.xacro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>launch文件不变（先启动gazebo虚拟环境，再启动rviz）</p>
<p>使用命令控制小车运动</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun teleop_twist_keyboard  teleop_twist_keyboard.py</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Rviz查看里程计信息"><a href="#Rviz查看里程计信息" class="headerlink" title="Rviz查看里程计信息"></a>Rviz查看里程计信息</h4><p>里程计：利用从移动传感器获得的数据来估计物体位置随时间的变化而改变的方法</p>
<p>启动 Rviz（<font color="Violetred">记住一定是带上两个状态发布节点一起</font>）</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span> = <span class="string">"rviz"</span> <span class="attr">type</span> = <span class="string">"rviz"</span> <span class="attr">name</span> = <span class="string">"rviz"</span> <span class="attr">args</span> = <span class="string">"-d $(find urdf01_rviz)/config/show_car.rviz"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  关节状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  机器人状态发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>执行 launch 文件后，在 Rviz 中添加图示组件：</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/21_Rviz显示里程计数据.webp" alt="21_Rviz显示里程计数据" style="zoom: 50%;">

<h4 id="雷达信息仿真"><a href="#雷达信息仿真" class="headerlink" title="雷达信息仿真"></a>雷达信息仿真</h4><p>雷达仿真基本流程:</p>
<ol>
<li>已经创建完毕的机器人模型，编写一个单独的 xacro 文件，为机器人模型添加雷达配置；</li>
<li>将此文件集成进xacro文件；</li>
<li>启动 Gazebo，使用 Rviz 显示雷达信息。</li>
</ol>
<p>新建 Xacro 文件，配置雷达传感器信息：(直接复制)</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_sensors"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 雷达 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"laser"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sensor</span> <span class="attr">type</span>=<span class="string">"ray"</span> <span class="attr">name</span>=<span class="string">"rplidar"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">pose</span>&gt;</span>0 0 0 0 0 0<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">visualize</span>&gt;</span>true<span class="tag">&lt;/<span class="name">visualize</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">update_rate</span>&gt;</span>5.5<span class="tag">&lt;/<span class="name">update_rate</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ray</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scan</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 雷达参数 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">horizontal</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 采样个数,与仿真压力挂钩 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">samples</span>&gt;</span>360<span class="tag">&lt;/<span class="name">samples</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">resolution</span>&gt;</span>1<span class="tag">&lt;/<span class="name">resolution</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 采样弧度范围 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">min_angle</span>&gt;</span>-3<span class="tag">&lt;/<span class="name">min_angle</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max_angle</span>&gt;</span>3<span class="tag">&lt;/<span class="name">max_angle</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">horizontal</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">scan</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 采样距离范围 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">range</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">min</span>&gt;</span>0.10<span class="tag">&lt;/<span class="name">min</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">max</span>&gt;</span>30.0<span class="tag">&lt;/<span class="name">max</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 距离精度 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resolution</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">resolution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">range</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 仿真噪声 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">noise</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">type</span>&gt;</span>gaussian<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">mean</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">mean</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">stddev</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">stddev</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">noise</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ray</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">"gazebo_rplidar"</span> <span class="attr">filename</span>=<span class="string">"libgazebo_ros_laser.so"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">topicName</span>&gt;</span>/scan<span class="tag">&lt;/<span class="name">topicName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">frameName</span>&gt;</span>laser<span class="tag">&lt;/<span class="name">frameName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sensor</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>gazebo reference / frameName 这两个位置的名称和定义雷达的link名称需要相同</p>
<p>集成到总的xacro 文件中：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_car_camera"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- 雷达 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"$(find urdf02_gazebo)/urdf/gazebo/laser.xacro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>launch文件不变，先启动gazebo再启动rviz</p>
<p>添加雷达信息显示插件</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/雷达仿真2.webp" alt="雷达仿真2" style="zoom: 50%;">

<h4 id="摄像头信息仿真"><a href="#摄像头信息仿真" class="headerlink" title="摄像头信息仿真"></a>摄像头信息仿真</h4><p>步骤类似雷达</p>
<p>新建 Xacro 文件，配置摄像头传感器信息：(直接复制)</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_sensors"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 被引用的link --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"camera"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 类型设置为 camara --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sensor</span> <span class="attr">type</span>=<span class="string">"camera"</span> <span class="attr">name</span>=<span class="string">"camera_node"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">update_rate</span>&gt;</span>30.0<span class="tag">&lt;/<span class="name">update_rate</span>&gt;</span> <span class="comment">&lt;!-- 更新频率 --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 摄像头基本信息设置 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">camera</span> <span class="attr">name</span>=<span class="string">"head"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">horizontal_fov</span>&gt;</span>1.3962634<span class="tag">&lt;/<span class="name">horizontal_fov</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">width</span>&gt;</span>1280<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">height</span>&gt;</span>720<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">format</span>&gt;</span>R8G8B8<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">clip</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">near</span>&gt;</span>0.02<span class="tag">&lt;/<span class="name">near</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">far</span>&gt;</span>300<span class="tag">&lt;/<span class="name">far</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">clip</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">noise</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">type</span>&gt;</span>gaussian<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">mean</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">mean</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">stddev</span>&gt;</span>0.007<span class="tag">&lt;/<span class="name">stddev</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">noise</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">camera</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 核心插件 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">"gazebo_camera"</span> <span class="attr">filename</span>=<span class="string">"libgazebo_ros_camera.so"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">alwaysOn</span>&gt;</span>true<span class="tag">&lt;/<span class="name">alwaysOn</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">updateRate</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">updateRate</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为话题设置一个命名空间 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cameraName</span>&gt;</span>/camera<span class="tag">&lt;/<span class="name">cameraName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">imageTopicName</span>&gt;</span>image_raw<span class="tag">&lt;/<span class="name">imageTopicName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cameraInfoTopicName</span>&gt;</span>camera_info<span class="tag">&lt;/<span class="name">cameraInfoTopicName</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- link名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">frameName</span>&gt;</span>camera<span class="tag">&lt;/<span class="name">frameName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hackBaseline</span>&gt;</span>0.07<span class="tag">&lt;/<span class="name">hackBaseline</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distortionK1</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortionK1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distortionK2</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortionK2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distortionK3</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortionK3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distortionT1</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortionT1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">distortionT2</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortionT2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sensor</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>集成到总的xacro文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_car_camera"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- 摄像头 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"$(find urdf02_gazebo)/urdf/gazebo/camera.xacro"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>launch文件不变，先启动gazebo再启动rviz</p>
<p>在 Rviz 中添加摄像头组件</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/摄像头仿真3.webp" alt="摄像头仿真3" style="zoom:50%;">

<h4 id="kinect信息仿真"><a href="#kinect信息仿真" class="headerlink" title="kinect信息仿真"></a>kinect信息仿真</h4><p>kinect是深度信息摄像头</p>
<p>步骤类似上述</p>
<p>新建 Xacro 文件，配置 kinetic传感器信息(直接复制)：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_sensors"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"kinect link名称"</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">sensor</span> <span class="attr">type</span>=<span class="string">"depth"</span> <span class="attr">name</span>=<span class="string">"camera"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">always_on</span>&gt;</span>true<span class="tag">&lt;/<span class="name">always_on</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">update_rate</span>&gt;</span>20.0<span class="tag">&lt;/<span class="name">update_rate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">camera</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">horizontal_fov</span>&gt;</span>${60.0*PI/180.0}<span class="tag">&lt;/<span class="name">horizontal_fov</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">format</span>&gt;</span>R8G8B8<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">width</span>&gt;</span>640<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">height</span>&gt;</span>480<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">clip</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">near</span>&gt;</span>0.05<span class="tag">&lt;/<span class="name">near</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">far</span>&gt;</span>8.0<span class="tag">&lt;/<span class="name">far</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">clip</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">camera</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">"kinect_camera_controller"</span> <span class="attr">filename</span>=<span class="string">"libgazebo_ros_openni_kinect.so"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">cameraName</span>&gt;</span>camera<span class="tag">&lt;/<span class="name">cameraName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">alwaysOn</span>&gt;</span>true<span class="tag">&lt;/<span class="name">alwaysOn</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">updateRate</span>&gt;</span>10<span class="tag">&lt;/<span class="name">updateRate</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">imageTopicName</span>&gt;</span>rgb/image_raw<span class="tag">&lt;/<span class="name">imageTopicName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">depthImageTopicName</span>&gt;</span>depth/image_raw<span class="tag">&lt;/<span class="name">depthImageTopicName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">pointCloudTopicName</span>&gt;</span>depth/points<span class="tag">&lt;/<span class="name">pointCloudTopicName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">cameraInfoTopicName</span>&gt;</span>rgb/camera_info<span class="tag">&lt;/<span class="name">cameraInfoTopicName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">depthImageCameraInfoTopicName</span>&gt;</span>depth/camera_info<span class="tag">&lt;/<span class="name">depthImageCameraInfoTopicName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">frameName</span>&gt;</span>kinect link名称<span class="tag">&lt;/<span class="name">frameName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">baseline</span>&gt;</span>0.1<span class="tag">&lt;/<span class="name">baseline</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">distortion_k1</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortion_k1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">distortion_k2</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortion_k2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">distortion_k3</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortion_k3</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">distortion_t1</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortion_t1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">distortion_t2</span>&gt;</span>0.0<span class="tag">&lt;/<span class="name">distortion_t2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">pointCloudCutoff</span>&gt;</span>0.4<span class="tag">&lt;/<span class="name">pointCloudCutoff</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">sensor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以把上一步camera的xacro注释掉，把camera换成kinect</p>
<p>集成到总的xacro 文件中：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_car_camera"</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wiki.ros.org/xacro"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- 摄像头 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;xacro:include filename="$(find urdf02_gazebo)/urdf/gazebo/camera.xacro"/&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- kinect --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"$(find urdf02_gazebo)/urdf/gazebo/kinect.xacro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>launch文件不变，先启动gazebo再启动rviz</p>
<p>kinect 点云数据显示：</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/点云数据_默认.webp" alt="点云数据_默认" style="zoom:50%;">

<p>但在rviz中显示时错位</p>
<p>原因：在kinect中图像数据与点云数据使用了两套坐标系统，且两套坐标系统位姿并不一致</p>
<p>在插件中为kinect设置坐标系，修改配置文件的<code>&lt;frameName&gt;</code>标签内容</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">frameName</span>&gt;</span>camera_depth<span class="tag">&lt;/<span class="name">frameName</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>发布新设置的坐标系到kinect连杆的坐标变换关系，在启动rviz的launch中，添加</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加点云坐标系到kinect坐标系的变化=换  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"tf2_ros"</span> <span class="attr">type</span>=<span class="string">"static_transform_publisher"</span> <span class="attr">name</span>=<span class="string">"static_transform_publisher"</span> <span class="attr">args</span> =<span class="string">" 0 0 0 -1.57 0 -1.57 /camera /camera_depth"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>为什么是-1.57：逆着轴方向看逆时针旋转为正</p>
<p>启动rviz，重新显示</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本章主要介绍了ROS中仿真实现涉及的三大知识点：</p>
<ul>
<li>URDF(Xacro)</li>
<li>Rviz</li>
<li>Gazebo</li>
</ul>
<p>URDF 是用于描述机器人模型的 xml 文件，可以使用不同的标签具代表不同含义，URDF 编写机器人模型代码冗余，xacro 可以优化 URDF 实现，代码实现更为精简、高效、易读</p>
<p>rviz需要<strong>已有数据</strong>，强调把已有的数据可视化显示</p>
<p>rviz提供了很多插件，这些插件可以显示图像、模型、路径等信息，但是前提都是这些数据已经以话题、参数的形式发布，rviz做的事情就是订阅这些数据，并完成可视化的渲染</p>
<p>gazebo是<strong>三维物理仿真平台</strong>，创建虚拟的仿真环境，**不需要数据，而是创造数据，**不仅可以仿真机器人的运动功能，还可以仿真机器人的传感器数据</p>
<h2 id="机器人导航-仿真"><a href="#机器人导航-仿真" class="headerlink" title="机器人导航(仿真)"></a>机器人导航(仿真)</h2><p>导航是机器人系统中最重要的模块之一</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>在ROS中机器人导航(Navigation)由多个功能包组合实现，ROS 中又称之为导航功能包集</p>
<p>关于导航模块，官方介绍：一个二维导航堆栈，它接收来自里程计、传感器流和目标姿态的信息，并输出发送到移动底盘的安全速度命令</p>
<p>ROS 中导航相关的功能包集为机器人导航提供了一套通用的实现，开发者不再需要关注于导航算法、硬件交互等偏复杂、偏底层的实现，这些实现都由更专业的研发人员管理、迭代和维护，开发者可以更专注于上层功能，而对于导航功能的调用，只需要根据自身机器人相关参数合理设置各模块的配置文件即可</p>
<blockquote>
<p>简而言之调参</p>
</blockquote>
<h4 id="导航模块简介"><a href="#导航模块简介" class="headerlink" title="导航模块简介"></a>导航模块简介</h4><p>ROS 官方为了提供了一张导航功能包集的图示，该图中囊括了 ROS 导航的一些关键技术：</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/02_导航官方架构.webp" alt="02_导航官方架构" style="zoom: 80%;">

<p>这个图的解读：</p>
<p>先看图例：</p>
<ul>
<li>provided node：必须节点</li>
<li>optional provided node：可选择节点</li>
<li>platform specific node：平台相关节点</li>
</ul>
<p>外部数据输入：</p>
<ul>
<li><strong>map_server</strong>：读取或发布静态环境地图（occupancy grid），供全局规划器和代价地图使用</li>
<li><strong>sensor sources</strong>：各类传感器数据（激光雷达、深度相机等），用于构建局部环境的代价地图</li>
<li><strong>odometry source</strong>：里程计数据（车轮编码器、惯导等），提供机器人相对运动信息</li>
<li><strong>amcl</strong>：自适应 Monte‑Carlo 本地化（Adaptive Monte Carlo Localization），结合传感器与地图给出机器人在地图中的全局位姿</li>
<li><strong>sensor transforms</strong>：TF 数 据，负责把各个传感器坐标系和机器人基座（base_link）坐标系对齐</li>
</ul>
<p>move_base 核心：</p>
<ul>
<li><strong>global_costmap</strong>：用静态地图（map_server）以及部分传感器数据（静态障碍）构建的全局代价栅格（occupancy grid），主要用于规划从当前位置到目标位置的全局路径</li>
<li><strong>global_planner</strong>：基于 <code>global_costmap</code> 和 <code>amcl</code> 提供的位姿，运行 A*、Dijkstra 或 Navfn 等算法，生成一条从起点到目标点的全局路径</li>
<li><strong>local_costmap</strong>：动态地整合传感器实时数据，构建机器人周围的局部代价栅格，用于避障</li>
<li><strong>local_planner</strong>：接收全局路径（waypoints）和 <code>local_costmap</code>，生成实际的速度命令（线速度、角速度）给底层运动控制器（base controller），在避障的同时跟踪全局路径</li>
<li><strong>recovery_behaviors</strong>：当局部规划失败（如被障碍物完全包围、无法前进）时，触发恢复行为：比如向后退、旋转扫描、清空局部地图等，尝试脱困</li>
</ul>
<p>底层执行：</p>
<ul>
<li><strong>base controller</strong>：接收 <code>local_planner</code> 输出的速度指令，驱动机器人底盘（电机、差分驱动或者四轮全向等）去移动</li>
</ul>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/Snipaste_2025-06-21_16-22-29.jpg" alt="Snipaste_2025-06-21_16-22-29" style="zoom:80%;">

<p>总结下来，涉及的关键技术有如下五点:</p>
<ol>
<li>全局地图</li>
<li>自身定位</li>
<li>路径规划</li>
<li>运动控制</li>
<li>环境感知</li>
</ol>
<p>机器人导航实现与无人驾驶类似，关键技术也是由上述五点组成，只是无人驾驶是基于室外的，而当前介绍的机器人导航更多是基于室内的</p>
<p><strong>全局地图</strong>：</p>
<ol>
<li><strong>SLAM</strong>(simultaneous localization and mapping)，也称为CML (Concurrent Mapping and Localization)，即时定位与地图构建</li>
<li>SLAM问题：机器人在未知环境中从一个未知位置开始移动,在移动过程中根据位置估计和地图进行自身定位，同时在自身定位的基础上建造增量式地图，以绘制出外部环境的完全地图</li>
<li>如果要完成 SLAM ，机器人必须要具备感知外界环境的能力，尤其是要具备获取周围环境深度信息的能力。感知的实现需要依赖于传感器，比如：激光雷达、摄像头、RGB-D摄像头…</li>
<li>SLAM 可以用于地图生成，而生成的地图还需要被保存以待后续使用，在 ROS 中保存地图的功能包是 map_server</li>
</ol>
<p>SLAM 虽然是机器人导航的重要技术之一，但是二者并不等价，确切的讲，SLAM 只是实现地图构建和即时定位</p>
<p><strong>自身定位</strong>：</p>
<p>导航开始和过程中，机器人都需要确定当前自身的位置</p>
<p>如果在室外，那么 GPS 是一个不错的选择，而如果室内、隧道、地下或一些特殊的屏蔽 GPS 信号的区域，由于 GPS 信号弱化甚至完全不可用，那么就必须另辟蹊径了</p>
<p>前面提到的 SLAM 就可以实现自身定位，除此之外，ROS 中还提供了一个用于定位的功能包：amcl (ROS1/Ros2 经典实现已经老化与不够鲁棒)</p>
<p><strong>路径规划：</strong></p>
<p>在 ROS 中提供了 move_base 包来实现路径规则，该功能包主要由两大规划器组成：</p>
<ol>
<li><p>全局路径规划(gloable_planner)</p>
<p>根据给定的目标点和全局地图实现总体的路径规划，使用 Dijkstra 或 A* 算法进行全局路径规划，计算最优路线，作为全局路线</p>
</li>
<li><p>本地时时规划(local_planner)</p>
<p>在实际导航过程中，机器人可能无法按照给定的全局最优路线运行，本地规划的作用就是使用一定算法(Dynamic Window Approaches) 来实现障碍物的规避，并选取当前最优路径以尽量符合全局最优路径</p>
</li>
</ol>
<p><strong>运动控制</strong>：</p>
<p>导航功能包集假定通过话题”cmd_vel”发布<code>geometry_msgs/Twist</code>类型的消息，这个消息基于机器人的基坐标系，传递的是运动命令。这意味着必须有一个节点订阅”cmd_vel”话题，将该话题上的速度命令转换为电机命令并发送</p>
<h4 id="导航之坐标系"><a href="#导航之坐标系" class="headerlink" title="导航之坐标系"></a>导航之坐标系</h4><p>定位实现需要依赖于机器人自身，机器人需要逆向推导参考系原点并计算坐标系相对关系，该过程实现常用方式有两种：</p>
<ul>
<li>通过里程计定位：时时收集机器人的速度信息计算并发布机器人坐标系与父级参考系的相对关系</li>
<li>通过传感器定位：通过传感器收集外界环境信息通过匹配计算并发布机器人坐标系与父级参考系的相对关系</li>
</ul>
<p>两种定位方式都有各自的优缺点</p>
<p>里程计定位:</p>
<ul>
<li>优点：里程计定位信息是连续的，没有离散的跳跃</li>
<li>缺点：里程计存在<font color="Violetred">累计误差</font>，不利于长距离或长期定位</li>
</ul>
<p>传感器定位:</p>
<ul>
<li>优点：比里程计定位更精准；</li>
<li>缺点：传感器定位会出现跳变的情况，且传感器定位在标志物较少的环境下，其定位精度会大打折扣</li>
</ul>
<p><strong>坐标系变换</strong>：</p>
<p>上述两种定位实现中，机器人坐标系一般使用机器人模型中的根坐标系(base_link 或 base_footprint)</p>
<ul>
<li>里程计定位时，父级坐标系一般称之为 odom</li>
<li>传感器定位时，父级参考系一般称之为 map</li>
</ul>
<p>当二者结合使用时，map 和 odom 都是机器人模型根坐标系的父级，这是不符合坐标变换中”单继承”的原则的</p>
<p>一般会将转换关系设置为：<font color="Violetred">map -&gt; odom -&gt; base_link 或 base_footprint</font></p>
<blockquote>
<p>因为map一般精度更高</p>
</blockquote>
<h4 id="导航条件说明"><a href="#导航条件说明" class="headerlink" title="导航条件说明"></a>导航条件说明</h4><p><strong>硬件</strong></p>
<p>虽然导航功能包集被设计成尽可能的通用，在使用时仍然有三个主要的硬件限制：</p>
<ol>
<li>它是为差速驱动的轮式机器人设计的。它假设底盘受到理想的运动命令的控制并可实现预期的结果，命令的格式为：x速度分量，y速度分量，$\theta$分量</li>
<li>它需要在底盘上安装一个单线激光雷达，这个激光雷达用于构建地图和定位</li>
<li>导航功能包集是为正方形的机器人开发的，所以<font color="Violetred">方形或圆形的机器人将是性能最好的</font>。 它也可以工作在任意形状和大小的机器人上，但是较大的机器人将很难通过狭窄的空间</li>
</ol>
<p><strong>软件</strong></p>
<p>在仿真环境下，机器人可以正常接收 /cmd_vel 消息，并发布里程计消息，传感器消息发布也正常，也即导航模块中的运动控制和环境感知实现完毕</p>
<p>主要关注于: 使用 SLAM 绘制地图、地图服务、自身定位与路径规划</p>
<h3 id="导航实现"><a href="#导航实现" class="headerlink" title="导航实现"></a>导航实现</h3><p><strong>准备工作</strong></p>
<p>先安装相关的ROS功能包：</p>
<ul>
<li><p>安装 gmapping 包(用于构建地图)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-noetic-gmapping</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>安装地图服务包(用于保存与读取地图)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-noetic-map-server</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>安装 navigation 包(用于定位以及路径规划)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-noetic-navigation</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<p>安装map-server时会出现错误，提示：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">有一些软件包无法被安装。如果您用的是 unstable 发行版，这也许是</span><br><span class="line">因为系统无法达到您要求的状态造成的。该版本中可能会有一些您需要的软件</span><br><span class="line">包尚未被创建或是它们已被从新到(Incoming)目录移出。</span><br><span class="line">下列信息可能会对解决问题有所帮助：</span><br><span class="line"></span><br><span class="line">下列软件包有未满足的依赖关系：</span><br><span class="line"> ros-noetic-map-server : 依赖: libsdl-image1.2-dev 但是它将不会被安装</span><br><span class="line">                         依赖: libsdl1.2-dev 但是它将不会被安装</span><br><span class="line">E: 无法修正错误，因为您要求某些软件包保持现状，就是它们破坏了软件包间的依赖关系</span><br></pre></td></tr></tbody></table></figure>

<p>需要通过降级兼容，安装 <code>aptitude</code> 工具</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install aptitude</span><br><span class="line">sudo aptitude install libsdl-image1.2-dev libsdl1.2-dev</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>选择 n y y</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_78615366/article/details/135299929">ROS安装软件包有未满足的依赖关系应如何解决</a></p>
</blockquote>
<p>新建功能包，并导入依赖: gmapping map_server amcl move_base</p>
<blockquote>
<p>因为不需要编码，roscpp rospy可以不导入</p>
</blockquote>
<h4 id="SLAM建图"><a href="#SLAM建图" class="headerlink" title="SLAM建图"></a>SLAM建图</h4><p>SLAM算法有多种，当前选用gmapping</p>
<p>gmapping可以根据移动机器人里程计数据和激光雷达数据来绘制二维的栅格地图</p>
<p>gmapping 功能包中的核心节点是 slam_gmapping</p>
<p><strong>节点内容</strong></p>
<p>订阅的Topic：</p>
<ul>
<li>tf (tf/tfMessage) ：用于雷达、底盘与里程计之间的坐标变换消息</li>
<li>scan(sensor_msgs/LaserScan)：SLAM所需的雷达信息</li>
</ul>
<p>发布的Topic：</p>
<ul>
<li>map_metadata(nav_msgs/MapMetaData)：地图元数据，包括地图的宽度、高度、分辨率等，该消息会固定更新</li>
<li>map(nav_msgs/OccupancyGrid)：地图栅格数据，一般会在rviz中以图形化的方式显示</li>
<li>~entropy(std_msgs/Float64)：机器人姿态分布熵估计(值越大，不确定性越大)</li>
</ul>
<blockquote>
<p>注意，~代表私有，具体见基础知识部分的名称重名</p>
</blockquote>
<p>服务：</p>
<ul>
<li>dynamic_map(nav_msgs/GetMap)：用于获取地图数据</li>
</ul>
<p>参数（参数较多，下面是几个较为常用的参数）：</p>
<ul>
<li>~base_frame(string, default:”base_link”)：机器人基坐标系</li>
<li>~map_frame(string, default:”map”)：地图坐标系</li>
<li>~odom_frame(string, default:”odom”)：里程计坐标系</li>
<li>~map_update_interval(float, default: 5.0)：地图更新频率，根据指定的值设计更新间隔</li>
<li>~maxUrange(float, default: 80.0)：激光探测的最大可用范围(超出此阈值，被截断)</li>
<li>~maxRange(float)：激光探测的最大范围</li>
</ul>
<p>所需的坐标变换：</p>
<ul>
<li>雷达坐标系→基坐标系：一般由 robot_state_publisher 或 static_transform_publisher 发布</li>
<li>基坐标系→里程计坐标系：一般由里程计节点发布</li>
</ul>
<p>发布的坐标变换：</p>
<ul>
<li>地图坐标系→里程计坐标系</li>
</ul>
<p><strong>gmapping使用</strong></p>
<p>launch文件：(直接复制)</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 仿真环境下value设为true --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"use_sim_time"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gmapping节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"gmapping"</span> <span class="attr">type</span>=<span class="string">"slam_gmapping"</span> <span class="attr">name</span>=<span class="string">"slam_gmapping"</span> <span class="attr">output</span>=<span class="string">"screen"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 设置雷达话题 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">"scan"</span> <span class="attr">to</span>=<span class="string">"scan"</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 设置关键参数:坐标系 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"base_frame"</span> <span class="attr">value</span>=<span class="string">"base_footprint"</span>/&gt;</span><span class="comment">&lt;!--底盘坐标系--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"map_frame"</span> <span class="attr">value</span>=<span class="string">"map"</span>/&gt;</span> <span class="comment">&lt;!--地图坐标系--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_frame"</span> <span class="attr">value</span>=<span class="string">"odom"</span>/&gt;</span> <span class="comment">&lt;!--里程计坐标系--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"map_update_interval"</span> <span class="attr">value</span>=<span class="string">"5.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"maxUrange"</span> <span class="attr">value</span>=<span class="string">"16.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"sigma"</span> <span class="attr">value</span>=<span class="string">"0.05"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"kernelSize"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"lstep"</span> <span class="attr">value</span>=<span class="string">"0.05"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"astep"</span> <span class="attr">value</span>=<span class="string">"0.05"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"iterations"</span> <span class="attr">value</span>=<span class="string">"5"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"lsigma"</span> <span class="attr">value</span>=<span class="string">"0.075"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"ogain"</span> <span class="attr">value</span>=<span class="string">"3.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"lskip"</span> <span class="attr">value</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"srr"</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"srt"</span> <span class="attr">value</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"str"</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"stt"</span> <span class="attr">value</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"linearUpdate"</span> <span class="attr">value</span>=<span class="string">"1.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"angularUpdate"</span> <span class="attr">value</span>=<span class="string">"0.5"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"temporalUpdate"</span> <span class="attr">value</span>=<span class="string">"3.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"resampleThreshold"</span> <span class="attr">value</span>=<span class="string">"0.5"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"particles"</span> <span class="attr">value</span>=<span class="string">"30"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"xmin"</span> <span class="attr">value</span>=<span class="string">"-50.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"ymin"</span> <span class="attr">value</span>=<span class="string">"-50.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"xmax"</span> <span class="attr">value</span>=<span class="string">"50.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"ymax"</span> <span class="attr">value</span>=<span class="string">"50.0"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"delta"</span> <span class="attr">value</span>=<span class="string">"0.05"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"llsamplerange"</span> <span class="attr">value</span>=<span class="string">"0.01"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"llsamplestep"</span> <span class="attr">value</span>=<span class="string">"0.01"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"lasamplerange"</span> <span class="attr">value</span>=<span class="string">"0.005"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"lasamplestep"</span> <span class="attr">value</span>=<span class="string">"0.005"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"rviz"</span> <span class="attr">type</span>=<span class="string">"rviz"</span> <span class="attr">name</span>=<span class="string">"rviz"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可以保存 rviz 配置并后期直接使用--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;node pkg="rviz" type="rviz" name="rviz" args="-d $(find nav_demo)/config/nav.rviz"/&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>启动过程：</p>
<ol>
<li>先启动 Gazebo 仿真环境</li>
<li>然后再启动地图绘制的 launch 文件</li>
<li>启动键盘键盘控制节点，用于控制机器人运动建图</li>
<li>在 rviz 中添加组件，显示栅格地图</li>
</ol>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/slam演示.webp" alt="slam演示" style="zoom:50%;">

<p>可以通过键盘控制gazebo中的机器人运动</p>
<p>机器人跑一圈会获得完整地图数据</p>
<p>接下来要保存地图，编写一个launch文件，内容如下：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"filename"</span> <span class="attr">value</span>=<span class="string">"$(find nav_demo)/map/nav"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"map_save"</span> <span class="attr">pkg</span>=<span class="string">"map_server"</span> <span class="attr">type</span>=<span class="string">"map_saver"</span> <span class="attr">args</span>=<span class="string">"-f $(arg filename)"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>SLAM建图完毕后，执行该launch文件即可</p>
<p>在指定路径下会生成两个文件，xxx.pgm 与 xxx.yaml</p>
<p>xxx.pgm 本质是一张图片，直接使用图片查看程序即可打开</p>
<p>xxx.yaml 保存的是地图的元数据信息，用于描述图片</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明图片路径,图片也可以根据需求编辑</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">/home/ros/demo05_ws/src/nav_demo/map/nav.pgm</span></span><br><span class="line"><span class="comment"># 地图刻度尺 米/每像素</span></span><br><span class="line"><span class="attr">resolution:</span> <span class="number">0.050000</span></span><br><span class="line"><span class="comment"># 地图位姿信息(相对于rviz原点,x,y,偏航角)</span></span><br><span class="line"><span class="attr">origin:</span> [<span class="number">-50.000000</span>, <span class="number">-50.000000</span>, <span class="number">0.000000</span>]</span><br><span class="line"><span class="comment"># 白色是可通行区域，黑色是障碍物，蓝灰是未知区域</span></span><br><span class="line"><span class="comment"># 占用阈值</span></span><br><span class="line"><span class="attr">occupied_thresh:</span> <span class="number">0.65</span></span><br><span class="line"><span class="comment"># 空闲阈值</span></span><br><span class="line"><span class="attr">free_thresh:</span> <span class="number">0.196</span></span><br><span class="line"><span class="comment"># 二者结合用于判断是不是障碍物</span></span><br><span class="line"><span class="comment"># 取反</span></span><br><span class="line"><span class="attr">negate:</span> <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>

<p>map_server 中障碍物计算规则：</p>
<ol>
<li><p>地图中的每一个像素取值在 [0,255] 之间，白色为 255，黑色为 0，该值设为 x；</p>
</li>
<li><p>map_server 会将像素值作为判断是否是障碍物的依据，首先计算比例：p = (255 - x) / 255.0，白色为0，黑色为1</p>
<blockquote>
<p>negate为true，则p = x / 255.0</p>
</blockquote>
</li>
<li><p>根据步骤2计算的比例判断是否是障碍物，如果 p &gt; occupied_thresh 那么视为障碍物，如果 p &lt; free_thresh 那么视为无物</p>
</li>
</ol>
<h4 id="地图服务"><a href="#地图服务" class="headerlink" title="地图服务"></a>地图服务</h4><p><strong>map_server节点</strong></p>
<p>发布话题：</p>
<ul>
<li>map_metadata（nav_msgs / MapMetaData）：发布地图元数据</li>
<li>map（nav_msgs / OccupancyGrid）：地图数据</li>
</ul>
<p>服务：</p>
<ul>
<li>static_map（nav_msgs / GetMap）：通过此服务获取地图</li>
</ul>
<p>参数：</p>
<ul>
<li>〜frame_id（字符串，默认值：“map”）：地图坐标系</li>
</ul>
<p>通过 map_server 的 map_server 节点可以读取栅格地图数据，编写 launch 文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置地图的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"map"</span> <span class="attr">default</span>=<span class="string">"nav.yaml"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行地图服务器，并且加载设置的地图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"map_server"</span> <span class="attr">pkg</span>=<span class="string">"map_server"</span> <span class="attr">type</span>=<span class="string">"map_server"</span> <span class="attr">args</span>=<span class="string">"$(find nav_demo)/map/$(arg map)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>执行该launch文件，该节点会发布话题：map(nav_msgs/OccupancyGrid)</p>
<p>在 rviz 中使用 map 组件可以显示栅格地图</p>
<h4 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h4><p>SLAM中也包含定位算法实现，不过SLAM的定位是用于构建全局地图的，是属于导航开始之前的阶段</p>
<p>当前定位是用于导航中，机器人需要按照设定的路线运动，通过定位可以判断机器人的实际轨迹是否符合预期</p>
<p>AMCL(adaptive Monte Carlo Localization) 是用于2D移动机器人的概率定位系统，它实现了自适应（或KLD采样）蒙特卡洛定位方法，可以根据已有地图使用粒子滤波器推算机器人位置</p>
<p>amcl已经被集成到了navigation包</p>
<p>订阅的Topic：</p>
<ul>
<li><p>scan(sensor_msgs/LaserScan)：激光雷达数据</p>
</li>
<li><p>tf(tf/tfMessage)：坐标变换消息</p>
</li>
<li><p>initialpose(geometry_msgs/PoseWithCovarianceStamped)：用来初始化粒子滤波器的均值和协方差</p>
</li>
<li><p>map(nav_msgs/OccupancyGrid)：获取地图数据</p>
</li>
</ul>
<p>发布的Topic：</p>
<ul>
<li><p>amcl_pose(geometry_msgs/PoseWithCovarianceStamped)：机器人在地图中的位姿估计</p>
</li>
<li><p>particlecloud(geometry_msgs/PoseArray)：位姿估计集合，rviz中可以被 PoseArray 订阅然后图形化显示机器人的位姿估计集合。</p>
</li>
<li><p>tf(tf/tfMessage)：发布从 odom 到 map 的转换</p>
</li>
</ul>
<p>服务：</p>
<ul>
<li><p>global_localization(std_srvs/Empty)：初始化全局定位的服务</p>
</li>
<li><p>request_nomotion_update(std_srvs/Empty)：手动执行更新和发布更新的粒子的服务</p>
</li>
<li><p>set_map(nav_msgs/SetMap)：手动设置新地图和姿态的服务</p>
</li>
</ul>
<p>调用的服务：</p>
<ul>
<li>static_map(nav_msgs/GetMap)：调用此服务获取地图数据</li>
</ul>
<p>参数：</p>
<ul>
<li><p>~odom_model_type(string, default:”diff”)：里程计模型选择”diff”,”omni”,”diff-corrected”,”omni-corrected” (diff 差速、omni 全向轮)</p>
</li>
<li><p>~odom_frame_id(string, default:”odom”)：里程计坐标系</p>
</li>
<li><p>~base_frame_id(string, default:”base_link”)：机器人坐标系</p>
</li>
<li><p>~global_frame_id(string, default:”map”)：地图坐标系</p>
</li>
</ul>
<p>里程计本身也是可以协助机器人定位的，不过里程计存在累计误差且一些特殊情况时(车轮打滑)会出现定位错误的情况</p>
<p>amcl 则可以通过估算机器人在地图坐标系下的姿态，再结合里程计提高定位准确度</p>
<p><strong>编写amcl节点相关的launch文件</strong></p>
<p>找到amcl功能包的example</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roscd amcl</span><br><span class="line">ls examples/</span><br><span class="line">gedit examples/amcl_diff.launch</span><br></pre></td></tr></tbody></table></figure>

<p>修改案例</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"amcl"</span> <span class="attr">type</span>=<span class="string">"amcl"</span> <span class="attr">name</span>=<span class="string">"amcl"</span> <span class="attr">output</span>=<span class="string">"screen"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Publish scans from best pose at a max of 10 Hz --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_model_type"</span> <span class="attr">value</span>=<span class="string">"diff"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_alpha5"</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"gui_publish_rate"</span> <span class="attr">value</span>=<span class="string">"10.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_max_beams"</span> <span class="attr">value</span>=<span class="string">"30"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"min_particles"</span> <span class="attr">value</span>=<span class="string">"500"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"max_particles"</span> <span class="attr">value</span>=<span class="string">"5000"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"kld_err"</span> <span class="attr">value</span>=<span class="string">"0.05"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"kld_z"</span> <span class="attr">value</span>=<span class="string">"0.99"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_alpha1"</span> <span class="attr">value</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_alpha2"</span> <span class="attr">value</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- translation std dev, m --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_alpha3"</span> <span class="attr">value</span>=<span class="string">"0.8"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_alpha4"</span> <span class="attr">value</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_z_hit"</span> <span class="attr">value</span>=<span class="string">"0.5"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_z_short"</span> <span class="attr">value</span>=<span class="string">"0.05"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_z_max"</span> <span class="attr">value</span>=<span class="string">"0.05"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_z_rand"</span> <span class="attr">value</span>=<span class="string">"0.5"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_sigma_hit"</span> <span class="attr">value</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_lambda_short"</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_model_type"</span> <span class="attr">value</span>=<span class="string">"likelihood_field"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;param name="laser_model_type" value="beam"/&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"laser_likelihood_max_dist"</span> <span class="attr">value</span>=<span class="string">"2.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"update_min_d"</span> <span class="attr">value</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"update_min_a"</span> <span class="attr">value</span>=<span class="string">"0.5"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 里程计坐标系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"odom_frame_id"</span> <span class="attr">value</span>=<span class="string">"odom"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置机器人坐标系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"base_frame_id"</span> <span class="attr">value</span>=<span class="string">"base_footprint"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 地图坐标系默认,不写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"resample_interval"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"transform_tolerance"</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"recovery_alpha_slow"</span> <span class="attr">value</span>=<span class="string">"0.0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"recovery_alpha_fast"</span> <span class="attr">value</span>=<span class="string">"0.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>编写测试launch文件</p>
<p>amcl节点是不可以单独运行的，运行 amcl 节点之前，需要先加载全局地图，然后启动 rviz 显示定位结果，上述节点可以集成进launch文件</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"rviz"</span> <span class="attr">pkg</span>=<span class="string">"rviz"</span> <span class="attr">type</span>=<span class="string">"rviz"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动地图服务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/launch/nav03_map_server.launch"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- amcl --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/launch/nav04_amcl.launch"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>执行：</p>
<ol>
<li>先启动 Gazebo 仿真环境</li>
<li>启动键盘控制节点</li>
<li>启动集成地图服务、amcl 与 rviz 的 launch 文件</li>
<li>在启动的 rviz 中，添加RobotModel、Map组件，分别显示机器人模型与地图，添加 posearray 插件，设置topic为particlecloud来显示 amcl 预估的当前机器人的位姿，箭头越是密集，说明当前机器人处于此位置的概率越高</li>
<li>通过键盘控制机器人运动，会发现 posearray 也随之而改变</li>
</ol>
<h4 id="路径规划"><a href="#路径规划" class="headerlink" title="路径规划"></a>路径规划</h4><p>在ROS的导航功能包集navigation中提供了 move_base 功能包，用于实现此功能，包在之前已经安装</p>
<p>move_base 功能包提供了基于<font color="Violetred">动作(action)</font>的路径规划实现，move_base 可以根据给定的目标点，控制机器人底盘运动至目标位置，并且在运动过程中会连续反馈机器人自身的姿态与目标点的状态信息</p>
<blockquote>
<p>Actions 是一种客户端/服务器 (Client/Server) 模式的通信方式，专为<strong>长时间运行、可抢占的任务</strong>而设计，并提供<strong>进度反馈</strong>和<strong>结果</strong></p>
<p>Actions 实际上是建立在 Topics 和 Services (服务) 之上的更高级别的抽象</p>
</blockquote>
<p>move_base主要由全局路径规划与本地路径规划组成</p>
<p>move_base功能包中的核心节点是：move_base</p>
<p>动作订阅：</p>
<ul>
<li><p>move_base/goal(move_base_msgs/MoveBaseActionGoal)：move_base 的运动规划目标</p>
</li>
<li><p>move_base/cancel(actionlib_msgs/GoalID)：取消目标</p>
</li>
</ul>
<p>动作发布：</p>
<ul>
<li><p>move_base/feedback(move_base_msgs/MoveBaseActionFeedback)：连续反馈的信息，包含机器人底盘坐标</p>
</li>
<li><p>move_base/status(actionlib_msgs/GoalStatusArray)：发送到move_base的目标状态信息</p>
</li>
<li><p>move_base/result(move_base_msgs/MoveBaseActionResult)：操作结果(此处为空)</p>
</li>
</ul>
<p>订阅的Topic：</p>
<ul>
<li>move_base_simple/goal(geometry_msgs/PoseStamped)：运动规划目标(与action相比，没有连续反馈，无法追踪机器人执行状态)</li>
</ul>
<p>发布的Topic：</p>
<ul>
<li>cmd_vel(geometry_msgs/Twist)：输出到机器人底盘的运动控制消息</li>
</ul>
<p>服务：</p>
<ul>
<li><p>~make_plan(nav_msgs/GetPlan)：请求该服务，可以获取给定目标的规划路径，但是并不执行该路径规划</p>
</li>
<li><p>~clear_unknown_space(std_srvs/Empty)：允许用户直接清除机器人周围的未知空间</p>
</li>
<li><p>~clear_costmaps(std_srvs/Empty)：允许清除代价地图中的障碍物，可能会导致机器人与障碍物碰撞，请慎用</p>
</li>
</ul>
<h5 id="代价地图"><a href="#代价地图" class="headerlink" title="代价地图"></a>代价地图</h5><p>ROS中的地图其实就是一张图片，这张图片有宽度、高度、分辨率等元数据，在图片中使用灰度值来表示障碍物存在的概率</p>
<p>SLAM构建的地图在导航中是不可以直接使用的：</p>
<ol>
<li>SLAM构建的地图是静态地图，而导航过程中，障碍物信息是可变的，导航中需要时时获取障碍物信息；</li>
<li>在靠近障碍物边缘时，机器人可能由于惯性、不规则形体会与障碍物产生碰撞，所以最好在地图的障碍物边缘设置警戒区</li>
</ol>
<p>因此静态地图无法直接应用于导航，其基础之上需要添加一些辅助信息的地图</p>
<p><strong>组成</strong></p>
<p>代价地图有两张：global_costmap(全局代价地图) 和 local_costmap(本地代价地图)，前者用于全局路径规划，后者用于本地路径规划</p>
<p>两张代价地图都可以多层叠加：</p>
<ol>
<li>静态地图层，SLAM构建的静态地图</li>
<li>障碍地图层，传感器感知的障碍物信息</li>
<li>膨胀层，在以上两层地图上进行膨胀（向外扩张），以避免机器人的外壳会撞上障碍物</li>
<li>自定义层，根据业务自设计的地图数据</li>
</ol>
<p><strong>碰撞算法</strong></p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/碰撞算法.webp" alt="碰撞算法" style="zoom:50%;">

<p>上图中，横轴是距离机器人中心的距离，纵轴是代价地图中栅格的灰度值</p>
<ul>
<li>致命障碍：栅格值为254，此时障碍物与机器人中心重叠，必然发生碰撞；</li>
<li>内切障碍：栅格值为253，此时障碍物处于机器人的内切圆内，必然发生碰撞；</li>
<li>外切障碍：栅格值为[128,252]，此时障碍物处于其机器人的外切圆内，处于碰撞临界，不一定发生碰撞；</li>
<li>非自由空间：栅格值为(0,127]，此时机器人处于障碍物附近，属于危险警戒区，进入此区域，将来可能会发生碰撞；</li>
<li>自由区域：栅格值为0，此处机器人可以自由通过；</li>
<li>未知区域：栅格值为255，还没探明是否有障碍物</li>
</ul>
<h5 id="move-base使用"><a href="#move-base使用" class="headerlink" title="move_base使用"></a>move_base使用</h5><p><strong>launch文件模板</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"move_base"</span> <span class="attr">type</span>=<span class="string">"move_base"</span> <span class="attr">respawn</span>=<span class="string">"false"</span> <span class="attr">name</span>=<span class="string">"move_base"</span> <span class="attr">output</span>=<span class="string">"screen"</span> <span class="attr">clear_params</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- costmap_common_params.yaml 加载到两个空间 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/param/costmap_common_params.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span> <span class="attr">ns</span>=<span class="string">"global_costmap"</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/param/costmap_common_params.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span> <span class="attr">ns</span>=<span class="string">"local_costmap"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/param/local_costmap_params.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/param/global_costmap_params.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/param/base_local_planner_params.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>启动了 move_base 功能包下的 move_base 节点，respawn 为 false，意味着该节点关闭后，不会被重启；</p>
<p>clear_params 为 true，意味着每次启动该节点都要清空私有参数然后重新载入；</p>
<p><strong>配置文件</strong></p>
<p>关于配置文件的编写，可以参考一些成熟的机器人的路径规划实现</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ROBOTIS-GIT/turtlebot3">ROBOTIS-GIT/turtlebot3: ROS packages for Turtlebot3</a></p>
<p><font color="Violetred">costmap_common_params.yaml</font></p>
<p>该文件是move_base 在全局路径规划与本地路径规划时调用的通用参数，包括：机器人的尺寸、距离障碍物的安全距离、传感器信息等</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#机器人几何参，如果机器人是圆形，设置 robot_radius,如果是其他形状设置 footprint</span></span><br><span class="line"><span class="attr">robot_radius:</span> <span class="number">0.12</span> <span class="comment">#圆形</span></span><br><span class="line"><span class="comment"># footprint: [[-0.12, -0.12], [-0.12, 0.12], [0.12, 0.12], [0.12, -0.12]] #案例是方形，四个点的坐标</span></span><br><span class="line"></span><br><span class="line"><span class="attr">obstacle_range:</span> <span class="number">3.0</span> <span class="comment"># 用于障碍物探测，比如: 值为 3.0，意味着检测到距离小于 3 米的障碍物时，就会引入代价地图</span></span><br><span class="line"><span class="attr">raytrace_range:</span> <span class="number">3.5</span> <span class="comment"># 用于清除障碍物，比如：值为 3.5，意味着清除代价地图中 3.5 米以外的障碍物</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#膨胀半径，扩展在碰撞区域以外的代价区域，使得机器人规划路径避开障碍物</span></span><br><span class="line"><span class="attr">inflation_radius:</span> <span class="number">0.2</span></span><br><span class="line"><span class="comment">#代价比例系数，越大则代价值越小</span></span><br><span class="line"><span class="attr">cost_scaling_factor:</span> <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#地图类型</span></span><br><span class="line"><span class="attr">map_type:</span> <span class="string">costmap</span></span><br><span class="line"><span class="comment">#导航包所需要的传感器</span></span><br><span class="line"><span class="attr">observation_sources:</span> <span class="string">scan</span></span><br><span class="line"><span class="comment">#对传感器的坐标系和数据进行配置。这个也会用于代价地图添加和清除障碍物。例如，你可以用激光雷达传感器用于在代价地图添加障碍物，再添加kinect用于导航和清除障碍物。</span></span><br><span class="line"><span class="attr">scan:</span> {<span class="attr">sensor_frame:</span> <span class="string">laser</span>, <span class="attr">data_type:</span> <span class="string">LaserScan</span>, <span class="attr">topic:</span> <span class="string">scan</span>, <span class="attr">marking:</span> <span class="literal">true</span>, <span class="attr">clearing:</span> <span class="literal">true</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>global_costmap_params.yaml</p>
<p>该文件用于全局代价地图参数设置：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global_costmap:</span></span><br><span class="line">  <span class="attr">global_frame:</span> <span class="string">map</span> <span class="comment">#地图坐标系</span></span><br><span class="line">  <span class="attr">robot_base_frame:</span> <span class="string">base_footprint</span> <span class="comment">#机器人坐标系</span></span><br><span class="line">  <span class="comment"># 以此实现坐标变换</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">update_frequency:</span> <span class="number">1.0</span> <span class="comment">#代价地图更新频率，全局地图频率不会太高</span></span><br><span class="line">  <span class="attr">publish_frequency:</span> <span class="number">1.0</span> <span class="comment">#代价地图的发布频率</span></span><br><span class="line">  <span class="attr">transform_tolerance:</span> <span class="number">0.5</span> <span class="comment">#等待坐标变换发布信息的超时时间，一般不大于0.5</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">static_map:</span> <span class="literal">true</span> <span class="comment"># 是否使用一个地图或者地图服务器来初始化全局代价地图，如果不使用静态地图，这个参数为false.</span></span><br></pre></td></tr></tbody></table></figure>

<p>local_costmap_params.yaml</p>
<p>该文件用于局部代价地图参数设置：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">local_costmap:</span></span><br><span class="line">  <span class="attr">global_frame:</span> <span class="string">odom</span> <span class="comment">#里程计坐标系</span></span><br><span class="line">  <span class="attr">robot_base_frame:</span> <span class="string">base_footprint</span> <span class="comment">#机器人坐标系</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">update_frequency:</span> <span class="number">10.0</span> <span class="comment">#代价地图更新频率，局部地图要大一些</span></span><br><span class="line">  <span class="attr">publish_frequency:</span> <span class="number">10.0</span> <span class="comment">#代价地图的发布频率</span></span><br><span class="line">  <span class="attr">transform_tolerance:</span> <span class="number">0.5</span> <span class="comment">#等待坐标变换发布信息的超时时间</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">static_map:</span> <span class="literal">false</span>  <span class="comment">#不需要静态地图，可以提升导航效果</span></span><br><span class="line">  <span class="attr">rolling_window:</span> <span class="literal">true</span> <span class="comment">#是否使用动态窗口，默认为false，在静态的全局地图中，地图不会变化</span></span><br><span class="line">  <span class="attr">width:</span> <span class="number">3</span> <span class="comment"># 局部地图宽度 单位是 m</span></span><br><span class="line">  <span class="attr">height:</span> <span class="number">3</span> <span class="comment"># 局部地图高度 单位是 m</span></span><br><span class="line">  <span class="attr">resolution:</span> <span class="number">0.05</span> <span class="comment"># 局部地图分辨率 单位是 m，一般与静态地图分辨率保持一致</span></span><br></pre></td></tr></tbody></table></figure>

<p>base_local_planner_params</p>
<p>基本的局部规划器参数配置，这个配置文件设定了机器人的最大和最小速度限制值，也设定了加速度的阈值</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">TrajectoryPlannerROS:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Robot Configuration Parameters</span></span><br><span class="line">  <span class="attr">max_vel_x:</span> <span class="number">0.5</span> <span class="comment"># X 方向最大速度</span></span><br><span class="line">  <span class="attr">min_vel_x:</span> <span class="number">0.1</span> <span class="comment"># X 方向最小速速</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">max_vel_theta:</span>  <span class="number">1.0</span> <span class="comment"># 角速度</span></span><br><span class="line">  <span class="attr">min_vel_theta:</span> <span class="number">-1.0</span></span><br><span class="line">  <span class="attr">min_in_place_vel_theta:</span> <span class="number">1.0</span> <span class="comment"># 原地旋转角速度</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">acc_lim_x:</span> <span class="number">1.0</span> <span class="comment"># X 加速限制</span></span><br><span class="line">  <span class="attr">acc_lim_y:</span> <span class="number">0.0</span> <span class="comment"># Y 加速限制</span></span><br><span class="line">  <span class="attr">acc_lim_theta:</span> <span class="number">0.6</span> <span class="comment"># 角速度加速限制</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Goal Tolerance Parameters，目标公差</span></span><br><span class="line">  <span class="attr">xy_goal_tolerance:</span> <span class="number">0.10</span></span><br><span class="line">  <span class="attr">yaw_goal_tolerance:</span> <span class="number">0.05</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Differential-drive robot configuration</span></span><br><span class="line"><span class="comment"># 是否是全向移动机器人</span></span><br><span class="line">  <span class="attr">holonomic_robot:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Forward Simulation Parameters，前进模拟参数</span></span><br><span class="line">  <span class="attr">sim_time:</span> <span class="number">0.8</span> <span class="comment"># 大一些会让局部路径规划贴近全局</span></span><br><span class="line">  <span class="attr">vx_samples:</span> <span class="number">18</span></span><br><span class="line">  <span class="attr">vtheta_samples:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">sim_granularity:</span> <span class="number">0.05</span></span><br></pre></td></tr></tbody></table></figure>

<p>以上配置在实操中，可能会出现机器人在本地路径规划时与全局路径规划不符而进入膨胀区域出现假死的情况，如何尽量避免这种情形呢？</p>
<p>可以采用不同的参数设置策略:</p>
<ul>
<li>全局代价地图可以将膨胀半径和障碍物系数设置的偏大一些</li>
<li>本地代价地图可以将膨胀半径和障碍物系数设置的偏小一些</li>
</ul>
<p>这样，在全局路径规划时，规划的路径会尽量远离障碍物，而本地路径规划时，机器人即便偏离全局路径也会和障碍物之间保留更大的自由空间，从而避免了陷入“假死”的情形</p>
<p><strong>launch文件集成</strong></p>
<p>如果要实现导航，需要集成地图服务、amcl 、move_base 与 Rviz 等</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 地图服务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/launch/nav03_map_server.launch"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动AMCL节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/launch/nav04_amcl.launch"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行move_base节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/launch/nav05_path.launch"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 运行rviz --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">type</span>=<span class="string">"joint_state_publisher"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">output</span>=<span class="string">"screen"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">"rviz"</span> <span class="attr">type</span>=<span class="string">"rviz"</span> <span class="attr">name</span>=<span class="string">"rviz"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>1.先启动 Gazebo 仿真环境(此过程略)；</p>
<p>2.启动导航相关的 launch 文件；</p>
<p>3.添加Rviz组件(参考演示结果),可以将配置数据保存，后期直接调用；</p>
<p>全局代价地图与本地代价地图组件配置如下：</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/rviz代价地图.webp" alt="rviz代价地图" style="zoom: 67%;">

<p>全局路径规划与本地路径规划组件配置如下：</p>
<img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/YJS1/rviz路径规划.webp" alt="rviz路径规划" style="zoom:67%;">

<p>4.通过Rviz工具栏的 2D Nav Goal设置目的地实现导航</p>
<p>5.可以在导航过程中，添加新的障碍物，机器人也可以自动躲避障碍物</p>
<h4 id="导航与SLAM建图"><a href="#导航与SLAM建图" class="headerlink" title="导航与SLAM建图"></a>导航与SLAM建图</h4><p>在SLAM建图中是通过键盘控制来实现的，现在想结合自主移动来实现建图</p>
<p>之前导航实现时，是通过 map_server 包的 map_server 节点来发布地图信息的，如果不先通过SLAM建图，那么如何发布地图信息呢？</p>
<p>SLAM建图过程中本身就会时时发布地图信息，所以无需再使用map_server，且导航需要定位模块，SLAM本身也是可以实现定位的</p>
<p>launch文件：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 集成SLAM与导航,实现自主移动的地图构建 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SLAM实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/launch/nav01_slam.launch"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航move_base --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find nav_demo)/launch/nav05_path.launch"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>1.首先运行gazebo仿真环境；</p>
<p>2.然后执行launch文件；</p>
<p>3.在rviz中通过2D Nav Goal设置目标点，机器人开始自主移动并建图了；</p>
<p>4.最后可以使用 map_server 保存地图</p>
<h3 id="导航相关消息"><a href="#导航相关消息" class="headerlink" title="导航相关消息"></a>导航相关消息</h3><p>在上一节的实现中，这些消息已经在rviz中做了可视化处理，比如：地图、雷达、摄像头、里程计、路径规划…的相关消息在rviz中提供了相关组件，本节主要介绍这些消息的具体格式</p>
<h4 id="地图"><a href="#地图" class="headerlink" title="地图"></a>地图</h4><p>地图相关的消息主要有两个：</p>
<ul>
<li><p>nav_msgs/MapMetaData：地图元数据，包括地图的宽度、高度、分辨率等。</p>
</li>
<li><p>nav_msgs/OccupancyGrid：地图栅格数据，一般会在rviz中以图形化的方式显示</p>
</li>
</ul>
<p><strong>nav_msgs/MapMetaData</strong></p>
<p>调用<code>rosmsg info nav_msgs/MapMetaData</code>显示消息内容如下</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">time map_load_time</span><br><span class="line">float32 resolution #地图分辨率</span><br><span class="line">uint32 width #地图宽度</span><br><span class="line">uint32 height #地图高度</span><br><span class="line">geometry_msgs/Pose origin #地图位姿数据</span><br><span class="line">  geometry_msgs/Point position</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">  geometry_msgs/Quaternion orientation</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">    float64 w</span><br></pre></td></tr></tbody></table></figure>

<p>在地图数据中，未知区域为-1，白色为 255，黑色为 0，map_server 会将像素值作为判断是否是障碍物的依据</p>
<p><strong>nav_msgs/OccupancyGrid</strong></p>
<p>调用 <code>rosmsg info nav_msgs/OccupancyGrid</code>显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">#--- 地图元数据</span><br><span class="line">nav_msgs/MapMetaData info</span><br><span class="line">  time map_load_time</span><br><span class="line">  float32 resolution</span><br><span class="line">  uint32 width</span><br><span class="line">  uint32 height</span><br><span class="line">  geometry_msgs/Pose origin</span><br><span class="line">    geometry_msgs/Point position</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion orientation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br><span class="line">#--- 地图内容数据，数组长度 = width * height</span><br><span class="line">int8[] data</span><br></pre></td></tr></tbody></table></figure>

<p>值为0-100，判断风险，未知和空闲区域都为0</p>
<h4 id="里程计"><a href="#里程计" class="headerlink" title="里程计"></a>里程计</h4><p>里程计相关消息是:nav_msgs/Odometry，调用<code>rosmsg info nav_msgs/Odometry</code> 显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">string child_frame_id</span><br><span class="line">geometry_msgs/PoseWithCovariance pose</span><br><span class="line">  geometry_msgs/Pose pose #里程计位姿</span><br><span class="line">    geometry_msgs/Point position</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion orientation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br><span class="line">  float64[36] covariance</span><br><span class="line">geometry_msgs/TwistWithCovariance twist</span><br><span class="line">  geometry_msgs/Twist twist #速度</span><br><span class="line">    geometry_msgs/Vector3 linear</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Vector3 angular</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z    </span><br><span class="line">  # 协方差矩阵</span><br><span class="line">  float64[36] covariance</span><br></pre></td></tr></tbody></table></figure>

<h4 id="坐标变换"><a href="#坐标变换" class="headerlink" title="坐标变换"></a>坐标变换</h4><p>坐标变换相关消息是: tf/tfMessage，调用<code>rosmsg info tf/tfMessage</code> 显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">geometry_msgs/TransformStamped[] transforms #包含了多个坐标系相对关系数据的数组</span><br><span class="line">  std_msgs/Header header</span><br><span class="line">    uint32 seq</span><br><span class="line">    time stamp</span><br><span class="line">    string frame_id</span><br><span class="line">  string child_frame_id</span><br><span class="line">  geometry_msgs/Transform transform</span><br><span class="line">    geometry_msgs/Vector3 translation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion rotation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br></pre></td></tr></tbody></table></figure>

<h4 id="定位-1"><a href="#定位-1" class="headerlink" title="定位"></a>定位</h4><p>定位相关消息是:geometry_msgs/PoseArray，调用<code>rosmsg info geometry_msgs/PoseArray</code>显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">geometry_msgs/Pose[] poses #预估的点位姿组成的数组</span><br><span class="line">  geometry_msgs/Point position</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">  geometry_msgs/Quaternion orientation</span><br><span class="line">    float64 x</span><br><span class="line">    float64 y</span><br><span class="line">    float64 z</span><br><span class="line">    float64 w</span><br></pre></td></tr></tbody></table></figure>

<h4 id="目标点与路径规划"><a href="#目标点与路径规划" class="headerlink" title="目标点与路径规划"></a>目标点与路径规划</h4><p>目标点相关消息是:move_base_msgs/MoveBaseActionGoal，调用<code>rosmsg info move_base_msgs/MoveBaseActionGoal</code>显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">actionlib_msgs/GoalID goal_id</span><br><span class="line">  time stamp</span><br><span class="line">  string id</span><br><span class="line">move_base_msgs/MoveBaseGoal goal</span><br><span class="line">  geometry_msgs/PoseStamped target_pose</span><br><span class="line">    std_msgs/Header header</span><br><span class="line">      uint32 seq</span><br><span class="line">      time stamp</span><br><span class="line">      string frame_id</span><br><span class="line">    geometry_msgs/Pose pose #目标点位姿</span><br><span class="line">      geometry_msgs/Point position</span><br><span class="line">        float64 x</span><br><span class="line">        float64 y</span><br><span class="line">        float64 z</span><br><span class="line">      geometry_msgs/Quaternion orientation</span><br><span class="line">        float64 x</span><br><span class="line">        float64 y</span><br><span class="line">        float64 z</span><br><span class="line">        float64 w</span><br></pre></td></tr></tbody></table></figure>

<p>路径规划相关消息是:nav_msgs/Path，调用<code>rosmsg info nav_msgs/Path</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">geometry_msgs/PoseStamped[] poses #由一系列点组成的数组</span><br><span class="line">  std_msgs/Header header</span><br><span class="line">    uint32 seq</span><br><span class="line">    time stamp</span><br><span class="line">    string frame_id</span><br><span class="line">  geometry_msgs/Pose pose</span><br><span class="line">    geometry_msgs/Point position</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">    geometry_msgs/Quaternion orientation</span><br><span class="line">      float64 x</span><br><span class="line">      float64 y</span><br><span class="line">      float64 z</span><br><span class="line">      float64 w</span><br></pre></td></tr></tbody></table></figure>

<h4 id="激光雷达"><a href="#激光雷达" class="headerlink" title="激光雷达"></a>激光雷达</h4><p>激光雷达相关消息是：sensor_msgs/LaserScan，调用<code>rosmsg info sensor_msgs/LaserScan</code>显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">float32 angle_min #起始扫描角度(rad)</span><br><span class="line">float32 angle_max #终止扫描角度(rad)</span><br><span class="line">float32 angle_increment #测量值之间的角距离(rad)</span><br><span class="line">float32 time_increment #测量间隔时间(s)</span><br><span class="line">float32 scan_time #扫描间隔时间(s)</span><br><span class="line">float32 range_min #最小有效距离值(m)</span><br><span class="line">float32 range_max #最大有效距离值(m)</span><br><span class="line">float32[] ranges #一个周期的扫描数据</span><br><span class="line">float32[] intensities #扫描强度数据，如果设备不支持强度数据，该数组为空</span><br></pre></td></tr></tbody></table></figure>

<h4 id="相机"><a href="#相机" class="headerlink" title="相机"></a>相机</h4><p>深度相机相关消息有:sensor_msgs/Image、sensor_msgs/CompressedImage、sensor_msgs/PointCloud2</p>
<p>sensor_msgs/Image 对应的一般的图像数据</p>
<p>调用<code>rosmsg info sensor_msgs/Image</code>显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">uint32 height #高度</span><br><span class="line">uint32 width  #宽度</span><br><span class="line">string encoding #编码格式:RGB、YUV等</span><br><span class="line">uint8 is_bigendian #图像大小端存储模式</span><br><span class="line">uint32 step #一行图像数据的字节数，作为步进参数</span><br><span class="line">uint8[] data #图像数据，长度等于 step * height</span><br></pre></td></tr></tbody></table></figure>

<p>sensor_msgs/CompressedImage 对应压缩后的图像数据</p>
<p>调用<code>rosmsg info sensor_msgs/CompressedImage</code>显示消息内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">string format #压缩编码格式(jpeg、png、bmp)</span><br><span class="line">uint8[] data #压缩后的数据</span><br></pre></td></tr></tbody></table></figure>

<p>sensor_msgs/PointCloud2 对应的是点云数据(带有深度信息的图像数据)</p>
<p>调用<code>rosmsg info sensor_msgs/PointCloud2</code>显示消息内容如下:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">  uint32 seq</span><br><span class="line">  time stamp</span><br><span class="line">  string frame_id</span><br><span class="line">uint32 height #高度</span><br><span class="line">uint32 width  #宽度</span><br><span class="line">sensor_msgs/PointField[] fields #每个点的数据类型</span><br><span class="line">  uint8 INT8=1</span><br><span class="line">  uint8 UINT8=2</span><br><span class="line">  uint8 INT16=3</span><br><span class="line">  uint8 UINT16=4</span><br><span class="line">  uint8 INT32=5</span><br><span class="line">  uint8 UINT32=6</span><br><span class="line">  uint8 FLOAT32=7</span><br><span class="line">  uint8 FLOAT64=8</span><br><span class="line">  string name</span><br><span class="line">  uint32 offset</span><br><span class="line">  uint8 datatype</span><br><span class="line">  uint32 count</span><br><span class="line">bool is_bigendian #图像大小端存储模式</span><br><span class="line">uint32 point_step #单点的数据字节步长</span><br><span class="line">uint32 row_step   #一行数据的字节步长</span><br><span class="line">uint8[] data      #存储点云的数组，总长度为 row_step * height</span><br><span class="line">bool is_dense     #是否有无效点</span><br></pre></td></tr></tbody></table></figure>

<h4 id="深度图像转激光数据"><a href="#深度图像转激光数据" class="headerlink" title="深度图像转激光数据"></a>深度图像转激光数据</h4><p>在诸多SLAM算法中，一般都需要订阅激光雷达数据用于构建地图，因为激光雷达可以感知周围环境的深度信息</p>
<p>深度相机也具备感知深度信息的功能，且最初激光雷达价格比价比较昂贵，可以选用深度相机代替激光雷达</p>
<p>不过二者发布的消息类型是完全不同的，如果想要实现传感器的置换，那么就需要将深度相机发布的三维的图形信息转换成二维的激光雷达信息</p>
<p>这一功能就是通过depthimage_to_laserscan来实现的</p>
<p><strong>缺点</strong>：深度相机较之于激光雷达无论是检测范围还是精度都有不小的差距，SLAM效果可能不如激光雷达理想</p>
<p>安装包：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-noetic-depthimage-to-laserscan</span><br></pre></td></tr></tbody></table></figure>

<p>但随着时间发展其实激光雷达价格已经下来了，这一节内容略</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://yhblogs.cn">今天睡够了吗</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://yhblogs.cn/posts/3254549402.html">http://yhblogs.cn/posts/3254549402.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yhblogs.cn" target="_blank">がんばろう</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%F0%9F%A4%96ROS/">🤖ROS</a></div><div class="post_share"><div class="social-share" data-image="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-1q83qg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2715330630.html" title="秦皇岛出游"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-4996q1_compressed.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">秦皇岛出游</div></div></a></div><div class="next-post pull-right"><a href="/posts/626062709.html" title="ROS基础知识"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/ros-logo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ROS基础知识</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/3894864178.html" title="ROS2理论"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/wallhaven-5g22q5_1920x1080_compressed.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-30</div><div class="title">ROS2理论</div></div></a></div><div><a href="/posts/626062709.html" title="ROS基础知识"><img class="cover" src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/ros-logo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-19</div><div class="title">ROS基础知识</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/b_2a1aef95f351a5f7ef72eb81e6838fd6.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">今天睡够了吗</div><div class="author-info__description">相遇是最小单位的奇迹</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/202206071549233.webp" target="_blank" title="QQ"><i class="iconfont icon-QQ"></i></a><a class="social-icon" href="https://wuyaohui06022.oss-cn-chengdu.aliyuncs.com/blogwebp/202206071549234.webp" target="_blank" title="微信"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://space.bilibili.com/277953459?spm_id_from=333.1007.0.0" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="https://github.com/YaoHui-Wu06022" target="_blank" title="Github"><i class="iconfont icon-GitHub"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">保持理智，相信明天</div><div class="twopeople"><div class="twopeople"><div class="container" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div> <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script> <script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script> <script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script> <style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F"><span class="toc-number">1.</span> <span class="toc-text">机器人系统仿真</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#URDF%E9%9B%86%E6%88%90Rviz"><span class="toc-number">1.1.</span> <span class="toc-text">URDF集成Rviz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URDF%E8%AF%AD%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">URDF语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#link"><span class="toc-number">1.2.1.</span> <span class="toc-text">link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#joint"><span class="toc-number">1.2.2.</span> <span class="toc-text">joint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#urdf%E5%AE%9E%E6%93%8D"><span class="toc-number">1.2.3.</span> <span class="toc-text">urdf实操</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#urdf%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.4.</span> <span class="toc-text">urdf工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URDF%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">URDF优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Xacro%E4%BD%93%E9%AA%8C"><span class="toc-number">1.3.1.</span> <span class="toc-text">Xacro体验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Xacro%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.2.</span> <span class="toc-text">Xacro语法详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Xacro%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">Xacro完整使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Xacro%E5%AE%9E%E6%93%8D"><span class="toc-number">1.3.4.</span> <span class="toc-text">Xacro实操</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rviz%E6%8E%A7%E5%88%B6%E8%BF%90%E5%8A%A8"><span class="toc-number">1.4.</span> <span class="toc-text">Rviz控制运动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URDF%E9%9B%86%E6%88%90Gazebo"><span class="toc-number">1.5.</span> <span class="toc-text">URDF集成Gazebo</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%9B%86%E6%88%90%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">基本集成流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.5.2.</span> <span class="toc-text">相关设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D"><span class="toc-number">1.5.3.</span> <span class="toc-text">实操</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BF%E7%9C%9F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.5.4.</span> <span class="toc-text">仿真环境搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URDF%E3%80%81Gazebo%E4%B8%8ERviz%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.</span> <span class="toc-text">URDF、Gazebo与Rviz综合应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%BF%90%E5%8A%A8%E6%8E%A7%E5%88%B6"><span class="toc-number">1.6.1.</span> <span class="toc-text">机器人运动控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rviz%E6%9F%A5%E7%9C%8B%E9%87%8C%E7%A8%8B%E8%AE%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.2.</span> <span class="toc-text">Rviz查看里程计信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%B7%E8%BE%BE%E4%BF%A1%E6%81%AF%E4%BB%BF%E7%9C%9F"><span class="toc-number">1.6.3.</span> <span class="toc-text">雷达信息仿真</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E4%BF%A1%E6%81%AF%E4%BB%BF%E7%9C%9F"><span class="toc-number">1.6.4.</span> <span class="toc-text">摄像头信息仿真</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kinect%E4%BF%A1%E6%81%AF%E4%BB%BF%E7%9C%9F"><span class="toc-number">1.6.5.</span> <span class="toc-text">kinect信息仿真</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA-%E4%BB%BF%E7%9C%9F"><span class="toc-number">2.</span> <span class="toc-text">机器人导航(仿真)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E6%A8%A1%E5%9D%97%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">导航模块简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E4%B9%8B%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="toc-number">2.1.2.</span> <span class="toc-text">导航之坐标系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E6%9D%A1%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">2.1.3.</span> <span class="toc-text">导航条件说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.2.</span> <span class="toc-text">导航实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SLAM%E5%BB%BA%E5%9B%BE"><span class="toc-number">2.2.1.</span> <span class="toc-text">SLAM建图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.2.2.</span> <span class="toc-text">地图服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D"><span class="toc-number">2.2.3.</span> <span class="toc-text">定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92"><span class="toc-number">2.2.4.</span> <span class="toc-text">路径规划</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">代价地图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#move-base%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">move_base使用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E4%B8%8ESLAM%E5%BB%BA%E5%9B%BE"><span class="toc-number">2.2.5.</span> <span class="toc-text">导航与SLAM建图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E7%9B%B8%E5%85%B3%E6%B6%88%E6%81%AF"><span class="toc-number">2.3.</span> <span class="toc-text">导航相关消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE"><span class="toc-number">2.3.1.</span> <span class="toc-text">地图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8C%E7%A8%8B%E8%AE%A1"><span class="toc-number">2.3.2.</span> <span class="toc-text">里程计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-number">2.3.3.</span> <span class="toc-text">坐标变换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D-1"><span class="toc-number">2.3.4.</span> <span class="toc-text">定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E7%82%B9%E4%B8%8E%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92"><span class="toc-number">2.3.5.</span> <span class="toc-text">目标点与路径规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE"><span class="toc-number">2.3.6.</span> <span class="toc-text">激光雷达</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E6%9C%BA"><span class="toc-number">2.3.7.</span> <span class="toc-text">相机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%83%8F%E8%BD%AC%E6%BF%80%E5%85%89%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.8.</span> <span class="toc-text">深度图像转激光数据</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2022 - 2025 By 今天睡够了吗</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">You must always have faith in who you are！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>